!function(t){function e(e){for(var r,o,i=e[0],s=e[1],c=e[2],f=0,d=[];f<i.length;f++)o=i[f],a[o]&&d.push(a[o][0]),a[o]=0;for(r in s)Object.prototype.hasOwnProperty.call(s,r)&&(t[r]=s[r]);for(u&&u(e);d.length;)d.shift()();return l.push.apply(l,c||[]),n()}function n(){for(var t,e=0;e<l.length;e++){for(var n=l[e],r=!0,i=1;i<n.length;i++){var s=n[i];0!==a[s]&&(r=!1)}r&&(l.splice(e--,1),t=o(o.s=n[0]))}return t}var r={},a={0:0},l=[];function o(e){if(r[e])return r[e].exports;var n=r[e]={i:e,l:!1,exports:{}};return t[e].call(n.exports,n,n.exports,o),n.l=!0,n.exports}o.m=t,o.c=r,o.d=function(t,e,n){o.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},o.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},o.t=function(t,e){if(1&e&&(t=o(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)o.d(n,r,function(e){return t[e]}.bind(null,r));return n},o.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return o.d(e,"a",e),e},o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},o.p="/Evo-Bio-Design-Study/";var i=window.webpackJsonp=window.webpackJsonp||[],s=i.push.bind(i);i.push=e,i=i.slice();for(var c=0;c<i.length;c++)e(i[c]);var u=s;l.push([141,1]),n()}({141:function(t,e,n){"use strict";n.r(e);n(11),n(19),n(20),n(13),n(21),n(113),n(14),n(59),n(60),n(35);var r=n(0);function a(t,e,n,r,a,l,o){try{var i=t[l](o),s=i.value}catch(t){return void n(t)}i.done?e(s):Promise.resolve(s).then(r,a)}function l(t,e,n){return o.apply(this,arguments)}function o(){var t;return t=regeneratorRuntime.mark(function t(e,n,r){var a;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e(n);case 2:return(a=t.sent).type=String(r),t.abrupt("return",a);case 5:case"end":return t.stop()}},t)}),(o=function(){var e=this,n=arguments;return new Promise(function(r,l){var o=t.apply(e,n);function i(t){a(o,r,l,i,s,"next",t)}function s(t){a(o,r,l,i,s,"throw",t)}i(void 0)})}).apply(this,arguments)}n(23),n(24),n(25),n(26),n(22),n(126),n(61),n(27),n(28),n(36),n(29);function i(t){return function(t){if(Array.isArray(t)){for(var e=0,n=new Array(t.length);e<t.length;e++)n[e]=t[e];return n}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function s(t){return t.flatMap(function(e,n){return t.filter(function(t,e){return e!=n}).map(function(t){return{p1:e,p2:t}}).map(function(t){var e,n,a,l,o,s,c,u;return t.distance=(n=(e=t).p2.map(function(t){return t.node}),a=e.p1.filter(function(t){return-1!=n.indexOf(t.node)}),l=a[a.length-1].node,o=e.p1.map(function(t){return t.node}).indexOf(l),s=e.p2.map(function(t){return t.node}).indexOf(l),c=e.p1.filter(function(t,e){return e>=o}),u=e.p2.filter(function(t,e){return e>=s}),e.common=e.p1[o],r.A(c.map(function(t){return t.edgeLength}))+r.A(u.map(function(t){return t.edgeLength}))),t.deltas=function(t){var e=t.p2.map(function(t){return t.node}),n=t.p1.filter(function(t){return-1!=e.indexOf(t.node)}),a=n[n.length-1].node,l=t.p1.map(function(t){return t.node}).indexOf(a),o=t.p2.map(function(t){return t.node}).indexOf(a),s=t.p1.filter(function(t,e){return e>=l}),c=t.p2.filter(function(t,e){return e>=o}),u=1-s[0].edgeMove,f=r.q([s.length,c.length]),d=u/f,p=i(new Array(f-1)).map(function(t,e){return{bottom:s[0].edgeMove+e*d,top:s[0].edgeMove+(e+1)*d}});return p=(p=p.map(function(t,e){var n=s.filter(function(e){return e.edgeMove<=t.top&&e.edgeMove>=t.bottom}),r=c.filter(function(e){return e.edgeMove<=t.top&&e.edgeMove>=t.bottom});return t.one=n,t.two=r,t})).map(function(t,e){return 0===t.one.length&&(t.one=p[e-1].one),0===t.two.length&&(t.two=p[e-1].two),t}),r.j(s[0].attributes).filter(function(t){return"continuous"===t.value.type}).map(function(t){var e=t.key,n=p.map(function(t,n){return Math.abs(t.one[0].attributes[e].realVal-t.two[0].attributes[e].realVal)});return t.value=r.q(n),t})}(t),t.closeness=function(t){var e=t.p1.filter(function(t){return!0===t.leaf})[0].attributes,n=t.p2.filter(function(t){return!0===t.leaf})[0].attributes;return r.j(e).filter(function(t){return"continuous"===t.value.type}).map(function(t){return t.value=Math.abs(t.value.realVal-n[t.key].realVal),t})}(t),t})})}function c(t,e){return Object.keys(t).map(function(n,a){if("continuous"==t[n].type){var l=r.q(t[n].rows.map(function(t){return t.upperCI95})),o=r.t(t[n].rows.map(function(t){return t.lowerCI95}));r.r(t[n].rows.map(function(t){return t.realVal}));return{field:n,type:"continuous",max:l,min:o,yScale:r.v().range([0,43]).domain([o,l]).clamp(!0),satScale:r.v().range([0,.9]).domain([o,l]),colorScale:r.v().range([e[a][0],"#f23929"]).domain([o,l]),catColor:e[a][0]}}var i=t[n].fields.filter(function(t){return"nodeLabels"!=t});return{field:n,type:"discrete",stateColors:i.map(function(t,n){return{state:t,color:e[n][0]}}),catColor:e[a][0],scales:i.map(function(t){return{field:n,scaleName:t,max:1,min:0,yScale:r.v().range([45,0]).domain([0,1])}})}})}function u(t,e,n,r){var a=t.rows.map(function(t){return t.x});return e.map(function(t,e){t.label=a[e];var l=n.rows[0][""]?n.rows.map(function(t){return t[""]}):n.rows.map(function(t){return t.species});t.node=t.V2;var o=r.map(function(t){return t.field}),i={},s=n.rows[l.indexOf(t.label)];return o.forEach(function(t){var e=r.filter(function(e){return e.field==t})[0];if("discrete"===e.type){e.scales.filter(function(e){return e.scaleName==s[t]})[0].yScale;var n=e.scales.map(function(t){return t.scaleName}).map(function(e){return{state:e,realVal:e===s[t]?1:0}});i[t]={states:n,label:t,type:e.type,leaf:!0}}else if("continuous"===e.type){e.yScale;i[t]={realVal:s[t],type:e.type,leaf:!0}}else i[t]="error in leaf matching"}),t.clade=s.clade,t.attributes=i,t.leaf=!0,t})}function f(t,e,n,r){return t.rows.map(function(t,a){var l=Object.keys(n),o=n[l[0]].rows.map(function(t){return t.nodeLabels}).indexOf(t.V2);return t.edgeLength=e.rows[a].x,t.node=t.V2,o>-1&&l.forEach(function(e){if("continuous"==n[e].type){r.filter(function(t){return t.field==e})[0].yScale;var a=n[e].rows[o];a.realVal=a.estimate,a.type="continuous",t.attributes=null!=t.attributes?t.attributes:{},t.attributes[e]=a}else{var l=r.filter(function(t){return t.field==e})[0].scales,i=n[e].rows[o],s=l.map(function(t){return{state:t.scaleName,realVal:i[t.scaleName]}});t.attributes=null!=t.attributes?t.attributes:{},t.attributes[e]={states:s,type:"discrete"}}}),t})}function d(t,e,n){t.forEach(function(t,r){t[0].attributes={},Object.keys(e).map(function(r){if("continuous"==e[r].type){var a=e[r].rows.filter(function(e){return e.nodeLabels==t[0].node||e.nodeLabels=="node "+t[0].node})[0];t[0].attributes[r]={};var l=n.filter(function(t){return t.field==r})[0].yScale;t[0].attributes[r].realVal=a.estimate,t[0].attributes[r].upperCI95=a.upperCI95,t[0].attributes[r].lowerCI95=a.lowerCI95,t[0].attributes[r].scale=l,t[0].attributes[r].type="continuous"}else if("discrete"==e[r].type){var o=e[r].rows.filter(function(e){return e.nodeLabels==t[0].node})[0],i=n.filter(function(t){return t.field==r})[0].scales.map(function(t){return{state:t.scaleName,realVal:o[t.scaleName]}});t[0].attributes[r]={states:i,type:"discrete"}}else console.error("type not found")})});var a=r.q(t.map(function(t){return t.length})),l=r.v().range([0,1e3]).clamp(!0);return t.map(function(t,e){t.xScale=l.domain([0,a-1]);var n=t.length-1,r=(t.map(function(t){return t.edgeLength}),0);return t.map(function(e,l){var o=Object.assign({},e),i=o.edgeLength+r;return o.edgeMove=l<n?i:1,r+=o.edgeLength,o.move=l<n?t.xScale(l):t.xScale(a-1),o})})}function p(t,e,n){var r=null==n?Object.keys(t[0][0].attributes):n;return t.map(function(t){return r.map(function(n){return t.map(function(r){var a=t[t.length-1].label;if("continuous"===r.attributes[n].type)return r.attributes[n].species=a,r.attributes[n].color=e.filter(function(t){return t.field===n})[0].catColor,r.attributes[n].move=r.move,r.attributes[n].node=r.node,r.attributes[n].edgeMove=r.edgeMove,r.attributes[n].label=n,r.attributes[n].yScale=e.filter(function(t){return t.field===n})[0].yScale,r.attributes[n].satScale=e.filter(function(t){return t.field===n})[0].satScale,r.attributes[n].colorScale=e.filter(function(t){return t.field===n})[0].colorScale,r.attributes[n];if("discrete"===r.attributes[n].type){if(r.leaf){var l=r.attributes[n];return l.species=a,l.winState=r.attributes[n].states.filter(function(t){return 1===t.realVal})[0].state,l.color=e.filter(function(t){return t.field===n})[0].stateColors.filter(function(t){return t.state===l.winState})[0].color,l.move=r.move,l.node=r.node,l.edgeMove=r.edgeMove,l.attrLabel=n,l}return(r.attributes[n].states?r.attributes[n].states:r.attributes[n]).map(function(t,l){return t.color=e.filter(function(t){return t.field===n})[0].stateColors.filter(function(e){return e.state===t.state})[0].color,t.move=r.move,t.node=r.node,t.edgeMove=r.edgeMove,t.attrLabel=n,t.species=a,t})}console.error("attribute type not found")})})})}n(45),n(129);function h(t,e,n,r){return e.map(function(e){return function t(e,n,r,a,l){var o=e.filter(function(t){return t[l]===n[a]});return o.length>0?(r.push(o[0]),t(e,o[0],r,a,l)):(r.push({root:!0,node:n[a],edgeLength:0}),r.reverse())}(t,e,[e],n,r)})}n(30),n(62),n(46),n(104);var v=n(142);n(105),n(131),n(132),n(106);function y(t){return function(t){if(Array.isArray(t)){for(var e=0,n=new Array(t.length);e<t.length;e++)n[e]=t[e];return n}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function g(t,e){var n=e.append("g").classed("branch-bar",!0).attr("transform","translate(10, 10)");n.append("rect").classed("point-dis-rect",!0).attr("height",25).attr("x",-10).attr("y",-10).attr("fill","#fff"),n.append("line").attr("y1",2).attr("y2",2).attr("x1","100").attr("x2",890).attr("stroke","gray").attr("stroke-width",.25),n.append("text").text("Root").attr("transform","translate(70, 7)"),n.append("g").classed("leaf-label",!0).attr("transform","translate(950, 7)").append("text").text("Leaves");var a=[],l=[];t.map(function(t){t.filter(function(t){return 1!=t.leaf}).map(function(t){-1==l.indexOf(t.node)&&(l.push(t.node),a.push({node:t.node,eMove:t.edgeMove}))})});var o=r.v().domain([0,1]).range([0,795]),i=n.selectAll("g.branch-points").data(a).join("g").attr("class",function(t,e){return t.node}).classed("branch-points",!0);return i.attr("transform",function(t,e){return"translate("+(105+o(t.eMove))+", 0)"}),i.append("circle").attr("r",5).attr("fill","rgba(123, 141, 153, 0.5)"),n}function m(t,e,n){var a=A.filter(function(t){return"hide-attribute"===t.type}).map(function(t){return t.attribute}),l=Object.keys(t[0][0].attributes).filter(function(t){return-1===a.indexOf(t)}),o=y(t),i=a.length>0?n.filter(function(t){return-1===a.indexOf(t.field)}).map(function(t){return t.field}):null;p(o,n,i);r.q(o.map(function(t){return t.length}));var s=r.s(o.map(function(t){return t.length})),c=new Array(s).fill().map(function(t,e){var n=1/s;return{base:e*n,top:(e+1)*n,binI:e}}),u=o.map(function(t){return t.filter(function(t){return 1!=t.leaf})}),f=o.flatMap(function(t){return t.filter(function(t){return!0===t.leaf})}),d=o.flatMap(function(t){return t.filter(function(t){return!0===t.root})});c.map(function(t,e){var n=u.flatMap(function(e){return e.filter(function(e){return e.edgeMove>t.base&&e.edgeMove<=t.top})});return t.data=n,t});var h=l.map(function(t){var e=n.filter(function(e){return e.field===t})[0],a=c.map(function(e){return e.data.length>0?e.fData=e.data.map(function(e){return e.attributes[t]}):e.fData=[],{data:e.fData,range:[e.base,e.top],index:e.binI,key:t}}),l=f.map(function(e){return e.attributes[t]}),o={data:l};if("continuous"===e.type){var i=r.v().domain([e.min,e.max]).range([0,90]),s=r.n().value(function(t){return t.realVal}).domain(i.domain()).thresholds(i.ticks(20));a.forEach(function(t){return t.type=e.type,t.bins=s(t.data),t.domain=[e.max,e.min],t});var u=r.q(l.flatMap(function(t){return t.realVal})),p=r.t(l.flatMap(function(t){return t.realVal})),h=r.v().domain([p,u]).range([0,90]),v=r.n().value(function(t){return t.realVal}).domain(h.domain()).thresholds(h.ticks(20));return o.bins=v(l),{key:t,branches:y(a),type:e.type,leafData:o,rootData:d.map(function(e){return e.attributes[t]})[0]}}var g=l[0].states;a.bins=null,o.bins=g.map(function(t){return l.filter(function(e){return e.winState===t.state})});r.v().domain([0,1]).range([0,90]);a.map(function(t){t.type=e.type;var n=e.stateColors;return t.bins=g.map(function(e){var a=n.filter(function(t){return t.state===e.state}),l=t.data.flatMap(function(t){return t.states.filter(function(t){return t.state===e.state})}).map(function(t){return t.realVal}),o=r.r(l),i=r.i(l);return{state:e.state,average:o,stDev:i,stUp:o+i,stDown:o-i,color:a[0].color,range:t.range}}),t});var m=g.map(function(t){var e=t.state;return a.flatMap(function(t){return t.bins.filter(function(t){return t.state===e})})});return{key:t,branches:y(a),type:e.type,leafData:o,states:m,rootData:d.map(function(e){return e.attributes[t]})[0]}}),v=r.v().domain([0,s]).range([0,760]),m=e.append("svg");m.attr("id","main-summary-view"),m.attr("height",115*l.length);var b=g(o,m).selectAll("g.branch-points"),x=m.append("g").classed("summary-wrapper",!0);x.attr("transform","translate(10, 50)");var w=x.selectAll(".attr-wrap").data(h).join("g").attr("class",function(t){return t.key+" attr-wrap"});w.attr("transform",function(t,e){return"translate(0,"+95*e+")"});w.append("text").text(function(t){return t.key}).attr("y",40).attr("x",80).style("text-anchor","end");var k=w.append("g").classed("predicted",!0);k.attr("transform","translate(25, 0)");var S=k.selectAll("g.root").data(function(t){return[t.rootData]}).join("g").classed("root",!0);S.attr("transform","translate(60,0)");var j=S.filter(function(t){return"continuous"===t.type});j.append("rect").attr("height",90).attr("width",12).attr("fill","#fff").style("stroke-width","0.5px").style("stroke","black");j.append("rect").attr("width",12).attr("height",function(t){var e=t.yScale;return e.range([80,0]),e(t.lowerCI95)-e(t.upperCI95)}).attr("transform",function(t,e){var n=t.yScale;return n.range([80,0]),"translate(0,"+n(t.upperCI95)+")"}).style("opacity",.5).attr("fill","rgba(133, 193, 233)");j.append("rect").attr("width",12).attr("height",3).attr("transform",function(t,e){var n=t.yScale;return n.range([90,0]),"translate(0,"+n(t.realVal)+")"}).attr("fill","#004573"),S.filter(function(t){return"discrete"===t.type}).selectAll("rect.dist").data(function(t){return t.states.sort(function(t,e){return t.realVal-e.realVal})}).join("rect").classed("dist",!0).attr("width",12).attr("height",function(t){var e=r.v().domain([0,1]).range([0,80]).clamp(!0);return t.height=e(t.realVal),e(t.realVal)}).attr("transform",function(t,e,n){var a=r.z(n).filter(function(t,n){return n<e}).data().map(function(t){return t.height});return"translate(0, ".concat(2+1.2*r.A(a),")")}).attr("fill",function(t){return t.color}).style("opacity",.9).on("mouseover",function(t,e,n){var a=r.y("#tooltip");a.transition().duration(200).style("opacity",.9);var l=r.l(".3f");a.html(t.state+": "+l(t.realVal)).style("left",r.k.pageX+10+"px").style("top",r.k.pageY-28+"px")}).on("mouseout",function(t){r.y("#tooltip").transition().duration(500).style("opacity",0)});k.append("g").classed("path-wrapper",!0);var M=k.selectAll("g.branch-bin").data(function(t){return t.branches}).join("g").classed("branch-bin",!0);M.attr("transform",function(t,e){return"translate("+(100+v(e))+", 0)"});var O=M.filter(function(t){return"continuous"===t.type});O.on("mouseover",function(t,e,n){var a=t.data.map(function(t){return t.nodeLabels}),l=(b.filter(function(t){return a.indexOf(t.node)>-1}).classed("selected",!0),r.y("#sidebar").selectAll(".node").filter(function(t){return a.indexOf(t.data.node)>0}).classed("selected-branch",!0),r.v().domain(t.domain).range([0,90]));r.y(n[e]).append("g").classed("y-axis",!0).call(r.c(l).ticks(5))}).on("mouseout",function(t,e,n){r.z(".branch-points.selected").classed("selected",!1),r.z(".selected-branch").classed("selected-branch",!1),r.y(n[e]).select(".y-axis").remove()});var V=r.a().curve(r.g).x(function(t,e,n){return r.v().domain([0,n.length-1]).range([0,90]).clamp(!0)(e)}).y0(function(t){return 0}).y1(function(t){var e=Object.keys(t).length-1;return r.v().domain([0,50]).range([0,80]).clamp(!0)(e)});O.each(function(t,e,n){var a=r.y(n[e]).selectAll("g").data([t.bins]).join("g").classed("distribution",!0);a.attr("transform","translate(11, 90) rotate(-90)"),a.append("path").attr("d",V).attr("fill","rgba(133, 193, 233, .4)").style("stroke","rgba(133, 193, 233, .9)")});O.append("rect").attr("height",90).attr("width",10).style("fill","none").style("stroke","gray");var z=O.selectAll("rect.range").data(function(t){return t.data.map(function(e){return e.range=t.range,e})}).join("rect").classed("range",!0);z.attr("width",10),z.attr("height",function(t,e){if(null!=t.yScale){var n=t.yScale;return n.range([80,0]),n(t.lowerCI95)-n(t.upperCI95)}return 0}).attr("transform",function(t,e){var n=t.yScale;return n.range([80,0]),"translate(0,"+n(t.upperCI95)+")"}),z.attr("fill","rgba(133, 193, 233, .05)"),O.append("rect").attr("width",10).attr("height",function(t,e){return null!=t.data[0]?3:0}).attr("transform",function(t,e){if(null!=t.data[0]){var n=t.data[0].yScale;return n.range([90,0]),"translate(0,"+n(r.r(t.data.map(function(t){return t.realVal})))+")"}return"translate(0,0)"}).attr("fill","#004573");var C=M.filter(function(t){return"discrete"===t.type});C.append("line").attr("x0",2).attr("x1",2).attr("y0",0).attr("y1",90).attr("stroke","gray").attr("stroke-width",.5),C.append("rect").attr("height",90).attr("width",10).attr("opacity",0);C.on("mouseover",function(t,e,n){var a=r.v().domain([1,0]).range([0,90]);r.y(n[e]).append("g").classed("y-axis",!0).call(r.c(a).ticks(3));b.filter(function(e){return e.eMove>=t.range[0]&&e.eMove<t.range[1]}).classed("selected",!0);r.y("#sidebar").selectAll(".node").filter(function(e){return e.data.combEdge>=t.range[0]&&e.data.combEdge<t.range[1]}).classed("selected-branch",!0)}).on("mouseout",function(t,e,n){r.y(n[e]).select(".y-axis").remove(),r.z(".branch-points.selected").classed("selected",!1),r.z(".selected-branch").classed("selected-branch",!1)});var I=k.filter(function(t){return"discrete"===t.type}),E=I.selectAll(".path-wrapper").selectAll("g.state").data(function(t){return t.states}).join("g").classed("state",!0);I.append("line").attr("x1",100).attr("x2",900).attr("y1",48).attr("y2",48).attr("stroke-width",.3).attr("stroke","black"),E.append("path").attr("d",function(t,e){return r.a().curve(r.g).x(function(t,e){return r.v().domain([0,9]).range([0,900])(e)}).y0(function(t){return r.v().domain([0,1]).range([80,0]).clamp(!0)(t.stDown)}).y1(function(t){return r.v().domain([0,1]).range([80,0]).clamp(!0)(t.stUp)})(t)}).attr("transform","translate(100, 10)").attr("fill",function(t,e){return t[0]?t[0].color:"#fff"}).attr("opacity",.3),E.append("path").attr("d",function(t,e){return r.p().curve(r.g).x(function(t,e){return r.v().domain([0,9]).range([0,900])(e)}).y(function(t){return r.v().domain([0,1]).range([80,0]).clamp(!0)(t.average)})(t)}).attr("transform","translate(100, 10)").attr("fill","none").attr("stroke",function(t,e){return t[0]?t[0].color:"#fff"});var T=w.append("g").classed("observed",!0);T.attr("transform","translate(950, 0)");var L=T.filter(function(t){return"continuous"===t.type}),D=L.selectAll("g.ob-bars").data(function(t){return t.leafData.bins}).join("g").classed("ob-bars",!0);D.append("rect").attr("width",function(t,e,n){return 200/n.length}).attr("height",function(t,e){return r.v().domain([0,Object.keys(t).length]).range([70,0])(Object.keys(t).length-2)}).attr("fill","rgba(133, 193, 233, .5)");D.attr("transform",function(t,e,n){return"translate("+200/n.length*e+", "+(90-r.v().domain([0,Object.keys(t).length]).range([70,0])(Object.keys(t).length-2))+")"}),L.each(function(t,e,n){var a=t.leafData.data.map(function(t){return t.realVal}),l=r.v().domain([r.t(a),r.q(a)]).range([0,200]),o=r.v().domain([0,r.q(t.leafData.bins.map(function(t){return Object.keys(t).length}))-2]).range([70,0]);r.y(n[e]).append("g").classed("x-axis",!0).call(r.b(l)).attr("transform","translate(0, 90)"),r.y(n[e]).append("g").classed("y-axis",!0).call(r.c(o).ticks(4)).attr("transform","translate(0, 20)")});var N=T.filter(function(t){return"discrete"===t.type}),q=N.selectAll("g.ob-bars").data(function(t){return t.leafData.bins}).join("g").classed("ob-bars",!0),P=q.append("rect").attr("width",function(t,e,n){return 200/n.length}).attr("height",function(t,e,n){return r.v().domain([0,100]).range([70,0])(t.length)}).attr("fill",function(t,e){return null!=t[0]?t[0].color:"#fff"}).attr("opacity",.3);q.attr("transform",function(t,e,n){return"translate("+200/n.length*e+", "+(90-r.v().domain([0,100]).range([70,0])(t.length))+")"}),P.on("mouseover",function(t,e,n){var a=r.y("g."+t[0].label).selectAll("g.state");a.filter(function(e){return e[0].state===t[0].winState}).attr("opacity",.8),a.filter(function(e){return e[0].state!=t[0].winState}).attr("opacity",.1),r.y(n[e]).attr("opacity",.9)}).on("mouseout",function(t,e,n){r.y(n[e]).attr("opacity",.3);r.y("g."+t[0].label).selectAll("g.state").attr("opacity",.6)}),N.each(function(t,e,n){var a=t.leafData.bins.map(function(t){return null!=t[0]?t[0].winState:""}),l=r.x().domain(a).range([0,200]).padding(.6),o=r.v().domain([0,100]).range([70,0]);r.y(n[e]).append("g").classed("y-axis",!0).call(r.c(o).ticks(5)).attr("transform","translate(0, 20)"),r.y(n[e]).append("g").classed("x-axis",!0).call(r.b(l)).attr("transform","translate(0, 90)")})}function b(t,e){var n=r.y("#main"),a=j();n.selectAll("*").remove(),"View Paths"===r.y("#view-toggle").text()?(m(a,n,t),document.getElementById("scrunch").disabled=!0):(R(a,n,t),document.getElementById("scrunch").disabled=!1)}function x(t,e){var n=r.y("#main"),a=j();n.selectAll("*").remove(),a.length>50?(!function(t,e,n){var a=Array.from(new Set(t.map(function(t){return""===t.filter(function(t){return!0===t.leaf})[0].clade?"Anolis":"Norops"}))).map(function(e){var n=t.filter(function(t){return"Norops"===t[t.length-1].clade?t[t.length-1].clade="Norops":t[t.length-1].clade="Anolis",t[t.length-1].clade===e});return{label:e,paths:n}});e.selectAll(".group-div").data(a).join("div").classed("group-div",!0).each(function(t,e,a){var l=r.y(a[e]);l.style("text-align","center"),l.append("text").text(t.label),l.append("text").text(" Shown:"+t.paths.length),m(t.paths,r.y(a[e]),n)})}(a,n,t),r.y("#view-toggle").text("View Paths"),document.getElementById("scrunch").disabled=!0):(R(a,n,t),r.y("#view-toggle").text("View Summary"),document.getElementById("scrunch").disabled=!1)}function w(t){return function(t){if(Array.isArray(t)){for(var e=0,n=new Array(t.length);e<t.length;e++)n[e]=t[e];return n}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var A=[];function k(t,e){var n=A.filter(function(t){return"data-filter"===t.filterType}),a=n.map(function(t){return t.filterId}).indexOf(t);if(a!=n.length-1)for(var l=w(0===a?ot[0]:n[a-1].data),o=(r.y("#toolbar").selectAll(".filter-tag").remove(),a+1);o<n.length;o++){var i=n[o].filterFunction;if("continuous"===n[o].attributeType){var s=i(l,n[o].selectedOption,n[o].predictedFilter,n[o].observedFilter);n[o].data=w(s),n[o].filterId="c-"+o,O(n[o],e),l=s}else{var c=i(l,n[o].selectedOption,n[o].fromState,n[o].toState);n[o].data=w(c),n[o].filterId="d-"+o,O(n[o],e),l=c}}var u=A.filter(function(e){return e.filterId!=t});A=u}function S(t,e,n,r,a,l,o){var i={filterType:t,attributeType:e,filterId:n,filterFunction:r,"before-data":a,data:l};return null!=o&&o.forEach(function(t){i[t[0]]=t[1]}),A.push(i),i}function j(){return A.length>0?A[A.length-1].data:ot[0]}function M(t,e,n,a){var l=r.y("#filter-tab"),o=j();l.classed("hidden")?(t.text("Hide Filters"),l.classed("hidden",!1),e.style("padding-top","200px"),function(t,e,n,a,l){var o=Object.keys(e[0][0].attributes),i=A.filter(function(t){return"hide-attribute"===t.type}),s=i.length>0?i.map(function(t){return t.attribute}):[],c=t.append("div").classed("filter-wrap",!0);c.style("width","150px");var u=c.append("svg").classed("attr-toggle-svg",!0);u.append("text").text("Attributes: ").attr("x",20).attr("y",10);var f=u.append("g").attr("transform","translate(20, 25)").selectAll("g").data(o).join("g");f.attr("transform",function(t,e){return"translate(0,"+25*e+")"});var d=f.append("circle").attr("cx",0).attr("cy",0);d.classed("toggle",!0);var p=d.filter(function(t){return-1===s.indexOf(t)});p.classed("shown",!0),p.style("fill",function(t,e){return a.filter(function(e){return e.field===t})[0].catColor}),d.on("click",function(t,n){var l=r.y(this);!function(t,e){t.classed("shown")?(t.classed("shown",!1),t.style("fill","#fff")):(t.classed("shown",!0),t.style("fill",function(t,n){return e.filter(function(e){return e.field===t})[0].catColor}))}(l,a),A.push({type:"hide-attribute",attribute:t,"before-data":w(e)});var o=r.z(".shown"),i=a.filter(function(t){return-1===o.data().indexOf(t.field)}),s=A.filter(function(t){return"hide-attribute"!=t.type});i.forEach(function(t){s.push({type:"hide-attribute",attribute:t.field,"before-data":w(e),data:w(e)})}),A=s,b(a)}),f.append("text").text(function(t){return t}).style("font-size",10).attr("transform","translate(10, 4)")}(l,o,0,a),function(t,e,n,a,l,o){var i=["Select a Trait"].concat(Object.keys(n[0][0].attributes)),s=t.append("div").classed("filter-wrap",!0);s.style("width","200px"),s.append("h6").text("State Transition:");var c=I(s,i,"attr-select",""),u=s.append("div").classed("attribute-properties",!0);c.on("change",function(n){var l=r.y(this).property("value"),i=o.filter(function(t){return t.field===l})[0];if(u.selectAll("*").remove(),"discrete"===i.type){var s=["Any"],c=i.scales.map(function(t){return t.scaleName});s=s.concat(c);var f=I(u,s,"predicted-state","From"),d=I(u,s,"observed-state","To"),p=u.append("button").classed("btn btn-outline-success",!0);p.text("Filter"),p.on("click",function(){var n=f.node().classList[0],i=d.node().classList[0],s=(A.filter(function(t){return"data-filter"===t.filterType}),j()),c=C(s,l,n,i),u="d-"+A.filter(function(t){return"discrete"===t.attributeType}).length,p=S("data-filter","discrete",u,C,w(s),w(c),[["state",[n,i]],["selectedOption",l]]);b(o);var h=r.y("#sidebar").selectAll(".link"),v=r.y("#sidebar").selectAll(".node"),y=c.flatMap(function(t){return t.map(function(t){return t.node})});r.z(".link-not-there").classed("link-not-there",!1),r.z(".node-not-there").classed("node-not-there",!1);var g=h.filter(function(t){return-1===y.indexOf(t.data.node)});g.classed("link-not-there",!0);var m=v.filter(function(t){return-1===y.indexOf(t.data.node)});m.classed("node-not-there",!0),O(p,o),e.text("Show Filters"),t.selectAll("*").remove(),t.classed("hidden",!0),a.style("padding-top","0px")})}else{var h=r.v().domain([i.min,i.max]).range([60,0]),v=u.append("svg");v.attr("width",200).attr("height",100);var y=v.selectAll(".range").data([{label:"Ancestors",type:"predicted"},{label:"Leaves",type:"observed"}]).join("g").classed("range",!0);y.attr("transform",function(t,e){return"translate("+125*e+",20)"});var g=y.append("g");g.attr("transform","translate(10, 10)");var m=y.append("text").text(function(t){return t.label+": "});m.attr("x",0).attr("y",0);var x=g.append("rect").attr("width",20).attr("height",50);x.attr("x",10),g.append("g").attr("class","axis axis--y").attr("transform","translate(10,0)").call(r.c(h).ticks(3));var k=r.e().extent([[10,0],[30,60]]).on("end",function(){var t=r.k.selection;if(null==t)handle.attr("display","none");else t.map(h.invert)}),M=g.append("g").call(k);M.call(k.move,[0,60]);var V=u.append("button").classed("btn btn-outline-success",!0);V.text("Filter"),V.on("click",function(){var n=M._groups[0].map(function(t){return t.__brush.selection.map(function(t){return t[1]})}),i=n[0].map(h.invert).sort(),s=n[1].map(h.invert).sort(),c=A.filter(function(t){return"data-filter"===t.filterType}),u=c.length>0?c[c.length-1].data:ot[0],f=z(u,l,i,s),d="c-"+A.filter(function(t){return"continuous"===t.attributeType}).length,p=S("data-filter","continuous",d,z,w(u),w(f),[["selectedOption",l],["predictedFilter",i],["observedFilter",s]]);b(o),O(p,o);var v=r.y("#sidebar").selectAll(".link"),y=r.y("#sidebar").selectAll(".node"),g=f.flatMap(function(t){return t.map(function(t){return t.node})});r.z(".link-not-there").classed("link-not-there",!1),r.z(".node-not-there").classed("node-not-there",!1);var m=v.filter(function(t){return-1===g.indexOf(t.data.node)});m.classed("link-not-there",!0);var x=y.filter(function(t){return-1===g.indexOf(t.data.node)});x.classed("node-not-there",!0),e.text("Show Filters"),t.selectAll("*").remove(),t.classed("hidden",!0),a.style("padding-top","0px")})}})}(l,t,o,e,0,a),function(t,e,n,a,l,o){var i=t.append("div").classed("search-bar-div",!0);i.append("h6").text("Query Filter:");var s=i.append("form").classed("form-inline",!0),c=s.append("input").classed("form-control mr-sm-2",!0);c.attr("type","search").attr("placeholder","Search by Species").attr("aria-label","Search"),s.append("button").classed("btn btn-outline-success my-2 my-sm-0",!0).attr("type","button").append("i").classed("fas fa-search",!0).on("click",function(){var l=c.node().value.split(" ").map(function(t){return t.toLowerCase()}),i=n.filter(function(t){var e=t.filter(function(t){return!0===t.leaf})[0].label;return l.indexOf(e)>-1});b(o);var s=r.y("#toolbar"),u=s.append("button").classed("btn btn-info",!0),f=u.append("span").classed("badge badge-light",!0);f.text(i.length),u.append("h6").text("Query Filter");var d=u.append("i").classed("close fas fa-times",!0);d.on("click",function(){b(o),u.remove()}),r.y("#main-path-view").style("height",function(){return 60*i.length+100*Object.keys(i[0][0].attributes).length+"px"}),e.text("Show Filters"),t.selectAll("*").remove(),t.classed("hidden",!0),a.style("padding-top","0px")})}(l,t,o,e,0,a)):(t.text("Show Filters"),l.selectAll("*").remove(),l.classed("hidden",!0),e.style("padding-top","0px"))}function O(t,e){var n=r.y("#toolbar");if("continuous"===t.attributeType){var a=r.l(".2s"),l=n.append("button").classed("btn btn-info filter-tag",!0);r.y(l).datum(t),l.append("span").classed("badge badge-light",!0).text(t.data.length),l.append("h6").text(t.selectedOption+"  Predicted: "+a(t.predictedFilter[0])+"-"+a(t.predictedFilter[1])+" Observed: "+a(t.observedFilter[0])+"-"+a(t.observedFilter[1])).append("i").classed("close fas fa-times",!0).on("click",function(){A.filter(function(t){return"data-filter"===t.filterType}).filter(function(e){return t.attribute!=e.attribute});k(t.filterId,e),b(e),r.z(".link-not-there").classed("link-not-there",!1),r.z(".node-not-there").classed("node-not-there",!1),l.remove()})}else if("discrete"===t.attributeType){var o=n.append("button").classed("btn btn-info filter-tag",!0);o.append("span").classed("badge badge-light",!0).text(t.data.length),o.append("h6").text(t.state[0]),o.append("i").classed("fas fa-arrow-right",!0),o.append("h6").text(t.state[1]+"  "),o.append("i").classed("close fas fa-times",!0).on("click",function(){k(t.filterId,e),b(e),r.z(".link-not-there").classed("link-not-there",!1),r.z(".node-not-there").classed("node-not-there",!1),o.remove()})}else if("branch"===t.attributeType){var i=n.append("button").classed("btn btn-info filter-tag",!0);i.append("span").classed("badge badge-light",!0).text(t.data.length),i.append("h6").text(" At Branch: "+t.nodeId),i.append("i").classed("close fas fa-times",!0).on("click",function(){k(t.filterId,e),b(e),r.z(".link-not-there").classed("link-not-there",!1),r.z(".node-not-there").classed("node-not-there",!1),i.remove()})}}function V(t,e){var n=j(),a=(A.filter(function(t){return"data-filter"===t.filterType}),n.filter(function(e){return e.map(function(t){return t.node}).indexOf(t)>-1}));O(S("data-filter","branch","b-"+A.filter(function(t){return"branch"===t.attributeType}).length,V,w(n),w(a),[["nodeId",t]]),e),b(e);var l=r.y("#sidebar").selectAll(".link"),o=r.y("#sidebar").selectAll(".node"),i=a.flatMap(function(t){return t.map(function(t){return t.node})});r.z(".link-not-there").classed("link-not-there",!1),r.z(".node-not-there").classed("node-not-there",!1),l.filter(function(t){return-1===i.indexOf(t.data.node)}).classed("link-not-there",!0),o.filter(function(t){return-1===i.indexOf(t.data.node)}).classed("node-not-there",!0)}function z(t,e,n,r){return t.filter(function(t){return-1===t.map(function(t){var a=t.attributes[e].realVal;return 1==t.leaf?a>r[0]&&a<r[1]:a>n[0]&&a<n[1]}).indexOf(!1)})}function C(t,e,n,r){if(null!=e)return t.filter(function(t){var a=t.filter(function(t){return 1!=t.leaf}).map(function(t){var r=t.attributes[e].states;return"Any"===n||r.filter(function(t){return t.state===n}).length>0&&r.filter(function(t){return t.state===n})[0].realVal>.75}),l=t.filter(function(t){return!0===t.leaf}).map(function(t){var n=t.attributes[e].winState;return"Any"===r||n===r});return a.indexOf(!0)>-1&&l.indexOf(!0)>-1})}function I(t,e,n,a){var l=t.append("div").classed("selector",!0);l.append("h6").text(a);return l.append("select").attr("id",n).attr("class","Any").selectAll("option").data(e).join("option").text(function(t){return t}).attr("value",function(t){return t}),r.y("#"+n).on("change",function(t){var e=r.y(this).property("value");r.y(this).attr("class",e)}),r.y("#"+n)}function E(t){return function(t){if(Array.isArray(t)){for(var e=0,n=new Array(t.length);e<t.length;e++)n[e]=t[e];return n}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var T=[],L=[];function D(t,e,n){var a=r.y("div#selected"),l=r.y("div#main");if(null===t){T=[],r.y("div#selected").selectAll("*").remove(),a.style("height",0),r.y("div#main").style("padding-top","0px");var o=r.y("div#main");R(E(e),o,n)}else{var i=function(t,e,n,a){var l=t.flatMap(function(t){return t.filter(function(t){return!0===t.leaf}).map(function(t){return t.node})}),o=r.y("#sidebar").select("svg").selectAll(".node");o.filter(function(t){return l.indexOf(t.data.node)>-1}).classed("selected",!0);var i=A.filter(function(t){return"hide-attribute"===t.type}).length>0?A.filter(function(t){return"hide-attribute"===t.type}).map(function(t){return t.attribute}):[],s=i.length>0?a.filter(function(t){return-1===i.indexOf(t.field)}).map(function(t){return t.field}):null,c=n.select(".selected-toolbar"),u=c.empty()?n.append("div").classed("selected-toolbar",!0):c;u.selectAll("*").remove();var f=u.append("div").style("display","inline-block");f.append("text").text("Topology: ");var d=f.append("button").classed("btn btn-secondary btn-sm",!0);d.text("Sort Most to Least"),d.on("click",function(){var t;"Sort Most to Least"===(t=d).text()?t.text("Sort Least to Most"):t.text("Sort Most to Least")});var h=a.map(function(t){return t.field}),v=u.append("div").style("display","inline-block");v.append("h6").text("Sort by: ").style("display","inline");var y=v.selectAll("div.attr-radio").data(h).join("div").classed("attr-radio form-check form-check-inline",!0),g=y.append("input").attr("type","radio").property("name","attribute-radio-sort").property("value",function(t){return t}).attr("id",function(t,e){return"radio-"+e}).classed("form-check-input",!0);y.append("label").text(function(t){return t}).property("for",function(t,e){return"radio-"+e}).classed("form-check-label",!0);var b=n.select("svg.select-svg"),x=b.empty()?n.append("svg").classed("select-svg",!0):b;x.selectAll("*").remove();var w=t.flatMap(function(t){return t.flatMap(function(t){return t.node})}).reduce(function(t,e){return void 0===t[e]?t[e]=1:t[e]+=1,t},{});if(1===t.length){var k=x.append("g").classed("select-wrap",!0);k.attr("transform",function(t,e){return"translate(0,20)"});var S=r.w().range([6,14]).domain([1,r.q(Object.values(w))]),j=k.selectAll(".paths").data(t).join("g").classed("paths",!0),M=j.append("rect").classed("path-rect",!0);M.attr("y",-8),N(j,a),j.on("mouseover",function(t,e){var n=r.y("#sidebar").selectAll(".node"),a=r.y("#sidebar").selectAll(".link");return n.filter(function(e){return t.map(function(t){return t.node}).indexOf(e.data.node)>-1}).classed("hover",!0),a.filter(function(e){return t.map(function(t){return t.node}).indexOf(e.data.node)>-1}).classed("hover",!0),r.y(this).classed("hover",!0)}).on("mouseout",function(t,e){r.y("#sidebar").selectAll(".node").classed("hover",!1),r.y("#sidebar").selectAll(".link").classed("hover",!1);return r.y(this).classed("hover",!1)});var O=j.append("text").text(function(t){var e=t.filter(function(t){return!0===t.leaf})[0].label;return e.charAt(0).toUpperCase()+e.slice(1)});O.attr("x",25).attr("y",15);var V=j.append("g").classed("time-line",!0);V.attr("transform",function(t,e){return"translate(150, 0)"});V.append("line").attr("x1",0).attr("x2",1e3).attr("y1",15).attr("y2",15);var z=V.selectAll(".node").data(function(t){return t}).join("g").classed("node",!0);z.attr("transform",function(t){var e=r.v().domain([0,1]).range([0,1e3]),n=e(t.edgeMove);return"translate("+n+", 10)"});var C=z.append("circle").attr("cx",0).attr("cy",0).attr("r",function(t){return S(w[t.node])}).attr("class",function(t,e){return"node-"+t.node});C.on("mouseover",function(t,e){var n=z.filter(function(e){return e.node===t.node}),a=r.y("#sidebar").selectAll(".node");a.filter(function(e){return e.data.node===t.node}).classed("selected-branch",!0);return n.classed("hover-branch",!0)}).on("mouseout",function(t,e){var n=z.filter(function(e){return e.node===t.node});return r.z(".selected-branch").classed("selected-branch",!1),n.classed("hover-branch",!1)});z.filter(function(t){return null!=t.label}).append("text").text(function(t){var e=t.label.charAt(0).toUpperCase()+t.label.slice(1);return e}).attr("x",10).attr("y",5);j.attr("transform",function(t,e){return"translate(0,"+60*e+")"});var I=j.select(".time-line").selectAll(".node");I.on("mouseover",function(t,n){var r=e.filter(function(e){var n=e.flatMap(function(t){return t.node});return n.indexOf(t.node)>-1});r[0],r[1]});var T=j.append("g").classed("attribute-wrapper",!0),L=p(t,a,s),q=X(T,L,a,null);return j.attr("transform",function(t,e){return"translate(10,"+e*(55*(Object.keys(t[1].attributes).length+1))+")"}),_(q),U(q,a,!1),x.style("height",50*(t.length+q.data().map(function(t){return t[0]}).length)+50+"px"),n.style("height",50*(t.length+q.data().map(function(t){return t[0]}).length)+50+"px"),T.attr("transform",function(t){return"translate(140, 25)"}),r.z(".selected-path").classed("selected-path",!1),g.on("click",function(n,l){var i=t.map(function(t){return t.filter(function(t){return!0===t.leaf})[0]})[0],s=E(e).sort(function(t,e){return t.filter(function(t){return!0===t.leaf})[0].attributes[n].realVal-e.filter(function(t){return!0===t.leaf})[0].attributes[n].realVal}),c=r.y("div#main");R(s.reverse(),c,a),c.style("padding-top","250px");var u=c.select("svg#main-path-view").selectAll(".paths"),f=u.filter(function(t){var e=t.filter(function(t){return!0===t.leaf})[0];return e.attributes[n].realVal>i.attributes[n].realVal});f.classed("high",!0);var d=f.data().map(function(t){return t.filter(function(t){return!0===t.leaf})[0].node});o.filter(function(t){return d.indexOf(t.data.node)>-1}).classed("high",!0);var p=u.filter(function(t){var e=t.filter(function(t){return!0===t.leaf})[0];return e.attributes[n].realVal<i.attributes[n].realVal});p.classed("low",!0);var h=p.data().map(function(t){return t.filter(function(t){return!0===t.leaf})[0].node});o.filter(function(t){return h.indexOf(t.data.node)>-1}).classed("low",!0);var v=u.filter(function(t){var e=t.filter(function(t){return!0===t.leaf})[0];return e.attributes[n].realVal===i.attributes[n].realVal});v.classed("same",!0)}),t}if(t.length>1&&t.length<5){var P=function(t){var e=r.q(t.map(function(t){return t.length})),n=t.filter(function(t){return t.length===e})[0].filter(function(t){return 1!=t.leaf});t.map(function(t){n=E(t).filter(function(t){return n.map(function(t){return t.node}).indexOf(t.node)>-1&1!=t.leaf})});var a=t.map(function(t){var e=(t=!0===t[0].leaf?t.reverse():t).map(function(t){return t.node}),r=e.indexOf(n[n.length-1].node),a=t.filter(function(t,e){return e>r});return a});return n[n.length-1].children=a.map(function(t,e){var a=r.q(t.map(function(t){return t.edgeMove}))-n[n.length-1].edgeMove;return t.map(function(t,l,o){t.parentBase=n[n.length-1].edgeMove,t.move=t.edgeMove-n[n.length-1].edgeMove,t.base=0===l?0:o[l-1].edgeMove-n[n.length-1].edgeMove;var i=r.v().domain([0,1]).range([0,1e3])(n[n.length-1].edgeMove);return t.xScale=r.v().domain([0,a]).range([0,1e3-i]),t.level=e,t})}),n}(t);!function(t,e,n,a){var l=e.append("g").classed("select-wrap",!0);l.attr("transform","translate(0, 20)");var o=r.w().range([6,14]).domain([1,r.q(Object.values(a))]),i=l.selectAll(".paths").data([t]).join("g").classed("paths",!0),s=i.append("rect").classed("path-rect",!0);s.attr("y",-8),s.attr("height",35+25*t[t.length-1].children.length),N(i,n);var c=i.append("g").classed("time-line",!0);c.attr("transform",function(t,e){return"translate(145, 0)"});c.append("line").attr("x1",0).attr("x2",function(t,e){var n=r.v().domain([0,1]).range([0,1e3]);return n(t[t.length-1].edgeMove)}).attr("y1",15).attr("y2",15);var u=c.selectAll(".node").data(function(t){return t}).join("g").classed("node",!0);u.attr("transform",function(t){var e=r.v().domain([0,1]).range([0,1e3]),n=e(t.edgeMove);return"translate("+n+", 10)"}),u.classed("common-node",!0);var f=u.filter(function(t){return null!=t.children}).selectAll("g.child").data(function(t){return t.children}).join("g").classed("child",!0),d=f.selectAll("g.node").data(function(t){return t}).join("g").classed("node",!0);d.attr("transform",function(t,e,n){return"translate("+t.xScale(t.move)+", "+20*t.level+")"}),f.append("path").attr("d",function(t,e,n){var a=[{x:0,y:0},{x:0,y:e}];t.map(function(t){a.push({x:t.xScale(t.move),y:t.level})});var l=r.p().curve(r.h).x(function(t){return t.x}).y(function(t){return 20*t.y});return l(a)}).attr("stoke-width","2px").attr("fill","none").attr("stroke","gray"),f.on("mouseover",function(e,n){e.map(function(t){return t.species});var a=u.filter(function(t){return t.node===e.node}),l=E(t).map(function(t){return t.node}).concat(e.map(function(t){return t.node})),o=r.y("#sidebar").selectAll(".node"),i=r.y("#sidebar").selectAll(".link");return o.filter(function(t){return l.indexOf(t.data.node)>-1}).classed("hover",!0),i.filter(function(t){return l.indexOf(t.data.node)>-1}).classed("hover",!0),a.classed("hover-branch",!0)}).on("mouseout",function(t,e){r.z(".hover").classed("hover",!1)});u.append("circle").attr("cx",0).attr("cy",0).attr("r",function(t){return o(a[t.node])}).attr("class",function(t,e){return"node-"+t.node});d.append("circle").attr("r",7).attr("fill","red").attr("y",5).on("mouseover",function(t,e){var n=u.filter(function(e){return e.node===t.node}),a=r.y("#sidebar").selectAll(".node");a.filter(function(e){return e.data.node===t.node}).classed("selected-branch",!0);return n.classed("hover-branch",!0)}).on("mouseout",function(t,e){var n=u.filter(function(e){return e.node===t.node});return r.z(".selected-branch").classed("selected-branch",!1),n.classed("hover-branch",!1)}),d.filter(function(t){return!0===t.leaf}).append("text").text(function(t){return t.label}).attr("x",9).attr("y",4)}(P,x,a,w);var F=x.append("g").classed("attribute-wrapper",!0),Y=(P[P.length-1].children.map(function(t){return E(P).concat(t)}),p(t,a,s)),B=Y[0].map(function(e,n){var r=t[0].filter(function(t){return!0===t.leaf})[0].label;e[e.length-1].offset=0;for(var a={label:e[e.length-1].label,type:e[e.length-1].type,data:[{species:r,paths:e}]},l=1;l<Y.length;l++){var o=t[l].filter(function(t){return!0===t.leaf})[0].label,i=Y[l][n].length-1;Y[l][n][i].offset=8*l,a.data.push({species:o,paths:Y[l][n]})}return a}),H=B.map(function(t){return t.data=t.data.map(function(e,n){return e.paths=e.paths.map(function(e){if("discrete"===t.type){var a=5*n,l=e.states?{realVal:1,state:e.winState,color:e.color,edgeMove:e.edgeMove,offset:e.offset,leaf:!0}:function(t,e){var n=r.q(t.map(function(t){return t.realVal})),a=t.filter(function(t){return t.realVal!=n}),l=t[t.map(function(t){return t.realVal}).indexOf(n)];return l.other=a,l.offset=e,l}(e,a);return l}return e}),e}),t}),G=F.selectAll("g").data(H).join("g").classed("attr",!0);G.attr("transform",function(t,e){return"translate(145,"+60*e+")"}),G.append("text").text(function(t){return t.label}).style("text-anchor","end").style("font-size",11).attr("transform","translate(0,25)");var J=G.append("rect").attr("width",1010);J.attr("height",50),J.style("fill","#fff"),J.style("stroke","gray"),J.style("opacity",.5),G.append("line").classed("half",!0).attr("x1",0).attr("y1",22).attr("x2",1010).attr("y2",22);var Q=G.selectAll("g").data(function(t){return t.data=t.data.map(function(e){return e.type=t.type,e}),t.data}).join("g").classed("species",!0),K=r.p().x(function(t){var e=r.v().domain([0,1]).range([0,1e3]),n=t.edgeMove;return e(n)}).y(function(t){var e=r.v().domain([0,1]).range([48,1]);return e(t.realVal)+t.offset}),W=r.p().x(function(t){var e=r.v().domain([0,1]).range([0,1e3]),n=t.edgeMove;return e(n)}).y(function(t){var e=t.yScale;return e.range([48,1]),e(t.realVal)+2}),Z=Q.append("path").attr("d",function(t){return"discrete"===t.type?K(t.paths):W(t.paths)}).attr("class",function(t,e){return t.species+" inner-line"}).style("stroke-width",.7).style("fill","none").style("stroke","gray");Z.on("mouseover",function(t,e,n){r.y(n[e]).classed("selected",!0)}).on("mouseout",function(t,e,n){r.y(n[e]).classed("selected",!1)});var $=Q.filter(function(t){return"discrete"===t.type}),tt=$.selectAll(".branch").data(function(t){return t.paths}).join("g").classed("branch",!0);tt.attr("transform",function(t){var e=r.v().domain([0,1]).range([0,1e3]),n=e(t.edgeMove);return"translate("+n+", 0)"});var et=tt.append("circle").attr("r",5).attr("cy",function(t,e){var n=r.v().domain([0,1]).range([45,2]);return n(t.realVal)+t.offset}).attr("cx",5);et.attr("fill",function(t,e){return t.color});var nt=tt.filter(function(t){return 1!=t.leaf}).selectAll(".other").data(function(t){return t.other}).join("circle").classed("other",!0);nt.attr("r",4).attr("cx",5).attr("cy",function(t,e){var n=r.v().domain([1,0]);return n.range([0,45]),n(t.realVal)}).attr("fill",function(t){return t.color}).style("opacity",.1),nt.on("mouseover",function(t){var e=r.y("#tooltip");e.transition().duration(200).style("opacity",.9);var n=r.l(".3f");e.html(t.state+": "+n(t.realVal)).style("left",r.k.pageX+10+"px").style("top",r.k.pageY-28+"px")}).on("mouseout",function(t){var e=r.y("#tooltip");e.transition().duration(500).style("opacity",0)}),et.on("mouseover",function(t){var e=r.y("#tooltip");e.transition().duration(200).style("opacity",.9);var n=r.l(".3f");e.html(t.state+": "+n(t.realVal)).style("left",r.k.pageX+10+"px").style("top",r.k.pageY-28+"px")}).on("mouseout",function(t){var e=r.y("#tooltip");e.transition().duration(500).style("opacity",0)}),tt.on("mouseover",function(t,e,n){var a=r.v().domain([1,0]);a.range([0,45]),x.selectAll("path.inner-line."+t.species).attr("stroke","red"),x.selectAll("path.inner-line."+t.species).classed("selected",!0),r.y(n[e]).append("g").classed("y-axis",!0).call(r.c(a).ticks(3)),r.y(n[e]).selectAll(".other").style("opacity",.7)}).on("mouseout",function(t,e,n){r.y(n[e]).select("g.y-axis"),r.y(n[e]).select("g.y-axis").remove(),r.z("path.inner-line."+t.species).attr("stroke","gray"),r.z("path.inner-line."+t.species).classed("selected",!1),r.z(".other").style("opacity",.1)});var rt=Q.filter(function(t){return"continuous"===t.type}),at=rt.selectAll(".branch").data(function(t){return t.paths}).join("g").classed("branch",!0);at.attr("transform",function(t){var e=r.v().domain([0,1]).range([0,1e3]),n=e(t.edgeMove);return"translate("+n+", 0)"}),at.on("mouseover",function(t,e,n){var a=t.yScale;a.range([0,45]),x.selectAll("path.inner-line."+t.species).attr("stroke","red"),x.selectAll("path.inner-line."+t.species).classed("selected",!0),r.y(n[e]).append("g").classed("y-axis",!0).call(r.c(a).ticks(3)),r.y(n[e]).selectAll(".other").style("opacity",.7)}).on("mouseout",function(t,e,n){r.y(n[e]).select("g.y-axis"),r.y(n[e]).select("g.y-axis").remove(),r.z("path.inner-line."+t.species).attr("stroke","gray"),r.z("path.inner-line."+t.species).classed("selected",!1),r.z(".other").style("opacity",.1)});var lt=at.append("rect");lt.attr("width",10).attr("height",3),lt.attr("y",function(t,e){var n=a.filter(function(e){return e.field===t.label})[0],l=r.v().domain([n.min,n.max]).range([50,0]);return l(t.realVal)});var it=at.filter(function(t){return 1!=t.leaf}).append("rect");return it.attr("width",10).attr("height",function(t,e){var n=a.filter(function(e){return e.field===t.label})[0],l=r.v().domain([n.min,n.max]).range([50,0]);return l(t.lowerCI95)-l(t.upperCI95)}),it.attr("y",function(t,e){var n=a.filter(function(e){return e.field===t.label})[0],l=r.v().domain([n.min,n.max]).range([50,0]);return l(t.upperCI95)}),it.style("opacity",.1),x.style("height",50*(t.length+G.data().map(function(t){return t[0]}).length)+50+"px"),n.style("height",50*(t.length+G.data().map(function(t){return t[0]}).length)+50+"px"),F.attr("transform",function(t){return"translate(0, 60)"}),r.z(".selected-path").classed("selected-path",!1),P}var st=r.q(t.map(function(t){return t.length})),ct=t.filter(function(t){return t.length===st})[0],ut=ct.filter(function(t){return 1!=t.leaf}),ft=ut;t.map(function(t){ft=E(t).filter(function(t){return ft.map(function(t){return t.node}).indexOf(t.node)>-1&1!=t.leaf})}),x.remove();var dt=u.append("g").classed("x-icon",!0);return dt.attr("transform","translate(15, 10)"),dt.append("circle").attr("r",7).attr("fill","#fff"),dt.append("text").text("x").attr("transform","translate(-5, 5)"),dt.style("cursor","pointer"),dt.on("click",function(t,e,n){r.z(".high").classed("high",!1),r.z(".low").classed("low",!1),o.select(".selected").classed("selected",!1),D(null,ot[0],a)}),m(t,n,a),n.style("height","550px"),r.z(".selected-path").classed("selected-path",!1),g.on("click",function(n,l){var i=t.map(function(t){return t.filter(function(t){return!0===t.leaf})[0]})[0],s=E(e).sort(function(t,e){return t.filter(function(t){return!0===t.leaf})[0].attributes[n].realVal-e.filter(function(t){return!0===t.leaf})[0].attributes[n].realVal}),c=r.y("div#main");R(s.reverse(),c,a),c.style("padding-top","250px");var u=c.select("svg#main-path-view").selectAll(".paths"),f=u.filter(function(t){var e=t.filter(function(t){return!0===t.leaf})[0];return e.attributes[n].realVal>i.attributes[n].realVal});f.classed("high",!0);var d=f.data().map(function(t){return t.filter(function(t){return!0===t.leaf})[0].node});o.filter(function(t){return d.indexOf(t.data.node)>-1}).classed("high",!0);var p=u.filter(function(t){var e=t.filter(function(t){return!0===t.leaf})[0];return e.attributes[n].realVal<i.attributes[n].realVal});p.classed("low",!0);var h=p.data().map(function(t){return t.filter(function(t){return!0===t.leaf})[0].node});o.filter(function(t){return h.indexOf(t.data.node)>-1}).classed("low",!0);var v=u.filter(function(t){var e=t.filter(function(t){return!0===t.leaf})[0];return e.attributes[n].realVal===i.attributes[n].realVal});v.classed("same",!0)}),x.style("height",50*(t.length+attributeGroups.data().map(function(t){return t[0]}).length)+50+"px"),n.style("height",50*(t.length+attGroups.data().map(function(t){return t[0]}).length)+50+"px"),attWrap.attr("transform",function(t){return"translate(140, 25)"}),r.z(".selected-path").classed("selected-path",!1),ft}(E(T=T.concat(t)),E(e),a,n);R(function(t,e,n){if(!(t.length>1)){var r=t[0].reverse().map(function(t){return t.node}),a=e.map(function(t){var e=t.reverse().map(function(t,e){return r.indexOf(t.node),{indexOf:r.indexOf(t.node),pathIndex:e,node:t,chosen:r[r.indexOf(t.node)]}}).filter(function(t){return t.indexOf>-1}),n=e[0].indexOf+e[0].pathIndex;return{data:t.reverse(),distance:n}}),l=a.sort(function(t,e){return t.distance-e.distance});return l}if(null!=n){var o=n.reverse().map(function(t){return t.node}),i=e.map(function(t){var e=t.reverse().map(function(t,e){return o.indexOf(t.node),{indexOf:o.indexOf(t.node),pathIndex:e,node:t,chosen:o[o.indexOf(t.node)]}}).filter(function(t){return t.indexOf>-1}),n=e[0].indexOf+e[0].pathIndex;return{data:t.reverse(),distance:n}}),s=i.sort(function(t,e){return t.distance-e.distance});return s}console.error("multiple paths without common node")}(E(T),E(e),E(i)).map(function(t){return t.data}),l,n);l.style("padding-top","250px")}}function N(t,e){var n=t.append("g").classed("x-icon",!0);n.attr("transform","translate(15, 10)"),n.append("circle").attr("r",7).attr("fill","#fff"),n.append("text").text("x").attr("transform","translate(-5, 5)"),n.style("cursor","pointer"),n.on("click",function(t,n,a){r.z(".high").classed("high",!1),r.z(".low").classed("low",!1),treeNodes.select(".selected").classed("selected",!1),D(null,ot[0],e)})}function q(t,e,n,a){var l=n.select(".button-wrap"),o=l.empty()?n.append("div").classed("button-wrap",!0):l;o.style("display","inline-block").style("width","900px").style("height","50px");var i=r.y("div#main");if(i.style("padding-top","300px"),null!=t){var s=L.map(function(t){return t.groupColor}),c=ft.find(function(t){return-1===s.indexOf(t[0])});t.groupColor=c[0],L.push(t)}if(L.length>1){var u=r.y("#toolbar").select("#compare-button"),f=u.empty()?r.y("#toolbar").append("button").text("Normal Mode").attr("id","compare-button").classed("btn btn-info",!0):u;f.on("click",function(){"Normal Mode"===f.text()?f.text("Compare Mode"):f.text("Normal Mode"),q(null,e,n,a)})}var d=a.map(function(t,e){var n={field:t.field,type:t.type,data:[]};return L.map(function(e,r){var l=p(e.data,a,[t.field]),o=l.flatMap(function(t){return t.map(function(t){return t.map(function(t){var e=!0===t.leaf?0:(t.upperCI95-t.realVal)/2;return t.variance=e*e,t})})});n.data.push({group:{first:e.first,second:e.second,color:e.groupColor},data:"continuous"===t.type?o:l.flatMap(function(t){return t})})}),n}),h=o.selectAll("button").data(L).join("button").classed("btn btn-info",!0).style("background",function(t){return t.groupColor});h.selectAll("span").data(function(t){return[t]}).join("span").text(function(t){return t.first?"".concat(t.first[1]," / ").concat(t.second[1]):t.state}).append("span").text(function(t){return t.data.length}).classed("badge badge-light",!0),h.selectAll("i").data(function(t){return[t]}).join("i").classed("close fas fa-times",!0).style("padding-left","10px").on("click",function(t,r){var l=L.filter(function(e){return e.groupColor!=t.groupColor});(L=l).length>0?q(null,e,n,a):(n.selectAll("*").remove(),n.style("height","0px"),i.style("padding-top","0px"))});var v=n.select(".comparison-svg"),y=v.empty()?n.append("svg").classed("comparison-svg",!0):v;n.style("height","300px").style("width","100%"),y.style("height","300px");var g=y.selectAll(".att-wrapper").data(d.filter(function(t){return"continuous"===t.type}).map(function(t){var e=r.q(t.data.flatMap(function(t){return t.data.flatMap(function(t){return t.map(function(t){return t.upperCI95})})}))+.2,n=r.t(t.data.flatMap(function(t){return t.data.flatMap(function(t){return t.map(function(t){return t.lowerCI95})})}))-.2;return t.data.map(function(t){var a=new Array(6).fill().map(function(t,r){return{base:r*(1/6),top:(r+1)*(1/6),binI:r,max:e,min:n}}),l=t.data.map(function(t){return t.filter(function(t){return 1!=t.leaf})}),o=t.data.flatMap(function(t){return t.filter(function(t){return!0===t.leaf})});return t.bins=a.map(function(t,e,n){var o=l.flatMap(function(e){return e.filter(function(e){return e.edgeMove>=t.base&&e.edgeMove<=t.top})});t.data=o;var i=r.r(o.map(function(t){return t.realVal}));t.mean=void 0===i?a[e-1].mean:i;var s=Math.sqrt(r.r(o.map(function(t){return t.variance})));t.meanStandard=0===o.length?0:s;var c=2*s;return t.upCon95=void 0===i?a[e-1].upCon95:i+c,t.lowCon95=void 0===i?a[e-1].lowCon95:i-c,t}),t.leaves=o,t}),t}));g.exit().remove();var m=g.enter().append("g").classed("att-wrapper",!0);m.append("text").text(function(t){return t.field}).style("text-anchor","end").style("font-size","11px").attr("transform","translate(120, 35)");(g=m.merge(g)).attr("transform",function(t,e){return"translate(0,"+(10+70*e)+")"});var b=g.selectAll("g.inner-group").data(function(t){return[t]}).join("g").classed("inner-group",!0);b.attr("transform","translate(150, 0)");b.selectAll("rect.outline-rect").data(function(t){return[t]}).join("rect").classed("outline-rect",!0).attr("width",800).attr("height",60).attr("fill","#fff").attr("stroke","gray");if(r.y("#compare-button").empty()||"Normal Mode"===r.y("#compare-button").text()){var x=r.p().x(function(t,e){return r.v().domain([0,5]).range([0,800])(e)}).y(function(t){var e=r.v().domain([t.min,t.max]);return e.range([60,1]),e(t.mean)}),w=b.selectAll("g.path-groups").data(function(t){return t.data}).join("g").classed("path-groups",!0);w.selectAll("*").remove();var A=w.append("path").attr("d",function(t){t.bins[0].data[0].yScale;return t.bins=t.bins.map(function(e,n,a){return void 0===e.mean&&(e.mean=t.bins[n-1].mean,t.missing=!0),e.yScale=r.v().domain([e.min,e.max]).range([60,1]),e}),x(t.bins)}).classed("path",!0),k=r.a().curve(r.g).x(function(t,e){return r.v().domain([0,5]).range([0,800])(e)}).y0(function(t){var e=t.yScale;return e.range([60,1]),e(t.lowCon95)}).y1(function(t){var e=t.yScale;return e.range([60,1]),e(t.upCon95)}),S=b.selectAll("g.conf-groups").data(function(t){return t.data}).join("g").classed("conf-groups",!0);S.selectAll("*").remove();var j=S.append("path").attr("d",function(t){return t.bins=t.bins.map(function(e,n,r){return NaN===e.upCon95&&(e.upCon95=t.bins[n-1].upCon95,t.missing=!0),NaN===e.lowCon95&&(e.lowCon95=t.bins[n-1].lowCon95,t.missing=!0),e}),k(t.bins)}).classed("path",!0);A.style("fill","none"),A.style("stroke",function(t){return t.group.color}),A.style("stroke-width","2px"),j.style("fill",function(t){return t.group.color}),j.style("opacity",.15);b.append("g").classed("y-axis",!0);b.on("mousemove",function(t,e){var n=this,a=r.v().domain([t.data[0].bins[0].min,t.data[0].bins[0].max]).range([1,60]),l=r.y(this).select(".y-axis"),o=l.empty()?r.y(this).append("g").classed("y-axis",!0):l;if(r.y("#compare-button").empty()||"Normal Mode"===r.y("#compare-button").text())o.attr("transform",function(t,e){return"translate("+(r.u(n)[0]-10)+",0)"}),o.call(r.c(a).ticks(5));else{var i=r.y(this).select(".path-groups").selectAll("path").data().map(function(t){return t[0].maxDiff})[0];o.attr("transform",function(t,e){return"translate("+(r.u(n)[0]-10)+",0)"});var s=r.v().domain([i,0]).range([0,60]);o.call(r.c(s).ticks(5))}}).on("mouseleave",function(){r.y(this).select(".y-axis").remove()})}else{b.selectAll(".path-groups").remove(),b.selectAll("g.conf-groups").remove();var M=b.selectAll("g.path-groups").data(function(t){for(var e=t.data[0].bins,n=[],r=function(r){var a=[];t.data[r].bins.map(function(n,l){void 0===n.mean&&(n.mean=t.data[r].bins[l-1].mean),void 0===e[l].mean&&(e[l].mean=e[l-1].mean);var o=t.data[0].bins[0].max-t.data[0].bins[0].min;a.push({diff:Math.abs(e[l].mean-n.mean),maxDiff:o})}),n.push(a)},a=1;a<t.data.length;a++)r(a);return n}).join("g").classed("path-groups",!0),O=r.p().x(function(t,e){return r.v().domain([0,5]).range([0,800])(e)}).y(function(t){var e=r.v().domain([0,t.maxDiff]).clamp(!0);return e.range([60,0]),e(t.diff)}),V=M.append("path").attr("d",function(t){return O(t)});V.style("fill","none"),V.style("stroke","black"),V.style("stroke-width","2px")}var z=g.selectAll(".observed-dist-wrap").data(function(t){var e=r.q(t.data.flatMap(function(t){return t.leaves.map(function(t){return t.realVal})})),n=r.t(t.data.flatMap(function(t){return t.leaves.map(function(t){return t.realVal})})),a=r.v().domain([n,e]).range([0,200]),l=r.n().value(function(t){return t.realVal}).domain(a.domain()).thresholds(a.ticks(10));return[{data:t.data.map(function(t){var e=E(t.leaves).map(function(e){return e.x=a,e.group=t.group,e});return{binData:l(t.leaves),data:e,group:t.group,xScale:a}}),xScale:a}]}).join("g").classed("observed-dist-wrap",!0);z.attr("transform","translate(970, 0)");var C=z.selectAll("g.axis-x").data(function(t){return[t]}).join("g").classed("axis-x",!0);C.attr("transform","translate(0, 50)"),C.each(function(t,e,n){r.y(n[e]).call(r.b(t.xScale).ticks(5))});var I=z.selectAll(".observed-group").data(function(t){return t.data.map(function(t,e,n){return t.index=e,t.groupLength=n.length,t})}).join("g").classed("observed-group",!0);I.selectAll(".line").data(function(t){return[{mean:r.r(t.data.map(function(t){return t.realVal})),group:t.group,x:t.xScale}]}).join("rect").classed("line",!0).attr("transform",function(t,e){return"translate("+(t.x(t.mean)-1.5)+",0)"}).attr("height",50).attr("width",3).attr("fill",function(t){return t.group.color}).style("opacity","0.4"),I.selectAll(".circ-wrap").data(function(t,e){return[t]}).join("g").classed("circ-wrap",!0).attr("transform",function(t,e,n){return"translate(0,"+r.v().domain([0,t.groupLength]).range([0,60])(t.index+.5)+")"}).selectAll("circle.disDots").data(function(t){return t.data}).join("circle").attr("r",3).attr("cx",function(t,e){return t.x(t.realVal)}).attr("cy",function(t,e,n){return 0}).attr("fill",function(t){return t.group.color})}function P(t,e,n,r){var a=t.append("div").classed("dropdown ".concat(r),!0);a.style("display","inline-block");var l=a.append("button").classed("btn dropbtn btn-secondary",!0).text(n),o=a.append("div").attr("id",r).classed("dropdown-content",!0);o.append("a").text("text");var i=o.selectAll("a").data(e).join("a").text(function(t){return t.field});return l.on("click",function(t,e,n){o.classed("show")?o.classed("show",!1):o.classed("show",!0)}),i}function F(t,e,n,r,a,l,o){try{var i=t[l](o),s=i.value}catch(t){return void n(t)}i.done?e(s):Promise.resolve(s).then(r,a)}function R(t,e,n){var a=!0,l=r.y("#scrunch").attr("value");e.select("#main-path-view").selectAll("*").remove();var o=function(t,e,n){var a=e.select("#main-path-view"),l=a.empty()?e.append("svg").attr("id","main-path-view"):a,o=!1,i=l.select(".path-wrapper"),s=i.empty()?l.append("g").classed("path-wrapper",!0):i;s.attr("transform",function(t,e){return"translate(0,20)"});var c=t.flatMap(function(t){return t.flatMap(function(t){return t.node})}).reduce(function(t,e){return void 0===t[e]?t[e]=1:t[e]+=1,t},{}),u=r.w().range([6,14]).domain([1,r.q(Object.values(c))]),f=s.selectAll(".paths").data(t).join("g").classed("paths",!0);f.append("rect").classed("path-rect",!0).attr("y",-8);var d=f.append("g").classed("fas fa-search-plus",!0);d.attr("transform","translate(15, 10)"),d.append("circle").attr("r",7).attr("fill","#fff"),d.append("text").text("+").attr("transform","translate(-5, 5)"),d.style("cursor","pointer"),d.on("click",function(t,e,a){var l=r.z(a).filter(function(t,n){return n!=e}).classed("selected-path",!1);r.y(a[e]).classed("selected-path")?(r.y(a[e]).classed("selected-path",!1),D(null,l.data(),n)):(r.y(a[e]).classed("selected-path",!0),D([t],l.data(),n))}),f.on("mouseover",function(t,e){var n=r.y("#sidebar").selectAll(".node"),a=r.y("#sidebar").selectAll(".link");return n.filter(function(e){return t.map(function(t){return t.node}).indexOf(e.data.node)>-1}).classed("hover",!0),a.filter(function(e){return t.map(function(t){return t.node}).indexOf(e.data.node)>-1}).classed("hover",!0),r.y(this).classed("hover",!0)}).on("mouseout",function(t,e){r.y("#sidebar").selectAll(".node").classed("hover",!1),r.y("#sidebar").selectAll(".link").classed("hover",!1);return r.y(this).classed("hover",!1)}),f.append("text").text(function(t){var e=t.filter(function(t){return!0===t.leaf})[0].label;return e.charAt(0).toUpperCase()+e.slice(1)}).attr("x",25).attr("y",15);var p=f.append("g").classed("time-line",!0);p.attr("transform",function(t,e){return"translate(150, 0)"});p.append("line").attr("x1",0).attr("x2",1e3).attr("y1",15).attr("y2",15);var h=p.selectAll(".node").data(function(t){return t}).join("g").attr("class",function(t,e,n){return r.y(n[n.length-1]).data()[0].label+" node"});h.attr("transform",function(t){var e=r.v().domain([0,1]).range([0,1e3]),n=e(t.edgeMove);return"translate("+n+", 10)"}),h.on("click",function(t,e,a){o?(o=!1,r.y("#branch-tooltip").classed("hidden",!0)):(o=!0,r.y("#branch-tooltip").style("left",r.k.pageX+"px").style("top",r.k.pageY-28+"px").select("#value").text(t.node),r.y("#branch-tooltip").classed("hidden",!1),r.y("#filter-by-node").on("click",function(){V(t.node,n),o=!1,r.y("#branch-tooltip").classed("hidden",!0)}),r.y("#select-by-node").on("click",function(){j();var e=f.filter(function(e){return e.map(function(t){return t.node}).indexOf(t.node)>-1}),a=f.filter(function(e){return-1===e.map(function(t){return t.node}).indexOf(t.node)});o=!1,r.y("#branch-tooltip").classed("hidden",!0),D(e.data(),a.data(),n)}))}),h.append("circle").attr("cx",0).attr("cy",0).attr("r",function(t){return u(c[t.node])}).attr("class",function(t,e){return"node-"+t.node}).on("mouseover",function(t,e){var n=h.filter(function(e){return e.node===t.node}),a=r.y("#sidebar").selectAll(".node");a.filter(function(e){return e.data.node===t.node}).classed("selected-branch",!0);return n.classed("hover-branch",!0)}).on("mouseout",function(t,e){var n=h.filter(function(e){return e.node===t.node});return r.z(".selected-branch").classed("selected-branch",!1),n.classed("hover-branch",!1)});h.filter(function(t){return null!=t.label}).append("text").text(function(t){var e=t.label.charAt(0).toUpperCase()+t.label.slice(1);return e}).attr("x",10).attr("y",5);return f}(t,e,n),i=o.append("g").classed("attribute-wrapper",!0),s=A.filter(function(t){return"hide-attribute"===t.type}).map(function(t){return t.attribute}),c=s.length>0?n.filter(function(t){return-1===s.indexOf(t.field)}).map(function(t){return t.field}):null,u=p(t,n,c),f=null===c?n.length:c.length,d=X(i,u,n,null,l),h="true"===l?22:45;o.attr("transform",function(t,e){return"translate(10,"+e*((h+5)*(f+1))+")"});_(d,l),U(d,l,!1);return function(t,e,n,r){t.style("height",n.length*(r+52)+"px"),e.attr("transform",function(t){return"translate(140, 25)"})}(e.select("#main-path-view"),i,t,f*h),r.z(".discrete-leaf").on("click",function(t,e){a?(a=!1,r.y("#state-tooltip").classed("hidden",!0)):(a=!0,r.y("#state-tooltip").style("left",r.k.pageX+"px").style("top",r.k.pageY-28+"px").select("#value").text(t.winState),r.y("#state-tooltip").classed("hidden",!1),r.y("#filter-by-state").on("click",function(){!function(t,e){var n=j(),a=(A.filter(function(t){return"data-filter"===t.filterType}),n.filter(function(e){return e[e.length-1].attributes[t.label].winState===t.winState}));O(S("data-filter","leaf","l-"+A.filter(function(t){return"leaf"===t.attributeType}).length,V,w(n),w(a),[["leafState",[t.label,t.winState]]]),e),b(e);var l=r.y("#sidebar").selectAll(".link"),o=r.y("#sidebar").selectAll(".node"),i=a.flatMap(function(t){return t.map(function(t){return t.node})});r.z(".link-not-there").classed("link-not-there",!1),r.z(".node-not-there").classed("node-not-there",!1),l.filter(function(t){return-1===i.indexOf(t.data.node)}).classed("link-not-there",!0),o.filter(function(t){return-1===i.indexOf(t.data.node)}).classed("node-not-there",!0)}(t,n),a=!1,r.y("#state-tooltip").classed("hidden",!0)}),r.y("#select-by-state").on("click",function(){var e=j(),l=e.filter(function(e){return e[e.length-1].attributes[t.label].winState===t.winState}),o=e.filter(function(e){return e[e.length-1].attributes[t.label].winState!=t.winState});a=!1,r.y("#state-tooltip").classed("hidden",!0),D(l,o,n)}))}),o}function X(t,e,n,r,a){var l="true"===a?20:45,o=t.selectAll("g").data(function(t,n){return e[n]}).join("g");o.classed("predicated-attr-groups",!0),o.attr("transform",function(t,e){return"translate(0, "+e*(l+5)+")"});var i=o.append("text").text(function(t){return t[t.length-1].label});return i.classed("attribute-label",!0),i.attr("transform","translate(-15, 20)"),o}function Y(){var t;return t=regeneratorRuntime.mark(function t(e,n){var a,l,o;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e.data().forEach(function(t){var e;(e=t).map(function(t,n){var r=0===n?0:1,a=t.realVal>e[n-r].realVal?1:18;t.change=a})}),a="true"===n?20:45,l=r.p().x(function(t){return r.v().domain([0,1]).range([0,1e3])(t.edgeMove)}).y(function(t){var e=t.yScale;return e.range([a,0]),"true"===n?t.change:e(t.realVal)}),o=e.append("path").attr("d",l).attr("class","inner-line").style("stroke",function(t){return t[0].color}),t.abrupt("return",o);case 5:case"end":return t.stop()}},t)}),(Y=function(){var e=this,n=arguments;return new Promise(function(r,a){var l=t.apply(e,n);function o(t){F(l,r,a,o,i,"next",t)}function i(t){F(l,r,a,o,i,"throw",t)}o(void 0)})}).apply(this,arguments)}function _(t,e){var n=t.filter(function(t){return null!=t[t.length-1]?"continuous"===t[t.length-1].type:"continuous"===t.type}),a="true"===e?20:45,l=n.append("g").classed("attribute-time-line",!0);!function(t,e){Y.apply(this,arguments)}(l,e);l.append("rect").classed("attribute-rect",!0).attr("height",a);var o=l.selectAll("g").data(function(t){return t}).join("g").classed("attribute-node",!0),i=o.append("g").classed("inner-bars",!0);i.append("rect").classed("attribute-inner-bar",!0).attr("height",a),i.attr("transform",function(t){return"translate("+r.v().domain([0,1]).range([0,1e3])(t.edgeMove)+", 0)"});var s=i.append("rect").classed("range-rect",!0);return s.attr("width",20).attr("height",function(t,n){var r=t.yScale;r.range([a,0]);var l=t.leaf?0:r(t.lowerCI95)-r(t.upperCI95);return"true"===e?20:l}),s.attr("transform",function(t,n){var r=t.yScale;return r.range([a,0]),"translate(0, "+(t.leaf||"true"===e?0:r(t.upperCI95))+")"}),s.style("fill",function(t){return t.colorScale(t.realVal)}),s.attr("opacity",function(t){return t.satScale(t.realVal)}),"true"!=e&&i.append("rect").attr("width",20).attr("height",5).attr("transform",function(t,e){var n=t.yScale;return n.range([a,0]),"translate(0, "+n(t.realVal)+")"}).attr("fill",function(t){return t.color}).classed("val-bar",!0),i.on("mouseover",function(t,e,n){var l=t.yScale;l.range([0,a]),r.y(n[e]).append("g").classed("y-axis",!0).call(r.c(l).ticks(5));var o=r.y("#tooltip");o.transition().duration(200).style("opacity",.9);var i=r.l(".3f");o.html("mean: "+i(t.realVal)+"</br></br>upperCI: "+i(t.upperCI95)+"</br></br>lowerCI: "+i(t.lowerCI95)).style("left",r.k.pageX+"px").style("top",r.k.pageY-28+"px"),o.style("height","auto")}).on("mouseout",function(t,e,n){r.y(n[e]).select("g.y-axis"),r.y(n[e]).select("g.y-axis").remove(),r.y("#tooltip").transition().duration(500).style("opacity",0)}),o}function B(t,e){var n=r.q(t.map(function(t){return t.realVal})),a=t.filter(function(t){return t.realVal!=n}),l=t[t.map(function(t){return t.realVal}).indexOf(n)];return l.other=a,l.offset=e,l}function H(t,e){r.y("#show-drop-div-group").attr("value","grouped");var n=r.y("#selected");n.selectAll("*").remove();var a=r.y("#main");a.style("padding-top",0),r.y("#toolbar").append("text").text(t[0].field);var l=[{field:"None"}].concat(e.filter(function(e){return e.field!=t[0].field&&"discrete"===e.type}));P(r.y("#toolbar"),l,"Split On","show-drop-div-group").on("click",function(a,l,o){if(r.y("#toolbar").append("text").text(a.field),"discrete"===a.type){var c=t.map(function(t){var e=a.scales.map(function(e){var n=e.field,r=e.scaleName,a=t.data.filter(function(t){return t.filter(function(t){return!0===t.leaf})[0].attributes[n].winState===r});return{field:n,state:r,data:a}});return t.data=e,t}),u=r.y("#main");u.selectAll("*").remove(),u.style("padding-top","40px");var f=u.selectAll("div.first-group").data(c).join("div").classed("first-group",!0).append("svg");f.attr("height",function(t){return 270*t.data.length});var d=f.append("g"),h=(d.append("text").text(function(t){return t.state}).attr("transform","translate(10, 10)"),d.selectAll("g.second-group").data(function(t){return t.data.map(function(e){var n={};return n.first=[t.field,t.state],n.second=[e.field,e.state],n.data=e.data,n.leaves=e.data.flatMap(function(t){return t.filter(function(t){return!0===t.leaf})}),n})}).join("g").classed("second-group",!0));(h=h.filter(function(t){return t.data.length>0})).attr("transform",function(t,e){return"translate(30,"+(20+270*e)+")"}),h.each(function(t,n,a){var l=g(t.data,r.y(a[n]));l.select("rect").attr("x",-80).attr("fill","gray"),l.selectAll(".branch-points").selectAll("circle").attr("fill","rgba(255, 255, 255, 0.3)"),l.select(".leaf-label").append("text").text(function(t,e){return": "+t.data.length}).attr("transform","translate(45, 0)"),l.selectAll("text").style("font-size","11.5px").style("fill","#fff"),l.select("line").attr("stroke","#fff");var o=r.y(a[n]).append("g"),i=o.append("g").classed("fas fa-search-plus",!0);i.attr("transform","translate(-10, 15)"),i.append("circle").attr("r",7).attr("fill","#fff"),i.append("text").text("+").attr("transform","translate(-5, 3)").attr("fill","gray"),i.style("cursor","pointer"),i.on("click",function(){var l=r.z(a).filter(function(t,e){return e!=n});q(t,l.data(),r.y("#selected"),e)});var s=o.append("text").text(function(t,e){return t.second[1]});s.attr("transform",function(t,e){return"translate(3, 20)"}),s.attr("fill","#fff")});var v=h.filter(function(t){return t.data.length>0}).append("g").classed("inner-wrap",!0);v.attr("transform",function(t,e){return"translate(110, 0)"});var y=v.selectAll(".att-wrapper").data(function(t){var n=p(t.data,e,null);return n[0].map(function(e,r){var a=t.data[0].filter(function(t){return!0===t.leaf})[0].label;e[e.length-1].offset=0;for(var l={label:e[e.length-1].label,type:e[e.length-1].type,data:[{species:a,paths:e}]},o=1;o<n.length;o++){var i=t.data[o].filter(function(t){return!0===t.leaf})[0].label,s=n[o][r].length-1;n[o][r][s].offset=8*o,l.data.push({species:i,paths:n[o][r]})}return l}).map(function(t){return t.data=t.data.map(function(e,n){return e.paths=e.paths.map(function(e){if("discrete"===t.type){var r=5*n;return e.states?{realVal:1,state:e.winState,color:e.color,edgeMove:e.edgeMove,offset:e.offset,leaf:!0}:B(e,r)}return e}),e}),t.leaves=t.data.flatMap(function(t){return t.paths.filter(function(t){return!0===t.leaf})}),t})}).join("g").classed("att-wrapper",!0),m=y.append("rect").attr("width",800);m.attr("height",40),m.style("fill","#fff"),m.style("stroke","gray"),y.attr("transform",function(t,e){return"translate(0,"+(45*e+30)+")"}),s.attr("transform",function(t,e){return"translate(60,"+(275*e+50)+")"}),i.attr("height",275*s.data().length+50),y.append("text").text(function(t){return t.label}).style("text-anchor","end").style("font-size",11).attr("transform","translate(-5,25)");var b=y.filter(function(t){return"discrete"===t.type}).selectAll("g.shift-wrap").data(function(t){return[t.data.flatMap(function(t){return t.paths.filter(function(e,n){return 0===n?0===n:n>0?t.paths[n-1].state!=e.state:n<t.paths.length-1?t.paths[n+1].state!=e.state:void 0})})]}).join("g").classed("shift-wrap",!0);b.attr("transform","translate(850, 0)");var x=b.append("g").classed("axis-x",!0);x.attr("transform","translate(0, 25)"),x.each(function(t,e,n){var a=r.v().domain([0,1]).range([0,200]);r.y(n[e]).call(r.b(a).ticks(5))});var w=b.append("g").attr("transform","translate(0, 20)").selectAll("circle.shift").data(function(t){return t}).join("circle").classed("shift",!0);w.attr("r",4).attr("cx",function(t,e){return r.v().domain([0,1]).range([0,200])(t.edgeMove)}),w.attr("fill",function(t){return t.color}).style("opacity",.4);var A=y.filter(function(t){return"continuous"===t.type}).selectAll("g.observe-wrap").data(function(t){var e=y.data().filter(function(e){return e.label===t.label}).flatMap(function(t){return t.leaves.map(function(t){return t.realVal})}),n=r.q(e),a=r.t(e),l=r.r(e),o=r.v().domain([a,n]).range([0,200]),i=t.leaves.map(function(t,e){return t.index=e,{value:t.realVal,x:o,min:a,max:n,species:t.species}}),s=r.r(i.map(function(t){return t.value}));return[{dotVals:i,x:o,totalMean:l,groupMean:s}]}).join("g").classed("observe-wrap",!0);A.attr("transform","translate(850, 0)");var k=A.append("g").classed("axis-x",!0);k.attr("transform","translate(0, 25)"),k.each(function(t,e,n){r.y(n[e]).call(r.b(t.x).ticks(5))});A.append("rect").classed("line",!0).attr("transform",function(t,e){return"translate("+(t.x(t.totalMean)-1.5)+",0)"}).attr("height",25).attr("width",3).attr("fill","red").style("opacity","0.4"),A.append("rect").classed("line",!0).attr("transform",function(t,e){return"translate("+(t.x(t.groupMean)-1.5)+",0)"}).attr("height",25).attr("width",3).attr("fill","gray").style("opacity","0.4");var S=A.append("g").attr("transform","translate(0, 20)").selectAll("circle").data(function(t){return t.dotVals}).join("circle");S.attr("r",4).attr("cx",function(t,e){return t.x(t.value)}).style("opacity","0.3"),S.on("mouseover",function(t,e,n){var a=r.y("#tooltip");a.transition().duration(200).style("opacity",.9);r.l(".3f");a.html(t.species).style("left",r.k.pageX+10+"px").style("top",r.k.pageY-28+"px"),r.y("#sidebar").selectAll(".node--leaf").filter(function(e){return e.data.label===t.species}).classed("selected",!0)}).on("mouseout",function(t,e,n){r.y(n[e]).classed("selected",!1),S.classed("selected",!1).style("opacity",.3),r.y("#tooltip").transition().duration(500).style("opacity",0),r.y("#sidebar").selectAll(".node--leaf").filter(function(e){return e.data.label===t.species}).classed("selected",!1)});var j=y.selectAll("g.species").data(function(t){return t.data=t.data.map(function(e){return e.type=t.type,e}),t.data}).join("g").classed("species",!0),M=r.p().x(function(t){return r.v().domain([0,1]).range([0,800])(t.edgeMove)}).y(function(t){return r.v().domain([0,1]).range([38,1])(t.realVal)}),O=r.p().x(function(t){return r.v().domain([0,1]).range([0,800])(t.edgeMove)}).y(function(t){var e=t.yScale;return e.range([38,1]),e(t.realVal)+2});j.append("path").attr("d",function(t){return"discrete"===t.type?M(t.paths):O(t.paths)}).attr("class",function(t,e){return t.species+" inner-line"}).style("stroke-width",.7).style("fill","none").style("stroke","gray").on("mouseover",function(t,e,n){r.y(n[e]).classed("selected",!0),S.filter(function(e){return e.species===t.species}).classed("selected",!0).style("opacity",1);var a=r.y("#tooltip");a.transition().duration(200).style("opacity",.9);r.l(".3f");a.html(t.species).style("left",r.k.pageX+10+"px").style("top",r.k.pageY-28+"px"),r.y("#sidebar").selectAll(".node--leaf").filter(function(e){return e.data.label===t.species}).classed("selected",!0)}).on("mouseout",function(t,e,n){r.y(n[e]).classed("selected",!1),S.classed("selected",!1).style("opacity",.3),r.y("#tooltip").transition().duration(500).style("opacity",0),r.y("#sidebar").selectAll(".node--leaf").filter(function(e){return e.data.label===t.species}).classed("selected",!1)});var V=j.filter(function(t){return"discrete"===t.type}).selectAll(".branch").data(function(t){return t.paths}).join("g").classed("branch",!0);V.attr("transform",function(t){return"translate("+r.v().domain([0,1]).range([0,800])(t.edgeMove)+", 0)"});var z=V.append("circle").attr("r",5).attr("cy",function(t,e){return r.v().domain([0,1]).range([35,2])(t.realVal)}).attr("cx",5);z.classed("win-state",!0),z.attr("fill",function(t,e,n){return 0===e?t.color:e===n.length-1?t.state===r.y(n[e-1]).data()[0].state?"rgba(189, 195, 199, 0.3)":(t.shift=!0,t.color):t.state===r.y(n[e+1]).data()[0].state||t.state===r.y(n[e-1]).data()[0].state?"rgba(189, 195, 199, 0.3)":(t.shift=!0,t.color)});var C=V.filter(function(t){return 1!=t.leaf}).selectAll(".other").data(function(t){return t.other}).join("circle").classed("other",!0);C.attr("r",4).attr("cx",5).attr("cy",function(t,e){var n=r.v().domain([1,0]);return n.range([0,35]),n(t.realVal)}).attr("fill","rgba(189, 195, 199, 0.1)"),C.on("mouseover",function(t){var e=r.y("#tooltip");e.transition().duration(200).style("opacity",.9);var n=r.l(".3f");e.html(t.state+": "+n(t.realVal)).style("left",r.k.pageX+10+"px").style("top",r.k.pageY-28+"px")}).on("mouseout",function(t){r.y("#tooltip").transition().duration(500).style("opacity",0)}),z.on("mouseover",function(t){var e=r.y("#tooltip");e.transition().duration(200).style("opacity",.9);var n=r.l(".3f");e.html(t.state+": "+n(t.realVal)).style("left",r.k.pageX+10+"px").style("top",r.k.pageY-28+"px")}).on("mouseout",function(t){r.y("#tooltip").transition().duration(500).style("opacity",0)}),V.on("mouseover",function(t,e,n){var a=r.v().domain([1,0]);a.range([0,35]),i.selectAll("path.inner-line."+t.species).attr("stroke","red"),i.selectAll("path.inner-line."+t.species).classed("selected",!0),r.y(n[e]).append("g").classed("y-axis",!0).call(r.c(a).ticks(3)),r.y(n[e]).selectAll(".other").style("opacity",.7).attr("fill",function(t){return t.color}),r.y(n[e]).selectAll(".win-state").style("opacity",.7).attr("fill",function(t){return t.color})}).on("mouseout",function(t,e,n){r.y(n[e]).select("g.y-axis"),r.y(n[e]).select("g.y-axis").remove(),r.z("path.inner-line."+t.species).attr("stroke","gray"),r.z("path.inner-line."+t.species).classed("selected",!1),r.z(".other").attr("fill","rgba(189, 195, 199, 0.1)"),r.y(n[e]).selectAll(".win-state").filter(function(t){return 1!=t.shift}).attr("fill","rgba(189, 195, 199, 0.3)")});var I=j.filter(function(t){return"continuous"===t.type}).selectAll(".branch").data(function(t){return t.paths}).join("g").classed("branch",!0);I.attr("transform",function(t){return"translate("+r.v().domain([0,1]).range([0,800])(t.edgeMove)+", 0)"}),I.on("mouseover",function(t,e,n){var a=t.yScale;a.range([0,35]),i.selectAll("path.inner-line."+t.species).attr("stroke","red"),i.selectAll("path.inner-line."+t.species).classed("selected",!0),r.y(n[e]).append("g").classed("y-axis",!0).call(r.c(a).ticks(3)),r.y(n[e]).selectAll(".other").style("opacity",.7)}).on("mouseout",function(t,e,n){r.y(n[e]).select("g.y-axis"),r.y(n[e]).select("g.y-axis").remove(),r.z("path.inner-line."+t.species).attr("stroke","gray"),r.z("path.inner-line."+t.species).classed("selected",!1),r.z(".other").style("opacity",.1)});var E=I.append("rect");E.attr("width",10).attr("height",3),E.attr("y",function(t,n){var a=e.filter(function(e){return e.field===t.label})[0];return r.v().domain([a.min,a.max]).range([40,0])(t.realVal)});var T=I.filter(function(t){return 1!=t.leaf}).append("rect");T.attr("width",10).attr("height",function(t,n){var a=e.filter(function(e){return e.field===t.label})[0],l=r.v().domain([a.min,a.max]).range([40,0]);return l(t.lowerCI95)-l(t.upperCI95)}),T.attr("y",function(t,n){var a=e.filter(function(e){return e.field===t.label})[0];return r.v().domain([a.min,a.max]).range([40,0])(t.upperCI95)}),T.style("opacity",.1)}else console.error("THIS HAS TO BE DISCRETE");n.select("#show-drop-div-group").classed("show",!1)});var o=a.select("#main-path-view"),i=o.empty()?a.append("svg").attr("id","main-path-view"):o;i.selectAll("*").remove(),i.attr("height",60*t.length),i.append("g").attr("transform","translate(500, 40)").append("text").text(t[0].field);var s=i.selectAll(".grouped").data(t).join("g").classed("grouped",!0);s.each(function(t,e,n){var a=g(t.data,r.y(n[e]));a.select("rect").attr("x",-80).attr("fill","gray"),a.selectAll(".branch-points").selectAll("circle").attr("fill","rgba(255, 255, 255, 0.3)"),a.select(".leaf-label").append("text").text(function(t,e){return": "+t.data.length}).attr("transform","translate(45, 0)"),a.selectAll("text").style("font-size","11.5px").style("fill","#fff"),a.select("line").attr("stroke","#fff")});var c=s.append("g"),u=c.append("g").classed("fas fa-search-plus",!0);u.attr("transform","translate(20, -5)"),u.append("circle").attr("r",7).attr("fill","#fff"),u.append("text").text("+").attr("transform","translate(5, 3)").attr("fill","gray"),u.style("cursor","pointer"),u.on("click",function(t,n,a){q(t,r.z(a).filter(function(t,e){return e!=n}).data(),r.y("#selected"),e)}),c.append("text").text(function(t,e){return t.state}),c.attr("transform",function(t,e){return"translate(40, 16)"}),c.style("text-anchor","end"),c.attr("fill","#fff");var f=s.append("g").classed("inner-wrap",!0);f.attr("transform",function(t,e){return"translate(110, 0)"});var d=f.selectAll(".att-wrapper").data(function(t,n){var r=p(t.data,e,null);return r[0].map(function(e,n){var a=t.data[0].filter(function(t){return!0===t.leaf})[0].label;e[e.length-1].offset=0;for(var l={label:e[e.length-1].label,type:e[e.length-1].type,data:[{species:a,paths:e}]},o=1;o<r.length;o++){var i=t.data[o].filter(function(t){return!0===t.leaf})[0].label,s=r[o][n].length-1;r[o][n][s].offset=8*o,l.data.push({species:i,paths:r[o][n]})}return l}).map(function(t){return t.data=t.data.map(function(e,n){return e.paths=e.paths.map(function(e){if("discrete"===t.type){var r=5*n;return e.states?{realVal:1,state:e.winState,color:e.color,edgeMove:e.edgeMove,offset:e.offset,leaf:!0}:B(e,r)}return e}),e}),t})}).join("g").classed("att-wrapper",!0),h=d.append("rect").attr("width",800);h.attr("height",40),h.style("fill","#fff"),h.style("stroke","gray"),d.attr("transform",function(t,e){return"translate(0,"+(45*e+30)+")"}),s.attr("transform",function(t,e){return"translate(60,"+(275*e+50)+")"}),i.attr("height",275*s.data().length+50),function(t,e){var n=t.filter(function(t){return"continuous"===t.type}).selectAll("g.observe-wrap-first.continuous").data(function(e){var n=t.data().filter(function(t){return t.label===e.label}).map(function(t){return t.data}).flatMap(function(t){return t.flatMap(function(t){return t.paths[t.paths.length-1].realVal})}),a=r.q(n),l=r.t(n),o=r.r(n),i=r.v().domain([l,a]).range([0,200]),s=e.data.map(function(t,e){return t.index=e,{value:t.paths[t.paths.length-1].realVal,x:i,min:l,max:a,species:t.species}}),c=r.r(s.map(function(t){return t.value}));return[{dotVals:s,x:i,totalMean:o,groupMean:c}]}).join("g").classed("observe-wrap-first continuous",!0);n.attr("transform","translate(850, 0)");var a=n.append("g").classed("axis-x",!0);a.attr("transform","translate(0, 25)"),a.each(function(t,e,n){r.y(n[e]).call(r.b(t.x).ticks(5))}),n.append("rect").classed("line",!0).attr("transform",function(t,e){return"translate("+(t.x(t.totalMean)-1.5)+",0)"}).attr("height",25).attr("width",3).attr("fill","red").style("opacity","0.4"),n.append("rect").classed("line",!0).attr("transform",function(t,e){return"translate("+(t.x(t.groupMean)-1.5)+",0)"}).attr("height",25).attr("width",3).attr("fill","gray").style("opacity","0.4"),n.append("g").attr("transform","translate(0, 20)").selectAll("circle").data(function(t){return t.dotVals}).join("circle").attr("r",4).attr("cx",function(t,e){return t.x(t.value)}).style("opacity","0.3");var l=t.filter(function(t){return"discrete"===t.type}).selectAll("g.observe-wrap-first.discrete").data(function(t){return[t]}).join("g").classed("observe-wrap-first discrete",!0),o=l.filter(function(t){return t.label!=e}).selectAll("rect").data(function(t){var e=v.a(t.data.map(function(t){return t.paths[t.paths.length-1]}),function(t){return t.state});return e.sort(function(t,e){return e[1].length-t[1].length}),e}).join("rect").attr("height",15).attr("width",function(t,e,n){var a=r.v().domain([0,r.A(r.z(n).data().map(function(t){return t[1].length}))]).range([5,170]);return t.width=a(t[1].length),a(t[1].length)});o.attr("x",function(t,e,n){return 0===e?0:(r.z(n).filter(function(t,n){return n<e}),r.A(r.z(n).filter(function(t,n){return n<e}).data().map(function(t){return t.width})))}).attr("y",12),o.attr("fill",function(t){return t[1][0].color}),o.on("mouseover",function(t,e,n){var a=r.y("#tooltip");a.transition().duration(200).style("opacity",.9),a.html(t[0]+"</br>"+t[1].length).style("left",r.k.pageX+10+"px").style("top",r.k.pageY+20+"px"),r.z(n).filter(function(t,n){return n!=e}).attr("opacity",.3)}).on("mouseout",function(t,e,n){r.y("#tooltip").transition().duration(500).style("opacity",0),r.z(n).filter(function(t,n){return n!=e}).attr("opacity",1)}),l.attr("transform","translate(850, 0)");var i=l.filter(function(t){return t.label===e}).selectAll("text").data(function(t){return[t]}).join("text").text(function(t){var e=t.data[t.data.length-1].paths;return"".concat(e[e.length-1].state,": ").concat(t.data.length," / ").concat(100)});i.style("text-anchor","middle"),i.style("font-size","12px"),i.attr("x",90).attr("y",25)}(d,t[0].field),d.append("text").text(function(t){return t.label}).style("text-anchor","end").style("font-size",11).attr("transform","translate(-5,25)");var y=d.selectAll("g.species").data(function(t){return t.data=t.data.map(function(e){return e.type=t.type,e}),t.data}).join("g").classed("species",!0),m=r.p().x(function(t){return r.v().domain([0,1]).range([0,800])(t.edgeMove)}).y(function(t){return r.v().domain([0,1]).range([38,1])(t.realVal)}),b=r.p().x(function(t){return r.v().domain([0,1]).range([0,800])(t.edgeMove)}).y(function(t){var e=t.yScale;return e.range([38,1]),e(t.realVal)+2});y.append("path").attr("d",function(t){return"discrete"===t.type?m(t.paths):b(t.paths)}).attr("class",function(t,e){return t.species+" inner-line"}).style("stroke-width",.7).style("fill","none").style("stroke","gray").on("mouseover",function(t,e,n){r.y(n[e]).classed("selected",!0)}).on("mouseout",function(t,e,n){r.y(n[e]).classed("selected",!1)});var x=y.filter(function(t){return"discrete"===t.type}).selectAll(".branch").data(function(t){return t.paths}).join("g").classed("branch",!0);x.attr("transform",function(t){return"translate("+r.v().domain([0,1]).range([0,800])(t.edgeMove)+", 0)"});var w=x.append("circle").attr("r",5).attr("cy",function(t,e){return r.v().domain([0,1]).range([35,2])(t.realVal)}).attr("cx",5);w.classed("win-state",!0),w.attr("fill",function(t,e,n){return 0===e||e===n.length-1?t.color:t.state===r.y(n[e+1]).data()[0].state||t.state===r.y(n[e-1]).data()[0].state?"rgba(189, 195, 199, 0.3)":(t.shift=!0,t.color)});var A=x.filter(function(t){return 1!=t.leaf}).selectAll(".other").data(function(t){return t.other}).join("circle").classed("other",!0);A.attr("r",4).attr("cx",5).attr("cy",function(t,e){var n=r.v().domain([1,0]);return n.range([0,35]),n(t.realVal)}).attr("fill","rgba(189, 195, 199, 0.1)"),A.on("mouseover",function(t){var e=r.y("#tooltip");e.transition().duration(200).style("opacity",.9);var n=r.l(".3f");e.html(t.state+": "+n(t.realVal)).style("left",r.k.pageX+10+"px").style("top",r.k.pageY-28+"px")}).on("mouseout",function(t){r.y("#tooltip").transition().duration(500).style("opacity",0)}),w.on("mouseover",function(t){var e=r.y("#tooltip");e.transition().duration(200).style("opacity",.9);var n=r.l(".3f");e.html(t.state+": "+n(t.realVal)).style("left",r.k.pageX+10+"px").style("top",r.k.pageY-28+"px")}).on("mouseout",function(t){r.y("#tooltip").transition().duration(500).style("opacity",0)}),x.on("mouseover",function(t,e,n){var a=r.v().domain([1,0]);a.range([0,35]),i.selectAll("path.inner-line."+t.species).attr("stroke","red"),i.selectAll("path.inner-line."+t.species).classed("selected",!0),r.y(n[e]).append("g").classed("y-axis",!0).call(r.c(a).ticks(3)),r.y(n[e]).selectAll(".other").style("opacity",.7).attr("fill",function(t){return t.color}),r.y(n[e]).selectAll(".win-state").style("opacity",.7).attr("fill",function(t){return t.color})}).on("mouseout",function(t,e,n){r.y(n[e]).select("g.y-axis"),r.y(n[e]).select("g.y-axis").remove(),r.z("path.inner-line."+t.species).attr("stroke","gray"),r.z("path.inner-line."+t.species).classed("selected",!1),r.z(".other").attr("fill","rgba(189, 195, 199, 0.1)"),r.y(n[e]).selectAll(".win-state").filter(function(t){return 1!=t.shift}).attr("fill","rgba(189, 195, 199, 0.3)")});var k=y.filter(function(t){return"continuous"===t.type}).selectAll(".branch").data(function(t){return t.paths}).join("g").classed("branch",!0);k.attr("transform",function(t){return"translate("+r.v().domain([0,1]).range([0,800])(t.edgeMove)+", 0)"}),k.on("mouseover",function(t,e,n){var a=t.yScale;a.range([0,35]),i.selectAll("path.inner-line."+t.species).attr("stroke","red"),i.selectAll("path.inner-line."+t.species).classed("selected",!0),r.y(n[e]).append("g").classed("y-axis",!0).call(r.c(a).ticks(3)),r.y(n[e]).selectAll(".other").style("opacity",.7)}).on("mouseout",function(t,e,n){r.y(n[e]).select("g.y-axis"),r.y(n[e]).select("g.y-axis").remove(),r.z("path.inner-line."+t.species).attr("stroke","gray"),r.z("path.inner-line."+t.species).classed("selected",!1),r.z(".other").style("opacity",.1)});var S=k.append("rect");S.attr("width",10).attr("height",3),S.attr("y",function(t,n){var a=e.filter(function(e){return e.field===t.label})[0];return r.v().domain([a.min,a.max]).range([40,0])(t.realVal)});var j=k.filter(function(t){return 1!=t.leaf}).append("rect");j.attr("width",10).attr("height",function(t,n){var a=e.filter(function(e){return e.field===t.label})[0],l=r.v().domain([a.min,a.max]).range([40,0]);return l(t.lowerCI95)-l(t.upperCI95)}),j.attr("y",function(t,n){var a=e.filter(function(e){return e.field===t.label})[0];return r.v().domain([a.min,a.max]).range([40,0])(t.upperCI95)}),j.style("opacity",.1),r.z(".att-wrapper").selectAll(".branch").on("mouseover",function(t,e,n){r.y("#sidebar").selectAll(".node").filter(function(e){return t.node===e.data.node}).classed("selected",!0)}).on("mouseout",function(t,e,n){r.y("#sidebar").selectAll(".node").filter(function(e){return t.node===e.data.node}).classed("selected",!1)})}function U(t,e,n){var a=t.filter(function(t){return"discrete"===t[t.length-1].type});a.selectAll("*").remove();var l="true"===e?20:45,o=a.append("g").classed("attribute-time-line",!0);o.append("line").classed("half",!0).attr("x1",0).attr("y1",22).attr("x2",1010).attr("y2",22);var i=o.selectAll("g").data(function(t){var e=t.map(function(t){return 1==t.leaf?t.states.map(function(e){return e.move=t.move,e.edgeMove=t.edgeMove,e.color=t.color,e}):t});return e[0].map(function(t){return t.state}).map(function(t){return e.map(function(e){return e.filter(function(e){return e.state==t})[0]})})}).join("g").classed("state-path",!0),s=r.p().x(function(t){return r.v().domain([0,1]).range([0,1e3])(t.edgeMove)+7}).y(function(t){return r.v().domain([0,1]).range([l-2,1])(t.realVal)});i.append("path").attr("d",s).attr("class",function(t,e){return t[0].species+" inner-line"}).style("stroke-width",.7).style("stroke",function(t){return t[0].color});o.append("rect").classed("attribute-rect",!0).attr("height",l);var c=o.selectAll(".attribute-node-discrete").data(function(t){return t}).join("g");if(c.attr("transform",function(t){var e=r.v().domain([0,1]).range([0,1e3]);return t[0]?"translate("+e(t[0].edgeMove)+", 0)":"translate("+e(t.edgeMove)+", 0)"}),c.append("rect").attr("width",20).attr("height",l).attr("opacity",0),c.append("line").attr("x1",10).attr("x2",10).attr("y1",0).attr("y2",l),c.on("mouseover",function(t,e,n){var a=r.v().domain([1,0]);a.range([0,l]),r.y(n[e]).append("g").classed("y-axis",!0).call(r.c(a).ticks(3))}).on("mouseout",function(t,e,n){r.y(n[e]).select("g.y-axis"),r.y(n[e]).select("g.y-axis").remove()}),c.attr("class",function(t,e,n){var a=r.z(n).data();return a[a.length-1].species}).classed("attribute-node-discrete",!0),!1===n){var u=c.filter(function(t,e){return null!=t[0]}).selectAll(".dots").data(function(t){return t}).join("circle").classed("dots",!0);u.attr("cx",10).attr("cy",function(t){return r.v().domain([0,1]).range([l-2,2])(t.realVal)}).attr("r",2),u.style("fill",function(t,e,n){return"gray"}),u.filter(function(t){return t.realVal>.5}).attr("r",4),u.on("mouseover",function(t){var e=r.y("#tooltip");e.transition().duration(200).style("opacity",.9);var n=r.l(".3f");e.html(t.state+": "+n(t.realVal)).style("left",r.k.pageX+"px").style("top",r.k.pageY-28+"px")}).on("mouseout",function(t){r.y("#tooltip").transition().duration(500).style("opacity",0)});var f=c.filter(function(t,e){return void 0===t[0]}).classed("discrete-leaf",!0);f.append("circle").attr("cx",10).attr("cy",2).attr("r",7).style("fill",function(t){return t.color}),f.append("text").text(function(t){return t.winState}).attr("transform","translate(20, 5)").style("font-size",10)}else{c.filter(function(t,e){return null!=t[0]}).append("rect").attr("height",l).attr("width",20).attr("fill","#fff");var d=c.filter(function(t,e){return null!=t[0]}).selectAll(".dis-rect").data(function(t){return t}).join("rect").classed("dis-rect",!0);d.attr("width",20).attr("height",function(t,e){return r.v().domain([0,1]).range([0,l])(t.realVal)}),d.attr("fill",function(t,e){return t.color}),d.attr("opacity","0.7"),d.attr("stroke","#fff"),d.attr("transform",function(t,e,n){var a=r.v().domain([0,1]).range([0,l]),o=r.z(n).data().sort(function(t,e){return e.realVal-t.realVal}),i=o.map(function(t){return t.state}).indexOf(t.state);if(0===i)return"translate(0,0)";for(var s=0,c=0;c<i;c++)s+=o[c].realVal;return"translate(0,"+a(s)+")"}),d.on("mouseover",function(t){var e=r.y("#tooltip");e.transition().duration(200).style("opacity",.9);var n=r.l(".3f");e.html(t.state+": "+n(t.realVal)).style("left",r.k.pageX+"px").style("top",r.k.pageY-28+"px")}).on("mouseout",function(t){r.y("#tooltip").transition().duration(500).style("opacity",0)});var p=c.filter(function(t,e){return void 0===t[0]}).classed("discrete-leaf",!0);p.append("circle").attr("cx",10).attr("cy",2).attr("r",7).style("fill",function(t){return t.color}),p.append("text").text(function(t){return t.winState}).attr("transform","translate(20, 5)").style("font-size",10)}return c}function G(t,e,n,r,a,l,o){try{var i=t[l](o),s=i.value}catch(t){return void n(t)}i.done?e(s):Promise.resolve(s).then(r,a)}function J(t){return function(t){if(Array.isArray(t)){for(var e=0,n=new Array(t.length);e<t.length;e++)n[e]=t[e];return n}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function Q(t,e){return function t(e,n){return e.children=n.filter(function(t){return String(t.V1)===String(e.node)}),e.name=String(e.node),e.children.length>0?(e.children.forEach(function(e){return t(e,n)}),e):e}(t[0][0],e.rows)}function K(t,e){var n=this,a=r.y("#sidebar"),l=r.y("#toolbar"),o=(A.length,ot[0]),i=Z(o,a.select("svg").select("g").selectAll(".node").filter(function(t){return t.y>r.k.selection[0][0]&&t.y<r.k.selection[1][0]&&t.x>r.k.selection[0][1]&&t.x<r.k.selection[1][1]}).classed("selected",!0).data().map(function(t){return t.data.node})),s="brush-"+A.filter(function(t){return"topology"===t.attributType}).length;S("data-filter","topology",s,Z,J(o),J(i),null);b(e);var c=r.y("#sidebar").selectAll(".link"),u=r.y("#sidebar").selectAll(".node"),f=i.flatMap(function(t){return t.map(function(t){return t.node})});r.z(".link-not-there").classed("link-not-there",!1),r.z(".node-not-there").classed("node-not-there",!1),c.filter(function(t){return-1===f.indexOf(t.data.node)}).classed("link-not-there",!0),u.filter(function(t){return-1===f.indexOf(t.data.node)}).classed("node-not-there",!0);var d=l.append("button").classed("btn btn-info",!0);d.append("span").classed("badge badge-light",!0).text(i.length),d.append("h6").text("Tree Filter").append("i").classed("close fas fa-times",!0).on("click",function(){var a,l=(a=regeneratorRuntime.mark(function a(l,o,i){return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return k(s),a.next=3,b(e);case 3:r.z(".selected").classed("selected",!1),r.z(".link-not-there").classed("link-not-there",!1),r.z(".node-not-there").classed("node-not-there",!1),d.remove(),r.y(n).call(t.move,null),r.y(".tree-brush").remove();case 9:case"end":return a.stop()}},a)}),function(){var t=this,e=arguments;return new Promise(function(n,r){var l=a.apply(t,e);function o(t){G(l,n,r,o,i,"next",t)}function i(t){G(l,n,r,o,i,"throw",t)}o(void 0)})});return function(t,e,n){return l.apply(this,arguments)}}())}function W(t,e,n){var a=(n=n.append("div").classed("button-wrap",!0)).append("button").text("Filter by Tree").classed("btn btn-outline-secondary",!0),l=r.d().extent([[0,0],[400,600]]).on("end",function(t,n,r){return K(l,e)});a.on("click",function(){tt(n,!0,null,!0);n.select("svg").append("g").classed("tree-brush",!0).call(l)});var o=n.append("button").text("Hide Lengths").attr("id","length").classed("btn btn-outline-secondary",!0);o.on("click",function(){n.select("svg").remove(),"Show Lengths"===o.text()?(tt(n,null,!0),o.text("Hide Lengths")):(tt(n,null,!1),o.text("Show Lengths"))}),o.style("opacity",0).style("width",0).style("padding",0).style("margin",0);var i=[{field:"None"}];e.map(function(t){return i.push(t)}),P(n,i,"See Values","show-drop-div-sidebar").on("click",function(t,e,r){"discrete"===t.type?tt(n,t,!0):(t.type,tt(n,null,!1)),n.select("#show-drop-div-sidebar").classed("show",!1)})}function Z(t,e){return t.filter(function(t){return t.map(function(t){return t.node}).map(function(t){return e.indexOf(t)>-1}).indexOf(!0)>-1})}function $(t){t.children&&(t._children=t.children,t._children.forEach($),t.children=null)}function tt(t,e,n,a){var l={margin:{top:10,right:90,bottom:50,left:20},width:290,height:520},o=r.D().size([l.height,l.width]);!function t(e,n){n.combEdge=n.edgeLength+e,n.children&&n.children.forEach(function(e){t(n.combEdge,e)})}(0,ct[0]),console.log("neeested",a?ct[0].attributes[a].yScale.domain():null);var i=r.m(ct[0]);i=o(i);var s=r.y("#show-drop-div-group").attr("value"),c="Hide Lengths"===r.y("button#length").text(),u=t.select("svg"),f=u.empty()?t.append("svg"):u;f.attr("width",l.width+l.margin.left+l.margin.right).attr("height",l.height+l.margin.top+l.margin.bottom);var d=f.select("g.tree-g"),p=d.empty()?f.append("g").classed("tree-g",!0):d;(p.attr("transform","translate("+l.margin.left+","+l.margin.top+")"),"ungrouped"===s&&!1===n)?et(function(t){return e(t,[]).forEach(function(t){return"Norops"===t.data.clade?t.data.clade="Norops":t.data.clade="Anolis"}),function t(n){var r=e(n,[]),a=new Set(r.map(function(t){return t.data.clade}));return a.size>1?(n.children.map(function(e){return t(e)}),n):(n.branchPoint=!0,n.clade=Array.from(a)[0],$(n),n)}(t);function e(t,n){return null!=t.children?t.children.map(function(t){return e(t,n)}):n.push(t),n}}(i),l,f,p,e,c):(console.log("pheno",a),et(i,l,f,p,e,c,a))}function et(t,e,n,a,l,o,i){!function t(e,n){if(void 0===e.children||null===e.children)return n+=1.5,e.position=n,n;var a=[];return e.children.forEach(function(e){n=t(e,n),a.push(n)}),e.options=a,e.position=r.q(a),n}(t,0);var s=function(t,e){return function t(n){null!=n.children?n.children.forEach(function(e){t(e)}):e.push(n)}(t),e}(t,[]),c=r.v().domain([0,1]).range([0,e.width]).clamp(!0),u=r.v().range([e.height,0]).domain([0,1]);o&&(a.attr("transform","translate(20, 265)"),n.attr("height",800),u.range([500,0]).domain([0,s.length]),c.range([0,e.width+10])),i&&(a.attr("transform","translate(20, 50)"),n.attr("height",800),c.domain(t.data.attributes[i].yScale.domain()),u.domain([0,1]).range([0,500]));var f=a.selectAll(".link").data(t.descendants().slice(1)).join("path").attr("class","link");f.transition().duration(500).attr("d",function(t){return o&&void 0===i?"M"+c(t.data.combEdge)+","+u(t.position)+"C"+(c(t.data.combEdge)+c(t.parent.data.combEdge))/2+","+u(t.position)+" "+c(t.parent.data.combEdge)+","+u(t.position)+" "+c(t.parent.data.combEdge)+","+u(t.parent.position):"M"+c(t.data.attributes[i].realVal)+","+u(t.data.combEdge)+" "+c(t.parent.data.attributes[i].realVal)+","+u(t.parent.data.combEdge)}),i&&f.style("opacity",.3);var d=a.selectAll(".node").data(t.descendants(),function(t){return t.data.node}).join("g").attr("class",function(t){return"node"+(t.children?" node--internal":" node--leaf")});if(d.selectAll("circle").data(function(t){return[t]}).join("circle").attr("r",3),d.transition().duration(500).attr("transform",function(t){return o&&void 0===i?"translate("+c(t.data.combEdge)+","+u(t.position)+")":"translate("+c(t.data.attributes[i].realVal)+","+u(t.data.combEdge)+")"}),null!=l){var p=d.filter(function(t){return!0===t.data.leaf}),h=d.filter(function(t){return 1!=t.data.leaf});l.stateColors.forEach(function(t){var e=p.filter(function(e){return e.data.attributes[l.field].winState===t.state}).select("circle");e.attr("fill",t.color),e.attr("r",4),h.selectAll("circle").attr("fill","gray")})}else d.selectAll("circle").attr("fill","gray");d.on("mouseover",function(t,e,n){var a=r.y("#main-path-view").selectAll(".paths");if(r.y("#main-summary-view").selectAll(".branch-points").filter(function(e){return e.node===t.data.node}).classed("selected",!0),a.filter(function(e){return e.map(function(t){return t.node}).indexOf(t.data.node)>-1}).classed("hover",!0).selectAll("g").filter(function(e){return e.node===t.data.node}).classed("selected",!0),r.y(n[e]).classed("selected-branch",!0),t.data.label){var l=r.y("#tooltip");l.transition().duration(200).style("opacity",.9),l.html("".concat(t.data.label.charAt(0).toUpperCase()+t.data.label.slice(1))).style("left",r.k.pageX-40+"px").style("top",r.k.pageY-28+"px"),l.style("height","auto")}}).on("mouseout",function(t,e,n){r.z(".paths.hover").classed("hover",!1),r.z("g.selected").classed("selected",!1),r.y(n[e]).classed("selected-branch",!1),r.y("#tooltip").transition().duration(500).style("opacity",0)});d.filter(function(t){return 0==t.data.children.length});d.selectAll("text").remove(),d.selectAll(".triangle").remove();var v=d.filter(function(t){return!0===t.branchPoint});return v.each(function(t,e,n){if(null===t.children){var a=r.y(n[e]).append("path").classed("triangle",!0).attr("d",r.B().type(r.C).size("400"));a.attr("transform","rotate(-90) translate(0, 65) scale(.9 4)"),a.attr("fill","gray").style("opacity",.3),r.y(n[e]).selectAll("text").data(function(t){return[t]}).join("text").text(t.clade).attr("transform","translate(55, 5)")}}),v.select("circle").attr("fill","red").attr("r",4.5),v.on("click",function(o,i,s){null==o.children?function t(e){e.children=e._children,e._children=null,e.children&&e.children.map(function(e){return t(e)})}(o):$(o);var c="Hide Lengths"===r.y("button#length").text();et(t,e,n,a,l,c)}),d.raise(),d.selectAll("circle").raise(),d}function nt(t){return function(t){if(Array.isArray(t)){for(var e=0,n=new Array(t.length);e<t.length;e++)n[e]=t[e];return n}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function rt(t,e){var n=r.q(nt(t).map(function(t){return t.deltas.filter(function(t){return t.key===e})[0]}).map(function(t){return t.value})),a=r.q(nt(t).map(function(t){return t.closeness.filter(function(t){return t.key===e})[0]}).map(function(t){return t.value})),l=r.q(nt(t).map(function(t){return t.distance})),o=r.v().domain([0,n]).range([0,1]),i=r.v().domain([a,0]).range([0,1]),s=r.v().domain([0,l]).range([0,1]),c=nt(t).map(function(t){return t.delta=t.deltas.filter(function(t){return t.key===e})[0],t.closeness=t.closeness.filter(function(t){return t.key===e})[0],t.deltaRank=o(t.delta.value),t.closenessRank=i(t.closeness.value),t.distanceRank=s(t.distance),t.totalRank=t.deltaRank+t.closenessRank+t.distanceRank,t}).sort(function(t,e){return e.totalRank-t.totalRank}).slice(0,40);!function(t,e){var n=this,a=r.v().domain([0,1]).range([0,600]);r.y("#main").selectAll("*").remove();var l=r.y("#main").append("svg");l.attr("height",150*t.length);var o=l.append("g");o.attr("transform","translate(20, 70)");var i=o.selectAll("g.pair-wrap").data(t).join("g").classed("pair-wrap",!0);i.attr("transform",function(t,e){return"translate(50,".concat(150*e,")")}),i.append("rect").attr("width",function(t,e){return 600-a(t.common.edgeMove)}).attr("height",100).attr("x",function(t){return a(t.common.edgeMove)}).attr("stroke-width",1).attr("stroke","black").attr("fill","#fff"),i.append("text").text(function(t,e){return"".concat(t.p1[t.p1.length-1].label," + ").concat(t.p2[t.p2.length-1].label)}).attr("y",-10);var s=i.selectAll("g.pair").data(function(t){return[t.p1,t.p2]}).join("g").classed("pair",!0),c=r.p().x(function(t){var e=r.v().domain([0,1]).range([0,600]),n=e(t.edgeMove);return n}).y(function(t){var n=t.attributes[e].yScale;return n.range([100,0]),n(t.attributes[e].realVal)}),u=(s.append("path").attr("d",c).attr("class","inner-line").style("stroke","rgb(165, 185, 198)"),s.selectAll("g.branch").data(function(t){return t}).join("g").classed("branch",!0));u.attr("transform",function(t,e){return"translate(".concat(a(t.edgeMove),", 0)")}),u.filter(function(t){return 1!=t.leaf}).append("rect").attr("width",10).attr("height",function(t){var n=t.attributes[e].yScale;return n(t.attributes[e].lowerCI95)-n(t.attributes[e].upperCI95)}).attr("fill","rgb(165, 185, 198, .5)").attr("y",function(t,n){var r=t.attributes[e].yScale;return r(t.attributes[e].upperCI95)}),u.append("rect").attr("width",10).attr("height",4).attr("y",function(t,n){return t.attributes[e].yScale(t.attributes[e].realVal)-2}),i.append("rect").attr("width",function(t,e){return a(t.common.edgeMove)}).attr("height",100).attr("fill","#fff").style("opacity",.7);i.append("g").classed("y-axis",!0);var f=i.append("g").classed("x-axis",!0);f.call(r.b(a).ticks(10)),f.attr("transform","translate(0, ".concat(100,")")),i.on("mouseover",function(t,e){var a=nt(t.p1.map(function(t){return t.node})).concat(t.p2.map(function(t){return t.node})),l=nt(t.p1.filter(function(t){return!0===t.leaf}).map(function(t){return t.label})).concat(t.p1.filter(function(t){return!0===t.leaf}).map(function(t){return t.label})),o=l.flatMap(function(t){var e=ut[0].indexOf(t),n=ut[0].filter(function(t,n){return n<+e+4&&n>+e-4});return n}),i=ot[0].filter(function(t){return o.indexOf(t[t.length-1].label)>-1}).flatMap(function(t){return t.map(function(t){return t.node})}),s=r.y("#sidebar").selectAll(".node"),c=r.y("#sidebar").selectAll(".link");return s.filter(function(t){return a.indexOf(t.data.node)>-1}).classed("hover",!0),c.filter(function(t){return a.indexOf(t.data.node)>-1}).classed("hover",!0),s.filter(function(t){return i.indexOf(t.data.node)>-1}).classed("hover-neighbor",!0),s.filter(function(t){return-1===i.indexOf(t.data.node)&&-1===a.indexOf(t.data.node)}).classed("hover-not",!0),c.filter(function(t){return i.indexOf(t.data.node)>-1}).classed("hover-neighbor",!0),c.filter(function(t){return-1===i.indexOf(t.data.node)&&-1===a.indexOf(t.data.node)}).classed("hover-not",!0),r.y(n).classed("hover",!0)}),i.on("mousemove",function(t,n){var a=this,l=t.p1[0].attributes[e].yScale,o=r.y(this).select(".y-axis"),i=o.empty()?r.y(this).append("g").classed("y-axis",!0):o;if(r.y("#compare-button").empty()||"Normal Mode"===r.y("#compare-button").text())i.attr("transform",function(t,e){return"translate("+(r.u(a)[0]-10)+",0)"}),i.call(r.c(l).ticks(5));else{var s=r.y(this).select(".path-groups").selectAll("path"),c=s.data().map(function(t){return t[0].maxDiff})[0];i.attr("transform",function(t,e){return"translate("+(r.u(a)[0]-10)+",0)"});var u=r.v().domain([c,0]).range([0,60]);i.call(r.c(u).ticks(5))}}).on("mouseleave",function(){var t=r.y(this).select(".y-axis");t.remove();r.y("#sidebar").selectAll(".node").classed("hover",!1).classed("hover-neighbor",!1).classed("hover-not",!1),r.y("#sidebar").selectAll(".link").classed("hover",!1).classed("hover-neighbor",!1).classed("hover-not",!1);return r.y(this).classed("hover",!1)})}(c=c.filter(function(t,e){return e%2==0}),e)}function at(t,e,n,a,l){console.log("paths",l);var o=t.append("button").attr("id","view-toggle").attr("attr","button").attr("class","btn btn-outline-secondary");o.on("click",function(){return function(t,e){"View Paths"===t.text()?t.text("View Summary"):t.text("View Paths");b(e)}(o,a)});var i=t.append("button").attr("id","pair-toggle").attr("attr","button").attr("class","btn btn-outline-secondary");i.text("Pair View"),i.on("click",function(){!function(t,e){var n=s(t),a=r.j(n[0].p1[0].attributes).filter(function(t){return"continuous"===t.value.type}).map(function(t){return{field:t.key,value:t.key}});P(r.y("#toolbar"),a,a[0].field,"attr-drop").on("click",function(e,n,a){rt(s(t),e.field),tt(r.y("#sidebar"),null,!0,e.field),r.y(".attr-drop.dropdown").select("button").text(e.field)}),rt(nt(n),a[0].field);var l=r.y("#sidebar").select(".button-wrap").append("button").text("Phenogram");l.classed("btn btn-outline-secondary",!0),l.on("click",function(){tt(r.y("#sidebar"),null,!0,r.y(".attr-drop.dropdown").select("button").text())})}(e)}),"paths"===l?o.text("View Summary"):"summary"===l?o.text("View Paths"):console.error("pathView parameter not found");var c=t.append("button").attr("id","view-filter");c.attr("class","btn btn-outline-secondary").text("Show Filters"),c.on("click",function(){return M(c,n)});var u=t.append("button").attr("id","scrunch");u.attr("class","btn btn-outline-secondary").text("Collapse Attributes"),u.attr("value",!1),u.on("click",function(){return function(t,e,n){var r=j();"Collapse Attributes"===t.text()?(t.text("Expand Attributes"),e.selectAll("*").remove(),t.attr("value",!0),R(r,e,n)):(t.text("Collapse Attributes"),e.selectAll("*").remove(),t.attr("value",!1),R(r,e,n))}(u,n,a)});var f=t.append("button").attr("id","discrete-view");f.attr("class","btn btn-outline-secondary").text("Switch to Discrete Bars"),f.attr("value",!1),f.on("click",function(){var t=r.z(".predicated-attr-groups");"Switch to Discrete Bars"===f.text()?(f.text("Switch to Discrete Dots"),U(t,st,!0)):(f.text("Switch to Discrete Bars"),U(t,st,!1))});var d=[{field:"None"}];a.map(function(t){"discrete"===t.type&&d.push(t)});var p=P(t,d,"Group By","show-drop-div-group");t.select("#show-drop-div-group").attr("value","ungrouped"),console.log("dropOptions",t.select("#show-drop-div-group").attr("value")),p.on("click",function(e,n,l){if("discrete"===e.type){var o=j(),i=e.scales.map(function(t){return{field:t.field,state:t.scaleName,data:[]}});i.map(function(t){t.data=o.filter(function(e){return e.filter(function(t){return!0===t.leaf})[0].attributes[t.field].winState===t.state})}),r.y("#main").selectAll("*").remove(),H(i,a)}else console.error("THIS HAS TO BE DISCRETE");t.select("#show-drop-div-group").classed("show",!1)})}function lt(t,e,n,r,a,l,o){try{var i=t[l](o),s=i.value}catch(t){return void n(t)}i.done?e(s):Promise.resolve(s).then(r,a)}n.d(e,"dataMaster",function(){return ot}),n.d(e,"savedSelected",function(){return it}),n.d(e,"collapsed",function(){return st}),n.d(e,"nestedData",function(){return ct}),n.d(e,"speciesTest",function(){return ut}),n.d(e,"colorKeeper",function(){return ft});var ot=[],it=[],st=!1,ct=[],ut=[],ft=[["#0dc1d1","#c8f7fd"],["#3AD701","#2a9b01"],["#fec303","#d3a001"],["#fe4ecb","#d30197"],["#f36b2c"],["#1abc9c"],["#493267"],["#a40b0b"],["#0095b6"]],dt=r.y("#wrapper"),pt=dt.select("#main"),ht=(dt.select("#selected"),dt.select("#sidebar")),vt=dt.select("#toolbar");l(r.o,"./public/data/body-length-res.json","").then(function(t){return console.log("new data!",t)}),l(r.o,"./public/data/anolis-edges.json","edge").then(function(){var t,e=(t=regeneratorRuntime.mark(function t(e){var n,a,o,i,s,p,v,y,g,m,b,w;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return Array.prototype.unique=function(){return this.filter(function(t,e,n){return n.indexOf(t)===e})},t.next=3,l(r.o,"./public/data/anolis-edge-length.json","edge");case 3:return n=t.sent,a=e.rows.map(function(t){return t.V1}),o=e.rows.filter(function(t){return-1==a.indexOf(t.V2)}),t.next=8,l(r.o,"./public/data/anolisLeafChar.json","");case 8:return i=t.sent,t.next=11,l(r.f,"./public/data/anolisDataNew.csv","");case 11:return s=t.sent,t.next=14,l(r.o,"./public/data/anolis-labels.json","");case 14:return p=t.sent,console.log("leafffs",i),Object.entries(s).filter(function(t){return"columns"!=t[0]&&"type"!=t[0]}),t.next=19,l(r.o,"./public/data/anolis-awesomeness-res.json","continuous");case 19:return t.t0=t.sent,t.next=22,l(r.o,"./public/data/anolis-island-res.json","discrete");case 22:return t.t1=t.sent,t.next=25,l(r.o,"./public/data/anolis-svl-res.json","continuous");case 25:return t.t2=t.sent,t.next=28,l(r.o,"./public/data/anolis-ecomorph-res.json","discrete");case 28:return t.t3=t.sent,t.next=31,l(r.o,"./public/data/padwidth-vs-tail-res.json","continuous");case 31:t.t4=t.sent,v={awesomeness:t.t0,island:t.t1,SVL:t.t2,ecomorph:t.t3,PCIII_padwidth_vs_tail:t.t4},y=c(v,ft),g=u(p,o,i,y),m=f(e,n,v,y),b=h(m,g,"V1","V2"),w=d(b,v,y),ot.push(w),ut.push(w.flatMap(function(t){return t.filter(function(t){return!0===t.leaf})}).map(function(t){return t.label})),at(vt,w,pt,y,"paths"),dt.select("#filter-tab").classed("hidden",!0),ct.push(Q(b,e)),W(0,y,ht),tt(ht,null,!1),x(y);case 46:case"end":return t.stop()}},t)}),function(){var e=this,n=arguments;return new Promise(function(r,a){var l=t.apply(e,n);function o(t){lt(l,r,a,o,i,"next",t)}function i(t){lt(l,r,a,o,i,"throw",t)}o(void 0)})});return function(t){return e.apply(this,arguments)}}());dt.append("div").attr("id","tooltip").style("opacity",0)},35:function(t,e,n){}});
//# sourceMappingURL=app.322a10b8.js.map