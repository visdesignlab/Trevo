!function(t){function e(e){for(var r,o,i=e[0],s=e[1],c=e[2],d=0,f=[];d<i.length;d++)o=i[d],Object.prototype.hasOwnProperty.call(a,o)&&a[o]&&f.push(a[o][0]),a[o]=0;for(r in s)Object.prototype.hasOwnProperty.call(s,r)&&(t[r]=s[r]);for(u&&u(e);f.length;)f.shift()();return l.push.apply(l,c||[]),n()}function n(){for(var t,e=0;e<l.length;e++){for(var n=l[e],r=!0,i=1;i<n.length;i++){var s=n[i];0!==a[s]&&(r=!1)}r&&(l.splice(e--,1),t=o(o.s=n[0]))}return t}var r={},a={0:0},l=[];function o(e){if(r[e])return r[e].exports;var n=r[e]={i:e,l:!1,exports:{}};return t[e].call(n.exports,n,n.exports,o),n.l=!0,n.exports}o.m=t,o.c=r,o.d=function(t,e,n){o.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},o.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},o.t=function(t,e){if(1&e&&(t=o(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)o.d(n,r,function(e){return t[e]}.bind(null,r));return n},o.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return o.d(e,"a",e),e},o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},o.p="/Trevo/";var i=window.webpackJsonp=window.webpackJsonp||[],s=i.push.bind(i);i.push=e,i=i.slice();for(var c=0;c<i.length;c++)e(i[c]);var u=s;l.push([197,1]),n()}({197:function(t,e,n){"use strict";n.r(e);n(19),n(11),n(23),n(40),n(17),n(12),n(10),n(24),n(28),n(58),n(13),n(41),n(42),n(43),n(14),n(44),n(49);var r=n(0),a=(n(45),n(46),n(47),n(29),n(25),n(30),n(59),n(50),n(74),n(26),n(142));function l(t,e,n,r,a,l,o){try{var i=t[l](o),s=i.value}catch(t){return void n(t)}i.done?e(s):Promise.resolve(s).then(r,a)}function o(t){return function(){var e=this,n=arguments;return new Promise((function(r,a){var o=t.apply(e,n);function i(t){l(o,r,a,i,s,"next",t)}function s(t){l(o,r,a,i,s,"throw",t)}i(void 0)}))}}var i="https://api.multinet.app/api",s=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.tables={},this.nodes=[],this.links=[],this.graph_structure={},this.api_root=i},c=Object(a.a)(i);function u(t){return d.apply(this,arguments)}function d(){return(d=o(regeneratorRuntime.mark((function t(e){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,c.networks(e);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function f(t,e){return p.apply(this,arguments)}function p(){return(p=o(regeneratorRuntime.mark((function t(e,n){var r,a;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=new s,t.next=3,c.networkTables(e,n);case 3:return a=t.sent,r.tables=a,t.next=7,c.table(e,a.filter((function(t){return t.name.includes("internal")}))[0].name,{limit:1e3});case 7:return r.nodes[0]=t.sent,t.next=10,c.table(e,a.filter((function(t){return t.name.includes("leaf")}))[0].name,{limit:1e3});case 10:return r.nodes[1]=t.sent,t.next=13,c.table(e,a.filter((function(t){return t.name.includes("edges")}))[0].name,{limit:1e3});case 13:return r.links[0]=t.sent,r.graph_structure={nodes:r.nodes.map((function(t){return t.results=g(t.results)})),links:r.links.map((function(t){return t.results=h(t.results)}))},t.abrupt("return",JSON.parse(JSON.stringify(r.graph_structure)));case 16:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function h(t){var e=!0,n=!1,r=void 0;try{for(var a,l=t[Symbol.iterator]();!(e=(a=l.next()).done);e=!0){var o=a.value;o.id=o._id,o.source=o._from,o.target=o._to,delete o._id,delete o._from,delete o._to}}catch(t){n=!0,r=t}finally{try{e||null==l.return||l.return()}finally{if(n)throw r}}return t}function g(t){var e=!0,n=!1,r=void 0;try{for(var a,l=t[Symbol.iterator]();!(e=(a=l.next()).done);e=!0){var o=a.value;o.id=o._id,delete o._id}}catch(t){n=!0,r=t}finally{try{e||null==l.return||l.return()}finally{if(n)throw r}}return t}n(101);function v(t){return function(t){if(Array.isArray(t))return m(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return m(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return m(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function m(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function y(t,e,n,r){return e.map((function(e){return function t(e,n,r,a,l){var o=e.filter((function(t){return t[l]===n[a]}));return o.length>0?(r.push(o[0]),t(e,o[0],r,a,l)):(r.push({root:!0,node:n[a],edgeLength:0}),r.reverse())}(t,e,[e],n,r)}))}function b(t,e,n,r,a){return e.forEach((function(e,l){var o;e.depth=a,e.id=a+"."+l,null!=(o=e.children)&&0!=o.length?(t.push(Object.assign({},e)),b(v(t),v(e.children),n,r,a+1)):(r.push(e.node),e.flag=!0,n.push([].concat(v(t),[Object.assign({},e)])))})),n}n(102),n(189),n(190),n(140);var x=n(199);n(194);function w(t){return function(t){if(Array.isArray(t))return C(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return C(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return C(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function C(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var k=[],A=[],S=800;function D(t,e,n,a){var l=r.C("div#selected"),o=r.C("div#main");if(null===t){k=[],r.C("div#selected").selectAll("*").remove(),l.style("height",0),r.C("div#main").style("padding-top","0px");var i=r.C("div#main");St(w(e),i)}else{var s=function(t,e,n,a,l){console.log("path",t,e,n,a),r.C("#selected").classed("hidden",!1);var o=t.flatMap((function(t){return t.filter((function(t){return!0===t.leaf})).map((function(t){return t.node}))})),i=r.C("#sidebar").select("svg").selectAll(".node");i.filter((function(t){return o.indexOf(t.data.node)>-1})).classed("selected",!0);var s=n.select(".selected-toolbar"),c=s.empty()?n.append("div").classed("selected-toolbar",!0):s;c.selectAll("*").remove();var u=n.select("svg.select-svg"),d=u.empty()?n.append("svg").classed("select-svg",!0):u;d.selectAll("*").remove();var f=t.flatMap((function(t){return t.flatMap((function(t){return t.node}))})).reduce((function(t,e){return void 0===t[e]?t[e]=1:t[e]+=1,t}),{});if(1===t.length){var p=d.append("g").classed("select-wrap",!0);p.attr("transform",(function(t,e){return"translate(0,20)"}));var h=r.A().range([6,14]).domain([1,r.t(Object.values(f))]),g=p.selectAll(".paths").data(t).join("g").classed("paths",!0);g.append("rect").classed("path-rect",!0).attr("y",-8),z(g,a,l),g.on("mouseover",(function(t,e){var n=r.C("#sidebar").selectAll(".node"),a=r.C("#sidebar").selectAll(".link");return n.filter((function(e){return t.map((function(t){return t.node})).indexOf(e.data.node)>-1})).classed("hover",!0),a.filter((function(e){return t.map((function(t){return t.node})).indexOf(e.data.node)>-1})).classed("hover",!0),r.C(this).classed("hover",!0)})).on("mouseout",(function(t,e){r.C("#sidebar").selectAll(".node").classed("hover",!1),r.C("#sidebar").selectAll(".link").classed("hover",!1);return r.C(this).classed("hover",!1)})),g.append("text").text((function(t){var e=t.filter((function(t){return!0===t.leaf}))[0].node;return e.charAt(0).toUpperCase()+e.slice(1)})).attr("x",25).attr("y",15);var v=g.append("g").classed("time-line",!0);v.attr("transform",(function(t,e){return"translate(150, 0)"}));v.append("line").attr("x1",0).attr("x2",l).attr("y1",15).attr("y2",15);var m=v.selectAll(".node").data((function(t){return t})).join("g").classed("node",!0);m.attr("transform",(function(t){return"translate("+r.z().domain([0,Ce[Ce.length-1]]).range([0,l])(t.combLength)+", 10)"})),m.append("circle").attr("cx",0).attr("cy",0).attr("r",(function(t){return h(f[t.node])})).attr("class",(function(t,e){return"node-"+t.node})).on("mouseover",(function(t,e){var n=m.filter((function(e){return e.node===t.node}));r.C("#sidebar").selectAll(".node").filter((function(e){return e.data.node===t.node})).classed("selected-branch",!0);return n.classed("hover-branch",!0)})).on("mouseout",(function(t,e){var n=m.filter((function(e){return e.node===t.node}));return r.D(".selected-branch").classed("selected-branch",!1),n.classed("hover-branch",!1)}));m.filter((function(t){return null!=t.label})).append("text").text((function(t){return t.label.charAt(0).toUpperCase()+t.label.slice(1)})).attr("x",10).attr("y",5);g.attr("transform",(function(t,e){return"translate(0,"+60*e+")"})),g.select(".time-line").selectAll(".node").on("mouseover",(function(t,n){var r=e.filter((function(e){return e.flatMap((function(t){return t.node})).indexOf(t.node)>-1}));r[0],r[1]}));var y=r.C("#attribute-show").selectAll("input").filter((function(t,e,n){return!0===n[e].checked})).data(),b=g.append("g").classed("attribute-wrapper",!0),x=Ve(t,a,y),C=Dt(b,x,a);return g.attr("transform",(function(t,e){return"translate(10,"+e*(55*(Object.keys(t[1].attributes).length+1))+")"})),Vt(C,Te,l),Lt(C,!1,!1,l),d.style("height",50*(t.length+C.data().map((function(t){return t[0]})).length)+50+"px"),n.style("height",50*(t.length+C.data().map((function(t){return t[0]})).length)+50+"px"),b.attr("transform",(function(t){return"translate(140, 25)"})),r.D(".selected-path").classed("selected-path",!1),t}if(t.length>1&&t.length<5){var k=function(t){var e=r.t(t.map((function(t){return t.length}))),n=t.filter((function(t){return t.length===e}))[0].filter((function(t){return 1!=t.leaf}));t.map((function(t){n=w(t).filter((function(t){return n.map((function(t){return t.node})).indexOf(t.node)>-1&1!=t.leaf}))}));var a=t.map((function(t){var e=(t=!0===t[0].leaf?t.reverse():t).map((function(t){return t.node})).indexOf(n[n.length-1].node);return t.filter((function(t,n){return n>e}))}));return n[n.length-1].children=a.map((function(t,e){var a=r.t(t.map((function(t){return t.combLength})))-n[n.length-1].combLength;return t.map((function(t,l,o){t.parentBase=n[n.length-1].combLength,t.move=t.combLength-n[n.length-1].combLength,t.base=0===l?0:o[l-1].combLength-n[n.length-1].combLength;var i=r.z().domain([0,Ce[Ce.length-1]]).range([0,S])(n[n.length-1].combLength);return t.xScale=r.z().domain([0,a]).range([0,S-i]),t.level=e,t}))})),n}(t);!function(t,e,n,a){var l=e.append("g").classed("select-wrap",!0);l.attr("transform","translate(0, 20)");var o=r.A().range([6,14]).domain([1,r.t(Object.values(a))]),i=l.selectAll(".paths").data([t]).join("g").classed("paths",!0),s=i.append("rect").classed("path-rect",!0);s.attr("y",-8),s.attr("height",35+25*t[t.length-1].children.length),z(i,n,S);var c=i.append("g").classed("time-line",!0);c.attr("transform",(function(t,e){return"translate(145, 0)"}));c.append("line").attr("x1",0).attr("x2",(function(t,e){return r.z().domain([0,Ce[Ce.length-1]]).range([0,S])(t[t.length-1].combEdge)})).attr("y1",15).attr("y2",15);var u=c.selectAll(".node").data((function(t){return t})).join("g").classed("node",!0);u.attr("transform",(function(t){return"translate("+r.z().domain([0,Ce[Ce.length-1]]).range([0,S])(t.combEdge)+", 10)"})),u.classed("common-node",!0);var d=u.filter((function(t,e,n){return e===n.length-1})).selectAll("g.child").data((function(t){return t.children})).join("g").classed("child",!0),f=d.selectAll("g.node").data((function(t){return t})).join("g").classed("node",!0);f.attr("transform",(function(t,e,n){return"translate("+t.xScale(t.move)+", "+20*t.level+")"})),d.append("path").attr("d",(function(t,e,n){var a=[{x:0,y:0},{x:0,y:e}];return t.map((function(t){r.z().domain([0,Ce[Ce.length-1]]),a.push({x:t.xScale(t.move),y:t.level})})),r.s().curve(r.i).x((function(t){return t.x})).y((function(t){return 20*t.y}))(a)})).attr("stoke-width","2px").attr("fill","none").attr("stroke","gray"),d.on("mouseover",(function(e,n){e.map((function(t){return t.species}));var a=u.filter((function(t){return t.node===e.node})),l=w(t).map((function(t){return t.node})).concat(e.map((function(t){return t.node}))),o=r.C("#sidebar").selectAll(".node"),i=r.C("#sidebar").selectAll(".link");return o.filter((function(t){return l.indexOf(t.data.node)>-1})).classed("hover",!0),i.filter((function(t){return l.indexOf(t.data.node)>-1})).classed("hover",!0),a.classed("hover-branch",!0)})).on("mouseout",(function(t,e){r.D(".hover").classed("hover",!1)}));u.append("circle").attr("cx",0).attr("cy",0).attr("r",(function(t){return o(a[t.node])})).attr("class",(function(t,e){return"node-"+t.node}));f.append("circle").attr("r",7).attr("fill","red").attr("y",5).on("mouseover",(function(t,e){var n=u.filter((function(e){return e.node===t.node}));r.C("#sidebar").selectAll(".node").filter((function(e){return e.data.node===t.node})).classed("selected-branch",!0);return n.classed("hover-branch",!0)})).on("mouseout",(function(t,e){var n=u.filter((function(e){return e.node===t.node}));return r.D(".selected-branch").classed("selected-branch",!1),n.classed("hover-branch",!1)})),f.filter((function(t){return!0===t.leaf})).append("text").text((function(t){return t.label})).attr("x",9).attr("y",4)}(k,d,a,f);var A=d.append("g").classed("attribute-wrapper",!0),O=k[k.length-1].children.map((function(t){return w(k).concat(t)})),j=r.C("#attribute-show").selectAll("input").filter((function(t,e,n){return!0===n[e].checked})).data(),V=Ve(O,a,j);console.log("attData",V);var M=V[0].map((function(t,e){var n=t[t.length-1].node;t[t.length-1].offset=0;for(var r={label:t[t.length-1].label,type:t[t.length-1].type,data:[{species:n,paths:t}]},a=1;a<V.length;a++){console.log(V[a],V[a][V[a].length-1].filter((function(t){return!0===t.leaf}))[0].species);var l=V[a][V[a].length-1].filter((function(t){return!0===t.leaf}))[0].species,o=V[a][e].length-1;V[a][e][o].offset=8*a,r.data.push({species:l,paths:V[a][e]})}return r}));console.log("attr comb",M);var L=M.map((function(t){return t.data=t.data.map((function(e,n){return e.paths=e.paths.map((function(e){if("discrete"===t.type){var a=5*n;return e.states?{realVal:1,state:e.winState,color:e.color,combLength:e.combLength,offset:e.offset,leaf:!0}:function(t,e){var n=r.t(t.map((function(t){return t.realVal}))),a=t.filter((function(t){return t.realVal!=n})),l=t[t.map((function(t){return t.realVal})).indexOf(n)];return l.other=a,l.offset=e,l}(e,a)}return e})),e})),t})),E=A.selectAll("g").data(L).join("g").classed("attr",!0);E.attr("transform",(function(t,e){return"translate(145,"+60*e+")"})),E.append("text").text((function(t){return t.label})).style("text-anchor","end").style("font-size",11).attr("transform","translate(0,25)");var I=E.append("rect").attr("width",l);I.attr("height",50),I.style("fill","#fff"),I.style("stroke","gray"),I.style("opacity",.5),E.append("line").classed("half",!0).attr("x1",0).attr("y1",22).attr("x2",1010).attr("y2",22);var R=E.selectAll("g").data((function(t){return t.data=t.data.map((function(e){return e.type=t.type,e})),t.data})).join("g").classed("species",!0),P=r.s().x((function(t){return r.z().domain([0,Ce[Ce.length-1]]).range([0,l])(t.combLength)})).y((function(t){return r.z().domain([0,1]).range([48,1])(t.realVal)})),N=r.s().x((function(t){return r.z().domain([0,Ce[Ce.length-1]]).range([0,l])(t.combLength)})).y((function(t){var e=t.scales.yScale;return e.range([48,1]),e(t.values.realVal)+2}));R.append("path").attr("d",(function(t){return"discrete"===t.type?P(t.paths):N(t.paths)})).attr("class",(function(t,e){return t.species+" inner-line"})).style("stroke-width",.7).style("fill","none").style("stroke","gray").on("mouseover",(function(t,e,n){r.C(n[e]).classed("selected",!0)})).on("mouseout",(function(t,e,n){r.C(n[e]).classed("selected",!1)}));var T=R.filter((function(t){return"discrete"===t.type})).selectAll(".branch").data((function(t){return t.paths})).join("g").classed("branch",!0);T.attr("transform",(function(t){return"translate("+r.z().domain([0,Ce[Ce.length-1]]).range([0,l])(t.combLength)+", 0)"}));var B=T.append("circle").attr("r",5).attr("cy",(function(t,e){return r.z().domain([0,1]).range([45,2])(t.values.realVal)+t.offset})).attr("cx",5);B.attr("fill",(function(t,e){return t.color}));var F=T.filter((function(t){return 1!=t.leaf})).selectAll(".other").data((function(t){return t.other})).join("circle").classed("other",!0);F.attr("r",4).attr("cx",5).attr("cy",(function(t,e){var n=r.z().domain([1,0]);return n.range([0,45]),n(t.values.realVal)})).attr("fill",(function(t){return t.color})).style("opacity",.1),F.on("mouseover",(function(t){var e=r.C("#tooltip");e.transition().duration(200).style("opacity",.9);var n=r.n(".3f");e.html(t.state+": "+n(t.realVal)).style("left",r.l.pageX+10+"px").style("top",r.l.pageY-28+"px")})).on("mouseout",(function(t){r.C("#tooltip").transition().duration(500).style("opacity",0)})),B.on("mouseover",(function(t){var e=r.C("#tooltip");e.transition().duration(200).style("opacity",.9);var n=r.n(".3f");e.html(t.state+": "+n(t.values.realVal)).style("left",r.l.pageX+10+"px").style("top",r.l.pageY-28+"px")})).on("mouseout",(function(t){r.C("#tooltip").transition().duration(500).style("opacity",0)})),T.on("mouseover",(function(t,e,n){var a=r.z().domain([1,0]);a.range([0,45]),d.selectAll("path.inner-line."+t.species).attr("stroke","red"),d.selectAll("path.inner-line."+t.species).classed("selected",!0),r.C(n[e]).append("g").classed("y-axis",!0).call(r.c(a).ticks(3)),r.C(n[e]).selectAll(".other").style("opacity",.7)})).on("mouseout",(function(t,e,n){r.C(n[e]).select("g.y-axis"),r.C(n[e]).select("g.y-axis").remove(),r.D("path.inner-line."+t.species).attr("stroke","gray"),r.D("path.inner-line."+t.species).classed("selected",!1),r.D(".other").style("opacity",.1)}));var _=R.filter((function(t){return"continuous"===t.type})).selectAll(".branch").data((function(t){return t.paths})).join("g").classed("branch",!0);_.attr("transform",(function(t){return"translate("+r.z().domain([0,Ce[Ce.length-1]]).range([0,l])(t.combLength)+", 0)"})),_.on("mouseover",(function(t,e,n){var a=t.yScale;a.range([0,45]),d.selectAll("path.inner-line."+t.species).attr("stroke","red"),d.selectAll("path.inner-line."+t.species).classed("selected",!0),r.C(n[e]).append("g").classed("y-axis",!0).call(r.c(a).ticks(3)),r.C(n[e]).selectAll(".other").style("opacity",.7)})).on("mouseout",(function(t,e,n){r.C(n[e]).select("g.y-axis"),r.C(n[e]).select("g.y-axis").remove(),r.D("path.inner-line."+t.species).attr("stroke","gray"),r.D("path.inner-line."+t.species).classed("selected",!1),r.D(".other").style("opacity",.1)}));var q=_.append("rect");q.attr("width",10).attr("height",3),q.attr("y",(function(t,e){var n=a.filter((function(e){return e.field===t.label}))[0];return r.z().domain([n.min,n.max]).range([50,0])(t.values.realVal)}));var W=_.filter((function(t){return 1!=t.leaf})).append("rect");return W.attr("width",10).attr("height",(function(t,e){var n=a.filter((function(e){return e.field===t.label}))[0],l=r.z().domain([n.min,n.max]).range([50,0]);return l(t.values.lowerCI95)-l(t.values.upperCI95)})),W.attr("y",(function(t,e){var n=a.filter((function(e){return e.field===t.label}))[0];return r.z().domain([n.min,n.max]).range([50,0])(t.values.upperCI95)})),W.style("opacity",.1),d.style("height",50*(t.length+E.data().map((function(t){return t[0]})).length)+50+"px"),n.style("height",50*(t.length+E.data().map((function(t){return t[0]})).length)+50+"px"),A.attr("transform",(function(t){return"translate(0, 60)"})),r.D(".selected-path").classed("selected-path",!1),k}var X=r.t(t.map((function(t){return t.length}))),Y=t.filter((function(t){return t.length===X}))[0].filter((function(t){return 1!=t.leaf}));t.map((function(t){Y=w(t).filter((function(t){return Y.map((function(t){return t.node})).indexOf(t.node)>-1&1!=t.leaf}))})),d.remove();var H=c.append("g").classed("x-icon",!0);return H.attr("transform","translate(15, 10)"),H.append("circle").attr("r",7).attr("fill","#fff"),H.append("text").text("x").attr("transform","translate(-5, 5)"),H.style("cursor","pointer"),H.on("click",(function(t,e,n){r.D(".high").classed("high",!1),r.D(".low").classed("low",!1),i.select(".selected").classed("selected",!1),D(null,Pe[0],a,l)})),pe(t,n,a),n.style("height","550px"),r.D(".selected-path").classed("selected-path",!1),radio.on("click",(function(n,a){var l=t.map((function(t){return t.filter((function(t){return!0===t.leaf}))[0]}))[0],o=w(e).sort((function(t,e){return t.filter((function(t){return!0===t.leaf}))[0].attributes[n].realVal-e.filter((function(t){return!0===t.leaf}))[0].attributes[n].realVal})),s=r.C("div#main");St(o.reverse(),s),s.style("padding-top","250px");var c=s.select("svg#main-path-view").selectAll(".paths"),u=c.filter((function(t){return t.filter((function(t){return!0===t.leaf}))[0].attributes[n].realVal>l.attributes[n].realVal}));u.classed("high",!0);var d=u.data().map((function(t){return t.filter((function(t){return!0===t.leaf}))[0].node}));i.filter((function(t){return d.indexOf(t.data.node)>-1})).classed("high",!0);var f=c.filter((function(t){return t.filter((function(t){return!0===t.leaf}))[0].attributes[n].realVal<l.attributes[n].realVal}));f.classed("low",!0);var p=f.data().map((function(t){return t.filter((function(t){return!0===t.leaf}))[0].node}));i.filter((function(t){return p.indexOf(t.data.node)>-1})).classed("low",!0),c.filter((function(t){return t.filter((function(t){return!0===t.leaf}))[0].attributes[n].realVal===l.attributes[n].realVal})).classed("same",!0)})),d.style("height",50*(t.length+attributeGroups.data().map((function(t){return t[0]})).length)+50+"px"),n.style("height",50*(t.length+attGroups.data().map((function(t){return t[0]})).length)+50+"px"),attWrap.attr("transform",(function(t){return"translate(140, 25)"})),r.D(".selected-path").classed("selected-path",!1),Y}(w(k=k.concat(t)),w(e),l,n,a);St(function(t,e,n){if(!(t.length>1)){var r=t[0].reverse().map((function(t){return t.node}));return e.map((function(t){var e=t.reverse().map((function(t,e){return r.indexOf(t.node),{indexOf:r.indexOf(t.node),pathIndex:e,node:t,chosen:r[r.indexOf(t.node)]}})).filter((function(t){return t.indexOf>-1})),n=e[0].indexOf+e[0].pathIndex;return{data:t.reverse(),distance:n}})).sort((function(t,e){return t.distance-e.distance}))}if(null!=n){var a=n.reverse().map((function(t){return t.node}));return e.map((function(t){var e=t.reverse().map((function(t,e){return a.indexOf(t.node),{indexOf:a.indexOf(t.node),pathIndex:e,node:t,chosen:a[a.indexOf(t.node)]}})).filter((function(t){return t.indexOf>-1})),n=e[0].indexOf+e[0].pathIndex;return{data:t.reverse(),distance:n}})).sort((function(t,e){return t.distance-e.distance}))}console.error("multiple paths without common node")}(w(k),w(e),w(s)).map((function(t){return t.data})),o);o.style("padding-top","250px")}}function z(t,e,n){var a=t.append("g").classed("x-icon",!0);a.attr("transform","translate(15, 10)"),a.append("circle").attr("r",7).attr("fill","#fff"),a.append("text").text("x").attr("transform","translate(-5, 5)"),a.style("cursor","pointer"),a.on("click",(function(t,a,l){var o=r.C("#sidebar").select("svg").selectAll(".node");r.D(".high").classed("high",!1),r.D(".low").classed("low",!1),o.select(".selected").classed("selected",!1),D(null,Pe[0],e,n)}))}function O(t,e,n,a){var l=n.select(".button-wrap"),o=l.empty()?n.append("div").classed("button-wrap",!0):l;o.style("display","inline-block").style("width","900px").style("height","50px");var i=r.C("div#main");if(i.style("padding-top","300px"),null!=t){var s=A.map((function(t){return t.groupColor})),c=qe.find((function(t){return-1===s.indexOf(t[0])}));t.groupColor=c[0],A.push(t)}if(A.length>1){var u=r.C("#toolbar").select("#compare-button"),d=u.empty()?r.C("#toolbar").append("button").text("Normal Mode").attr("id","compare-button").classed("btn btn-info",!0):u;d.on("click",(function(){"Normal Mode"===d.text()?d.text("Compare Mode"):d.text("Normal Mode"),O(null,e,n,a)}))}var f=a.map((function(t,e){var n={field:t.field,type:t.type,data:[]};return A.map((function(e,r){var l=Ve(e.data,a,[t.field]),o=l.flatMap((function(t){return t.map((function(t){return t.map((function(t){var e=!0===t.leaf?0:(t.upperCI95-t.realVal)/2;return t.variance=e*e,t}))}))}));n.data.push({group:{first:e.first,second:e.second,color:e.groupColor},data:"continuous"===t.type?o:l.flatMap((function(t){return t}))})})),n})),p=o.selectAll("button").data(A).join("button").classed("btn btn-info",!0).style("background",(function(t){return t.groupColor}));p.selectAll("span").data((function(t){return[t]})).join("span").text((function(t){return t.first?"".concat(t.first[1]," / ").concat(t.second[1]):t.state})).append("span").text((function(t){return t.data.length})).classed("badge badge-light",!0),p.selectAll("i").data((function(t){return[t]})).join("i").classed("close fas fa-times",!0).style("padding-left","10px").on("click",(function(t,r){var l=A.filter((function(e){return e.groupColor!=t.groupColor}));(A=l).length>0?O(null,e,n,a):(n.selectAll("*").remove(),n.style("height","0px"),i.style("padding-top","0px"))}));var h=n.select(".comparison-svg"),g=h.empty()?n.append("svg").classed("comparison-svg",!0):h;n.style("height","300px").style("width","100%"),g.style("height","300px");var v=g.selectAll(".att-wrapper").data(f.filter((function(t){return"continuous"===t.type})).map((function(t){var e=r.t(t.data.flatMap((function(t){return t.data.flatMap((function(t){return t.map((function(t){return t.upperCI95}))}))})))+.2,n=r.w(t.data.flatMap((function(t){return t.data.flatMap((function(t){return t.map((function(t){return t.lowerCI95}))}))})))-.2;return t.data.map((function(t){var a=new Array(6).fill().map((function(t,r){return{base:r*(1/6),top:(r+1)*(1/6),binI:r,max:e,min:n}})),l=t.data.map((function(t){return t.filter((function(t){return 1!=t.leaf}))})),o=t.data.flatMap((function(t){return t.filter((function(t){return!0===t.leaf}))}));return t.bins=a.map((function(t,e,n){var o=l.flatMap((function(e){return e.filter((function(e){return e.combLength>=t.base&&e.combLength<=t.top}))}));t.data=o;var i=r.u(o.map((function(t){return t.realVal})));t.mean=void 0===i?a[e-1].mean:i;var s=Math.sqrt(r.u(o.map((function(t){return t.variance}))));t.meanStandard=0===o.length?0:s;var c=2*s;return t.upCon95=void 0===i?a[e-1].upCon95:i+c,t.lowCon95=void 0===i?a[e-1].lowCon95:i-c,t})),t.leaves=o,t})),t})));v.exit().remove();var m=v.enter().append("g").classed("att-wrapper",!0);m.append("text").text((function(t){return t.field})).style("text-anchor","end").style("font-size","11px").attr("transform","translate(120, 35)");(v=m.merge(v)).attr("transform",(function(t,e){return"translate(0,"+(10+70*e)+")"}));var y=v.selectAll("g.inner-group").data((function(t){return[t]})).join("g").classed("inner-group",!0);y.attr("transform","translate(150, 0)");y.selectAll("rect.outline-rect").data((function(t){return[t]})).join("rect").classed("outline-rect",!0).attr("width",800).attr("height",60).attr("fill","#fff").attr("stroke","gray");if(r.C("#compare-button").empty()||"Normal Mode"===r.C("#compare-button").text()){var b=r.s().x((function(t,e){return r.z().domain([0,5]).range([0,800])(e)})).y((function(t){var e=r.z().domain([t.min,t.max]);return e.range([60,1]),e(t.mean)})),x=y.selectAll("g.path-groups").data((function(t){return t.data})).join("g").classed("path-groups",!0);x.selectAll("*").remove();var C=x.append("path").attr("d",(function(t){t.bins[0].data[0].yScale;return t.bins=t.bins.map((function(e,n,a){return void 0===e.mean&&(e.mean=t.bins[n-1].mean,t.missing=!0),e.yScale=r.z().domain([e.min,e.max]).range([60,1]),e})),b(t.bins)})).classed("path",!0),k=r.a().curve(r.h).x((function(t,e){return r.z().domain([0,5]).range([0,800])(e)})).y0((function(t){var e=t.yScale;return e.range([60,1]),e(t.lowCon95)})).y1((function(t){var e=t.yScale;return e.range([60,1]),e(t.upCon95)})),S=y.selectAll("g.conf-groups").data((function(t){return t.data})).join("g").classed("conf-groups",!0);S.selectAll("*").remove();var D=S.append("path").attr("d",(function(t){return t.bins=t.bins.map((function(e,n,r){return NaN===e.upCon95&&(e.upCon95=t.bins[n-1].upCon95,t.missing=!0),NaN===e.lowCon95&&(e.lowCon95=t.bins[n-1].lowCon95,t.missing=!0),e})),k(t.bins)})).classed("path",!0);C.style("fill","none"),C.style("stroke",(function(t){return t.group.color})),C.style("stroke-width","2px"),D.style("fill",(function(t){return t.group.color})),D.style("opacity",.15);y.append("g").classed("y-axis",!0);y.on("mousemove",(function(t,e){var n=this,a=r.z().domain([t.data[0].bins[0].min,t.data[0].bins[0].max]).range([1,60]),l=r.C(this).select(".y-axis"),o=l.empty()?r.C(this).append("g").classed("y-axis",!0):l;if(r.C("#compare-button").empty()||"Normal Mode"===r.C("#compare-button").text())o.attr("transform",(function(t,e){return"translate("+(r.x(n)[0]-10)+",0)"})),o.call(r.c(a).ticks(5));else{var i=r.C(this).select(".path-groups").selectAll("path").data().map((function(t){return t[0].maxDiff}))[0];o.attr("transform",(function(t,e){return"translate("+(r.x(n)[0]-10)+",0)"}));var s=r.z().domain([i,0]).range([0,60]);o.call(r.c(s).ticks(5))}})).on("mouseleave",(function(){r.C(this).select(".y-axis").remove()}))}else{y.selectAll(".path-groups").remove(),y.selectAll("g.conf-groups").remove();var z=y.selectAll("g.path-groups").data((function(t){for(var e=t.data[0].bins,n=[],r=function(r){var a=[];t.data[r].bins.map((function(n,l){void 0===n.mean&&(n.mean=t.data[r].bins[l-1].mean),void 0===e[l].mean&&(e[l].mean=e[l-1].mean);var o=t.data[0].bins[0].max-t.data[0].bins[0].min;a.push({diff:Math.abs(e[l].mean-n.mean),maxDiff:o})})),n.push(a)},a=1;a<t.data.length;a++)r(a);return n})).join("g").classed("path-groups",!0),j=r.s().x((function(t,e){return r.z().domain([0,5]).range([0,800])(e)})).y((function(t){var e=r.z().domain([0,t.maxDiff]).clamp(!0);return e.range([60,0]),e(t.diff)})),V=z.append("path").attr("d",(function(t){return j(t)}));V.style("fill","none"),V.style("stroke","black"),V.style("stroke-width","2px")}var M=v.selectAll(".observed-dist-wrap").data((function(t){var e=r.t(t.data.flatMap((function(t){return t.leaves.map((function(t){return t.realVal}))}))),n=r.w(t.data.flatMap((function(t){return t.leaves.map((function(t){return t.realVal}))}))),a=r.z().domain([n,e]).range([0,200]),l=r.p().value((function(t){return t.realVal})).domain(a.domain()).thresholds(a.ticks(10));return[{data:t.data.map((function(t){var e=w(t.leaves).map((function(e){return e.x=a,e.group=t.group,e}));return{binData:l(t.leaves),data:e,group:t.group,xScale:a}})),xScale:a}]})).join("g").classed("observed-dist-wrap",!0);M.attr("transform","translate(970, 0)");var L=M.selectAll("g.axis-x").data((function(t){return[t]})).join("g").classed("axis-x",!0);L.attr("transform","translate(0, 50)"),L.each((function(t,e,n){r.C(n[e]).call(r.b(t.xScale).ticks(5))}));var E=M.selectAll(".observed-group").data((function(t){return t.data.map((function(t,e,n){return t.index=e,t.groupLength=n.length,t}))})).join("g").classed("observed-group",!0);E.selectAll(".line").data((function(t){return[{mean:r.u(t.data.map((function(t){return t.realVal}))),group:t.group,x:t.xScale}]})).join("rect").classed("line",!0).attr("transform",(function(t,e){return"translate("+(t.x(t.mean)-1.5)+",0)"})).attr("height",50).attr("width",3).attr("fill",(function(t){return t.group.color})).style("opacity","0.4"),E.selectAll(".circ-wrap").data((function(t,e){return[t]})).join("g").classed("circ-wrap",!0).attr("transform",(function(t,e,n){return"translate(0,"+r.z().domain([0,t.groupLength]).range([0,60])(t.index+.5)+")"})).selectAll("circle.disDots").data((function(t){return t.data})).join("circle").attr("r",3).attr("cx",(function(t,e){return t.x(t.realVal)})).attr("cy",(function(t,e,n){return 0})).attr("fill",(function(t){return t.group.color}))}n(141);var j=n(104);function V(t){return function(t){if(Array.isArray(t))return M(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return M(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return M(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function M(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function L(t,e,n,r,a,l,o){try{var i=t[l](o),s=i.value}catch(t){return void n(t)}i.done?e(s):Promise.resolve(s).then(r,a)}var E=[{field:"Convergence (Shallow)",value:[-1,1,1],pict:"shallow-converg.gif"},{field:"Convergence (Ancient)",value:[1,1,1],pict:"ancient-converg.gif"},{field:"Divergence (Shallow)",value:[-1,1,-1],pict:"shallow-div.gif"},{field:"Divergence (Ancient)",value:[1,1,-1],pict:"ancient-div.gif"},{field:"Conservativism",value:[1,-1,1],pict:"conservativism.gif"},{field:"Anti-Convergence",value:[1,-1,-1],pict:"char-disp.gif"}],I=null,R=[];function P(t,e,n){var a=_(t,e,n);R.push(a);var l=q(a.topPairs,r.C(".attr-drop.dropdown").select("button").attr("value"));null!=I&&N(l,I),function(t,e,n,r){var a=[],l=t.map((function(t){return t.key}));Ht().filter((function(t){return t.field!=n&&"continuous"===t.type})).map((function(t){return t.field})).map((function(t){_(V(e),t,r).topPairs.map((function(t,e){var n=t.key;if(l.indexOf(t.key)>-1){var r=a.map((function(t){return t.key}));if(r.indexOf(n)>-1){var o=r.indexOf(n);a[o].value.push([n,e+1,t])}else a.push({key:n,value:[[n,e+1,t]]})}}))})),R[R.length-1].others=a,W(a,t.length)}(a.topPairs,a.pairs,r.C(".attr-drop.dropdown").select("button").attr("value"),n)}function N(t,e){!function(t,e){console.log("pppppairs",t,e)}(t.data(),e);var n=t.selectAll("g.stateWrap").data((function(t){return[t]})).join("g").classed("stateWrap",!0);n.attr("transform","translate(560, -24)");var a=n.selectAll("g.state").data((function(t){return[{key:"p1",value:t.p1},{key:"p2",value:t.p2}]})).join("g").classed("state",!0);a.append("rect").attr("height",15).attr("width",15).attr("fill",(function(t){return t.value[t.value.length-1].attributes[e].color})),a.attr("transform",(function(t,e){return"translate(".concat(20*e,", 0)")})),a.on("mouseover",(function(t,n){var a=r.C("#tooltip");a.transition().duration(200).style("opacity",.9),a.html("".concat(t.value[t.value.length-1].attributes[e].winState)),a.style("left",r.l.pageX+6+"px").style("top",r.l.pageY-18+"px"),a.style("height","auto")})).on("mouseout",(function(){r.C("#tooltip").style("opacity",0)}))}function T(t){var e=r.C("#pair-rank").classed("hidden",!1);e.selectAll("*").remove();var n=e.append("div").style("width","180px").style("display","inline-block").style("padding-left","30px").style("padding-bottom","20px"),a=e.append("div").style("display","inline-block").style("padding-left","80px").append("svg").style("width","830px").attr("height",100).append("g").attr("transform","translate(10,10)"),l=a.append("svg:image").attr("width",142).attr("height",102).attr("y",-12).attr("xlink:href","./public/".concat(E[1].pict)),o=xt(n,E,E[1].field,"preset");o.attr("value",E[1].field);var i=E[1].value;a.selectAll("text.labels").data(["Distance","Delta","Closeness"]).join("text").classed("labels",!0).text((function(t){return t})).attr("y",10).attr("x",(function(t,e){return 200+150*e})),i.forEach((function(e,n){var l=j.a().min(-1).max(1).ticks(2).width(110).default(i[n]).displayValue(!1).fill("#516880").on("end",(function(e){i[n]=e,P(De(t),r.C(".attr-drop.dropdown").select("button").attr("value"),i)}));a.append("g").attr("id","weight-slider-".concat(n)).attr("transform","translate(".concat(200+150*n,", 20)")).call(l),a.selectAll(".tick").filter((function(t){return t<0})).select("text").attr("fill","red").attr("opacity",.6)})),o.on("click",(function(e,n,a){r.D(".weight-slider");r.C("#preset").classed("show",!1),(i=e.value).forEach((function(e,a){var l=j.a().min(-1).max(1).ticks(3).width(110).default(e).displayValue(!1).fill("#516880").on("end",(function(e){i[n]=e,P(De(t),r.C(".attr-drop.dropdown").select("button").attr("value"),i)}));r.C("#weight-slider-".concat(a)).call(l)})),r.C(".dropdown.preset").select("button").text(e.field),o.attr("value",e.field),P(De(t),r.C(".attr-drop.dropdown").select("button").attr("value"),i),l.attr("xlink:href","./public/".concat(e.pict))}));var s=Ht().filter((function(t){return"discrete"===t.type}));null!=(I=s.length>0?s[0].field:null)&&xt(e,s,s[0].field,"discrete-trait-mark").on("click",(function(t){r.C(".discrete-trait-mark").select("button").attr("value",t.field),r.C(".discrete-trait-mark.dropdown").select("button").text("Trait: ".concat(t.field)),r.C("#discrete-trait-mark").classed("show",!1),N(r.D(".pair-wrap"),t.field)}));var c=[{field:"Sort by Rank"},{field:"Sort by Top Frequency"}];xt(e,c,c[0].field,"sort-pair-drop").on("click",(function(t){r.C(".sort-pair-drop").select("button").attr("value",t.field),r.C(".sort-pair-drop.dropdown").select("button").text("".concat(t.field)),r.C("#sort-pair-drop").classed("show",!1),function(t){var e=R[R.length-1];if("Sort by Top Frequency"===t){var n=e.others.sort((function(t,e){return e.value.length-t.value.length})).map((function(t){return t.key})),a=q(e.topPairs.map((function(t,e){return t.index=n.indexOf(t.key)>-1?n.indexOf(t.key):100+e,t})).sort((function(t,e){return t.index-e.index})),r.C(".attr-drop.dropdown").select("button").attr("value"));null!=I&&N(a,I),W(e.others.sort((function(t,e){return e.value.length-t.value.length})),e.length)}else{var l=q(e.topPairs.sort((function(t,e){return e.totalRank-t.totalRank})),r.C(".attr-drop.dropdown").select("button").attr("value"));null!=I&&N(l,I),W(e.others.sort((function(t,e){return e.value.length-t.value.length})),e.length)}}(t.field)}))}function B(t,e,n){var a=r.C("#toolbar").select("#tool-buttons"),l=(a.select(".dropdown.change-view").select(".dropdown-toggle").node().value,r.C(".attr-drop.dropdown").selectAll("a").empty()?xt(a,t,"Trait: ".concat(t[3].field),"attr-drop"):r.C(".attr-drop.dropdown").selectAll("a"));return r.C(".attr-drop.dropdown").select("button").attr("value",t[3].field),l.on("click",(function(t,l,o){"Pair View"===a.select(".dropdown.change-view").select(".dropdown-toggle").node().value&&P(De(e),t.field,n),"View Phylogeny"===r.C("#sidebar").select("#view-pheno").text()&&J(null,!0,t.field),r.C(".attr-drop.dropdown").select("button").attr("value",t.field),r.C(".attr-drop.dropdown").select("button").text("Trait: ".concat(t.field)),r.C("#attr-drop").classed("show",!1)})),l}function F(){var t;return t=regeneratorRuntime.mark((function t(e){var n,a,l;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,De(e);case 2:n=t.sent,a=[1,1,1],B(l=r.k(n[0].p1[0].attributes).filter((function(t){return"continuous"===t.value.type})).map((function(t){return{field:t.key,value:t.key}})),e,a),P(V(n),l[0].field,a);case 7:case"end":return t.stop()}}),t)})),(F=function(){var e=this,n=arguments;return new Promise((function(r,a){var l=t.apply(e,n);function o(t){L(l,r,a,o,i,"next",t)}function i(t){L(l,r,a,o,i,"throw",t)}o(void 0)}))}).apply(this,arguments)}function _(t,e,n){var a=r.C(".dropdown.preset").select("button").text().includes("(Shallow)")?-1:1,l=function(t,e){var n=r.t(V(t).map((function(t){return t.deltas.filter((function(t){return t.key===e}))[0]})).map((function(t){return t.value}))),a=r.t(V(t).map((function(t){return t.closeAll.filter((function(t){return t.key===e}))[0]})).map((function(t){return t.value}))),l=r.t(V(t).map((function(t){return t.distance})));return{delta:r.z().domain([0,n]).range([0,1]),close:r.z().domain([a,0]).range([0,1]),distance:r.z().domain([0,l]).range([0,1])}}(t,e),o=V(t).map((function(t){var r=Object.assign({},t);r.delta=t.deltas.filter((function(t){return t.key===e}))[0],r.closeness=t.closeAll.filter((function(t){return t.key===e}))[0];var o=r.delta.value>11?0:l.delta(r.delta.value);r.deltaRank=o,r.closenessRank=l.close(r.closeness.value),r.distanceRank=-1===a&&t.lateDivergence?-100:l.distance(t.distance);var i=n[0]*r.distanceRank+n[1]*r.deltaRank+n[2]*r.closenessRank;return r.totalRank=r.delta.value<r.closeness.value?i*a:i,r})),i=Math.round(.01*o.length);return{topPairs:o.sort((function(t,e){return e.totalRank-t.totalRank})).slice(0,i),pairs:o}}function q(t,e){var n,a,l=this,o=["#FF5733","#129BF5"],i=(n=r.C("#toolbar").selectAll(".brush-span"),a=[],n.each((function(t){return a.push(t)})),a.flatMap((function(t){return t.nodes})));r.C("#main").selectAll("*").remove(),function(t,e){r.C("#pair-rank").select("svg").select(".rank-meta").remove();var n=r.C("#pair-rank").select("svg").append("g").classed("rank-meta",!0);n.append("text").text("Trait: ".concat(e)).attr("transform","translate(690, 20)").style("font-size","12px"),n.append("text").text("Pairs Shown: Top 1%").attr("transform","translate(690, 40)").style("font-size","12px"),n.append("text").text("Num of Pairs: ".concat(t.length)).attr("transform","translate(690, 60)").style("font-size","12px")}(t,e);var s=r.z().domain([0,Ce[Ce.length-1]]).range([0,600]),c=r.z().domain([Ce[Ce.length-1],0]).range([0,600]),u=r.C("#main").append("svg");u.attr("height",190*t.length);var d=u.append("g");d.attr("transform","translate(20, 120)");var f=d.selectAll("g.pair-wrap").data(t).join("g").classed("pair-wrap",!0);f.attr("transform",(function(t,e){return"translate(50,".concat(180*e,")")})),f.append("rect").attr("width",(function(t,e){return 600-s(t.common.combLength)})).attr("height",100).attr("x",(function(t){return s(t.common.combLength)})).attr("stroke-width",1).attr("stroke","black").attr("fill","#fff"),f.append("text").text((function(t,e){return"".concat(t.p1[t.p1.length-1].node," + ").concat(t.p2[t.p2.length-1].node)})).attr("y",-10);var p=f.append("g").classed("score-wrap",!0),h=p.selectAll("g.score").data((function(t,e){return[{label:"Distance",value:t.distance,score:t.distanceRank},{label:"Delta",value:t.delta.value,score:t.deltaRank},{label:"Closeness",value:t.closeness.value,score:t.closenessRank}]})).join("g").classed("score",!0),g=p.append("g").attr("transform","translate(650, 10)");g.append("rect").attr("width",200).attr("height",40).attr("fill","gray").attr("y",45).attr("opacity",.1),g.append("text").text("Score").attr("y",20).style("text-anchor","end").style("font-size",11),g.append("text").text("Value").attr("y",40).style("text-anchor","end").style("font-size",11),g.append("text").text("Distinctiveness Score").attr("y",60).attr("x",95).style("text-anchor","end").style("font-size",11),g.append("text").text("Rank").attr("y",80).attr("x",95).style("text-anchor","end").style("font-size",11),h.attr("transform",(function(t,e,n){return"translate(".concat(0===e?670:660+r.E(r.D(n).filter((function(t,n){return e>n})).data().map((function(t){return 6*t.label.length})))+30*e,",0)")}));var v=r.n(".3n");h.append("text").text((function(t,e){return t.label})).style("font-size",10).attr("y",10),h.append("text").text((function(t,e){return v(t.score)})).style("font-size",10).attr("y",30),h.append("text").text((function(t,e){return v(t.value)})).style("font-size",10).attr("y",50),g.append("text").text((function(t,e,n){return v(t.closenessRank+t.distanceRank+t.deltaRank)})).style("font-size",10).attr("y",60).attr("x",115),g.append("text").text((function(t,e){return e+1})).style("font-size",10).attr("y",80).attr("x",115);var m=r.s().x((function(t){return r.z().domain([0,Ce[Ce.length-1]]).range([0,600])(t.combLength)})).y((function(t){var n=t.attributes[e].scales.yScale;return n.range([100,0]),n(t.attributes[e].values.realVal)})),y=r.a().curve(r.h).x((function(t,e,n){return r.z().domain([0,Ce[Ce.length-1]]).range([0,600])(t.combLength)})).y0((function(t){var n=t.attributes[e].scales.yScale;return n.range([100,0]),n(t.attributes[e].values.lowerCI95?t.attributes[e].values.lowerCI95:t.attributes[e].values.realVal)})).y1((function(t,n,r){var a=t.attributes[e].scales.yScale;return a.range([100,0]),a(t.attributes[e].values.upperCI95?t.attributes[e].values.upperCI95:t.attributes[e].values.realVal)})),b=f.selectAll("g.pair-neighbor").data((function(t,e,n){var a=t.p1.map((function(t){return t.node})),l=t.p2.map((function(t){return t.node})),o=V(t.p1.filter((function(t){return!0===t.leaf})).map((function(t){return t.node}))).concat(t.p2.filter((function(t){return!0===t.leaf})).map((function(t){return t.node}))).flatMap((function(t){var e=Fe[Fe.length-1].indexOf(t);return Fe[Fe.length-1].filter((function(t,n){return n<+e+2&&n>+e-2}))})),i=[a[a.length-1],l[l.length-1]],s=V(Pe[Pe.length-1].filter((function(t){return o.indexOf(t[t.length-1].node)>-1&&-1===i.indexOf(t[t.length-1].node)}))).map((function(t){var e=t[t.length-1].node;return t.map((function(t){return t.name=e,t}))})),c=s.map((function(t){return t.filter((function(t){return a.indexOf(t.node)>-1}))})),u=s.map((function(t){return t.filter((function(t){return l.indexOf(t.node)>-1}))})),d=c.filter((function(t,e,n){var a=r.t(n.map((function(t){return t.length})));return t.length===a}))[0],f=u.filter((function(t,e,n){var a=r.t(n.map((function(t){return t.length})));return t.length===a}))[0];return[s.filter((function(t){return t[t.length-1].node===d[d.length-1].name}))[0],s.filter((function(t){return t[t.length-1].node===f[f.length-1].name}))[0]]})).join("g").classed("pair-neighbor",!0).attr("opacity",0),x=(b.append("path").attr("d",m).attr("class","inner-line-n").attr("fill","none").attr("stroke-width",1).style("stroke","rgba(160, 141, 184, .9)"),b.append("path").attr("d",y).attr("class","inner-area-n").attr("fill","rgba(160, 141, 184, .4)").attr("stroke-width",1).style("stroke","rgba(160, 141, 184, .9)"),b.selectAll("g.branch-n").data((function(t){return t})).join("g").classed("branch-n",!0));x.attr("transform",(function(t,e){return"translate(".concat(s(t.combLength),", 0)")})),x.filter((function(t){return 1!=t.leaf})).append("rect").attr("width",10).attr("height",(function(t){var n=t.attributes[e].scales.yScale;return n(t.attributes[e].values.lowerCI95)-n(t.attributes[e].values.upperCI95)})).attr("fill","rgba(160, 141, 184, .2)").attr("y",(function(t,n){return(0,t.attributes[e].scales.yScale)(t.attributes[e].values.upperCI95)})),x.append("rect").attr("width",10).attr("height",4).attr("y",(function(t,n){return t.attributes[e].scales.yScale(t.attributes[e].values.realVal)-2})).attr("opacity",.5),x.filter((function(t,e,n){return e===n.length-1})).append("text").text((function(t){return t.node})).attr("fill","rgba(160, 141, 184, 1)").attr("y",(function(t,n){return(0,t.attributes[e].scales.yScale)(t.attributes[e].values.realVal)-4})).attr("x",3).style("font-size",10);var w=f.selectAll("g.pair").data((function(t){return[t.p1,t.p2]})).join("g").classed("pair",!0),C=(w.append("path").attr("d",y).attr("class","inner-area").attr("fill",(function(t,e){return o[e]})).attr("opacity",.07),w.append("path").attr("d",m).attr("class","inner-line").style("stroke",(function(t,e){return o[e]})).filter((function(t){return t.filter((function(t){return i.map((function(t){return t.node})).indexOf(t.node)>-1})).length>0})).style("stroke","#64B5F6").style("stroke-width","5px"),w.selectAll("g.branch").data((function(t){return t})).join("g").classed("branch",!0));C.attr("transform",(function(t,e){return"translate(".concat(s(t.combLength),", 0)")})),C.filter((function(t){return 1!=t.leaf})).append("rect").classed("range",!0).attr("width",8).attr("height",(function(t){var n=t.attributes[e].scales.yScale;return n(t.attributes[e].values.lowerCI95)-n(t.attributes[e].values.upperCI95)})).attr("fill","none").style("stroke","rgba(165, 185, 198, .5)").attr("y",(function(t,n){return(0,t.attributes[e].scales.yScale)(t.attributes[e].values.upperCI95)}));C.filter((function(t){return i.map((function(t){return t.node})).indexOf(t.node)>-1})).selectAll("rect.range").attr("fill","#64B5F6");C.append("rect").attr("width",8).attr("height",4).attr("y",(function(t,n){return t.attributes[e].scales.yScale(t.attributes[e].values.realVal)-2})),f.append("rect").attr("width",(function(t,e){return s(t.common.combLength)})).attr("height",100).attr("fill","#fff").style("opacity",.7);f.append("g").classed("y-axis",!0);var k=f.append("g").classed("x-axis",!0);k.call(r.b(c).ticks(10)),k.attr("transform","translate(0, ".concat(100,")")),f.on("mouseover",(function(t,e,n){var a=t.p1.map((function(t){return t.node})),o=t.p2.map((function(t){return t.node})),i=(V(t.p1.filter((function(t){return!0===t.leaf})).map((function(t){return t.node}))).concat(t.p2.filter((function(t){return!0===t.leaf})).map((function(t){return t.node}))).flatMap((function(t){var e=Fe[Fe.length-1].indexOf(t);return Fe[Fe.length-1].filter((function(t,n){return n<+e+2&&n>+e-2}))})),a.filter((function(t){return o.indexOf(t)>-1}))),s=r.C("#sidebar").selectAll(".node"),c=r.C("#sidebar").selectAll(".link");s.filter((function(t){return a.filter((function(t){return-1===o.indexOf(t)})).indexOf(t.data.node)>-1})).classed("hover one",!0),s.filter((function(t){return o.filter((function(t){return-1===a.indexOf(t)})).indexOf(t.data.node)>-1})).classed("hover two",!0);c.filter((function(t){return a.filter((function(t){return-1===o.indexOf(t)})).indexOf(t.data.node)>-1})).classed("hover one",!0),c.filter((function(t){return o.filter((function(t){return-1===a.indexOf(t)})).indexOf(t.data.node)>-1})).classed("hover two",!0),s.filter((function(t){return i[i.length-1]!=t.data.node&&-1===a.filter((function(t){return-1===o.indexOf(t)})).concat(o.filter((function(t){return-1===a.indexOf(t)}))).indexOf(t.data.node)})).classed("hover-not",!0),c.filter((function(t){return-1===a.filter((function(t){return-1===o.indexOf(t)})).concat(o.filter((function(t){return-1===a.indexOf(t)}))).indexOf(t.data.node)})).classed("hover-not",!0);a[a.length-1],o[o.length-1];return r.C(l).classed("hover",!0)})).on("mouseleave",(function(t,e,n){r.C(n[e]).selectAll(".pair-neighbor").attr("opacity",0);r.C("#sidebar").selectAll(".node").classed("hover",!1).classed("hover-neighbor",!1).classed("hover-not",!1).classed("two",!1).classed("one",!1),r.C("#sidebar").selectAll(".link").classed("hover",!1).classed("hover-neighbor",!1).classed("hover-not",!1).classed("two",!1).classed("one",!1);return r.C(n[e]).classed("hover",!1)})),f.append("g").classed("y-axis",!0).each((function(t,n,a){var l=t.p1[0].attributes[e].scales.yScale;r.C(a[n]).call(r.c(l).ticks(5))}));var A=f.append("g").attr("class","mouse-over-effects");A.append("path").attr("class","mouse-line").style("stroke","black").style("stroke-width","1px").style("opacity","0");var S=A.selectAll(".mouse-per-line").data((function(t,e){return[t.p1,t.p2]})).join("g").attr("class","mouse-per-line");return S.append("circle").attr("r",7).style("stroke",(function(t){return"red"})).style("fill","none").style("stroke-width","1px").style("opacity","0"),S.append("text").attr("class","value").attr("transform","translate(10,3)"),S.append("text").attr("class","species").attr("transform","translate(10,3)"),A.append("svg:rect").attr("width",600).attr("height",100).attr("fill","none").attr("pointer-events","all").on("mouseout",(function(){r.D(".mouse-line").style("opacity","0"),r.D(".mouse-per-line circle").style("opacity","0"),r.D(".mouse-per-line text").style("opacity","0")})).on("mouseover",(function(t,e,n){r.C(n[e].parentNode).selectAll(".mouse-line").style("opacity","1"),r.C(n[e].parentNode).selectAll(".mouse-per-line circle").style("opacity","1"),r.C(n[e].parentNode).selectAll(".mouse-per-line text").style("opacity","1")})).on("mousemove",(function(t,n,a){var l=r.x(a[n]);r.C(a[n].parentNode).select(".mouse-line").attr("d",(function(){var t="M"+l[0]+",100";return t+=" "+l[0]+",0"})),r.C(a[n].parentNode).selectAll(".mouse-per-line").attr("transform",(function(o,i,c){for(var u=s.invert(l[0]),d=((0,r.d((function(t){return t.edgeLength})).right)(o.values,u),a[n].parentNode.parentNode.getElementsByClassName("inner-line")),f=0,p=d[i].getTotalLength(),h=null;;){h=Math.floor((f+p)/2);var g=d[i].getPointAtLength(h);if((h===p||h===f)&&g.x!==l[0])break;if(g.x>l[0])p=h;else{if(!(g.x<l[0]))break;f=h}}var v=t.p1[0].attributes[e].scales.yScale;return r.C(c[i]).select("text.value").text(v.invert(g.y).toFixed(2)).style("font-size",11).attr("y",(function(){return 0===i?10:-10})),r.C(c[i]).select("text.species").text(o[o.length-1].node).style("font-size",11).attr("y",(function(){return 0===i?19:-19})),"translate("+l[0]+","+g.y+")"}))})),f}function W(t,e){var n=Ht(),a=function(t,e){var n=0,r=t.length,a=[];for(n=0;n<r;n+=e){var l=t.slice(n,n+e);a.push(l)}return a}(n.map((function(t){return t.field})),4),l=t.map((function(t){var e=a.map((function(e){return e.map((function(e){return{key:e,value:t.value.filter((function(t){return t[2].delta.key===e}))}}))}));return{key:t.key,bins:e}})),o=r.z().domain([e,1]).range([.02,1]);l.map((function(t){var e=r.D(".pair-wrap").filter((function(e){return t.key===e.key})).append("g").classed("other-rank",!0);e.attr("transform","translate(900, 0)"),e.append("text").text("Ranked Top 1% in Other Traits").style("font-size",11).attr("transform","translate(5,0)");var n=e.selectAll(".square-group").data(t.bins).join("g").classed("square-group",!0);n.attr("transform",(function(t,e){return"translate(".concat(22*e,", 5)")}));var a=n.selectAll(".trait-bin").data((function(t){return t})).join("g").classed("trait-bin",!0);a.on("mouseover",(function(t,e){var n=r.C("#tooltip");n.transition().duration(200).style("opacity",.9);var a=r.n(".3f");t.value[0]&&(n.html("".concat(t.value[0][2].delta.key," : ").concat(a(t.value[0][2].totalRank)," </br> Ranking: ").concat(t.value[0][1])).style("left",r.l.pageX-40+"px").style("top",r.l.pageY-28+"px"),n.style("height","auto"),n.style("width","150px"))})).on("mouseout",(function(){r.C("#tooltip").style("opacity",0)})),a.append("rect").attr("width",20).attr("height",20).style("stroke","#EBECED").style("stoke-width","0.5px").style("fill",(function(t,e){return 0===t.value.length?"gray":t.value[0][1]<2?"#FFC74F":"gray"})).style("fill-opacity",(function(t,e){return 0===t.value.length?o(33):o(t.value[0][1])})),a.attr("transform",(function(t,e){return"translate(0, ".concat(22*e,")")}))}))}function X(t,e){return function t(e,n){return e.children=n.filter((function(t){return String(t.V1)===String(e.node)})),e.name=String(e.node),e.children.length>0?(e.children.forEach((function(e){return t(e,n)})),e):e}(t[0][0],e)}function Y(t,e,n,a){var l=H(t),o=xt(e,l,"Color By Trait","show-drop-div-sidebar");return o.on("click",(function(t,l,o){"discrete"===t.type?(n(t,!0,!1),r.C(".dropdown.show-drop-div-sidebar").select("button").text("Colored by ".concat(t.field)),null!=a&&a(t)):"continuous"===t.type?(n(t,!0,!1),r.C(".dropdown.show-drop-div-sidebar").select("button").text("Colored by ".concat(t.field)),null!=a&&a(t)):(n(null,!0,!1),r.C(".dropdown.show-drop-div-sidebar").select("button").text("Color By Value")),e.select("#show-drop-div-sidebar").classed("show",!1)})),o}function H(t){return t.reduce((function(t,e){return t.push(e),t}),[{field:"None"}])}function K(t){var e=Ht(),n=r.C("#sidebar").append("div").classed("button-wrap",!0);Y(e,n,J),n.select("button").style("font-size","12px");var a=H(e.filter((function(t){return"discrete"!=t.type}))),l=r.C("#sidebar").select(".button-wrap").append("button").text("Phenogram").style("font-size","12px");l.classed("btn btn-outline-secondary",!0).attr("id","view-pheno"),l.on("click",(function(){"Phenogram"===l.text()?(l.text("View Phylogeny"),B(a,t,null),J(null,!0,r.C(".attr-drop.dropdown").select("button").attr("value"))):("Pair View"!=r.C(".dropdown.change-view").select("button").text()&&r.C(".dropdown.attr-drop").remove(),J(null,!0,!1),l.text("Phenogram"))}));var o=n.append("button").attr("id","clade-maker");o.attr("class","btn btn-outline-secondary").text("Subtree View").style("font-size","12px"),o.on("click",(function(){return it(null)}))}function U(t){t.children&&(t._children=t.children,t._children.forEach(U),t.children=null)}function G(t,e){if(void 0===t.children||null===t.children)return e+=1.5,t.position=e,e;var n=[];return t.children.forEach((function(t){e=G(t,e),n.push(e)})),t.options=n,t.position=r.t(n),e}function $(t,e){e.combEdge=e.edgeLength+t,e.children&&e.children.forEach((function(t){$(e.combEdge,t)}))}function J(t,e,n){var a=r.C("#sidebar"),l={margin:{top:10,right:90,bottom:50,left:20},width:260,height:720,lengthHeight:850},o=r.H();$(0,Be[Be.length-1]);var i=r.o(Be[Be.length-1]);i=o(i);var s=r.C("#show-drop-div-group").attr("value"),c=a.select("svg"),u=c.empty()?a.append("svg"):c;u.classed("tree-svg",!0),u.attr("width",l.width+l.margin.left+l.margin.right).attr("height",l.height+l.margin.top+l.margin.bottom);var d=u.select("g.tree-g"),f=d.empty()?u.append("g").classed("tree-g",!0):d;(f.attr("transform","translate("+l.margin.left+","+l.margin.top+")"),"ungrouped"===s&&!1===e)?et.length>0&&"Clade Attribute)"!=nt[nt.length-1].field?Q(function(t){return e(t,[]),function t(n){var r=e(n,[]);var a=new Set(r.map((function(t){return t.data.attributes.Clade.values.Clade})));if(!(a.size>1))return n.branchPoint=!0,n.clade=Array.from(a)[0],U(n),n;n.children.map((function(e){return t(e)}));return n}(t);function e(t,n){return null!=t.children?t.children.map((function(t){return e(t,n)})):n.push(t),n}}(i),l,u,f,t,n):Q(i,l,u,f,t,n):Q(i,l,u,f,t,n)}function Q(t,e,n,a,l,o){var i=Yt().length>200?370:375;r.C(".pheno-y-axis").remove(),r.C(".pheno-x-axis").remove(),G(t,0);var s=function(t,e){return function t(n){null!=n.children?n.children.forEach((function(e){t(e)})):e.push(n)}(t),e}(t,[]),c=r.z().domain([0,Ce[Ce.length-1]]).range([0,e.width]).clamp(!0),u=r.z().range([e.height,0]).domain([0,1]);if(a.attr("transform","translate(20, ".concat(i,")")),n.attr("height",1100),u.range([700,0]).domain([0,s.length]),c.range([0,e.width+10]),o){if("None"===o){var d=Ht().filter((function(t){return"continuous"===t.type}));o=d[0].field}n.attr("height",800);var f=Ae(t.data.attributes[o].scales.min),p=Ae(t.data.attributes[o].scales.max);c.domain([f,p]),u.domain([0,Ce[Ce.length-1]]).range([0,600])}var h=a.selectAll(".link").data(t.descendants().slice(1)).join("path").attr("class","link");if(h.transition().duration(500).attr("d",(function(t){return void 0===o||!1===o?"M"+c(t.data.combEdge)+","+u(t.position)+"C"+(c(t.data.combEdge)+c(t.parent.data.combEdge))/2+","+u(t.position)+" "+c(t.parent.data.combEdge)+","+u(t.position)+" "+c(t.parent.data.combEdge)+","+u(t.parent.position):"M"+c(t.data.attributes[o].values[ft])+","+u(t.data.combEdge)+" "+c(t.parent.data.attributes[o].values[ft])+","+u(t.parent.data.combEdge)})),o){h.style("opacity",.3),a.attr("transform","translate(30, 50)");var g=c;g.range([0,e.width+20]);var v=Ae(t.data.attributes[o].scales.min),m=Ae(t.data.attributes[o].scales.max);g.domain([v,m]);var y=r.b(g);a.append("g").classed("pheno-x-axis",!0).call(y).attr("transform","translate(0, 610)").select("path").attr("stroke-width",0);r.z().domain([0,Ce[Ce.length-1]]).range([0,580]);var b=r.z().domain([Ce[Ce.length-1],0]).range([0,600]),x=r.c(b);a.append("g").classed("pheno-y-axis",!0).call(x).attr("transform","translate(0, 2)").select("path").attr("stroke-width",0)}var w=a.selectAll(".node").data(t.descendants(),(function(t){return t.data.node})).join("g").attr("class",(function(t){return"node"+(t.children?" node--internal":" node--leaf")}));if(w.selectAll("circle").data((function(t){return[t]})).join("circle").attr("r",3),w.transition().duration(500).attr("transform",(function(t){return void 0===o||!1===o?"translate("+c(t.data.combEdge)+","+u(t.position)+")":"translate("+(c(t.data.attributes[o].values[ft])-5)+","+u(t.data.combEdge)+")"})),null!=l){var C=w.filter((function(t){return!0===t.data.leaf})),k=w.filter((function(t){return 1!=t.data.leaf}));if("discrete"===l.type)l.stateColors.forEach((function(t){C.filter((function(e){return t.state.includes(e.data.attributes[l.field].states.state)})).select("circle").attr("fill",t.color),k.selectAll("circle").attr("fill","gray")}));else{var A=l.yScale;A.range(["#fff","#E74C3C"]),C.select("circle").attr("fill",(function(t,e){return A(t.data.attributes[l.field].values[ft])}))}}else w.selectAll("circle").attr("fill","gray");w.on("mouseover",(function(t,e,n){!function(t,e,n,a){var l=r.C("#main-path-view").selectAll(".paths");if(r.C("#main-summary-view").selectAll(".branch-points").filter((function(e){return e.node===t.data.node})).classed("selected",!0),l.filter((function(e){return e.map((function(t){return t.node})).indexOf(t.data.node)>-1})).classed("hover",!0).selectAll("g").filter((function(e){return e.node===t.data.node})).classed("selected",!0),r.C(n[e]).classed("selected-branch",!0),!0===t.data.leaf){var o=r.C("#tooltip");if(o.transition().duration(200).style("opacity",.9),null!=a){var i="continuous"===a.type?"realVal":a.field;o.html("\n            ".concat(t.data.name.charAt(0).toUpperCase()+t.data.name.slice(1)," <br/>\n            ").concat(a.field,": ").concat(t.data.attributes[a.field].values[i],"\n            "))}else o.html("".concat(t.data.name.charAt(0).toUpperCase()+t.data.name.slice(1)));o.style("left",r.l.pageX+6+"px").style("top",r.l.pageY-18+"px"),o.style("height","auto")}}(t,e,n,l)})).on("mouseout",(function(t,e,n){r.D(".paths.hover").classed("hover",!1),r.D("g.selected").classed("selected",!1),r.C(n[e]).classed("selected-branch",!1),r.C("#tooltip").transition().duration(500).style("opacity",0)}));w.filter((function(t){return 0==t.data.children.length}));w.selectAll("text").remove(),w.selectAll(".triangle").remove();var S=w.filter((function(t){return!0===t.branchPoint}));return S.each((function(t,e,n){if(null===t.children){var a=r.C(n[e]).append("path").classed("triangle",!0).attr("d",r.F().type(r.G).size("400"));a.attr("transform","rotate(-90) translate(0, 65) scale(.9 4)"),a.attr("fill","gray").style("opacity",.3),r.C(n[e]).selectAll("text").data((function(t){return[t]})).join("text").text(t.clade).attr("transform","translate(55, 5)")}})),S.select("circle").attr("fill","red").attr("r",4.5),S.on("click",(function(o,i,s){null==o.children?function t(e){e.children=e._children,e._children=null,e.children&&e.children.map((function(e){return t(e)}))}(o):U(o);r.C("button#length").text();Q(t,e,n,a,l,"SVL")})),w.raise(),w.selectAll("circle").raise(),w}function Z(t){return function(t){if(Array.isArray(t))return tt(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return tt(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return tt(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function tt(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var et=[],nt=[],rt=[[]],at=["#58D68D","#F39C12","#EC7063"];function lt(t,e,n,a){var l=a&&null!=a?a:"field",o=Yt();if("continuous"===t.type){r.D(".clade-define-hover").classed("clade-define-hover",!1);var i=o.filter((function(e){var r=e[e.length-1];return r.attributes[t.field].values.realVal>=n[0]&&r.attributes[t.field].values.realVal<=n[1]}));r.C("#sidebar").select(".tree-svg").selectAll(".node--leaf").filter((function(t){return i.map((function(t){return t[t.length-1].node})).indexOf(t.data.node)>-1})).select("circle").classed(e,!0);return i}var s=o.filter((function(e){var n=e[e.length-1];return t[l].includes(n.attributes[t.field].winState)}));r.C("#sidebar").select(".tree-svg").selectAll(".node--leaf").filter((function(t){return s.map((function(t){return t[t.length-1].node})).indexOf(t.data.node)>-1})).select("circle").classed(e,!0);return s}function ot(t){if(r.C("#clade-by-trait").remove(),"discrete"===t.type){var e=Z(t.scales).map((function(t){return t.trait=t.field,t.category=t.scaleName,t})),n=xt(r.C("#sidebar").select(".button-wrap"),e,"Define by Trait","clade-by-trait","category");n.on("mouseover",(function(t){lt(t,"clade-define-hover",null,"category")})).on("mouseout",(function(){r.D(".clade-define-hover").classed("clade-define-hover",!1)})),n.on("click",(function(t){var e=lt(t,"clade-define",null,"category");r.C("#clade-by-trait").classed("show",!1);var n=r.C("#sidebar").select(".button-wrap").append("form").classed("form-inline",!0).append("div").classed("form-group",!0).style("width","300px"),a=n.append("input").attr("type","text").classed("form-control",!0).attr("placeholder","Group-".concat(t.category)),l=n.append("div").classed("input-group-append",!0).append("button").attr("type","button").classed("btn btn-outline-secondary",!0);l.text("Add Group"),l.on("click",(function(){st(""!=a.node().value?a.node().value:"Group-".concat(t.trait),e,[]),it(null),bt(r.C("div#clade-show").selectAll("ul"),rt[rt.length-1])}))}))}else{console.log("c",t);var a=function(t,e,n){var a=[t.min,t.max],l=!1;e.attr("width",200).attr("height",100);var o={top:30,bottom:15,left:30,right:20},i=200-o.left-o.right,s=100-o.top-o.bottom,c=r.z().domain(a).range([0,i]),u=e.append("g").attr("transform","translate(".concat(o.left,", ").concat(o.top,")")),d=u.append("text").attr("id","labelleft").attr("x",0).attr("y",s+5).style("text-anchor","end"),f=u.append("text").attr("id","labelright").attr("x",0).attr("y",s+5).style("text-anchor","start"),p=r.e().extent([[0,0],[i,s]]).on("brush",(function(){var t=r.l.selection;d.attr("x",t[0]).text(c.invert(t[0]).toFixed(2)),f.attr("x",t[1]).text(c.invert(t[1]).toFixed(2)),g.attr("display",null).attr("transform",(function(e,n){return"translate("+[t[n],-s/4]+")"})),e.node().value=t.map((function(t){return+c.invert(t).toFixed(2)})),e.node().dispatchEvent(new CustomEvent("input"))})).on("end",(function(){!1===l?l=!0:n(t,"clade-define-hover",e.node().value)})),h=u.append("g").attr("class","brush").call(p),g=h.selectAll(".handle--custom").data([{type:"w"},{type:"e"}]).enter().append("path").attr("class","handle--custom").attr("stroke","#000").attr("fill","#eee").attr("cursor","ew-resize").attr("d",(function(t){var e=+("e"==t.type),n=e?1:-1,r=s/2;return"M"+.5*n+","+r+"A6,6 0 0 "+e+" "+6.5*n+","+(r+6)+"V"+(2*r-6)+"A6,6 0 0 "+e+" "+.5*n+","+2*r+"ZM"+2.5*n+","+(r+8)+"V"+(2*r-8)+"M"+4.5*n+","+(r+8)+"V"+(2*r-8)}));return h.selectAll(".overlay").each((function(t){t.type="selection"})).on("mousedown touchstart",(function(){var t=c(1)-c(0),e=r.x(this)[0],n=e-t/2,a=e+t/2;r.C(this.parentNode).call(p.move,a>i?[i-t,i]:n<0?[0,t]:[n,a])})),h.call(p.move,a.map(c)),e.node()}(t,r.C("#sidebar").select(".button-wrap").append("svg"),lt),l=r.C("#sidebar").select(".button-wrap").append("form").classed("form-inline",!0).append("div").classed("form-group",!0).style("width","300px"),o=l.append("input").attr("type","text").classed("form-control",!0).attr("placeholder","Group-".concat(t.field)),i=l.append("div").classed("input-group-append",!0).append("button").attr("type","button").classed("btn btn-outline-secondary",!0);i.text("Add Group"),i.on("click",(function(){var e=a.value;st(""!=o.node().value?o.node().value:"Group-".concat(t.field),Yt().filter((function(n){var r=n[n.length-1];return r.attributes[t.field].values.realVal>=e[0]&&r.attributes[t.field].values.realVal<=e[1]})),[]),it(null),bt(r.C("div#clade-show").selectAll("ul"),rt[rt.length-1])}))}}function it(t){var e=r.C("#sidebar"),n=null;e.classed("clade-view",!0),r.C("#main").classed("clade-view",!0),e.select(".tree-svg").remove(),e.select(".button-wrap").selectAll("*").remove(),Y(Ht(),e.select(".button-wrap"),it,ot),e.select(".button-wrap").append("div").style("position","absolute").style("right","5px").style("top","18px").append("i").classed("close fas fa-times",!0).style("padding-right","10px").on("click",(function(){e.classed("clade-view",!1),r.C("#main").classed("clade-view",!1),e.selectAll("*").remove(),K(Yt()),J(null,!0,!1)}));var a={margin:{top:10,right:90,bottom:50,left:20},width:400,height:8*Yt().length,lengthHeight:500},l=(function(t,e,n){$(0,Be[Be.length-1]);var a=(i=Be[Be.length-1],s=r.o(i),r.H().size([n.width,n.height])(s)),l=t.append("svg").classed("tree-svg",!0),o=l.append("g").classed("tree-g",!0);var i,s;(function t(e,n,a,l,o,i){var s=Yt();var c=s.length>200?n.height/1.964:n.height/1.9;G(e,0);a.attr("width",n.width+n.margin.left+n.margin.right).attr("height",n.height+n.height/1.5);!function(t,e){(function t(n){null!=n.children?n.children.forEach((function(e){t(e)})):e.push(n)})(t)}(e,[]);var u=r.z().domain([0,Ce[Ce.length-1]]).range([0,n.width]).clamp(!0);var d=r.z().range([n.height,0]).domain([0,Yt().length]);l.attr("transform","translate(30, ".concat(c,")"));var f=l.selectAll(".link").data(e.descendants().slice(1)).join("path").attr("class","link");f.transition().duration(500).attr("d",(function(t){return"M"+u(t.data.combEdge)+","+d(t.position)+"C"+(u(t.data.combEdge)+u(t.parent.data.combEdge))/2+","+d(t.position)+" "+u(t.parent.data.combEdge)+","+d(t.position)+" "+u(t.parent.data.combEdge)+","+d(t.parent.position)}));var p=l.selectAll(".node").data(e.descendants(),(function(t){return t.data.node})).join("g").attr("class",(function(t){return"node"+(t.children?" node--internal":" node--leaf")}));p.selectAll("circle").data((function(t){return[t]})).join("circle").attr("r",3);p.transition().duration(500).attr("transform",(function(t){return"translate("+u(t.data.combEdge)+","+d(t.position)+")"}));if(null!=o){var h=p.filter((function(t){return!0===t.data.leaf})),g=p.filter((function(t){return 1!=t.data.leaf}));if("discrete"===o.type)o.stateColors.forEach((function(t){h.filter((function(e){return t.state.includes(e.data.attributes[o.field].states.state)})).select("circle").attr("fill",t.color),g.selectAll("circle").attr("fill","gray")}));else{var v=o.yScale;v.range(["#fff","#E74C3C"]),h.select("circle").attr("fill",(function(t,e){return v(t.data.attributes[o.field].values.realVal)}))}}else p.selectAll("circle").attr("fill","gray");p.on("mouseover",(function(t,e,n){var a=r.C("#main-path-view").selectAll(".paths");if(r.C("#main-summary-view").selectAll(".branch-points").filter((function(e){return e.node===t.data.node})).classed("selected",!0),a.filter((function(e){return e.map((function(t){return t.node})).indexOf(t.data.node)>-1})).classed("hover",!0).selectAll("g").filter((function(e){return e.node===t.data.node})).classed("selected",!0),r.C(n[e]).classed("selected-branch",!0),t.data.label){var l=r.C("#tooltip");l.transition().duration(200).style("opacity",.9),l.html("".concat(t.data.label.charAt(0).toUpperCase()+t.data.label.slice(1))).style("left",r.l.pageX-40+"px").style("top",r.l.pageY-28+"px"),l.style("height","auto")}})).on("mouseout",(function(t,e,n){r.D(".paths.hover").classed("hover",!1),r.D("g.selected").classed("selected",!1),r.C(n[e]).classed("selected-branch",!1),r.C("#tooltip").transition().duration(500).style("opacity",0)}));p.filter((function(t){return 0==t.data.children.length}));p.selectAll("text").remove();p.selectAll(".triangle").remove();var m=p.filter((function(t){return!0===t.branchPoint}));m.each((function(t,e,n){if(null===t.children){var a=r.C(n[e]).append("path").classed("triangle",!0).attr("d",r.F().type(r.G).size("400"));a.attr("transform","rotate(-90) translate(0, 65) scale(.9 4)"),a.attr("fill","gray").style("opacity",.3),r.C(n[e]).selectAll("text").data((function(t){return[t]})).join("text").text(t.clade).attr("transform","translate(55, 5)")}}));m.select("circle").attr("fill","red").attr("r",4.5);m.on("click",(function(l,i,s){null==l.children?uncollapseSub(l):collapseSub(l);var c="Hide Lengths"===r.C("button#length").text();t(e,n,a,a.select("g"),o,c)}));p.raise();p.selectAll("circle").raise();return p})(a,n,l,o,e)}(e,null,a),e.select(".tree-svg").selectAll(".node--leaf")),o=e.select(".tree-svg").selectAll(".node"),i=e.select(".tree-svg").selectAll(".link"),s=Yt();function c(t,e,n){var r=t.filter((function(t){return e.map((function(t){return t.node})).indexOf(t.node)>-1})),a=[Be[Be.length-1]];o.filter((function(t){return t.data.node===r[r.length-1].node}));r.map((function(t){return t.node})).map((function(t,e){if(e>0){var n=a[a.length-1].children.filter((function(e){return e.node===t}))[0];a.push(n)}}));var l=b([a[a.length-1]],a[a.length-1].children,[],[],0),s=l.flatMap((function(t){return t.map((function(t){return t.node}))}));return o.filter((function(t){return s.indexOf(t.data.node)>-1})).select("circle").classed(n,!0),i.filter((function(t){return s.filter((function(t){return t!=r[r.length-1].node})).indexOf(t.data.node)>-1})).classed(n,!0),l}if(function(t){t.append("text").text((function(t){return t.data.node})).attr("font-size",9).attr("x",4).attr("y",2)}(l),null!=t){var u=o.filter((function(t){return 1!=t.data.leaf}));if("discrete"===t.type)t.stateColors.forEach((function(e){l.filter((function(n){return e.state.includes(n.data.attributes[t.field].states.state)})).select("circle").attr("fill",e.color),u.selectAll("circle").attr("fill","gray")}));else{var d=t.yScale;d.range(["#fff","#E74C3C"]),l.select("circle").attr("fill",(function(e,n){return d(e.data.attributes[t.field].values.realVal)}))}}else o.selectAll("circle").attr("fill","gray");!function(t){var e=0,n=r.C(".tree-svg"),a=t.filter((function(t){return null!=t.position})).map((function(t,e){return t.color=at[e],t})),l=n.append("g").selectAll("g.clade-label").data(a.filter((function(t){return t.position.length>0}))).join("g").classed("clade-label",!0);l.append("rect").attr("width",(function(t,e,n){if(e>0){var a=r.C(n[e-1]).data()[0].nodes.map((function(t){return t[t.length-1].node}));return t.nodes.filter((function(t){var e=t[t.length-1].node;return a.indexOf(e)>-1})).length>0?8:60}return 60})).attr("height",(function(t,e){return 12*t.nodes.length})).attr("transform",(function(t,n,a){if(n>0){var l=r.C(a[n-1]).data()[0].nodes.map((function(t){return t[t.length-1].node})),o=t.nodes.filter((function(t){var e=t[t.length-1].node;return l.indexOf(e)>-1}));o.length>0&&(e+=1);var i=0===o.length?0:e,s=t.position[0].index>10?12:11.6;return"translate(".concat(65*i+435,", ").concat(t.position[0].index*s+28,")")}var c=t.position[0].index>10?12:11.6;return"translate(".concat(435,", ",t.position[0].index*c+28,")")})).attr("fill",(function(t,e){return t.color})).attr("opacity",.3);a.filter((function(t){return 0===t.position.length})).map((function(t){var e=t.nodes.map((function(t){return t[t.length-1].node}));n.selectAll(".node--leaf").filter((function(t){return e.indexOf(t.data.node)>-1})).select("circle").attr("fill",t.color)}));l.on("mouseover",(function(t,e,n){var a=r.C("#tooltip");a.transition().duration(200).style("opacity",.9),a.html("".concat(t.field)).style("left",r.l.pageX-40+"px").style("top",r.l.pageY-28+"px"),a.style("height","auto")})).on("mouseout",(function(t,e,n){r.C("#tooltip").transition().duration(500).style("opacity",0)}))}(rt[rt.length-1]),l.on("click",(function(t,o,i){if(r.C(i[o]).select("circle").attr("fill","orange").attr("r","5"),null===n)n=t;else{var u=c(s.filter((function(t){return t[t.length-1].node===n.data.node}))[0],s.filter((function(e){return e[e.length-1].node===t.data.node}))[0],"selected"),d=u.map((function(t){return t[t.length-1].node})),f=l.filter((function(t){return d.indexOf(t.data.node)>-1})).data().sort((function(t,e){return e.position-t.position})),p=l.data().sort((function(t,e){return e.position-t.position})),h=[f[0],f[f.length-1]].map((function(t){var e=p.indexOf(t);return t.index=e,t}));r.z().range([a.height,0]).domain(r.m(l.data().map((function(t){return t.position}))));var g=e.select(".button-wrap").append("form").classed("form-inline",!0).append("div").classed("form-group",!0).style("width","300px"),v=g.append("input").attr("type","text").classed("form-control",!0).attr("placeholder","Clade Name"),m=g.append("div").classed("input-group-append",!0).append("button").attr("type","button").classed("btn btn-outline-secondary",!0);m.text("Add Group"),m.on("click",(function(){st(""!=v.node().value?v.node().value:"Group-".concat(rt[rt.length-1].length),u,h),it(null),bt(r.C("div#clade-show").selectAll("ul"),rt[rt.length-1])})),n=null}})),l.on("mouseover",(function(t,e,r){null!=n&&c(s.filter((function(t){return t[t.length-1].node===n.data.node}))[0],s.filter((function(e){return e[e.length-1].node===t.data.node}))[0],"selected-hover")})).on("mouseout",(function(){e.selectAll(".selected-hover").classed("selected-hover",!1)})),e.select(".tree-svg").classed("clade-view",!0).append("g").classed("overlay-brush",!0)}function st(t,e,n){rt[rt.length-1].push({field:t,nodes:e,position:n})}function ct(t,e,n){return et.push({field:t,names:e,groups:n}),{field:t,names:e,groups:n}}function ut(t,e,n,r,a,l,o){try{var i=t[l](o),s=i.value}catch(t){return void n(t)}i.done?e(s):Promise.resolve(s).then(r,a)}function dt(t){return function(){var e=this,n=arguments;return new Promise((function(r,a){var l=t.apply(e,n);function o(t){ut(l,r,a,o,i,"next",t)}function i(t){ut(l,r,a,o,i,"throw",t)}o(void 0)}))}}var ft=r.C("#toolbar").select("input").node().checked?"logVal":"realVal";function pt(){r.C("#toolbar").select("input").on("change",(function(t,e,n){ft=!0===n[e].checked?"logVal":"realVal",function(t){Nt.apply(this,arguments)}(r.C(".dropdown.change-view").select("button").node().value)}))}function ht(t,e,n){var a=xt(t,e,n.text,"change-data");r.C(".dropdown.change-data").select("button").node().value=n.field,a.on("click",(function(t,e,n){r.C(".dropdown.change-data").select("button").node().value=t.field,r.C(".dropdown.change-data").select("button").text(t.text),r.C("#change-data").classed("show",!1);var a=r.C("#main"),l=r.C("#sidebar"),o=r.C("#toolbar").select(".toolbar-button-wrap");a.selectAll("*").remove(),l.selectAll("*").remove(),o.selectAll("*").remove(),rt.push([]),Qe(Ye,t.field)}))}function gt(){return(gt=dt(regeneratorRuntime.mark((function t(e,n){var r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,mt();case 2:return r=t.sent,t.next=5,vt(e,n);case 5:return t.next=7,Tt(e.field,nt[nt.length-1].groups);case 7:r.style.display="none";case 8:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function vt(t,e){return e.node().value=t.field,e.text(t.field),t}function mt(){return r.C("#main").selectAll("*").remove(),r.C("#change-view").classed("show",!1),document.getElementById("loader").style.display="block",document.getElementById("loader")}function yt(t,e,n){var a=[{field:"Summary View"},{field:"Path View"},{field:"Pair View"}];xt(t,a,a[0].field,"change-view").on("click",(function(t){return function(t,e){return gt.apply(this,arguments)}(t,r.C(".dropdown.change-view").select("button"))}));var l=t.append("button").attr("id","view-filter");l.attr("class","btn btn-outline-secondary").text("Show Filters"),l.on("click",(function(){return function(t,e,n){console.log(t,e,n);var a=r.C("#filter-tab"),l=Yt();a.classed("hidden")?(t.text("Hide Filters"),a.classed("hidden",!1),e.style("padding-top","200px"),function(t,e,n,a,l,o){var i=["Select a Trait"].concat(Object.keys(n[0][0].attributes)),s=t.append("div").classed("filter-wrap",!0);s.style("width","200px"),s.append("h6").text("State Transition:");var c=Jt(s,i,"attr-select",""),u=s.append("div").classed("attribute-properties",!0);c.on("change",(function(n){var l=r.C(this).property("value"),i=o.filter((function(t){return t.field===l}))[0];if(u.selectAll("*").remove(),"discrete"===i.type){var s=["Any"],c=i.scales.map((function(t){return t.scaleName}));s=s.concat(c);var d=Jt(u,s,"predicted-state","From"),f=Jt(u,s,"observed-state","To"),p=u.append("button").classed("btn btn-outline-success",!0);p.text("Filter"),p.on("click",(function(){var n=d.node().classList[0],i=f.node().classList[0],s=(qt.filter((function(t){return"data-filter"===t.filterType})),Yt()),c=$t(s,l,n,i),u=Xt("data-filter","discrete","d-"+qt.filter((function(t){return"discrete"===t.attributeType})).length,$t,Ft(s),Ft(c),[["state",[n,i]],["selectedOption",l]]);Tt("Summary View");var p=r.C("#sidebar").selectAll(".link"),h=r.C("#sidebar").selectAll(".node"),g=c.flatMap((function(t){return t.map((function(t){return t.node}))}));r.D(".link-not-there").classed("link-not-there",!1),r.D(".node-not-there").classed("node-not-there",!1),p.filter((function(t){return-1===g.indexOf(t.data.node)})).classed("link-not-there",!0),h.filter((function(t){return-1===g.indexOf(t.data.node)})).classed("node-not-there",!0),Kt(u,o),e.text("Show Filters"),t.selectAll("*").remove(),t.classed("hidden",!0),a.style("padding-top","0px")}))}else{var h=r.z().domain([i.min,i.max]).range([60,0]),g=u.append("svg");g.attr("width",200).attr("height",100);var v=g.selectAll(".range").data([{label:"Ancestors",type:"predicted"},{label:"Leaves",type:"observed"}]).join("g").classed("range",!0);v.attr("transform",(function(t,e){return"translate("+125*e+",20)"}));var m=v.append("g");m.attr("transform","translate(10, 10)"),v.append("text").text((function(t){return t.label+": "})).attr("x",0).attr("y",0),m.append("rect").attr("width",20).attr("height",50).attr("x",10),m.append("g").attr("class","axis axis--y").attr("transform","translate(10,0)").call(r.c(h).ticks(3));var y=r.f().extent([[10,0],[30,60]]).on("end",(function(){var t=r.l.selection;if(null==t)handle.attr("display","none");else t.map(h.invert)})),b=m.append("g").call(y);b.call(y.move,[0,60]);var x=u.append("button").classed("btn btn-outline-success",!0);x.text("Filter"),x.on("click",(function(){var n=b._groups[0].map((function(t){return t.__brush.selection.map((function(t){return t[1]}))})),i=n[0].map(h.invert).sort(),s=n[1].map(h.invert).sort(),c=qt.filter((function(t){return"data-filter"===t.filterType})),u=c.length>0?c[c.length-1].data:Pe[0],d=Gt(u,l,i,s),f=Xt("data-filter","continuous","c-"+qt.filter((function(t){return"continuous"===t.attributeType})).length,Gt,Ft(u),Ft(d),[["selectedOption",l],["predictedFilter",i],["observedFilter",s]]);Tt("Summary View"),Kt(f,o);var p=r.C("#sidebar").selectAll(".link"),g=r.C("#sidebar").selectAll(".node"),v=d.flatMap((function(t){return t.map((function(t){return t.node}))}));r.D(".link-not-there").classed("link-not-there",!1),r.D(".node-not-there").classed("node-not-there",!1),p.filter((function(t){return-1===v.indexOf(t.data.node)})).classed("link-not-there",!0),g.filter((function(t){return-1===v.indexOf(t.data.node)})).classed("node-not-there",!0),e.text("Show Filters"),t.selectAll("*").remove(),t.classed("hidden",!0),a.style("padding-top","0px")}))}}))}(a,t,l,e),function(t,e,n,a,l){var o=t.append("div").classed("search-bar-div",!0);o.append("h6").text("Query Filter:");var i=o.append("form").classed("form-inline",!0),s=i.append("input").classed("form-control mr-sm-2",!0);s.attr("type","search").attr("placeholder","Search by Species").attr("aria-label","Search"),i.append("button").classed("btn btn-outline-success my-2 my-sm-0",!0).attr("type","button").append("i").classed("fas fa-search",!0).on("click",(function(){var l=s.node().value.split(" ").map((function(t){return t.toLowerCase()})),o=n.filter((function(t){var e=t.filter((function(t){return!0===t.leaf}))[0].label;return l.indexOf(e)>-1}));Tt("Summary View");var i=r.C("#toolbar").append("button").classed("btn btn-info",!0);i.append("span").classed("badge badge-light",!0).text(o.length),i.append("h6").text("Query Filter"),i.append("i").classed("close fas fa-times",!0).on("click",(function(){Tt("Summary View"),i.remove()})),r.C("#main-path-view").style("height",(function(){return 60*o.length+100*Object.keys(o[0][0].attributes).length+"px"})),e.text("Show Filters"),t.selectAll("*").remove(),t.classed("hidden",!0),a.style("padding-top","0px")}))}(a,t,l,e)):(t.text("Show Filters"),a.selectAll("*").remove(),a.classed("hidden",!0),e.style("padding-top","0px"))}(l,e,n)})),l.classed("hidden",!0);var o=t.append("button").attr("id","scrunch");o.attr("class","btn btn-outline-secondary").text("Collapse Attributes"),o.attr("value",!1),o.on("click",(function(){return function(t,e,n){var r=Yt();"Collapse Attributes"===t.text()?(t.text("Expand Attributes"),e.selectAll("*").remove(),t.attr("value",!0),St(r,e)):(t.text("Collapse Attributes"),e.selectAll("*").remove(),t.attr("value",!1),St(r,e))}(o,e)}));var i=t.append("button").attr("id","discrete-view");i.attr("class","btn btn-outline-secondary").text("Switch to Discrete Bars"),i.attr("value",!1),i.on("click",(function(){var t=r.D(".predicated-attr-groups");"Switch to Discrete Bars"===i.text()?(i.text("Switch to Discrete Dots"),Lt(t,Te,!0)):(i.text("Switch to Discrete Bars"),Lt(t,Te,!1))}));var s=[{field:"None"}];n.map((function(t){"discrete"===t.type&&s.push(t)}));var c=xt(t,s,"Group By","show-drop-div-group");t.select("#show-drop-div-group").attr("value","ungrouped"),r.C(".dropdown.show-drop-div-group").select("button").style("display","none"),c.on("click",(function(e,a,l){if("discrete"===e.type){var o=Yt(),i=e.scales.map((function(t){return{field:t.field,state:t.scaleName,data:[]}}));i.map((function(t){t.data=o.filter((function(e){return e.filter((function(t){return!0===t.leaf}))[0].attributes[t.field].winState===t.state}))})),r.C("#main").selectAll("*").remove(),function(t,e){r.C("#show-drop-div-group").attr("value","grouped");var n=r.C("#selected");n.selectAll("*").remove();var a=r.C("#main");a.style("padding-top",0),r.C("#toolbar").append("text").text(t[0].field);var l=[{field:"None"}].concat(e.filter((function(e){return e.field!=t[0].field&&"discrete"===e.type})));xt(r.C("#toolbar"),l,"Split On","show-drop-div-group").on("click",(function(a,l,o){if(r.C("#toolbar").append("text").text(a.field),"discrete"===a.type){var c=t.map((function(t){var e=a.scales.map((function(e){var n=e.field,r=e.scaleName,a=t.data.filter((function(t){return t.filter((function(t){return!0===t.leaf}))[0].attributes[n].winState===r}));return{field:n,state:r,data:a}}));return t.data=e,t})),u=r.C("#main");u.selectAll("*").remove(),u.style("padding-top","40px");var d=u.selectAll("div.first-group").data(c).join("div").classed("first-group",!0).append("svg");d.attr("height",(function(t){return 270*t.data.length}));var f=d.append("g"),p=(f.append("text").text((function(t){return t.state})).attr("transform","translate(10, 10)"),f.selectAll("g.second-group").data((function(t){return t.data.map((function(e){var n={};return n.first=[t.field,t.state],n.second=[e.field,e.state],n.data=e.data,n.leaves=e.data.flatMap((function(t){return t.filter((function(t){return!0===t.leaf}))})),n}))})).join("g").classed("second-group",!0));(p=p.filter((function(t){return t.data.length>0}))).attr("transform",(function(t,e){return"translate(30,"+(20+270*e)+")"})),p.each((function(t,n,a){var l=ce(t.data,r.C(a[n]));l.select("rect").attr("x",-80).attr("fill","gray"),l.selectAll(".branch-points").selectAll("circle").attr("fill","rgba(255, 255, 255, 0.3)"),l.select(".leaf-label").append("text").text((function(t,e){return": "+t.data.length})).attr("transform","translate(45, 0)"),l.selectAll("text").style("font-size","11.5px").style("fill","#fff"),l.select("line").attr("stroke","#fff");var o=r.C(a[n]).append("g"),i=o.append("g").classed("fas fa-search-plus",!0);i.attr("transform","translate(-10, 15)"),i.append("circle").attr("r",7).attr("fill","#fff"),i.append("text").text("+").attr("transform","translate(-5, 3)").attr("fill","gray"),i.style("cursor","pointer"),i.on("click",(function(){var l=r.D(a).filter((function(t,e){return e!=n}));O(t,l.data(),r.C("#selected"),e)}));var s=o.append("text").text((function(t,e){return t.second[1]}));s.attr("transform",(function(t,e){return"translate(3, 20)"})),s.attr("fill","#fff")}));var h=p.filter((function(t){return t.data.length>0})).append("g").classed("inner-wrap",!0);h.attr("transform",(function(t,e){return"translate(110, 0)"}));var g=h.selectAll(".att-wrapper").data((function(t){var n=Ve(t.data,e,null);return n[0].map((function(e,r){var a=t.data[0].filter((function(t){return!0===t.leaf}))[0].label;e[e.length-1].offset=0;for(var l={label:e[e.length-1].label,type:e[e.length-1].type,data:[{species:a,paths:e}]},o=1;o<n.length;o++){var i=t.data[o].filter((function(t){return!0===t.leaf}))[0].label,s=n[o][r].length-1;n[o][r][s].offset=8*o,l.data.push({species:i,paths:n[o][r]})}return l})).map((function(t){return t.data=t.data.map((function(e,n){return e.paths=e.paths.map((function(e){if("discrete"===t.type){var r=5*n;return e.states?{realVal:1,state:e.winState,color:e.color,combLength:e.combLength,offset:e.offset,leaf:!0}:Mt(e,r)}return e})),e})),t.leaves=t.data.flatMap((function(t){return t.paths.filter((function(t){return!0===t.leaf}))})),t}))})).join("g").classed("att-wrapper",!0),v=g.append("rect").attr("width",800);v.attr("height",40),v.style("fill","#fff"),v.style("stroke","gray"),g.attr("transform",(function(t,e){return"translate(0,"+(45*e+30)+")"})),s.attr("transform",(function(t,e){return"translate(60,"+(275*e+50)+")"})),i.attr("height",275*s.data().length+50),g.append("text").text((function(t){return t.label})).style("text-anchor","end").style("font-size",11).attr("transform","translate(-5,25)");var m=g.filter((function(t){return"discrete"===t.type})).selectAll("g.shift-wrap").data((function(t){return[t.data.flatMap((function(t){return t.paths.filter((function(e,n){return 0===n?0===n:n>0?t.paths[n-1].state!=e.state:n<t.paths.length-1?t.paths[n+1].state!=e.state:void 0}))}))]})).join("g").classed("shift-wrap",!0);m.attr("transform","translate(850, 0)");var y=m.append("g").classed("axis-x",!0);y.attr("transform","translate(0, 25)"),y.each((function(t,e,n){var a=r.z().domain([0,Ce[Ce.length-1]]).range([0,200]);r.C(n[e]).call(r.b(a).ticks(5))}));var b=m.append("g").attr("transform","translate(0, 20)").selectAll("circle.shift").data((function(t){return t})).join("circle").classed("shift",!0);b.attr("r",4).attr("cx",(function(t,e){return r.z().domain([0,Ce[Ce.length-1]]).range([0,200])(t.combLength)})),b.attr("fill",(function(t){return t.color})).style("opacity",.4);var x=g.filter((function(t){return"continuous"===t.type})).selectAll("g.observe-wrap").data((function(t){var e=g.data().filter((function(e){return e.label===t.label})).flatMap((function(t){return t.leaves.map((function(t){return t[kt]}))})),n=r.t(e),a=r.w(e),l=r.u(e),o=r.z().domain([a,n]).range([0,200]),i=t.leaves.map((function(t,e){return t.index=e,{value:t[kt],x:o,min:a,max:n,species:t.species}})),s=r.u(i.map((function(t){return t.value})));return[{dotVals:i,x:o,totalMean:l,groupMean:s}]})).join("g").classed("observe-wrap",!0);x.attr("transform","translate(850, 0)");var w=x.append("g").classed("axis-x",!0);w.attr("transform","translate(0, 25)"),w.each((function(t,e,n){r.C(n[e]).call(r.b(t.x).ticks(5))}));x.append("rect").classed("line",!0).attr("transform",(function(t,e){return"translate("+(t.x(t.totalMean)-1.5)+",0)"})).attr("height",25).attr("width",3).attr("fill","red").style("opacity","0.4"),x.append("rect").classed("line",!0).attr("transform",(function(t,e){return"translate("+(t.x(t.groupMean)-1.5)+",0)"})).attr("height",25).attr("width",3).attr("fill","gray").style("opacity","0.4");var C=x.append("g").attr("transform","translate(0, 20)").selectAll("circle").data((function(t){return t.dotVals})).join("circle");C.attr("r",4).attr("cx",(function(t,e){return t.x(t.value)})).style("opacity","0.3"),C.on("mouseover",(function(t,e,n){var a=r.C("#tooltip");a.transition().duration(200).style("opacity",.9);r.n(".3f");a.html(t.species).style("left",r.l.pageX+10+"px").style("top",r.l.pageY-28+"px"),r.C("#sidebar").selectAll(".node--leaf").filter((function(e){return e.data.label===t.species})).classed("selected",!0)})).on("mouseout",(function(t,e,n){r.C(n[e]).classed("selected",!1),C.classed("selected",!1).style("opacity",.3),r.C("#tooltip").transition().duration(500).style("opacity",0),r.C("#sidebar").selectAll(".node--leaf").filter((function(e){return e.data.label===t.species})).classed("selected",!1)}));var k=g.selectAll("g.species").data((function(t){return t.data=t.data.map((function(e){return e.type=t.type,e})),t.data})).join("g").classed("species",!0),A=r.s().x((function(t){return r.z().domain([0,Ce[Ce.length-1]]).range([0,800])(t.combLength)})).y((function(t){return r.z().domain([0,1]).range([38,1])(t.realVal)})),S=r.s().x((function(t){return r.z().domain([0,Ce[Ce.length-1]]).range([0,800])(t.combLength)})).y((function(t){return ke([t.scales.min,t.scales.max],[38])(t.values[kt])+2}));k.append("path").attr("d",(function(t){return"discrete"===t.type?A(t.paths):S(t.paths)})).attr("class",(function(t,e){return t.species+" inner-line"})).style("stroke-width",.7).style("fill","none").style("stroke","gray").on("mouseover",(function(t,e,n){r.C(n[e]).classed("selected",!0),C.filter((function(e){return e.species===t.species})).classed("selected",!0).style("opacity",1);var a=r.C("#tooltip");a.transition().duration(200).style("opacity",.9);r.n(".3f");a.html(t.species).style("left",r.l.pageX+10+"px").style("top",r.l.pageY-28+"px"),r.C("#sidebar").selectAll(".node--leaf").filter((function(e){return e.data.label===t.species})).classed("selected",!0)})).on("mouseout",(function(t,e,n){r.C(n[e]).classed("selected",!1),C.classed("selected",!1).style("opacity",.3),r.C("#tooltip").transition().duration(500).style("opacity",0),r.C("#sidebar").selectAll(".node--leaf").filter((function(e){return e.data.label===t.species})).classed("selected",!1)}));var D=k.filter((function(t){return"discrete"===t.type})).selectAll(".branch").data((function(t){return t.paths})).join("g").classed("branch",!0);D.attr("transform",(function(t){return"translate("+r.z().domain([0,1]).range([0,800])(t.combLength)+", 0)"}));var z=D.append("circle").attr("r",5).attr("cy",(function(t,e){return r.z().domain([0,1]).range([35,2])(t.realVal)})).attr("cx",5);z.classed("win-state",!0),z.attr("fill",(function(t,e,n){return 0===e?t.color:e===n.length-1?t.state===r.C(n[e-1]).data()[0].state?"rgba(189, 195, 199, 0.3)":(t.shift=!0,t.color):t.state===r.C(n[e+1]).data()[0].state||t.state===r.C(n[e-1]).data()[0].state?"rgba(189, 195, 199, 0.3)":(t.shift=!0,t.color)}));var j=D.filter((function(t){return 1!=t.leaf})).selectAll(".other").data((function(t){return t.other})).join("circle").classed("other",!0);j.attr("r",4).attr("cx",5).attr("cy",(function(t,e){var n=r.z().domain([1,0]);return n.range([0,35]),n(t.realVal)})).attr("fill","rgba(189, 195, 199, 0.1)"),j.on("mouseover",(function(t){var e=r.C("#tooltip");e.transition().duration(200).style("opacity",.9);var n=r.n(".3f");e.html(t.state+": "+n(t.realVal)).style("left",r.l.pageX+10+"px").style("top",r.l.pageY-28+"px")})).on("mouseout",(function(t){r.C("#tooltip").transition().duration(500).style("opacity",0)})),z.on("mouseover",(function(t){var e=r.C("#tooltip");e.transition().duration(200).style("opacity",.9);var n=r.n(".3f");e.html(t.state+": "+n(t.realVal)).style("left",r.l.pageX+10+"px").style("top",r.l.pageY-28+"px")})).on("mouseout",(function(t){r.C("#tooltip").transition().duration(500).style("opacity",0)})),D.on("mouseover",(function(t,e,n){var a=r.z().domain([1,0]);a.range([0,35]),i.selectAll("path.inner-line."+t.species).attr("stroke","red"),i.selectAll("path.inner-line."+t.species).classed("selected",!0),r.C(n[e]).append("g").classed("y-axis",!0).call(r.c(a).ticks(3)),r.C(n[e]).selectAll(".other").style("opacity",.7).attr("fill",(function(t){return t.color})),r.C(n[e]).selectAll(".win-state").style("opacity",.7).attr("fill",(function(t){return t.color}))})).on("mouseout",(function(t,e,n){r.C(n[e]).select("g.y-axis"),r.C(n[e]).select("g.y-axis").remove(),r.D("path.inner-line."+t.species).attr("stroke","gray"),r.D("path.inner-line."+t.species).classed("selected",!1),r.D(".other").attr("fill","rgba(189, 195, 199, 0.1)"),r.C(n[e]).selectAll(".win-state").filter((function(t){return 1!=t.shift})).attr("fill","rgba(189, 195, 199, 0.3)")}));var V=k.filter((function(t){return"continuous"===t.type})).selectAll(".branch").data((function(t){return t.paths})).join("g").classed("branch",!0);V.attr("transform",(function(t){return"translate("+r.z().domain([0,1]).range([0,800])(t.combLength)+", 0)"})),V.on("mouseover",(function(t,e,n){var a=t.yScale;a.range([0,35]),i.selectAll("path.inner-line."+t.species).attr("stroke","red"),i.selectAll("path.inner-line."+t.species).classed("selected",!0),r.C(n[e]).append("g").classed("y-axis",!0).call(r.c(a).ticks(3)),r.C(n[e]).selectAll(".other").style("opacity",.7)})).on("mouseout",(function(t,e,n){r.C(n[e]).select("g.y-axis"),r.C(n[e]).select("g.y-axis").remove(),r.D("path.inner-line."+t.species).attr("stroke","gray"),r.D("path.inner-line."+t.species).classed("selected",!1),r.D(".other").style("opacity",.1)}));var M=V.append("rect");M.attr("width",At.rectWidth).attr("height",3),M.attr("y",(function(t,n){var r=e.filter((function(e){return e.field===t.label}))[0];return ke([r.min,r.max],[37,0])(t[kt])}));var L=V.filter((function(t){return 1!=t.leaf})).append("rect");L.attr("width",At.rectWidth).attr("height",(function(t,n){var r=e.filter((function(e){return e.field===t.label}))[0],a=ke([r.min,r.max],[40,0]);return a(+t.values.lowerCI95)-a(+t.values.upperCI95)})),L.attr("y",(function(t,n){var a=e.filter((function(e){return e.field===t.label}))[0];return r.z().domain([a.min,a.max]).range([40,0])(t.upperCI95)})),L.style("opacity",.1)}else console.error("THIS HAS TO BE DISCRETE");n.select("#show-drop-div-group").classed("show",!1)}));var o=a.select("#main-path-view"),i=o.empty()?a.append("svg").attr("id","main-path-view"):o;i.selectAll("*").remove(),i.attr("height",60*t.length),i.append("g").attr("transform","translate(500, 40)").append("text").text(t[0].field);var s=i.selectAll(".grouped").data(t).join("g").classed("grouped",!0);s.each((function(t,e,n){var a=ce(t.data,r.C(n[e]));a.select("rect").attr("x",-80).attr("fill","gray"),a.selectAll(".branch-points").selectAll("circle").attr("fill","rgba(255, 255, 255, 0.3)"),a.select(".leaf-label").append("text").text((function(t,e){return": "+t.data.length})).attr("transform","translate(45, 0)"),a.selectAll("text").style("font-size","11.5px").style("fill","#fff"),a.select("line").attr("stroke","#fff")}));var c=s.append("g"),u=c.append("g").classed("fas fa-search-plus",!0);u.attr("transform","translate(20, -5)"),u.append("circle").attr("r",7).attr("fill","#fff"),u.append("text").text("+").attr("transform","translate(5, 3)").attr("fill","gray"),u.style("cursor","pointer"),u.on("click",(function(t,n,a){O(t,r.D(a).filter((function(t,e){return e!=n})).data(),r.C("#selected"),e)})),c.append("text").text((function(t,e){return t.state})),c.attr("transform",(function(t,e){return"translate(40, 16)"})),c.style("text-anchor","end"),c.attr("fill","#fff");var d=s.append("g").classed("inner-wrap",!0);d.attr("transform",(function(t,e){return"translate(110, 0)"}));var f=d.selectAll(".att-wrapper").data((function(t,n){var r=Ve(t.data,e,null);return r[0].map((function(e,n){var a=t.data[0].filter((function(t){return!0===t.leaf}))[0].label;e[e.length-1].offset=0;for(var l={label:e[e.length-1].label,type:e[e.length-1].type,data:[{species:a,paths:e}]},o=1;o<r.length;o++){var i=t.data[o].filter((function(t){return!0===t.leaf}))[0].label,s=r[o][n].length-1;r[o][n][s].offset=8*o,l.data.push({species:i,paths:r[o][n]})}return l})).map((function(t){return t.data=t.data.map((function(e,n){return e.paths=e.paths.map((function(e){if("discrete"===t.type){var r=5*n;return e.states?{realVal:1,state:e.winState,color:e.color,combLength:e.combLength,offset:e.offset,leaf:!0}:Mt(e,r)}return e})),e})),t}))})).join("g").classed("att-wrapper",!0),p=f.append("rect").attr("width",800);p.attr("height",40),p.style("fill","#fff"),p.style("stroke","gray"),f.attr("transform",(function(t,e){return"translate(0,"+(45*e+30)+")"})),s.attr("transform",(function(t,e){return"translate(60,"+(275*e+50)+")"})),i.attr("height",275*s.data().length+50),function(t,e){var n=t.filter((function(t){return"continuous"===t.type})).selectAll("g.observe-wrap-first.continuous").data((function(e){var n=t.data().filter((function(t){return t.label===e.label})).map((function(t){return t.data})).flatMap((function(t){return t.flatMap((function(t){return t.paths[t.paths.length-1][kt]}))})),a=r.t(n),l=r.w(n),o=r.u(n),i=r.z().domain([l,a]).range([0,200]),s=e.data.map((function(t,e){return t.index=e,{value:t.paths[t.paths.length-1].values[kt],x:i,min:l,max:a,species:t.species}})),c=r.u(s.map((function(t){return t.value})));return[{dotVals:s,x:i,totalMean:o,groupMean:c}]})).join("g").classed("observe-wrap-first continuous",!0);n.attr("transform","translate(850, 0)");var a=n.append("g").classed("axis-x",!0);a.attr("transform","translate(0, 25)"),a.each((function(t,e,n){r.C(n[e]).call(r.b(t.x).ticks(5))}));n.append("rect").classed("line",!0).attr("transform",(function(t,e){return"translate("+(t.x(t.totalMean)-1.5)+",0)"})).attr("height",25).attr("width",3).attr("fill","red").style("opacity","0.4"),n.append("rect").classed("line",!0).attr("transform",(function(t,e){return"translate("+(t.x(t.groupMean)-1.5)+",0)"})).attr("height",25).attr("width",3).attr("fill","gray").style("opacity","0.4");n.append("g").attr("transform","translate(0, 20)").selectAll("circle").data((function(t){return t.dotVals})).join("circle").attr("r",4).attr("cx",(function(t,e){return t.x(t.value)})).style("opacity","0.3");var l=t.filter((function(t){return"discrete"===t.type})).selectAll("g.observe-wrap-first.discrete").data((function(t){return[t]})).join("g").classed("observe-wrap-first discrete",!0),o=l.filter((function(t){return t.label!=e})).selectAll("rect").data((function(t){var e=x.b(t.data.map((function(t){return t.paths[t.paths.length-1]})),(function(t){return t.state}));return e.sort((function(t,e){return e[1].length-t[1].length})),e})).join("rect").attr("height",15).attr("width",(function(t,e,n){var a=r.z().domain([0,r.E(r.D(n).data().map((function(t){return t[1].length})))]).range([5,170]);return t.width=a(t[1].length),a(t[1].length)}));o.attr("x",(function(t,e,n){return 0===e?0:(r.D(n).filter((function(t,n){return n<e})),r.E(r.D(n).filter((function(t,n){return n<e})).data().map((function(t){return t.width}))))})).attr("y",12),o.attr("fill",(function(t){return t[1][0].color})),o.on("mouseover",(function(t,e,n){var a=r.C("#tooltip");a.transition().duration(200).style("opacity",.9),a.html(t[0]+"</br>"+t[1].length).style("left",r.l.pageX+10+"px").style("top",r.l.pageY+20+"px"),r.D(n).filter((function(t,n){return n!=e})).attr("opacity",.3)})).on("mouseout",(function(t,e,n){r.C("#tooltip").transition().duration(500).style("opacity",0),r.D(n).filter((function(t,n){return n!=e})).attr("opacity",1)})),l.attr("transform","translate(850, 0)");var i=l.filter((function(t){return t.label===e})).selectAll("text").data((function(t){return[t]})).join("text").text((function(t){var e=t.data[t.data.length-1].paths;return"".concat(e[e.length-1].state,": ").concat(t.data.length," / ").concat(100)}));i.style("text-anchor","middle"),i.style("font-size","12px"),i.attr("x",90).attr("y",25)}(f,t[0].field),f.append("text").text((function(t){return t.label})).style("text-anchor","end").style("font-size",11).attr("transform","translate(-5,25)");var h=f.selectAll("g.species").data((function(t){return t.data=t.data.map((function(e){return e.type=t.type,e})),t.data})).join("g").classed("species",!0),g=r.s().x((function(t){return r.z().domain([0,Ce[Ce.length-1]]).range([0,800])(t.combLength)})).y((function(t){return r.z().domain([0,1]).range([38,1])(t.values.realVal)})),v=r.s().x((function(t){return r.z().domain([0,1]).range([0,800])(t.combLength)})).y((function(t){var e=t.yScale;return e.range([38,1]),e(t.values.realVal)+2}));h.append("path").attr("d",(function(t){return"discrete"===t.type?g(t.paths):v(t.paths)})).attr("class",(function(t,e){return t.species+" inner-line"})).style("stroke-width",.7).style("fill","none").style("stroke","gray").on("mouseover",(function(t,e,n){r.C(n[e]).classed("selected",!0)})).on("mouseout",(function(t,e,n){r.C(n[e]).classed("selected",!1)}));var m=h.filter((function(t){return"discrete"===t.type})).selectAll(".branch").data((function(t){return t.paths})).join("g").classed("branch",!0);m.attr("transform",(function(t){return"translate("+r.z().domain([0,Ce[Ce.length-1]]).range([0,800])(t.combLength)+", 0)"}));var y=m.append("circle").attr("r",5).attr("cy",(function(t,e){return r.z().domain([0,1]).range([35,2])(t.values.realVal)})).attr("cx",5);y.classed("win-state",!0),y.attr("fill",(function(t,e,n){return 0===e||e===n.length-1?t.color:t.state===r.C(n[e+1]).data()[0].state||t.state===r.C(n[e-1]).data()[0].state?"rgba(189, 195, 199, 0.3)":(t.shift=!0,t.color)}));var b=m.filter((function(t){return 1!=t.leaf})).selectAll(".other").data((function(t){return t.other})).join("circle").classed("other",!0);b.attr("r",4).attr("cx",5).attr("cy",(function(t,e){var n=r.z().domain([1,0]);return n.range([0,35]),n(t.realVal)})).attr("fill","rgba(189, 195, 199, 0.1)"),b.on("mouseover",(function(t){var e=r.C("#tooltip");e.transition().duration(200).style("opacity",.9);var n=r.n(".3f");e.html(t.state+": "+n(t.realVal)).style("left",r.l.pageX+10+"px").style("top",r.l.pageY-28+"px")})).on("mouseout",(function(t){r.C("#tooltip").transition().duration(500).style("opacity",0)})),y.on("mouseover",(function(t){var e=r.C("#tooltip");e.transition().duration(200).style("opacity",.9);var n=r.n(".3f");e.html(t.state+": "+n(t.realVal)).style("left",r.l.pageX+10+"px").style("top",r.l.pageY-28+"px")})).on("mouseout",(function(t){r.C("#tooltip").transition().duration(500).style("opacity",0)})),m.on("mouseover",(function(t,e,n){var a=r.z().domain([1,0]);a.range([0,35]),i.selectAll("path.inner-line."+t.species).attr("stroke","red"),i.selectAll("path.inner-line."+t.species).classed("selected",!0),r.C(n[e]).append("g").classed("y-axis",!0).call(r.c(a).ticks(3)),r.C(n[e]).selectAll(".other").style("opacity",.7).attr("fill",(function(t){return t.color})),r.C(n[e]).selectAll(".win-state").style("opacity",.7).attr("fill",(function(t){return t.color}))})).on("mouseout",(function(t,e,n){r.C(n[e]).select("g.y-axis"),r.C(n[e]).select("g.y-axis").remove(),r.D("path.inner-line."+t.species).attr("stroke","gray"),r.D("path.inner-line."+t.species).classed("selected",!1),r.D(".other").attr("fill","rgba(189, 195, 199, 0.1)"),r.C(n[e]).selectAll(".win-state").filter((function(t){return 1!=t.shift})).attr("fill","rgba(189, 195, 199, 0.3)")}));var w=h.filter((function(t){return"continuous"===t.type})).selectAll(".branch").data((function(t){return t.paths})).join("g").classed("branch",!0);w.attr("transform",(function(t){return"translate("+r.z().domain([0,Ce[Ce.length-1]]).range([0,750])(t.combLength)+", 0)"})),w.on("mouseover",(function(t,e,n){var a=t.yScale;a.range([0,35]),i.selectAll("path.inner-line."+t.species).attr("stroke","red"),i.selectAll("path.inner-line."+t.species).classed("selected",!0),r.C(n[e]).append("g").classed("y-axis",!0).call(r.c(a).ticks(3)),r.C(n[e]).selectAll(".other").style("opacity",.7)})).on("mouseout",(function(t,e,n){r.C(n[e]).select("g.y-axis"),r.C(n[e]).select("g.y-axis").remove(),r.D("path.inner-line."+t.species).attr("stroke","gray"),r.D("path.inner-line."+t.species).classed("selected",!1),r.D(".other").style("opacity",.1)}));var C=w.append("rect");C.attr("width",At.rectWidth).attr("height",3),C.attr("y",(function(t,n){var a=e.filter((function(e){return e.field===t.label}))[0];return r.z().domain([a.min,a.max]).range([40,0])(t.realVal)}));var k=w.filter((function(t){return 1!=t.leaf})).append("rect");k.attr("width",At.rectWidth).attr("height",(function(t,n){var a=e.filter((function(e){return e.field===t.label}))[0],l=r.z().domain([a.min,a.max]).range([40,0]);return l(t.lowerCI95)-l(t.upperCI95)})),k.attr("y",(function(t,n){var a=e.filter((function(e){return e.field===t.label}))[0];return r.z().domain([a.min,a.max]).range([40,0])(t.upperCI95)})),k.style("opacity",.1),r.D(".att-wrapper").selectAll(".branch").on("mouseover",(function(t,e,n){r.C("#sidebar").selectAll(".node").filter((function(e){return t.node===e.data.node})).classed("selected",!0)})).on("mouseout",(function(t,e,n){r.C("#sidebar").selectAll(".node").filter((function(e){return t.node===e.data.node})).classed("selected",!1)}))}(i,n)}else console.error("THIS HAS TO BE DISCRETE");t.select("#show-drop-div-group").classed("show",!1)}));var u=n.map((function(t){return t.field})).filter((function(t){return"Clade"!=t})),d=u.length>11?u.slice(0,8):u,f=t.append("div").classed("dropdown attribute-show",!0);f.style("display","inline-block");var p=f.append("button").classed("btn dropbtn dropdown-toggle",!0).text("Shown Attributes"),h=f.append("div").attr("id","attribute-show").classed("dropdown-content",!0),g=h.append("ul").selectAll("li").data(u).join("li");g.append("input").attr("type","checkbox");g.append("text").text((function(t){return" ".concat(t)})),g.filter((function(t){return d.indexOf(t)>-1})).select("input").each((function(t,e,n){return n[e].checked=!0})),p.on("click",function(){var t=dt(regeneratorRuntime.mark((function t(e,n,a){var l;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!h.classed("show")){t.next=10;break}return t.next=3,mt();case 3:return l=t.sent,h.classed("show",!1),t.next=7,Tt(r.C(".dropdown.change-view").select("button").node().value,nt[nt.length-1].groups);case 7:l.style.display="none",t.next=11;break;case 10:h.classed("show",!0);case 11:case"end":return t.stop()}}),t)})));return function(e,n,r){return t.apply(this,arguments)}}());var v=rt[rt.length-1],m=t.append("div").classed("dropdown clade-show",!0);m.style("display","inline-block");var y=m.append("button").classed("btn dropbtn dropdown-toggle",!0).text("Shown Subtrees"),b=m.append("div").attr("id","clade-show").classed("dropdown-content",!0);bt(b.append("ul"),v);y.on("click",(function(t,e,n){if(b.classed("show")){b.classed("show",!1);var a=r.C("#clade-show").selectAll("li").selectAll("input").filter((function(t,e,n){return!0===n[e].checked})).data().map((function(t){var e=t.nodes.map((function(t){return t[t.length-1].node})),n=Yt().filter((function(t){return e.indexOf(t[t.length-1].node)>-1})),r=se(n,t.field,_e[0],8);return{label:t.field,paths:n,groupBins:r}})),l=mt();Tt(r.C(".dropdown.change-view").select("button").node().value,a),l.style.display="none"}else b.classed("show",!0)}))}function bt(t,e){var n=t.selectAll("li").data(e).join("li");n.selectAll("input").data((function(t){return[t]})).join("input").attr("type","checkbox");return n.selectAll("text").data((function(t){return[t]})).join("text").text((function(t){return" ".concat(t.field)})),e.length<1?r.C(".dropdown.clade-show").select("button").classed("hidden",!0):r.C(".dropdown.clade-show").select("button").classed("hidden",!1),n}function xt(t,e,n,r,a){var l=a&&null!=a?a:"field",o=t.append("div").classed("dropdown ".concat(r),!0);o.style("display","inline-block");var i=o.append("button").classed("btn dropbtn dropdown-toggle",!0).text(n),s=o.append("div").attr("id",r).classed("dropdown-content",!0);s.append("a").text("text").attr("font-size",11);var c=s.selectAll("a").data(e).join("a").text((function(t){return t[l]}));return c.on("click",(function(t,e,n){vt(t,i),s.classed("show",!1)})),i.on("click",(function(t,e,n){s.classed("show")?s.classed("show",!1):s.classed("show",!0)})),c.raise(),c}function wt(t,e,n,r,a,l,o){try{var i=t[l](o),s=i.value}catch(t){return void n(t)}i.done?e(s):Promise.resolve(s).then(r,a)}function Ct(t){return function(){var e=this,n=arguments;return new Promise((function(r,a){var l=t.apply(e,n);function o(t){wt(l,r,a,o,i,"next",t)}function i(t){wt(l,r,a,o,i,"throw",t)}o(void 0)}))}}var kt="realVal",At={rectWidth:15,rectHeight:40,collapsedHeight:20};function St(t,e){var n=Ht(),a=!0,l=r.C("#scrunch").attr("value");e.select("#main-path-view").selectAll("*").remove();var o=n.map((function(t){var e={};return e.field=t.field,e.type=t.type,e.popDeviation="continuous"===t.type?t.popDeviation:null,e.popCharShift="continuous"===t.type?null:t.popCharShift,e})),i=e.append("div").classed("sort-toolbar",!0).style("width","100%").style("height","60px").style("padding-top","10px"),s=i.append("div").style("display","inline").style("padding-top","10px").style("padding-left","20px"),c=i.append("div").style("display","inline").style("padding-left","20px");xt(s,o,"Sort Paths By","trait-path-sort").on("click",(function(n){r.C("#trait-path-sort").classed("show",!1),c.selectAll("*").remove();var a=r.n(".2n"),l=c.append("div").classed("label",!0);l.append("span").append("text").text("Sorted By :").style("font-weight","900"),l.append("text").text(" ".concat(n.field," "));var o=c.append("div").classed("label",!0);o.append("span").text("Volatility of Population : ").style("font-weight","900"),o.text("Volatility of Population : ".concat("discrete"===n.type?n.characterShifts:a(n.popDeviation))),function(t,e,n){St(e.sort((function(e,n){return"continuous"===t.type?n[n.length-1].attributes[t.field].volatility-e[e.length-1].attributes[t.field].volatility:n[n.length-1].attributes[t.field].characterShifts-e[e.length-1].attributes[t.field].characterShifts})),n)}(n,t,e)}));var u=function(t,e,n){var a=Ht(),l=e.select("#main-path-view"),o=l.empty()?e.append("svg").attr("id","main-path-view"):l,i=!1,s=o.select(".path-wrapper"),c=s.empty()?o.append("g").classed("path-wrapper",!0):s;c.attr("transform",(function(t,e){return"translate(0,20)"}));var u=t.flatMap((function(t){return t.flatMap((function(t){return t.node}))})).reduce((function(t,e){return void 0===t[e]?t[e]=1:t[e]+=1,t}),{}),d=r.A().range([6,12]).domain([1,r.t(Object.values(u))]),f=c.selectAll(".paths").data(t).join("g").classed("paths",!0),p=f.append("rect").classed("path-rect",!0);p.style("width","100%"),p.attr("y",-12);var h=f.append("g").classed("fas fa-search-plus",!0);h.attr("transform","translate(15, 10)"),h.append("circle").attr("r",7).attr("fill","#fff"),h.append("text").text("+").attr("transform","translate(-5, 5)"),h.style("cursor","pointer"),h.on("click",(function(t,e,l){var o=r.D(l).filter((function(t,n){return n!=e})).classed("selected-path",!1);r.C(l[e]).classed("selected-path")?(r.C(l[e]).classed("selected-path",!1),D(null,o.data(),a,n)):(r.C(l[e]).classed("selected-path",!0),D([t],o.data(),a,n))})),f.on("mouseover",(function(t,e){var n=t.map((function(t){return t.node})),a=r.C("#sidebar").selectAll(".node"),l=r.C("#sidebar").selectAll(".link");return a.filter((function(t){return n.indexOf(t.data.node)>-1})).classed("hover",!0),l.filter((function(e){return t.map((function(t){return t.node})).indexOf(e.data.node)>-1})).classed("hover",!0),r.C(this).classed("hover",!0)})).on("mouseout",(function(t,e){r.C("#sidebar").selectAll(".node").classed("hover",!1),r.C("#sidebar").selectAll(".link").classed("hover",!1);return r.C(this).classed("hover",!1)})),f.append("text").text((function(t){var e=t.filter((function(t){return!0===t.leaf}))[0].node;return e.charAt(0).toUpperCase()+e.slice(1)})).attr("x",25).attr("y",15);var g=f.append("g").classed("time-line",!0);g.attr("transform",(function(t,e){return"translate(150, 0)"}));g.append("line").attr("x1",0).attr("x2",n).attr("y1",15).attr("y2",15);var v=g.selectAll(".node").data((function(t){return t})).join("g").attr("class",(function(t,e,n){return r.C(n[n.length-1]).data()[0].node+" node"}));v.attr("transform",(function(t){return"translate("+r.z().domain([0,Ce[Ce.length-1]]).range([0,n])(t.combLength)+", 10)"})),v.on("click",(function(t,e,l){i?(i=!1,r.C("#branch-tooltip").classed("hidden",!0)):(i=!0,r.C("#branch-tooltip").style("left",r.l.pageX+"px").style("top",r.l.pageY-28+"px").select("#value").text(t.node),r.C("#branch-tooltip").classed("hidden",!1),r.C("#filter-by-node").on("click",(function(){Ut(t.node,a),i=!1,r.C("#branch-tooltip").classed("hidden",!0)})),r.C("#select-by-node").on("click",(function(){Yt();var e=f.filter((function(e){return e.map((function(t){return t.node})).indexOf(t.node)>-1})),l=f.filter((function(e){return-1===e.map((function(t){return t.node})).indexOf(t.node)}));i=!1,r.C("#branch-tooltip").classed("hidden",!0),D(e.data(),l.data(),a,n)})))})),v.append("circle").attr("cx",0).attr("cy",0).attr("r",(function(t){return d(u[t.node])})).attr("class",(function(t,e){return"node-"+t.node})).on("mouseover",(function(t,e){var n=v.filter((function(e){return e.node===t.node}));r.C("#sidebar").selectAll(".node").filter((function(e){return e.data.node===t.node})).classed("selected-branch",!0);return n.classed("hover-branch",!0)})).on("mouseout",(function(t,e){var n=v.filter((function(e){return e.node===t.node}));return r.D(".selected-branch").classed("selected-branch",!1),n.classed("hover-branch",!1)}));v.filter((function(t){return null!=t.label})).append("text").text((function(t){return t.label.charAt(0).toUpperCase()+t.label.slice(1)})).attr("x",10).attr("y",5);return f}(t,e,800),d=u.append("g").classed("attribute-wrapper",!0),f=r.C("#attribute-show").selectAll("input").filter((function(t,e,n){return!0===n[e].checked})).data(),p=Ve(t,n,f);if("true"!=l){var h=u.append("g").classed("all-att-combo",!0);h.datum((function(t,e){return p[e]})),h.attr("transform","translate(".concat(980,", -9)")),h.append("rect").attr("width",80).attr("height",40).attr("fill","#fff").style("fill-opacity","0.6").style("stroke","gray").style("stroke-width","0.7px");Ot(h.selectAll("g.combo-lines").data((function(t,e){return t})).join("g").classed("combo-lines",!0).filter((function(t){return"continuous"===t[0].type})),l,80,.3,!1);u.append("text").text("Volatility").attr("transform","translate(".concat(1100,", ",30,")")),u.append("text").text("Val Range").attr("transform","translate(".concat(1200,", ",30,")"))}var g=Dt(d,p,l),v="true"===l?22:45;u.attr("transform",(function(t,e){return"translate(10,"+e*((v+5)*(f.length+1))+")"}));var m,y,b,w,C=Vt(g,l,800);Lt(g,l,!1,800);if("true"!=l){var k=C.append("g").classed("compact-line",!0);k.attr("transform","translate(".concat(840,", 0)")),k.append("rect").attr("width",80).attr("height",40).classed("attribute-rect",!0);(function(t,e,n){zt.apply(this,arguments)})(k.filter((function(t){return"continuous"===t[0].type})),l,80,1);k.on("mouseover",(function(t,e,n){r.C(n[e].parentNode.parentNode.parentNode).selectAll("g.combo-lines").filter((function(e){return e[0].field===t[0].field})).select("path").style("stroke",(function(t){return t[0].color})).style("opacity",1)})).on("mouseout",(function(t,e,n){r.C(n[e].parentNode.parentNode.parentNode).selectAll("g.combo-lines").filter((function(e){return e[0].field===t[0].field})).select("path").style("stroke","gray").style("opacity",.4)}));var A=r.n(".2n"),S=(function(t){var e=t.selectAll("g.states").data((function(t){return t[0].map((function(t){return t.key})).map((function(e){var n=t.filter((function(t){return 1!=t.leaf})).flatMap((function(t){return t.filter((function(t){return t.key===e}))}));return{key:e,value:n}}))})).join("g").classed("states",!0);e.append("text").text((function(t){return t.key})).style("font-size","7px").style("fill","gray").attr("x",83).attr("y",3.5);var n=e.selectAll("g.state-node").data((function(t){var e=t.value.map((function(t,e,n){return t.value=+t.value,t.endLength=e<n.length-1?n[e+1].combLength:Ce[Ce.length-1],t}));return Array.from(x.a(e,(function(t){return e=t.value,(r=+e+(void 0===(n=.005)?.5:n/2))-r%(void 0===n?1:+n);var e,n,r})))})).join("g").classed("state-node",!0);e.attr("transform",(function(t,e,n){var r=40/n.length;return"translate(0, ".concat(e*r+r/2.2,")")})),n.append("rect").attr("width",(function(t,e){var n=t[1],a=r.z().domain([0,Ce[Ce.length-1]]).range([0,80]);return a(n[n.length-1].endLength)-a(n[0].combLength)-.5})).attr("height",(function(t,e){return r.z().domain([0,1]).range([.2,6])(t[0])})).attr("fill","gray").attr("opacity",.4).attr("y",(function(t){return r.z().domain([0,1]).range([.2,6])(t[0])/2*-1})),n.attr("transform",(function(t,e){var n=r.z().domain([0,Ce[Ce.length-1]]).range([0,80]);return"translate(".concat(n(t[1][0].combLength),",0)")}))}(k.filter((function(t){return"continuous"!=t[0].type}))),C.filter((function(t){return"continuous"===t[0].type})));S.append("g").append("text").text((function(t){return A(t[t.length-1].volatility)})).attr("transform","translate(".concat(970,", ",30,")")),S.append("g").append("text").text((function(t){return A(t[t.length-1].extent[1]-t[t.length-1].extent[0])})).attr("transform","translate(".concat(1075,", ",30,")")),C.filter((function(t){return"continuous"!=t[0].type})).append("g").append("text").text((function(t){return t[t.length-1].characterShifts})).attr("transform","translate(".concat(975,", ",30,")"))}return m=e.select("#main-path-view"),y=d,b=t,w=f.length*v,m.style("height",b.length*(w+52)+"px"),y.attr("transform",(function(t){return"translate(140, 35)"})),r.D(".discrete-leaf").on("click",(function(t,e){a?(a=!1,r.C("#state-tooltip").classed("hidden",!0)):(a=!0,r.C("#state-tooltip").style("left",r.l.pageX+"px").style("top",r.l.pageY-28+"px").select("#value").text(t.winState),r.C("#state-tooltip").classed("hidden",!1),r.C("#filter-by-state").on("click",(function(){!function(t,e){var n=Yt(),a=(qt.filter((function(t){return"data-filter"===t.filterType})),n.filter((function(e){return e[e.length-1].attributes[t.label].winState===t.winState})));Kt(Xt("data-filter","leaf","l-"+qt.filter((function(t){return"leaf"===t.attributeType})).length,Ut,Ft(n),Ft(a),[["leafState",[t.label,t.winState]]]),e),Tt("Summary View");var l=r.C("#sidebar").selectAll(".link"),o=r.C("#sidebar").selectAll(".node"),i=a.flatMap((function(t){return t.map((function(t){return t.node}))}));r.D(".link-not-there").classed("link-not-there",!1),r.D(".node-not-there").classed("node-not-there",!1),l.filter((function(t){return-1===i.indexOf(t.data.node)})).classed("link-not-there",!0),o.filter((function(t){return-1===i.indexOf(t.data.node)})).classed("node-not-there",!0)}(t,n),a=!1,r.C("#state-tooltip").classed("hidden",!0)})),r.C("#select-by-state").on("click",(function(){var e=Yt(),l=e.filter((function(e){return e[e.length-1].attributes[t.label].winState===t.winState})),o=e.filter((function(e){return e[e.length-1].attributes[t.label].winState!=t.winState}));a=!1,r.C("#state-tooltip").classed("hidden",!0),D(l,o,n)})))})),u}function Dt(t,e,n){var r="true"===n?20:45,a=t.selectAll("g").data((function(t,n){return e[n]})).join("g");a.classed("predicated-attr-groups",!0),a.attr("transform",(function(t,e){return"translate(0, "+e*(r+5)+")"}));var l=a.append("text").text((function(t){return t[t.length-1].label?t[t.length-1].label:t[t.length-1].attrLabel}));return l.classed("attribute-label",!0),l.attr("transform","translate(-15, 20)"),a}function zt(){return(zt=Ct(regeneratorRuntime.mark((function t(e,n,a){var l,o;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return"true"===n?At.collapsedHeight:At.rectHeight,l=r.a().x((function(t){return r.z().domain([0,Ce[Ce.length-1]]).range([0,a])(t.combLength)})).y1((function(t){var e=t.scales.yScale;return e.range([40,0]),"true"===n?t.change:e(t.values[kt])})).y0((function(t){return t.scales.yScale.range([40,0]),40})),o=e.append("path").attr("d",l).style("fill",(function(t){return t[0].color})).style("stroke-width","1px").style("stroke",(function(t){return t[0].color})).style("fill-opacity",.3),t.abrupt("return",o);case 4:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function Ot(t,e,n,r,a){return jt.apply(this,arguments)}function jt(){return(jt=Ct(regeneratorRuntime.mark((function t(e,n,a,l,o){var i,s,c;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.data().forEach((function(t){var e;(e=t).map((function(t,n){var r=0===n?0:1,a=t[kt]>e[n-r][kt]?1:18;t.change=a}))})),i="true"===n?At.collapsedHeight:At.rectHeight,s=r.s().x((function(t){return r.z().domain([0,Ce[Ce.length-1]]).range([0,a])(t.combLength)})).y((function(t){var e=ke([t.scales.min,t.scales.max],[i,0]);return"true"===n?t.change:e(t.values[kt])})),c=e.append("path").attr("d",s).attr("class","inner-line").style("stroke",(function(t){return o?t[0].color:"gray"})).style("opacity",l),t.abrupt("return",c);case 5:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function Vt(t,e,n){var a=t.filter((function(t){return null!=t[t.length-1]?"continuous"===t[t.length-1].type:"continuous"===t.type})),l="true"===e?At.collapsedHeight:At.rectHeight,o=a.append("g").classed("attribute-time-line",!0),i=(Ot(o,e,n,1,!0),o.append("rect").classed("attribute-rect",!0));i.attr("height",l),i.attr("width",n);var s=o.selectAll("g").data((function(t){return t})).join("g").classed("attribute-node",!0).append("g").classed("inner-bars",!0);s.attr("transform",(function(t){return"translate("+r.z().domain([0,Ce[Ce.length-1]]).range([0,n])(t.combLength)+", 0)"}));var c=s.append("rect").classed("range-rect",!0);return c.attr("width",At.rectWidth).attr("height",(function(t,n){var r=ke([t.scales.min,t.scales.max],[l-3,0]),a=0;return 1!=t.leaf&&(a=Math.abs(r(+t.values.lowerCI95)-r(+t.values.upperCI95))),"true"===e?At.collapsedHeight:a})),c.attr("transform",(function(t,n){var a=r.z(),o=t.scales.min,i=t.scales.max;a.domain([o,i]),a.range([l,0]).clamp(!0);var s=t.leaf||"true"===e?0:a(+t.values.upperCI95);return"translate(0, "+Math.abs(s)+")"})),c.style("fill",(function(t){return t.colorScale(t.values[kt])})),c.attr("opacity",(function(t){return t.satScale(t.values[kt])})),"true"!=e&&s.append("rect").attr("width",At.rectWidth).attr("height",4).attr("transform",(function(t,e){return"translate(0, "+ke([t.scales.min,t.scales.max],[l,0])(t.values[kt])+")"})).attr("fill",(function(t){return t.color})).classed("val-bar",!0),s.on("mouseover",(function(t,e,n){var a=ke([t.scales.min,t.scales.max],[0,l]);r.C(n[e]).append("g").classed("y-axis",!0).call(r.c(a).ticks(5));var o=r.C("#tooltip");o.transition().duration(200).style("opacity",.9);var i=r.n(".3f"),s="realVal"===kt?+t.values.upperCI95:+t.values.logUpper,c="realVal"===kt?+t.values.lowerCI95:+t.values.logLower;o.html("mean: "+i(t.values[kt])+"</br></br>upperCI: "+i(s)+"</br></br>lowerCI: "+i(c)).style("left",r.l.pageX+"px").style("top",r.l.pageY-28+"px"),o.style("height","auto")})).on("mouseout",(function(t,e,n){r.C(n[e]).select("g.y-axis"),r.C(n[e]).select("g.y-axis").remove(),r.C("#tooltip").transition().duration(500).style("opacity",0)})),t}function Mt(t,e){var n=r.t(t.map((function(t){return t.values.realVal}))),a=t.filter((function(t){return t.values.realVal!=n})),l=t[t.map((function(t){return t.values.realVal})).indexOf(n)];return l.other=a,l.offset=e,l}function Lt(t,e,n,a){var l=t.filter((function(t){return"discrete"===t[t.length-1].type})),o="true"===e?20:45,i=l.append("g").classed("attribute-time-line",!0);i.append("line").classed("half",!0).attr("x1",0).attr("y1",22).attr("x2",a).attr("y2",22);var s=i.selectAll("g").data((function(t){var e=t;return e[0].map((function(t){return t.state})).map((function(t){return e.map((function(e){return e.leaf?e:e.filter((function(e){return e.state==t}))[0]}))}))})).join("g").classed("state-path",!0),c=r.s().x((function(t){return r.z().domain([0,Ce[Ce.length-1]]).range([0,a-10])(t.combLength)+7})).y((function(t){var e=r.z().domain([0,1]).range([o-2,1]);return t.value?e(t.value):e(1)})),u=(s.append("path").attr("d",c).attr("class",(function(t,e){return t[0].species+" inner-line"})).style("stroke-width",.7).style("stroke",(function(t){return t[0].color})),i.append("rect").classed("attribute-rect",!0));u.attr("height",o),u.attr("width",a);var d=i.selectAll(".attribute-node-discrete").data((function(t){return t})).join("g");if(d.attr("transform",(function(t){var e=r.z().domain([0,Ce[Ce.length-1]]).range([0,a-10]);return t[0]?"translate("+e(t[0].combLength)+", 0)":"translate("+e(t.combLength)+", 0)"})),d.append("rect").attr("width",At.rectWidth).attr("height",o).attr("opacity",0),d.append("line").attr("x1",10).attr("x2",10).attr("y1",0).attr("y2",o),d.on("mouseover",(function(t,e,n){var a=r.z().domain([1,0]);a.range([0,o]),r.C(n[e]).append("g").classed("y-axis",!0).call(r.c(a).ticks(3))})).on("mouseout",(function(t,e,n){r.C(n[e]).select("g.y-axis"),r.C(n[e]).select("g.y-axis").remove()})),d.attr("class",(function(t,e,n){var a=r.D(n).data();return a[a.length-1].species})).classed("attribute-node-discrete",!0),!1===n){var f=d.filter((function(t,e){return null!=t[0]})).selectAll(".dots").data((function(t){return t})).join("circle").classed("dots",!0);f.attr("cx",10).attr("cy",(function(t){var e=r.z().domain([0,1]).range([o-2,2]);return t.realVal?e(t.realVal):e(t.value)})).attr("r",(function(t,e,n){return t.value>.5?7:3})),f.style("fill",(function(t,e,n){return t.value>.5?t.color.color:"gray"})).style("opacity","0.8"),f.on("mouseover",(function(t){var e=r.C("#tooltip");e.transition().duration(200).style("opacity",.9);var n=r.n(".3f");e.html(t.state+": "+n(t.realVal)).style("left",r.l.pageX+"px").style("top",r.l.pageY-28+"px")})).on("mouseout",(function(t){r.C("#tooltip").transition().duration(500).style("opacity",0)}));var p=d.filter((function(t,e){return void 0===t[0]})).classed("discrete-leaf",!0);p.append("circle").attr("cx",10).attr("cy",2).attr("r",7).style("fill",(function(t){return t.color})),p.append("text").text((function(t){return t.winState})).attr("transform","translate(20, 5)").style("font-size",10)}else{d.filter((function(t,e){return null!=t[0]})).append("rect").attr("height",o).attr("width",At.rectWidth).attr("fill","#fff");var h=d.filter((function(t,e){return null!=t[0]})).selectAll(".dis-rect").data((function(t){return t})).join("rect").classed("dis-rect",!0);h.attr("width",At.rectWidth).attr("height",(function(t,e){return r.z().domain([0,1]).range([0,o])(t.realVal)})),h.attr("fill",(function(t,e){return t.color})),h.attr("opacity","0.7"),h.attr("stroke","#fff"),h.attr("transform",(function(t,e,n){var a=r.z().domain([0,1]).range([0,o]),l=r.D(n).data().sort((function(t,e){return e.realVal-t.realVal})),i=l.map((function(t){return t.state})).indexOf(t.state);if(0===i)return"translate(0,0)";for(var s=0,c=0;c<i;c++)s+=l[c].realVal;return"translate(0,"+a(s)+")"})),h.on("mouseover",(function(t){var e=r.C("#tooltip");e.transition().duration(200).style("opacity",.9);var n=r.n(".3f");e.html(t.state+": "+n(t.realVal)).style("left",r.l.pageX+"px").style("top",r.l.pageY-28+"px")})).on("mouseout",(function(t){r.C("#tooltip").transition().duration(500).style("opacity",0)}));var g=d.filter((function(t,e){return void 0===t[0]})).classed("discrete-leaf",!0);g.append("circle").attr("cx",10).attr("cy",2).attr("r",7).style("fill",(function(t){return t.color})),g.append("text").text((function(t){return t.winState})).attr("transform","translate(20, 5)").style("font-size",10)}return d}var Et=[],It=["#FE6D5E","#85C1E9","#A3E4D7"];function Rt(t,e){var n=0,a=0,l=null,o=!1;t.on("mousedown",(function(t,e,a){o=!0;var i=r.z().domain(t.domain).range([0,80]),s=Et.length+1,c=r.C(a[e]).append("g").classed("group-".concat(s),!0),u=r.x(a[e]);n=u[1],l={key:"".concat(t.key,"-").concat(t.index,"-").concat(s),trait:t.key,brush:c,scale:i,color:It[s-1]},Et.push(l);c.append("rect").classed("rect-".concat(s),!0).attr("height",10).attr("width",10).attr("opacity",.5).attr("fill",l.color).attr("transform","translate(0, ".concat(u[1],")"))})),t.on("mousemove",(function(t,e,a){var i=r.x(a[e]);!0===o&&l.brush.select("rect").attr("height",i[1]-n)})),t.on("mouseup",(function(t,i,s){o=!1;var c=r.x(s[i]);a=c[1];var u=r.n(".3n"),d=t.data.filter((function(t){return t.values.realVal>=l.scale.invert(a)&&t.values.realVal<=l.scale.invert(n)})),f=he(d);f.maxCount=r.E(t.bins.map((function(t){return t.length})));var p=r.C(s[i].parentNode).selectAll("g.distribution-too").data([f]).join("g").classed("distribution-too",!0);p.attr("transform","translate(0, 0) rotate(90)");var h=p.append("path").attr("d",ge);h.attr("fill",l.color).attr("fill-opacity",.5).style("stroke",l.color);var g=function(t,e,n,a){var l=n.map((function(t){return t.node})),o=a.filter((function(e){return e.index===t.index&&e.key!=t.key}));return o.each((function(t,n,a){var o=he(t.data.filter((function(t){return l.indexOf(t.node)>-1})));o.maxCount=r.E(t.bins.map((function(t){return t.length})));var i=r.C(a[n]).selectAll("g.distribution-too").data([o]).join("g").classed("distribution-too",!0);i.attr("transform","translate(0, 0) rotate(90)"),i.append("path").attr("d",ge).attr("fill",e.color).attr("fill-opacity",.5).style("stroke",e.color)})),o}(t,l,d,e),v=function(t,e,n,a){var l=a.filter((function(e){return e.index>t.index&&e.key===t.key}));return l.each((function(t,a,l){var o=he(t.data.filter((function(t){return t.values.realVal>e.scale.invert(n[0])&&t.values.realVal<e.scale.invert(n[1])})));o.maxCount=r.E(t.bins.map((function(t){return t.length})));var i=r.C(l[a]).selectAll("g.distribution-too").data([o]).join("g").classed("distribution-too",!0);i.attr("transform","translate(0, 0) rotate(90)"),i.append("path").attr("d",ge).attr("fill",e.color).attr("fill-opacity",.5).style("stroke",e.color)})),l}(t,l,[a,n],e),m=function(t,e,n){var a=r.C("#sidebar").select(".tree-svg").selectAll(".node").filter((function(e){return t.map((function(t){return t.node})).indexOf(e.data.node)>-1})),l=r.C("#sidebar").select(".tree-svg").selectAll(".node").filter((function(t){return e.data().flatMap((function(t){return t.data.map((function(t){return t.node}))})).indexOf(t.data.node)>-1})),o=r.C("#sidebar").select(".tree-svg").selectAll(".link").filter((function(t){return e.data().flatMap((function(t){return t.data.map((function(t){return t.node}))})).indexOf(t.data.node)>-1}));return a.select("circle").attr("fill",n.color).attr("r",5).style("stroke-width","1px").style("stroke","gray"),l.select("circle").attr("fill",n.color).attr("r",5),{treenodes:a,descendNodes:l,descendLinks:o}}(d,v,l);!function(t,e,n,a,l,o,i){r.C("#toolbar").append();var s=r.C("#toolbar").append("span").attr("id",t.key).classed("brush-span",!0).classed("badge badge-secondary",!0).style("background",t.color).datum({brush:t}).text("".concat(t.trait,":").concat(e[0]," - ").concat(e[1])).style("margin-left","25px"),c=i.map((function(t){return t.node})),u=Yt().filter((function(t){return t.map((function(t){return t.node})).filter((function(t){return c.includes(t)})).length>0})).flatMap((function(t){return t[t.length-1].node}));s.on("click",(function(){var t=r.C("#copy-tooltip");t.classed("hidden")?t.classed("hidden",!1):t.classed("hidden",!0),t.style("left",r.l.pageX+"px").style("top",r.l.pageY-28+"px"),t.select("button").on("click",(function(){t.classed("hidden",!0);var e=r.C("#copy-input");e.select("#copy-input-text").attr("value",u),e.classed("hidden",!1),e.style("left",r.l.pageX+"px").style("top",r.l.pageY-28+"px"),e.select("button").on("click",(function(){e.classed("hidden",!0);var t=document.getElementById("copy-input-text");t.select(),t.setSelectionRange(0,99999),document.execCommand("copy"),alert("Copied the text: "+t.value)})),e.select("#make-clade-copy").on("click",(function(){e.classed("hidden",!0),st("Group-Brush-".concat(u.length),Yt().filter((function(t){return u.indexOf(t[t.length-1].node)>-1})),[]),bt(r.C("div#clade-show").selectAll("ul"),rt[rt.length-1])}))}))})),s.append("i").classed("close fas fa-times",!0).style("padding-left","10px").on("click",(function(t,e,i){event.stopPropagation(),function(t){t.brush.remove(),Et=Et.filter((function(e){return e.key!=t.key}))}(t.brush),r.C(i[e].parentNode).remove(),n.remove(),a.selectAll(".distribution-too").remove(),l.selectAll(".distribution-too").remove(),o.treenodes.selectAll("circle").attr("fill","gray").attr("r",3).style("stroke-width","0px"),o.descendNodes.selectAll("circle").attr("fill","gray").attr("r",3),o.descendLinks.style("stroke","gray")}))}(l,[u(l.scale.invert(a)),u(l.scale.invert(n))],h,g,v,m,d)}))}function Pt(t,e,n,r,a,l,o){try{var i=t[l](o),s=i.value}catch(t){return void n(t)}i.done?e(s):Promise.resolve(s).then(r,a)}function Nt(){var t;return t=regeneratorRuntime.mark((function t(e){var n,a;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n=r.C("#clade-show").selectAll("li").selectAll("input").filter((function(t,e,n){return!0===n[e].checked})),a=n.data().map((function(t){var e=t.nodes.map((function(t){return t[t.length-1].node})),n=Yt().filter((function(t){return e.indexOf(t[t.length-1].node)>-1})),r=se(n,t.field,_e[_e.length-1],8);return{label:t.field,paths:n,groupBins:r}})),mt().then((function(t){Tt(e,a).then((function(){t.style.display="none"}))}));case 3:case"end":return t.stop()}}),t)})),(Nt=function(){var e=this,n=arguments;return new Promise((function(r,a){var l=t.apply(e,n);function o(t){Pt(l,r,a,o,i,"next",t)}function i(t){Pt(l,r,a,o,i,"throw",t)}o(void 0)}))}).apply(this,arguments)}function Tt(t,e){var n,a,l=r.C("#main"),o=(n=r.C("#clade-show").selectAll("li").selectAll("input").filter((function(t,e,n){return!0===n[e].checked})),a=Array.from(new Set(n.data().flatMap((function(t){return t.nodes.map((function(t){return t[t.length-1].node}))})))),Yt().filter((function(t){return a.indexOf(t[t.length-1].node)>-1}))),i=r.C("#view-pheno").empty()?null:r.C("#view-pheno").text();return"Pair View"!=t&&"View Phenogram"===i&&r.C(".dropdown.attr-drop").remove(),r.D(".distribution-too").remove(),r.D(".brush-span").remove(),"Path View"===t||null===t?(r.C("#pair-rank").classed("hidden",!0),St(o,l),document.getElementById("scrunch").disabled=!1,document.getElementById("discrete-view").disabled=!1,r.C("#scrunch").classed("hidden",!1),r.C("#discrete-view").classed("hidden",!1)):"Summary View"===t?(r.C("#pair-rank").classed("hidden",!0),document.getElementById("scrunch").disabled=!0,document.getElementById("discrete-view").disabled=!0,r.C("#scrunch").classed("hidden",!0),r.C("#discrete-view").classed("hidden",!0),de(l,e||o)):"Pair View"===t?(T(o),function(t){F.apply(this,arguments)}(o),document.getElementById("scrunch").disabled=!0,document.getElementById("discrete-view").disabled=!0,r.C("#scrunch").classed("hidden",!0),r.C("#discrete-view").classed("hidden",!0)):console.error("field not found"),l}function Bt(t,e){var n=r.C("#main");Yt();n.selectAll("*").remove(),de(n,nt[nt.length-1].groups).then((function(){return document.getElementById("loader").style.display="none"})),r.C("#view-toggle").text("View Paths"),document.getElementById("scrunch").disabled=!0,document.getElementById("discrete-view").disabled=!0,r.C("#scrunch").classed("hidden",!0),r.C("#discrete-view").classed("hidden",!0),vt({field:"Summary View"},r.C(".dropdown.change-view").select("button"))}function Ft(t){return function(t){if(Array.isArray(t))return _t(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return _t(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _t(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _t(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var qt=[];function Wt(t,e){var n=qt.filter((function(t){return"data-filter"===t.filterType})),a=n.map((function(t){return t.filterId})).indexOf(t);if(a!=n.length-1)for(var l=Ft(0===a?Pe[0]:n[a-1].data),o=(r.C("#toolbar").selectAll(".filter-tag").remove(),a+1);o<n.length;o++){var i=n[o].filterFunction;if("continuous"===n[o].attributeType){var s=i(l,n[o].selectedOption,n[o].predictedFilter,n[o].observedFilter);n[o].data=Ft(s),n[o].filterId="c-"+o,Kt(n[o],e),l=s}else{var c=i(l,n[o].selectedOption,n[o].fromState,n[o].toState);n[o].data=Ft(c),n[o].filterId="d-"+o,Kt(n[o],e),l=c}}var u=qt.filter((function(e){return e.filterId!=t}));qt=u}function Xt(t,e,n,r,a,l,o){var i={filterType:t,attributeType:e,filterId:n,filterFunction:r,"before-data":a,data:l};return null!=o&&o.forEach((function(t){i[t[0]]=t[1]})),qt.push(i),i}function Yt(){return qt.length>0?qt[qt.length-1].data:Pe[Pe.length-1]}function Ht(){return _e[_e.length-1]}function Kt(t,e){var n=r.C("#toolbar");if("continuous"===t.attributeType){var a=r.n(".2s"),l=n.append("button").classed("btn btn-info filter-tag",!0);r.C(l).datum(t),l.append("span").classed("badge badge-light",!0).text(t.data.length),l.append("h6").text(t.selectedOption+"  Predicted: "+a(t.predictedFilter[0])+"-"+a(t.predictedFilter[1])+" Observed: "+a(t.observedFilter[0])+"-"+a(t.observedFilter[1])).append("i").classed("close fas fa-times",!0).on("click",(function(){qt.filter((function(t){return"data-filter"===t.filterType})).filter((function(e){return t.attribute!=e.attribute}));Wt(t.filterId,e),Tt("Summary View"),r.D(".link-not-there").classed("link-not-there",!1),r.D(".node-not-there").classed("node-not-there",!1),l.remove()}))}else if("discrete"===t.attributeType){var o=n.append("button").classed("btn btn-info filter-tag",!0);o.append("span").classed("badge badge-light",!0).text(t.data.length),o.append("h6").text(t.state[0]),o.append("i").classed("fas fa-arrow-right",!0),o.append("h6").text(t.state[1]+"  "),o.append("i").classed("close fas fa-times",!0).on("click",(function(){Wt(t.filterId,e),Tt("Summary View"),r.D(".link-not-there").classed("link-not-there",!1),r.D(".node-not-there").classed("node-not-there",!1),o.remove()}))}else if("branch"===t.attributeType){var i=n.append("button").classed("btn btn-info filter-tag",!0);i.append("span").classed("badge badge-light",!0).text(t.data.length),i.append("h6").text(" At Branch: "+t.nodeId),i.append("i").classed("close fas fa-times",!0).on("click",(function(){Wt(t.filterId,e),Tt("Summary View"),r.D(".link-not-there").classed("link-not-there",!1),r.D(".node-not-there").classed("node-not-there",!1),i.remove()}))}}function Ut(t,e){var n=Yt(),a=(qt.filter((function(t){return"data-filter"===t.filterType})),n.filter((function(e){return e.map((function(t){return t.node})).indexOf(t)>-1})));Kt(Xt("data-filter","branch","b-"+qt.filter((function(t){return"branch"===t.attributeType})).length,Ut,Ft(n),Ft(a),[["nodeId",t]]),e),Tt("Summary View");var l=r.C("#sidebar").selectAll(".link"),o=r.C("#sidebar").selectAll(".node"),i=a.flatMap((function(t){return t.map((function(t){return t.node}))}));r.D(".link-not-there").classed("link-not-there",!1),r.D(".node-not-there").classed("node-not-there",!1),l.filter((function(t){return-1===i.indexOf(t.data.node)})).classed("link-not-there",!0),o.filter((function(t){return-1===i.indexOf(t.data.node)})).classed("node-not-there",!0)}function Gt(t,e,n,r){return t.filter((function(t){return-1===t.map((function(t){var a=t.attributes[e].realVal;return 1==t.leaf?a>r[0]&&a<r[1]:a>n[0]&&a<n[1]})).indexOf(!1)}))}function $t(t,e,n,r){if(null!=e)return t.filter((function(t){var a=t.filter((function(t){return 1!=t.leaf})).map((function(t){var r=t.attributes[e].states;return"Any"===n||r.filter((function(t){return t.state===n})).length>0&&r.filter((function(t){return t.state===n}))[0].realVal>.75})),l=t.filter((function(t){return!0===t.leaf})).map((function(t){var n=t.attributes[e].winState;return"Any"===r||n===r}));return a.indexOf(!0)>-1&&l.indexOf(!0)>-1}))}function Jt(t,e,n,a){var l=t.append("div").classed("selector",!0);l.append("h6").text(a);return l.append("select").attr("id",n).attr("class","Any").selectAll("option").data(e).join("option").text((function(t){return t})).attr("value",(function(t){return t})),r.C("#"+n).on("change",(function(t){var e=r.C(this).property("value");r.C(this).attr("class",e)})),r.C("#"+n)}function Qt(t){return function(t){if(Array.isArray(t))return Zt(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return Zt(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Zt(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Zt(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var te=[{light:"#F8C471",dark:"#F39C12"},{light:"#A3E4D7",dark:"#17A589"}];function ee(t,e,n){var a=r.C("#attribute-show").selectAll("input").filter((function(t,e,n){return!0===n[e].checked})).data(),l=t.append("div").attr("id","compare-wrap"),o=l.append("div").classed("compare-header",!0).style("margin","auto"),i=o.append("div").attr("height",50).attr("width",200).style("margin-left","460px"),s=o.append("svg"),c=ce({paths:e[0].paths.concat(e[1].paths),groupBins:e[0].groupBins},s);c.attr("transform","translate(-30, 10)"),c.selectAll("rect.bin").attr("stroke","#fff").attr("stroke-width","3px");var u=c.selectAll("g.branch-points");if(o.append("div").style("position","absolute").style("left","5px").style("top","65px").append("i").classed("close fas fa-times",!0).style("padding-left","10px").on("click",(function(t,e,n){l.remove(),ie.push(new Array);var a=r.C("#clade-show").selectAll("li").selectAll("input").filter((function(t,e,n){return!0===n[e].checked})).data().map((function(t){var e=t.nodes.map((function(t){return t[t.length-1].node})),n=Yt().filter((function(t){return e.indexOf(t[t.length-1].node)>-1})),r=se(n,t.field,_e[0],8);return{label:t.field,paths:n,groupBins:r}}));r.C("#summary-view").remove(),de(r.C("#main"),a),r.C("#sidebar").selectAll(".node").remove(),r.C("#sidebar").selectAll(".link").remove(),J(null,!0,!1)})),e.length>1){r.C("#toolbar").selectAll(".brush-span").remove();var d=Array.from(new Set(e.flatMap((function(t){return t.paths})).flatMap((function(t){return t.map((function(t){return t.node}))})))),f=r.C("#sidebar").selectAll(".node").filter((function(t){return-1===d.indexOf(t.data.node)})),p=r.C("#sidebar").selectAll(".link").filter((function(t){return-1===d.indexOf(t.data.node)}));f.attr("opacity",.3),p.attr("opacity",.3);var h=Array.from(new Set(e[0].paths.flatMap((function(t){return t.map((function(t){return t.node}))})))),g=Array.from(new Set(e[1].paths.flatMap((function(t){return t.map((function(t){return t.node}))})))),v=r.C("#sidebar").selectAll(".node").filter((function(t){return h.indexOf(t.data.node)>-1})),m=r.C("#sidebar").selectAll(".link").filter((function(t){return h.indexOf(t.data.node)>-1}));v.attr("opacity",.8).selectAll("circle").attr("fill",te[0].dark),m.attr("opacity",.8).style("stroke",te[0].dark);var y=r.C("#sidebar").selectAll(".node").filter((function(t){return g.indexOf(t.data.node)>-1})),b=r.C("#sidebar").selectAll(".link").filter((function(t){return g.indexOf(t.data.node)>-1}));y.attr("opacity",.8).selectAll("circle").attr("fill",te[1].dark),b.attr("opacity",.8).style("stroke",te[1].dark),i.append("i").classed("fas fa-arrow-left",!0).style("margin-right","10px"),e.forEach((function(t,e){i.append("span").text(t.label).classed("badge badge-secondary",!0).style("padding","5px").style("margin-bottom","7px").style("background",te[e].light)})),i.append("i").classed("fas fa-arrow-right",!0).style("margin-left","10px")}var x=l.append("svg").attr("class","compare-svg").style("padding-top","50px");if(e.length>1){var w=e[0].groupBins.filter((function(t){return a.indexOf(t.key)>-1})),C=e[1].groupBins.filter((function(t){return a.indexOf(t.key)>-1})),k=w.map((function(t,n,r){return t.branches=Qt(t.branches).map((function(t,r){return t.bins=[{key:e[0].label,value:t.bins,index:0},{key:e[1].label,value:C[n].branches[r].bins,index:1}],t.data=[{key:e[0].label,value:t.data.map((function(t){return t.groupKey=e[0].label,t.index=0,t})),index:0},{key:e[1].label,value:C[n].branches[r].data.map((function(t){return t.groupKey=e[1].label,t.index=1,t})),index:1}],t})),"continuous"===t.type?(t.leafData.data=[{key:e[0].label,value:t.leafData.data.map((function(t){return t.groupKey=e[0].label,t.index=0,t})),index:0},{key:e[1].label,value:C[n].leafData.data.map((function(t){return t.groupKey=e[1].label,t.index=1,t})),index:1}],t.leafData.bins=[{key:e[0].label,value:t.leafData.bins,index:0},{key:e[1].label,value:C[n].leafData.bins,index:1}]):(t.leafData.data=[{key:e[0].label,value:t.leafData.data.map((function(t){return t.groupKey=e[0].label,t.index=0,t})),index:0},{key:e[1].label,value:C[n].leafData.data.map((function(t){return t.groupKey=e[1].label,t.index=1,t})),index:1}],t.leafData.bins=[{key:e[0].label,keys:t.stateKeys,value:t.leafData.bins,index:0},{key:e[1].label,keys:t.stateKeys,value:C[n].leafData.bins,index:1}]),t})),A=x.append("g").attr("class","group-wrap").attr("transform","translate(30, 10)").selectAll(".attr-wrap").data(k).join("g").classed("attr-wrap",!0);x.attr("height",k.length*(le.height+5)),A.attr("transform",(function(t,e,n){if(0===e)return"translate(0,0)";var a=r.D(n).filter((function(t,n){return n<e})).data(),l=r.E(a.flatMap((function(t){return"continuous"===t.type?le.height+5:t.stateKeys.length*(le.squareDim+4)})));return t.sum=l,"translate(0, ".concat(l,")")}));var S=A.append("text").text((function(t){return t.key}));S.filter((function(t){return"continuous"===t.type})).attr("y",40).attr("x",80).style("text-anchor","end").style("font-size",11),S.filter((function(t){return"discrete"===t.type})).attr("y",(function(t,e){return 3})).attr("x",(function(t){return-t.stateKeys.length*le.squareDim/2})).style("text-anchor","middle").style("font-size",11).attr("transform","rotate(-90)");var D=A.append("g").classed("predicted",!0);D.attr("transform","translate(25, 0)"),D.filter((function(t){return"discrete"===t.type})).append("g").classed("win-line",!0);var z=D.selectAll("g.root").data((function(t){return[t.rootData]})).join("g").classed("root",!0);z.attr("transform","translate(60,0)");var O=z.filter((function(t){return"continuous"===t.type}));O.append("rect").attr("height",le.height).attr("width",12).attr("fill","#fff").style("stroke-width","0.5px").style("stroke","black");O.append("rect").attr("width",12).attr("height",(function(t){var e=t.scales.yScale;return e.range([le.height-5,0]),e(t.values.lowerCI95)-e(+t.values.upperCI95)})).attr("transform",(function(t,e){var n=t.scales.yScale;return n.range([le.height-5,0]),"translate(0,"+n(+t.values.upperCI95)+")"})).style("opacity",.5).attr("fill",oe);O.append("rect").attr("width",12).attr("height",3).attr("transform",(function(t,e){var n=t.scales.yScale;return n.range([le.height,0]),"translate(0,"+n(+t.values.realVal)+")"})).attr("fill","#004573");var j=z.filter((function(t){return"discrete"===t.type})),V=j.selectAll("g.root-state-groups").data((function(t){return t.bins})).join("g").classed("root-state-groups",!0);V.append("text").text((function(t,e){return t.color.state})).attr("y",10).attr("x",-3).style("font-size",10).style("text-anchor","end"),V.attr("transform",(function(t,e){return"translate(0, ".concat(3.5+e*(le.squareDim+2),")")})),V.append("rect").attr("height",le.squareDim).attr("width",le.squareDim).attr("fill","#fff").attr("opacity",1),V.append("rect").classed("color-rect",!0).attr("height",le.squareDim).attr("width",le.squareDim).attr("fill",(function(t,e){return"rgba(89, 91, 101, ".concat(t.state[0].value,")")})).attr("stroke-width",.5).attr("stroke","rgba(200, 203, 219, .9)"),j.selectAll("g.root-state-groups").filter((function(t,e,n){var a=r.t(r.D(n).data().map((function(t){return t.state[0].value})));return t.color.state===r.D(n).data().filter((function(t){return t.state[0].value===a}))[0].color.state})).classed("win",!0).select("rect.color-rect").attr("fill",(function(t,e){return t.color.color})).attr("opacity",(function(t){return r.E(t.state.flatMap((function(t){return t.value})))/t.state.length}));var M=D.selectAll("g.branch-bin").data((function(t){return t.branches})).join("g").classed("branch-bin",!0);M.attr("transform",(function(t,e,a){var l=a.length<11?(t.range[1]-t.range[0])/5:0,o=r.z().domain([0,Ce[0]]).range([0,le.timeRange]);return"translate("+(("continuous"===t.type?100:70)+n(e)+o(l))+", 0)"}));var L=M.filter((function(t){return"discrete"===t.type})).append("g");L.attr("transform","translate(5, 0)");var E=L.selectAll("g.group").data((function(t){return t.bins[0].value.map((function(t){return t.color.state})).map((function(e){var n={};return n.stateKey=e,n.bins=t.bins.map((function(t,n){var r={};return r.index=n,r.value=t.value.filter((function(t){return t.color.state===e}))[0],r.key=t.key,r})),n}))})).join("g").classed("group",!0).attr("transform",(function(t,e){var n=0===t.index?-40-le.squareDim/2:le.squareDim/2;return"translate(".concat(n,", 0)")}));E.append("rect").attr("height",le.squareDim).attr("width",85).attr("stroke","black").attr("fill","#fff").attr("opacity",.3);E.attr("transform",(function(t,e){return"translate(0, ".concat(4+e*(le.squareDim+2),")")})),E.append("text").text("1").attr("transform","translate(".concat(87,",10)")).style("font-size","10px").style("opacity",.6),E.append("text").text("0").attr("transform","translate(-7,10)").style("font-size","10px").style("opacity",.6);var I=E.selectAll(".clade-dis").data((function(t){return t.bins})).join("g").classed("clade-dis",!0),R=I.selectAll(".prob-tick").data((function(t,e,n){var a=r.n(".3f");return Qt(new Set(t.value.state.map((function(t){return+a(t.value)})))).map((function(e){return t.value.state.filter((function(t){return+a(t.value)===e})).map((function(e){return e.index=t.index,e}))})).flatMap((function(t){return t}))})).join("circle").classed("prob-tick",!0);R.attr("r",2).attr("opacity",.4).attr("fill",(function(t){return te[t.index].light})),R.attr("transform",(function(t,e,n){console.log("d in prob",t);var a=r.z().domain([0,1]).range([2,83]).clamp(!0),l=r.z().domain([0,1]).range([2,le.squareDim-2]);return"translate(".concat(a(t.value+t.x),",").concat(l(t.y),")")})),I.selectAll(".av-tick").data((function(t){return[{value:t.value.state[0].average,color:t.value.color.color,index:t.index}]})).join("rect").classed("av-tick",!0).attr("width",2).attr("height",le.squareDim).attr("fill",(function(t){return te[t.index].dark})).attr("transform",(function(t,e,n){var a=r.z().domain([0,1]).range([0,83]);return"translate(".concat(a(t.value),", 0)")})).on("mouseover",(function(t,e,n){var a=r.C("#tooltip");a.transition().duration(200).style("opacity",.9);var l=r.n(".3f");a.html("Average: ".concat(l(t.value))).style("left",r.l.pageX-40+"px").style("top",r.l.pageY-28+"px"),a.style("height","auto")})).on("mouseout",(function(){r.C("#tooltip").transition().duration(500).style("opacity",0)})),R.on("mouseover",(function(t,e,n){var a=r.C("#tooltip");a.transition().duration(200).style("opacity",.9);var l=r.n(".3f");a.html("".concat(t.state," : ").concat(l(t.value))).style("left",r.l.pageX-40+"px").style("top",r.l.pageY-28+"px"),a.style("height","auto")})).on("mouseout",(function(){r.C("#tooltip").transition().duration(500).style("opacity",0)}));var P=M.filter((function(t){return"continuous"===t.type}));P.on("mouseover",(function(t,e,n){var a=t.data,l=a[0].value.concat(a[1].value).map((function(t){return t.node})),o=(u.filter((function(t){return l.indexOf(t.node)>-1})).classed("selected",!0),r.C("#sidebar").selectAll(".node").filter((function(t){return l.indexOf(t.data.node)>-1})).classed("selected-branch",!0),r.z().domain(t.domain).range([0,le.height]));r.C(n[e]).append("g").classed("y-axis",!0).call(r.c(o).ticks(5))})).on("mouseout",(function(t,e,n){r.D(".branch-points.selected").classed("selected",!1),r.D(".selected-branch").classed("selected-branch",!1),r.C(n[e]).select(".y-axis").remove()}));var N=P.selectAll("g.group").data((function(t){return t.bins})).join("g").attr("class",(function(t){return"g-".concat(t.index," group")}));N.each((function(t,e,n){t.maxCount=r.E(t.value.map((function(t){return t.length}))),t.value.maxCount=r.E(t.value.map((function(t){return t.length})));var a=r.C(n[e]).selectAll("g").data([t.value.map((function(e){return e.maxCount=r.E(t.value.map((function(t){return t.length}))),e.index=t.index,e}))]).join("g").classed("distribution",!0);a.attr("transform",(function(t,e,n){return 0===t[0].index?"translate(0, 0) rotate(90)":"translate(11, "+le.height+") rotate(-90)"})),a.append("path").attr("d",0===t.index?ge:ve).attr("fill",(function(t,e,n){return oe})).attr("opacity",.4).style("stroke",te[t.index].dark)}));N.append("rect").attr("height",le.height).attr("width",10).style("fill","#fff").style("stroke","gray"),P.selectAll("g.range-wrap").data((function(t){return t.data})).join("g").classed("range-wrap",!0).selectAll("rect.range").data((function(t,e){return t.value.map((function(n){return n.range=t.range,n.gindex=e,n}))})).join("rect").classed("range",!0);P.selectAll("rect.av-rect").data((function(t){return t.data})).join("rect").classed("av-rect",!0).attr("width",10).attr("height",(function(t,e){return null!=t.value?3:0})).attr("transform",(function(t,e){if(null!=t.value){var n=t.value[0].scales.yScale;return n.range([le.height,0]),"translate(0,"+n(r.u(t.value.map((function(t){return+t.values.realVal}))))+")"}return"translate(0,0)"})).attr("fill",(function(t){return te[t.index].dark}));var T=r.f().extent([[0,0],[20,le.height]]);T.on("end",(function(){var t=this,e=r.C(this.parentNode).data()[0],n=e.bins.map((function(t){return t.maxCount})),a=r.l.selection,l=r.n(".3n"),o=r.C("#toolbar").selectAll(".brush-span").size(),i=0===o?"one":"two";if(null!=a){r.C("#sidebar").selectAll(".node").filter((function(t){return!0===t.data.leaf}));var s=r.z().domain([e.domain[0],e.domain[1]]).range([0,le.height]),c=(e.key,[s.invert(a[1]),s.invert(a[0])]),u=r.C("#sidebar").selectAll(".node"),d=e.data.map((function(t){return t.value.filter((function(t){return t.values.realVal>=c[0]&&t.values.realVal<=c[1]}))})),f=P.filter((function(t){return t.index===e.index&&t.key!=e.key})),p=P.filter((function(t){return t.index>e.index&&t.key===e.key}));d.forEach((function(e,a){if(e.length>0){var l=r.C(t.parentNode).select(".g-".concat(a)).append("g").classed("distribution-too",!0),o=continuousHistogram(e);o.maxCount=n[a];var i=e.map((function(t){return t.node}));l.data([o]),l.append("path").attr("d",0===a?ge:ve).style("stroke",te[a].dark).style("fill",te[a].light).style("fill-opacity",.8),l.attr("transform",0===a?"translate(0, 0) rotate(90)":"translate(11, ".concat(le.height,") rotate(-90)"));f.select(".g-".concat(a)).each((function(t,e,n){var l=continuousHistogram(t.data.filter((function(t){return t.index===a}))[0].value.filter((function(t){return i.indexOf(t.node)>-1})));l.maxCount=t.bins[a].maxCount;var o=r.C(n[e]).append("g").classed("distribution-too",!0);o.data([l]).append("path").attr("d",0===a?ge:ve).style("stroke",te[a].dark).style("fill",te[a].light).style("fill-opacity",.8),o.attr("transform",0===a?"translate(0, 0) rotate(90)":"translate(11, ".concat(le.height,") rotate(-90)"))})),p.select(".g-".concat(a)).each((function(t,e,n){var l=continuousHistogram(t.data.filter((function(t){return t.index===a}))[0].value.filter((function(t){return t.values.realVal>c[0]&&t.values.realVal<c[1]})));l.maxCount=t.bins[a].maxCount;var o=r.C(n[e]).append("g").classed("distribution-too",!0);o.data([l]).append("path").attr("d",0===a?ge:ve).style("stroke",te[a].dark).style("fill",te[a].light).style("fill-opacity",.8),o.attr("transform",0===a?"translate(0, 0) rotate(90)":"translate(11, ".concat(le.height,") rotate(-90)"))}))}}));var h=e.data.flatMap((function(t){return t.value.filter((function(t){return t.values.realVal>=c[0]&&t.values.realVal<=c[1]}))})),g=e.data.flatMap((function(t){return t.value.filter((function(t){return t.values.realVal<c[0]||t.values.realVal>c[1]}))})),v=brushedNodes(h,g,e,c,i),m=v[0],y=v[1];v[2],v[3];if(o<2){var b=r.C("#toolbar").selectAll(".brush-span").filter((function(t,n,a){return r.C(a[n]).attr("value")=="".concat(e.bins.groupLabel,"-").concat(e.key)}));if(0===b.size()){r.C(this).select(".selection").style("fill","".concat(brushColors[o][0])).attr("stroke","".concat(brushColors[o][0])).attr("stroke-width",2),r.C(this).select(".overlay").attr("stroke",brushColors[o][1]).attr("stroke-width",2),r.C("#toolbar").append("span").attr("class",i).attr("id",i).classed("brush-span",!0).classed("".concat(e.bins.groupLabel),!0).classed("badge badge-secondary",!0).style("background",brushColors[o][0]).attr("value","".concat(e.bins.groupLabel,"-").concat(e.key)).datum({brush:this,nodes:d}).text("".concat(e.bins.groupLabel,", ").concat(e.key,": ").concat(l(c[0])," - ").concat(l(c[1]))).append("i").classed("close fas fa-times",!0).style("padding-left","10px").on("click",(function(t,e,n){var a=0===o?"one":"two";r.C(t.brush).call(T.move,null),r.C(n[e].parentNode).remove(),r.C(t.brush).select(".overlay").attr("stroke-width",0),p.selectAll(".distribution-too").remove(),f.selectAll(".distribution-too").remove(),r.C(t.brush.parentNode).selectAll(".distribution-too").remove(),r.C("#sidebar").selectAll(".".concat(a)).classed("anti-brushed-second",!1),r.C("#sidebar").selectAll(".".concat(a)).classed("anti-brushed",!1)}))}else{b.text("".concat(e.bins.groupLabel,", ").concat(e.key,": ").concat(l(c[0])," - ").concat(l(c[1]))),b.append("i").classed("close fas fa-times",!0).style("padding-left","10px").on("click",(function(t,e,n){r.C(t).call(T.move,null),r.C(t).select(".overlay").attr("stroke-width",0),r.C(n[e].parentNode).remove()})),r.C(b.datum()).call(T.move,null),r.C(b.datum()).select(".overlay").attr("stroke-width",0),u.selectAll(".".concat(e.key)).selectAll("".concat(e.bins.groupLabel)).selectAll(".second-branch").classed("second-branch",!1).classed("one",!1).classed("two",!1).classed("".concat(e.key),!1),u.selectAll(".".concat(e.key)).selectAll(".selected-branch").classed("selected-branch",!1).classed("one",!1).classed("two",!1).classed("".concat(e.key),!1),u.selectAll(".".concat(e.key)).selectAll(".anti-brushed-second").classed("anti-brushed-second",!1).classed("one",!1).classed("two",!1).classed("".concat(e.key),!1),u.selectAll(".".concat(e.key)).selectAll(".anti-brushed-branch").classed("anti-brushed-branch",!1).classed("one",!1).classed("two",!1).classed("".concat(e.key),!1);var x=b.attr("id");o="one"===x?0:1,r.C(this).select(".selection").style("fill","".concat(brushColors[o][0])).attr("stroke","".concat(brushColors[o][0])).attr("stroke-width",2),r.C(this).select(".overlay").attr("stroke",brushColors[o][1]).attr("stroke-width",2);var w=e.data.flatMap((function(t){return t.value.filter((function(t){return t.values.realVal>=c[0]&&t.values.realVal<=c[1]}))})),C=e.data.flatMap((function(t){return t.value.filter((function(t){return t.values.realVal<c[0]||t.values.realVal>c[1]}))}));b.datum({brush:this,nodes:w}),brushedNodes(w,C,e,c,x)}}else{r.C("#toolbar").selectAll(".brush-span").filter((function(t,e){return 0===e})).remove();var k=0===colorBool?"one":"two";r.C("#toolbar").append("span").attr("class").classed("brush-span",!0).classed("badge badge-secondary",!0).style("background",brushColors[colorBool][0]).attr("value","".concat(e.bins.groupLabel,"-").concat(e.key)).text("".concat(e.bins.groupLabel,", ").concat(e.key,": ").concat(l(c[0])," - ").concat(l(c[1]))),0===colorBool?colorBool=1:colorBool=0,y.classed(k,!0),m.classed(k,!0)}}else r.D(".".concat(e.key,".brushed-branch")).classed("brushed-branch",!1),r.D(".".concat(e.key,".brushed-second")).classed("brushed-second",!1)})),P.append("g").classed("continuous-branch-brush",!0).attr("class","brush").call(T);var B=A.append("g").classed("observed",!0);B.attr("transform",(function(t,e,n){return"translate("+(le.predictedWidth+150)+", 0)"}));var F=B.filter((function(t){return"continuous"===t.type}));F.attr("transform","translate(".concat(le.predictedWidth+160,", -15)"));var _=F.selectAll("g.cont-groups").data((function(t){return t.leafData.bins})).join("g").classed("cont-groups",!0).selectAll("g.ob-bars").data((function(t){return t.value.map((function(e){return e.index=t.index,e}))})).join("g").classed("ob-bars",!0);_.append("rect").attr("width",(function(t,e,n){return le.observedWidth/n.length})).attr("height",(function(t,e,n){return r.z().domain([0,r.t(r.D(n).data().map((function(t){return t.length})))]).range([0,le.height-le.margin])(Object.keys(t).length-2)})).attr("fill",(function(t){return te[t.index].light})).attr("fill-opacity",.4);_.attr("transform",(function(t,e,n){var a=le.observedWidth/n.length,l=r.z().domain([0,r.t(r.D(n).data().map((function(t){return t.length})))]).range([0,le.height-le.margin]);return"translate("+a*e+", "+(le.height-l(Object.keys(t).length-2))+")"})),F.each((function(t,e,n){var a=t.leafData.data[0].value.map((function(t){return+t.values.realVal})),l=r.z().domain([r.w(a),r.t(a)]).range([0,le.observedWidth]),o=r.z().domain([0,r.t(t.leafData.bins[0].value.map((function(t){return Object.keys(t).length})))-2]).range([le.height-le.margin,0]);r.C(n[e]).append("g").classed("x-axis",!0).call(r.b(l)).attr("transform","translate(0, "+le.height+")"),r.C(n[e]).append("g").classed("y-axis",!0).call(r.c(o).ticks(4)).attr("transform","translate(0, "+le.margin+")"),r.C(n[e]).select(".x-axis").selectAll("text").style("font-size","8px"),r.C(n[e]).select(".y-axis").selectAll("text").style("font-size","8px"),r.C(n[e]).append("g").classed("x-axis-label",!0).append("text").text("Frequency").attr("transform","translate(-20, ".concat(le.height-10,") rotate(-90)")).style("font-size","10px")}));var q=B.filter((function(t){return"discrete"===t.type}));q.attr("transform","translate(".concat(le.predictedWidth+160,", 5)"));var W=q.selectAll("g.dis-groups").data((function(t){return t.leafData.bins})).join("g").classed("dis-groups",!0).selectAll("g.ob-bars").data((function(t){return t.keys.map((function(e,n){return{state:e,data:t.value[n],max:r.E(t.value[n].map((function(t){return t.length}))),index:t.index}}))})).join("g").classed("ob-bars",!0),X=W.append("rect").attr("width",(function(t,e,n){return le.observedWidth/n.length/2})).attr("height",(function(t,e,n){return r.z().domain([0,r.t(r.D(n).data().map((function(t){return t.data.length})))]).range([0,le.height])(t.data.length)})).attr("fill",(function(t,e){return null!=t.data[0]?t.data[0].color:"#fff"})).attr("opacity",.3);W.attr("transform",(function(t,e,n){var a=le.observedWidth/n.length,l=a/2,o=r.z().domain([0,r.t(r.D(n).data().map((function(t){return t.data.length})))]).range([0,le.height]),i=le.height-o(t.data.length);return 0===t.index?"translate("+a*e+", "+i+")":"translate("+(l+a*e)+", "+i+")"})),X.on("mouseover",(function(t,e,n){var a=r.C("g."+t[0].label).selectAll("g.state");a.filter((function(e){return e[0].state===t[0].winState})).attr("opacity",.8),a.filter((function(e){return e[0].state!=t[0].winState})).attr("opacity",.1),r.C(n[e]).attr("opacity",.9)})).on("mouseout",(function(t,e,n){r.C(n[e]).attr("opacity",.3);r.C("g."+t[0].label).selectAll("g.state").attr("opacity",.6)})),q.each((function(t,e,n){var a=r.B().domain(t.stateKeys).range([0,le.observedWidth]).padding(.6),l=r.z().domain([0,t.leafData.data.length]).range([le.height,0]);r.C(n[e]).append("g").classed("y-axis",!0).call(r.c(l).ticks(4)),r.C(n[e]).append("g").classed("x-axis",!0).call(r.b(a)).attr("transform","translate(0, "+le.height+")"),r.C(n[e]).select(".x-axis").selectAll("text").style("font-size","8px"),r.C(n[e]).select(".y-axis").selectAll("text").style("font-size","8px")}))}}function ne(t,e,n,r,a,l,o){try{var i=t[l](o),s=i.value}catch(t){return void n(t)}i.done?e(s):Promise.resolve(s).then(r,a)}function re(t){return function(t){if(Array.isArray(t))return ae(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return ae(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return ae(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ae(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var le={height:80,observedWidth:200,predictedWidth:900,margin:20,squareDim:15,timeRange:895},oe="#baaaaa",ie=[[]];function se(t,e,n,a){var l=qt.filter((function(t){return"hide-attribute"===t.type})).map((function(t){return t.attribute})),o=n.map((function(t){return t.field})).filter((function(t){return-1===l.indexOf(t)})),i=re(t),s=l.length>0?n.filter((function(t){return-1===l.indexOf(t.field)})).map((function(t){return t.field})):null,c=(Ve(i,n,s),function(t,e){var n=Ce[Ce.length-1],a=t.map((function(t){return t.filter((function(t){return 1!=t.leaf&&1!=t.root}))})),l=r.t(a.map((function(t){return t.length})))<e?r.t(a.map((function(t){return t.length})))-1:e;return new Array(l).fill().map((function(t,e){var r=n/l;return{base:e*r,top:(e+1)*r,binI:e,step:r}})).map((function(t,e){var n=a.flatMap((function(e){return e.filter((function(e){return e.combLength>t.base&&e.combLength<=t.top}))})),r=re(new Set(n.map((function(t){return t.node})))).map((function(t){return n.filter((function(e){return e.node===t}))[0]}));return t.data=r.map((function(t){return t.range=re(new Set(n.map((function(t){return t.node})))).length,t})),t}))}(i,a)),u=i.flatMap((function(t){return t.filter((function(t){return!0===t.leaf}))})),d=i.flatMap((function(t){return t.filter((function(t){return!0===t.root}))})),f=o.map((function(t){var l=n.filter((function(e){return e.field===t}))[0],o=c.map((function(e){return e.data.length>0?e.fData=e.data.map((function(e){var n=e.attributes[t];return n.node=e.node,n})):e.fData=[],{data:e.fData,range:[e.base,e.top],index:e.binI,key:t}})),i=u.map((function(e){return e.attributes[t]})),s={data:i};if("continuous"===l.type){var f="realVal"===ft?l.min:Math.log(l.min),p="realVal"===ft?l.max:Math.log(l.max),h=r.z().domain([f,p]).range([0,le.height]),g=r.p().value((function(t){return t.values[ft]})).domain(h.domain()).thresholds(h.ticks(20));o.map((function(n,o,i){return n.outliers=n.data.filter((function(t){return t.values.realVal<t.normalRange[0]||t.values.realVal>t.normalRange[1]})),n.type=l.type,n.bins=g(n.data.filter((function(t){return t.values.realVal>=t.normalRange[0]&&t.values.realVal<=t.normalRange[1]}))),n.domain=[p,f],n.bins.count=a,n.bins.groupLabel=e,n.bins.binNormal=n.data[0]?n.data[0].normalRange:[],n.bins.outlierRange=n.domain,0===r.u(n.bins.map((function(t){return t.length})))&&(0===o?(n.bins=g(d.map((function(e){return e.attributes[t]}))),n.data=d.map((function(e){return e.attributes[t]})),n.bins.count=a):(n.bins=i[o-1].bins,n.data=i[o-1].data)),n}));r.t(i.flatMap((function(t){return+t.values[ft]}))),r.w(i.flatMap((function(t){return+t.values[ft]})));var v=r.z().domain([f,p]).range([0,le.width]),m=r.p().value((function(t){return+t.values[ft]})).domain(v.domain()).thresholds(v.ticks(10));return s.bins=m(i),{key:t,branches:re(o),type:l.type,leafData:s,rootData:d.map((function(e){return e.attributes[t]}))[0]}}var y=i[0].scales.scales,b=y[0].state?y.map((function(t){return t.state})):y.map((function(t){return t.scaleName})),x=d[0].attributes[t];x.bins=r.k(d[0].attributes[t].values).map((function(t){return{state:[{state:t.key,value:t.value}],branchCount:a,color:l.stateColors.filter((function(e){return e.state===t.key}))[0],max:80}})),o.bins=null,s.bins=y.map((function(t){return i.filter((function(e){return t.scaleName.includes(e.states.state)}))}));var w=r.z().domain([0,1]).range([0,40]),C=r.p().value((function(t){return t.value})).domain(w.domain()).thresholds(w.ticks(10));return o.map((function(t,e,n){var o=l.stateColors;return t.bins=b.map((function(e){var n=t.data.flatMap((function(t){return Object.entries(t.values).filter((function(t){return t[0]===e}))})).map((function(t){return{state:t[0],value:t[1]}}));return{state:n,branchCount:a,histogram:C(n),color:o.filter((function(t){return t.state===e}))[0],max:80}})),0===t.bins[0].state.length&&(t.bins=0===e?r.k(x.values).map((function(t){var e=C([+t.value]).map((function(e){return t.value<=e.x1&&t.value>=e.x0&&e.push(+t.value),e}));return{state:[{state:t.key,value:t.value}],branchCount:a,histogram:e,color:o.filter((function(e){return e.state===t.key}))[0],max:80}})):n[e-1].bins),t.type=l.type,t})),{key:t,branches:re(o),type:l.type,leafData:s,rootData:d.map((function(e){return e.attributes[t]}))[0],stateKeys:b,maxCount:r.t(o.map((function(t){return t.data.length})))}}));return f.group=e,f.branchCount=f[0].branches.length,f.keys=o,f}function ce(t,e){var n=e.append("g").classed("branch-bar",!0);n.attr("transform","translate(150, 0)"),n.append("rect").classed("point-dis-rect",!0).attr("height",25).attr("x",-10).attr("y",-10).attr("fill","none");var a=n.append("g").attr("transform","translate(115, -10)");n.append("line").attr("y1",2).attr("y2",2).attr("x1","100").attr("x2",le.predictedWidth).attr("stroke","gray").attr("stroke-width",.25),n.append("text").text("Root").attr("transform","translate(80, 7)"),n.append("g").classed("leaf-label",!0).attr("transform","translate(".concat(le.predictedWidth+200,", 7)")).append("text").text("Leaves");var l=[],o=[];t.paths.map((function(t){t.filter((function(t){return 1!=t.leaf})).map((function(t){-1==o.indexOf(t.node)&&(o.push(t.node),l.push({node:t.node,eMove:t.combLength}))}))}));var i=r.z().domain([0,Ce[Ce.length-1]]).range([0,le.timeRange]),s=n.selectAll("g.branch-points").data(l).join("g").attr("class",(function(t,e){return t.node})).classed("branch-points",!0);s.attr("transform",(function(t,e){return"translate(".concat(115+i(t.eMove),", 0)")})),s.append("circle").attr("r",5).attr("fill","#fff").attr("opacity",.5);var c=r.z().domain([0,Ce[Ce.length-1]]).range([0,le.timeRange]),u=a.selectAll("rect.bin").data(t.groupBins[0].branches.map((function(t){return t.range}))).join("rect").classed("bin",!0);u.attr("width",(function(t,e,n){return c(t[1])-c(t[0])})).attr("height",20),u.attr("transform",(function(t,e,n){var r=c(t[1])-c(t[0]);return"translate(".concat(r*e,",0)")})),u.attr("fill","gray").attr("stroke-width",2).attr("stroke","white");var d=r.z().domain([Ce[Ce.length-1],0]).range([0,le.timeRange]),f=r.b(d),p=n.append("g").call(f);return p.attr("transform","translate(113, 10)"),p.select("path").attr("stroke-width",0),n}function ue(t,e,n){var a=t[0].leafData.data.map((function(t){return t.node})),l=Yt().filter((function(t){return a.indexOf(t[t.length-1].node)>-1})).flatMap((function(t){return t.map((function(t){return t.node}))})),o=r.C("#attribute-show").selectAll("input").filter((function(t,e,n){return!0===n[e].checked})).data(),i=e.append("g").classed("clade-label",!0).attr("transform","translate(10, 0)");return i.append("rect").attr("width",50).attr("height",t.keys.length*(le.height+15)).attr("fill","gray").style("opacity",.2).on("mouseover",(function(t,e){var n=r.C("#sidebar").selectAll(".node"),a=r.C("#sidebar").selectAll(".link");n.filter((function(t){return l.indexOf(t.data.node)>-1})).classed("hover clade",!0),a.filter((function(t){return l.indexOf(t.data.node)>-1})).classed("hover clade",!0);t.paths.map((function(t){return t[t.length-1].label}))})).on("mouseout",(function(t,e){var n=r.C("#sidebar").selectAll(".node"),a=r.C("#sidebar").selectAll(".link");n.classed("hover clade",!1),a.classed("hover clade",!1)})),i.append("text").text((function(t){return t.label})).style("text-anchor","middle").attr("transform","translate(23, ".concat(o.length*(le.height+15)/2,"), rotate(-90)")),i}function de(t,e){return fe.apply(this,arguments)}function fe(){var t;return t=regeneratorRuntime.mark((function t(e,n){var a,l;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:console.log("pathgroups",n),a=!1,l=r.C("#attribute-show").selectAll("input").filter((function(t,e,n){return!0===n[e].checked})).data(),e.append("div").attr("id","summary-view").selectAll(".group-div").data(n).join("div").classed("group-div",!0).each((function(t,n,o){var i=t.groupBins.filter((function(t){return l.indexOf(t.key)>-1})),s=r.C(o[n]);s.classed(t.label,!0),s.style("text-align","center"),s.append("text").text(t.label),s.append("text").text(" : ".concat(t.paths.length," Paths"));var c=s.append("svg");c.attr("class","main-summary-view"),c.attr("id","".concat(t.label,"-svg")),c.attr("height",l.length*(le.height+11)+50);var u=ce(t,c);u.attr("transform","translate(55, 10)");var d=r.z().domain([0,t.groupBins.branchCount]).range([0,le.timeRange]),f=u.selectAll("g.branch-points"),p=c.append("g").classed("summary-wrapper",!0);p.attr("transform","translate(70, 50)");var h=p.selectAll(".attr-wrap").data(i).join("g").attr("class",(function(t){return t.key+" attr-wrap"}));h.attr("transform",(function(t,e,n){if(0===e)return"translate(0,0)";var a=r.D(n).filter((function(t,n){return n<e})).data(),l=r.E(a.flatMap((function(t){return"continuous"===t.type?le.height+5:t.stateKeys.length*(le.squareDim+4)})));return t.sum=l,"translate(0, ".concat(l,")")}));var g=h.append("g"),v=g.append("text").text((function(t){return Me(t.key,11)}));return g.on("mouseover",(function(t,e,n){r.C("#tooltip").classed("hidden",!1).style("opacity",1).style("left",r.l.pageX+"px").style("top",r.l.pageY-28+"px").text(t.key)})).on("mouseout",(function(t,e,n){return r.C("#tooltip").classed("hidden",!0).style("opacity",0)})),v.filter((function(t){return"continuous"===t.type})).attr("y",40).attr("x",80).style("text-anchor","end").style("font-size",11),v.filter((function(t){return"discrete"===t.type})).attr("y",(function(t,e){return 3})).attr("x",(function(t){return-t.stateKeys.length*le.squareDim/2})).style("text-anchor","middle").style("font-size",11).attr("transform","rotate(-90)"),ue(t.groupBins,c,t.label).on("click",(function(t,n,l){a?(a=!1,r.C("#compare-tooltip").classed("hidden",!0)):(a=!0,r.C("#compare-tooltip").style("left",r.l.pageX+"px").style("top",r.l.pageY-28+"px").select("#value").text(t.node),r.C("#compare-tooltip").classed("hidden",!1),r.C("#select-for-compare").on("click",(function(){a=!1,r.C("#compare-tooltip").classed("hidden",!0),r.C(l[n]).select("rect").attr("fill","#F5B041"),ie[ie.length-1].push(Object.assign({},t)),ie[ie.length-1].length>1&&(e.selectAll("*").remove(),e.select("#compare-wrap").remove(),ee(e,ie[ie.length-1],d))})))})),pe(h,d,f)}));case 6:case"end":return t.stop()}}),t)})),(fe=function(){var e=this,n=arguments;return new Promise((function(r,a){var l=t.apply(e,n);function o(t){ne(l,r,a,o,i,"next",t)}function i(t){ne(l,r,a,o,i,"throw",t)}o(void 0)}))}).apply(this,arguments)}function pe(t,e,n){var a=t.append("g").classed("predicted",!0);a.attr("transform","translate(35, 0)"),a.filter((function(t){return"discrete"===t.type})).append("g").classed("win-line",!0);var l=a.selectAll("g.root").data((function(t){return[t.rootData]})).join("g").classed("root",!0);l.attr("transform","translate(50,0)");var o=l.filter((function(t){return"continuous"===t.type}));o.append("rect").attr("height",le.height).attr("width",12).attr("fill","#fff").style("stroke-width","0.5px").style("stroke","black");o.append("rect").attr("width",12).attr("height",(function(t){var e=t.scales.yScale;e.range([le.height-5,0]);var n="realVal"===ft?+t.values.upperCI95:+t.values.logUpper;return e("realVal"===ft?+t.values.lowerCI95:+t.values.logLower)-e(n)})).attr("transform",(function(t,e){var n=t.scales.yScale;return n.range([le.height-5,0]),"translate(0,"+n("realVal"===ft?+t.values.upperCI95:+t.values.logUpper)+")"})).style("opacity",.5).attr("fill",oe);o.append("rect").attr("width",12).attr("height",3).attr("transform",(function(t,e){var n=t.scales.yScale;return n.range([le.height,0]),"translate(0,"+n(+t.values[ft])+")"})).attr("fill","#004573");var i=l.filter((function(t){return"discrete"===t.type})),s=i.selectAll("g.root-state-groups").data((function(t){return t.bins})).join("g").classed("root-state-groups",!0);s.append("text").text((function(t,e){return t.color.state})).attr("y",10).attr("x",-3).style("font-size",10).style("text-anchor","end"),s.attr("transform",(function(t,e){return"translate(0, ".concat(3.5+e*(le.squareDim+2),")")})),s.append("rect").attr("height",le.squareDim).attr("width",le.squareDim).attr("fill","#fff").attr("opacity",1),s.append("rect").classed("color-rect",!0).attr("height",le.squareDim).attr("width",le.squareDim).attr("fill",(function(t,e){return"rgba(89, 91, 101, ".concat(t.state[0].value,")")})).attr("stroke-width",.5).attr("stroke","rgba(200, 203, 219, .9)"),i.selectAll("g.root-state-groups").filter((function(t,e,n){var a=r.t(r.D(n).data().map((function(t){return t.state[0].value})));return t.color.state===r.D(n).data().filter((function(t){return t.state[0].value===a}))[0].color.state})).classed("win",!0).select("rect.color-rect").attr("fill",(function(t,e){return t.color.color})).attr("opacity",(function(t){return r.E(t.state.flatMap((function(t){return t.value})))/t.state.length}));var c=a.selectAll("g.branch-bin").data((function(t){return t.branches})).join("g").classed("branch-bin",!0);c.filter((function(t){return"continuous"===t.type})).attr("transform",(function(t,n,a){var l=a.length<11?(t.range[1]-t.range[0])/5:0,o=r.z().domain([0,Ce[Ce.length-1]]).range([0,le.timeRange]);return"translate("+(90+e(n)+o(l))+", 0)"}));var u=c.filter((function(t){return"discrete"===t.type}));!function(t){var e=t.selectAll("g.histo-bars").data((function(t){return t.bins.map((function(e){return e.index=t.index,e}))})).join("g").classed("histo-bars",!0);e.attr("transform",(function(t,e,n){return"translate(".concat(le.squareDim,", ").concat(3.5+e*(le.squareDim+2),")")}));e.append("rect").attr("height",le.squareDim).attr("width",85).attr("stroke","black").style("stroke-width",.5).attr("fill","#fff").attr("opacity",.3);e.append("text").text("1").attr("transform","translate(".concat(87,",10)")).style("font-size","10px").style("opacity",.6),e.append("text").text("0").attr("transform","translate(-7,10)").style("font-size","10px").style("opacity",.6);var n=e.selectAll(".prob-tick").data((function(t,e,n){var a=r.n(".3f"),l=(re(new Set(t.state.map((function(t){return+a(t.value)})))).map((function(e){return t.state.filter((function(t){return+a(t.value)===e})).map((function(t){return t.y=Math.random(),t.x=.06*Math.random()-.03,t}))})),t.state.map((function(e){var n=e;return n.average=r.u(t.histogram.flatMap((function(t){return t.map((function(t){return+t.value}))}))),n.color=t.color.color,n})));return l.color=t.color.color,l.average=r.u(t.histogram.flatMap((function(t){return+t}))),l})).join("circle").classed("prob-tick",!0);n.attr("r",2).attr("opacity",.4).attr("fill","gray"),n.attr("transform",(function(t,e,n){var a=r.z().domain([0,1]).range([2,83]).clamp(!0),l=r.z().domain([0,1]).range([2,le.squareDim-2]);return"translate(".concat(a(+t.value+t.x),",").concat(l(t.y),")")})),e.selectAll(".av-tick").data((function(t,e,n){return[{value:t.state[0].average,color:t.color.color}]})).join("rect").classed("av-tick",!0).attr("width",1).attr("height",le.squareDim).attr("fill",(function(t){return t.color})).attr("transform",(function(t,e,n){null!=t.value&&t.value;var a=r.z().domain([0,1]).range([0,83]);return"translate(".concat(a(t.value),", 0)")})).on("mouseover",(function(t,e,n){var a=r.C("#tooltip");a.transition().duration(200).style("opacity",.9);var l=r.n(".3f");a.html("Average: ".concat(l(t.value))).style("left",r.l.pageX-40+"px").style("top",r.l.pageY-28+"px"),a.style("height","auto")})).on("mouseout",(function(){r.C("#tooltip").transition().duration(500).style("opacity",0)})),n.on("mouseover",(function(t,e,n){var a=r.C("#tooltip");a.transition().duration(200).style("opacity",.9);var l=r.n(".3f");a.html("".concat(t.state," : ").concat(l(t.value))).style("left",r.l.pageX-40+"px").style("top",r.l.pageY-28+"px"),a.style("height","auto")})).on("mouseout",(function(){r.C("#tooltip").transition().duration(500).style("opacity",0)})),t.selectAll("g.state-bins").data((function(t){return t.bins})).join("g").classed("state-bins",!0).attr("transform",(function(t,e){return"translate(0, ".concat(3.5+e*(le.squareDim+2),")")})),t.each((function(t,e,n){var a=0,l=null;t.bins.map((function(t){r.E(t.state.flatMap((function(t){return t.value})))>a&&(a=r.E(t.state.flatMap((function(t){return t.value}))),l=t.color.state)}));var o=r.C(n[e]).selectAll("g.state-bins").filter((function(t,e,n){return t.color.state===l})).classed("win",!0);r.C(n[e]).selectAll("g.histo-bars").filter((function(t,e,n){return t.color.state===l})).classed("win",!0);o.select("rect.state-rect").attr("fill",(function(t){return t.color.color})).attr("opacity",(function(t){return r.E(t.state.flatMap((function(t){return t.value})))/t.state.length}))}))}(u),u.attr("transform",(function(t,n,a){var l=a.length<11?(t.range[1]-t.range[0])/5:0,o=r.z().domain([0,Ce[Ce.length-1]]).range([0,le.timeRange]);return"translate("+(44+e(n)+o(l))+", 0)"})),u.on("mouseover",(function(t,e,r){me(t,e,r,n)})).on("mouseout",(function(t,e,n){r.D(".branch-points.selected").classed("selected",!1),r.D(".selected-branch").classed("selected-branch",!1),r.C(n[e]).select(".y-axis").remove()}));var d=c.filter((function(t){return"continuous"===t.type}));d.on("mouseover",(function(t,e,r){me(t,e,r,n)})).on("mouseout",(function(t,e,n){r.D(".branch-points.selected").classed("selected",!1),r.D(".selected-branch").classed("selected-branch",!1),r.C(n[e]).select(".y-axis").remove()})),function(t){t.each((function(t,e,n){var a=r.C(n[e]).selectAll("g").data([t.bins]).join("g").classed("distribution",!0);a.attr("transform","translate(10, "+le.height+") rotate(-90)"),a.append("path").attr("d",ve).attr("fill",oe).attr("fill-opacity",.4).style("stroke",oe)}));t.append("rect").attr("height",le.height).attr("width",11).style("fill","#fff");t.append("rect").attr("width",10).attr("height",le.height).style("fill","none").style("stroke","gray").attr("opacity",.3);var e=t.selectAll("rect.range").data((function(t){return t.data.map((function(e){return e.range=t.range,e}))})).join("rect").classed("range",!0);e.attr("width",10),e.attr("height",(function(t,e){if(null!=t.scales.yScale){var n=t.scales.yScale;n.range([80,0]);var r=Ae(t.scales.min),a=Ae(t.scales.max);n.domain([r,a]);var l="realVal"===ft?+t.values.upperCI95:+t.values.logUpper;return n("realVal"===ft?+t.values.lowerCI95:+t.values.logLower)-n(l)}return 0})).attr("transform",(function(t,e){var n=t.scales.yScale;n.range([80,0]);var r=Ae(t.scales.min),a=Ae(t.scales.max);return n.domain([r,a]),"translate(0,"+n("realVal"===ft?+t.values.upperCI95:+t.values.logUpper)+")"})),e.attr("fill",oe).attr("opacity",.2);t.append("rect").attr("width",10).style("fill","none").style("stroke","gray").attr("height",(function(t,e,n){var a=r.z().domain([t.data[0].scales.min,t.data[0].scales.max]).range([le.height,0]);return a(t.data[0].normalRange[0])-a(t.data[0].normalRange[1])<le.height?a(t.data[0].normalRange[0])>le.height?le.height-a(t.data[0].normalRange[1]):a(t.data[0].normalRange[0])-a(t.data[0].normalRange[1]):le.height})).attr("transform",(function(t,e){var n=r.z().domain([t.data[0].scales.min,t.data[0].scales.max]).range([le.height,0]);return t.data[0].scales.max>=t.data[0].normalRange[1]?"translate(0, ".concat(n(t.data[0].normalRange[1]),")"):"translate(0, 0)"}));t.append("rect").attr("width",10).attr("height",(function(t,e){return null!=t.data[0]?3:0})).attr("transform",(function(t,e){if(null!=t.data[0]){var n=t.data[0].scales.yScale,a=Ae(t.data[0].scales.min),l=Ae(t.data[0].scales.max);return n.range([le.height,0]),n.domain([a,l]),"translate(0,"+n(r.u(t.data.map((function(t){return+t.values[ft]}))))+")"}return"translate(0,0)"})).attr("fill","#004573");var n=t.selectAll("g.outlier").data((function(t){return t.outliers.map((function(e){return e.domain=t.domain,e}))})).join("g").classed("outlier",!0);n.append("rect").attr("width",10).attr("height",2),n.attr("transform",(function(t,e){var n=r.z().domain([t.scales.min,t.scales.max]).range([le.height,0]);return"translate(0,".concat(n(t.values.realVal),")")})).attr("fill","red").attr("opacity",.7)}(d);var f=d.append("g").classed("brush-space",!0);f.append("rect").classed("brush-space-rect",!0),Rt(f,d);var p=t.append("g").classed("observed",!0);p.attr("transform",(function(t,e,n){return"translate("+(le.predictedWidth+150)+", 0)"}));var h=p.filter((function(t){return"continuous"===t.type}));h.attr("transform","translate(".concat(le.predictedWidth+160,", -15)"));var g=h.selectAll("g.ob-bars").data((function(t){return t.leafData.bins})).join("g").classed("ob-bars",!0);g.append("rect").attr("width",(function(t,e,n){return le.observedWidth/n.length})).attr("height",(function(t,e,n){return r.z().domain([0,r.t(r.D(n).data().map((function(t){return t.length})))]).range([0,le.height-le.margin])(Object.keys(t).length-2)})).attr("fill",oe).attr("fill-opacity",.5);g.attr("transform",(function(t,e,n){var a=le.observedWidth/n.length,l=r.z().domain([0,r.t(r.D(n).data().map((function(t){return t.length})))]).range([0,le.height-le.margin]);return"translate("+a*e+", "+(le.height-l(Object.keys(t).length-2))+")"})),h.each((function(t,e,n){var a=t.leafData.data.map((function(t){return+t.values[ft]})),l=r.z().domain([r.w(a),r.t(a)]).range([0,le.observedWidth]),o=r.z().domain([0,r.t(t.leafData.bins.map((function(t){return Object.keys(t).length})))-2]).range([le.height-le.margin,0]);r.C(n[e]).append("g").classed("x-axis",!0).call(r.b(l)).attr("transform","translate(0, "+le.height+")"),r.C(n[e]).append("g").classed("y-axis",!0).call(r.c(o).ticks(4)).attr("transform","translate(0, "+le.margin+")"),r.C(n[e]).select(".x-axis").selectAll("text").style("font-size","8px"),r.C(n[e]).select(".y-axis").selectAll("text").style("font-size","8px"),r.C(n[e]).append("g").classed("x-axis-label",!0).append("text").text("Frequency").attr("transform","translate(-20, ".concat(le.height-10,") rotate(-90)")).style("font-size","10px")}));var v=p.filter((function(t){return"discrete"===t.type}));v.attr("transform","translate(".concat(le.predictedWidth+160,", 5)"));var m=v.selectAll("g.ob-bars").data((function(t){return t.stateKeys.map((function(e,n){return{state:e,data:t.leafData.bins[n],max:r.E(t.leafData.bins.map((function(t){return t.length})))}}))})).join("g").classed("ob-bars",!0),y=m.append("rect").attr("width",(function(t,e,n){return le.observedWidth/n.length})).attr("height",(function(t,e,n){var a=t.data[0]?t.data[0].scales.stateColors.length*le.squareDim-10:0;return r.z().domain([0,t.max]).range([0,a])(t.data.length)})).attr("fill",(function(t,e){return null!=t.data[0]?t.data[0].color:"#fff"})).attr("opacity",.3);m.attr("transform",(function(t,e,n){var a=le.observedWidth/n.length,l=t.data[0]?t.data[0].scales.stateColors.length*le.squareDim-10:0;return"translate("+a*e+", "+(l-r.z().domain([0,t.max]).range([0,l-5])(t.data.length))+")"})),y.on("mouseover",(function(t,e,n){var a=r.C("g."+t[0].label).selectAll("g.state");a.filter((function(e){return e[0].state===t[0].winState})).attr("opacity",.8),a.filter((function(e){return e[0].state!=t[0].winState})).attr("opacity",.1),r.C(n[e]).attr("opacity",.9)})).on("mouseout",(function(t,e,n){r.C(n[e]).attr("opacity",.3);r.C("g."+t[0].label).selectAll("g.state").attr("opacity",.6)})),v.each((function(t,e,n){var a=r.B().domain(t.stateKeys).range([0,le.observedWidth]).padding(.6),l=t.stateKeys?t.stateKeys.length*le.squareDim-10:0,o=r.z().domain([0,t.leafData.data.length]).range([l,0]);r.C(n[e]).append("g").classed("y-axis",!0).call(r.c(o).ticks(4)),r.C(n[e]).append("g").classed("x-axis",!0).call(r.b(a)).attr("transform","translate(0, "+l+")"),r.C(n[e]).select(".x-axis").selectAll("text").style("font-size","8px"),r.C(n[e]).select(".y-axis").selectAll("text").style("font-size","8px")}))}function he(t){if(t[0]){var e=t[0].yScale;return r.p().value((function(t){return t.values[ft]})).domain(e.domain()).thresholds(e.ticks(20))(t)}return[]}var ge=r.a().curve(r.h).x((function(t,e,n){return r.z().domain([n.length-1,0]).range([0,le.height]).clamp(!0)(e)})).y0((function(t){return 0})).y1((function(t,e,n){var a=n.maxCount?n.maxCount:t.maxCount,l=t.length,o=n.count?n.count:8;return r.z().domain([0,a]).range([0,le.predictedWidth/o*.5]).clamp(!0)(l)})),ve=r.a().curve(r.h).x((function(t,e,n){return r.z().domain([0,n.length-1]).range([0,le.height]).clamp(!0)(e)})).y0((function(t){return 0})).y1((function(t,e,n){var a=t.maxCount?t.maxCount:r.E(n.map((function(t){return t.length}))),l=t.length,o=n.count?n.count:8;return r.z().domain([0,a]).range([0,le.predictedWidth/o*.5]).clamp(!0)(l)}));function me(t,e,n,a){var l=t.data.map((function(t){return t.node}));a.filter((function(t){return l.indexOf(t.node)>-1})).classed("selected",!0),r.C("#sidebar").selectAll(".node").filter((function(t){return l.indexOf(t.data.node)>-1})).classed("selected-branch",!0);if("continuous"===t.type){var o=r.z().domain(t.domain).range([0,le.height]);r.C(n[e]).append("g").classed("y-axis",!0).call(r.c(o).ticks(5))}}function ye(t){return function(t){if(Array.isArray(t))return be(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return be(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return be(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function be(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function xe(t,e,n,r,a,l,o){try{var i=t[l](o),s=i.value}catch(t){return void n(t)}i.done?e(s):Promise.resolve(s).then(r,a)}function we(t){return function(){var e=this,n=arguments;return new Promise((function(r,a){var l=t.apply(e,n);function o(t){xe(l,r,a,o,i,"next",t)}function i(t){xe(l,r,a,o,i,"throw",t)}o(void 0)}))}}var Ce=[];function ke(t,e){var n="realVal"===ft?r.z():r.A();return n.domain(t).range(e).clamp(!0),n}function Ae(t){return"realVal"===ft?t:t<0?-1*Math.log(Math.abs(t)):Math.log(t)}function Se(t){return t.flatMap((function(e,n){return t.filter((function(t,e){return e!=n})).map((function(t){return{p1:e,p2:t}})).map((function(t){var e=[t.p1[t.p1.length-1].node,t.p2[t.p2.length-1].node].sort();t.key=e.join(",");var n,a,l,o=function(t){var e=t.p2.map((function(t){return t.node})),n=t.p1.filter((function(t){return-1!=e.indexOf(t.node)})),a=n[n.length-1].node,l=t.p1.map((function(t){return t.node})).indexOf(a),o=t.p2.map((function(t){return t.node})).indexOf(a),i=t.p1.filter((function(t,e){return e>=l})),s=t.p2.filter((function(t,e){return e>=o}));t.common=t.p1[l];var c=t.common.combLength>Ce[Ce.length-1]/2;return{distance:r.E(i.map((function(t){return t.edgeLength})))+r.E(s.map((function(t){return t.edgeLength}))),shallowFlag:c}}(t);return t.distance=o.distance,t.lateDivergence=o.shallowFlag,t.deltas=function(t,e){var n=t.p2.map((function(t){return t.node})),a=t.p1.filter((function(t){return-1!=n.indexOf(t.node)})),l=a[a.length-1].node,o=t.p1.map((function(t){return t.node})).indexOf(l),i=t.p2.map((function(t){return t.node})).indexOf(l),s=t.p1.filter((function(t,e){return e>=o})),c=t.p2.filter((function(t,e){return e>=i})),u=Ce[Ce.length-1]-s[0].combLength,d=r.t([s.length,c.length]),f=u/d,p=ye(new Array(d-1)).map((function(t,e){return{bottom:s[0].combLength+e*f,top:s[0].combLength+(e+1)*f}}));p=(p=p.map((function(t,e){var n=s.filter((function(e){return e.combLength<=t.top&&e.combLength>=t.bottom})),r=c.filter((function(e){return e.combLength<=t.top&&e.combLength>=t.bottom}));return t.one=n,t.two=r,t}))).map((function(t,e){return 0===t.one.length&&(t=ze(t,s,p,"one",e)),0===t.two.length&&(t=ze(t,c,p,"two",e)),t}));var h=function(t,e,n){var r=t["slope_".concat(e)](t["y1_".concat(e)].attributes[n].values.realVal,t["y2_".concat(e)].attributes[n].values.realVal);return r*(t.top-t.bottom)+(t["y1_".concat(e)].attributes[n].values.realVal-r*t["y1_".concat(e)].combLength)};return r.k(s[0].attributes).filter((function(t){return"continuous"===t.value.type})).map((function(t){var e=t.key,n=p.map((function(t,n){var a=[],l=[];if(t.slope_one&&!t.slope_two){var o=!0===t.lateDivergence?t.y1_one.attributes[e].values.realVal:h(t,"one",e);a.push(o);var i=r.m(t.two.map((function(t){return t.attributes[e].values.realVal})));l.push(i[0]<0?i[0]:i[1])}else if(t.slope_two&&!t.slope_one){var s=!0===t.lateDivergence?t.y1_two.attributes[e].values.realVal:h(t,"two",e);l.push(s);var c=r.m(t.one.map((function(t){return t.attributes[e].values.realVal})));a.push(c[0]<0?c[0]:c[1])}else if(t.slope_one&&t.slope_two){var u=!0===t.lateDivergence?t.y1_one.attributes[e].values.realVal:h(t,"one",e);a.push(u);var d=!0===t.lateDivergence?t.y1_two.attributes[e].values.realVal:h(t,"two",e);l.push(d)}else{var f=r.m(t.one.map((function(t){return t.attributes[e].values.realVal})));a.push(f[0]<0?f[0]:f[1]);var p=r.m(t.two.map((function(t){return t.attributes[e].values.realVal})));l.push(p[0]<0?p[0]:p[1])}return Math.abs(a[0]-l[0])}));return t.value=r.t(n),t}))}(t),t.closeAll=(a=(n=t).p1.filter((function(t){return!0===t.leaf}))[0].attributes,l=n.p2.filter((function(t){return!0===t.leaf}))[0].attributes,r.k(a).filter((function(t){return"continuous"===t.value.type})).map((function(t){return t.value=Math.abs(t.value.values.realVal-l[t.key].values.realVal),t}))),t}))}))}function De(t){var e=Se(t);return ye(new Set(e.map((function(t){return t.key})))).map((function(t){var n=e.map((function(t){return t.key})).indexOf(t);return e[n]}))}function ze(t,e,n,r,a){var l=n.filter((function(t,e){return e<a&&t[r].length>0})),o=l[l.length-1][r][0].combLength,i=n.filter((function(t,e){return e>a&&t[r].length>0})),s=0===i.length?e[e.length-1].combLength:i[0][r][0].combLength;return t.lateDivergence=l[0][r][0].combLength>=.6*Ce[Ce.length-1],t["slope_".concat(r)]=function(t,e){return(e-t)/(s-o)},t["y1_".concat(r)]=l[l.length-1][r][0],t["y2_".concat(r)]=0===i.length?e[e.length-1]:i[0][r][0],t}function Oe(t,e,n){return e.map((function(e,a){var l=t.flatMap((function(t){return t[e]})),o=null!=n[a]?n[a][0]:n[0][0];if("continuous"==l[0].type){var i=r.t(l.flatMap((function(t){return t.values.upperCI95}))),s=r.w(l.flatMap((function(t){return t.values.lowerCI95}))),c=r.u(l.flatMap((function(t){return t.values.realVal}))),u=r.j(l.flatMap((function(t){return t.values.realVal})));return{field:e,type:"continuous",max:i,min:s,popDeviation:u,popNormalRange:[c-2*u,c+2*u],yScale:r.z().range([0,43]).domain([s,i]).clamp(!0),satScale:r.z().range([0,.9]).domain([s,i]),colorScale:r.z().range([o,"#f23929"]).domain([s,i]),catColor:o}}t.map((function(t){return t[e]}));var d=r.r(l[0].values);return{field:e,type:"discrete",stateColors:d.map((function(t,e){return{state:t,color:n[e][0]}})),catColor:o,scales:d.map((function(t){return{field:e,scaleName:t,max:1,min:0,yScale:r.z().range([45,0]).domain([0,1])}}))}}))}function je(t){var e=t.map((function(t){return r.E(t.map((function(t){return t.edgeLength})))}))[0];return Ce.push(e),t.map((function(t){return t.map((function(t,n,a){return t.maxTime=e,t.combLength=r.E(a.filter((function(t,e){return n>=e})).map((function(t){return t.edgeLength}))),t}))}))}function Ve(t,e,n){var a=null==n?Object.keys(t[0][0].attributes).filter((function(t){return"node"!=t&&"leaf"!=t&&"length"!=t&&"root"!=t&&"key"!=t})):n;t.map((function(t,n){return e.map((function(e){return function(t,e){for(var n=t.length,a=[],l=[],o=1;o<n;o++){var i=o-1,s=o;if(t[i]&&t[s]){var c=t[i].attributes[e].values[kt]-t[s].attributes[e].values[kt],u=c*c;a.push(u),l.push(t[i].attributes[e].values[kt])}}var d=[];if("discrete"===t[0].attributes[e].type){var f=r.k(t[0].attributes[e].values).filter((function(n){var a=r.t(r.k(t[0].attributes[e].values),(function(t){return+t.value}));return+n.value===a}));t.map((function(t){var n=r.k(t.attributes[e].values).filter((function(n){var a=r.t(r.k(t.attributes[e].values),(function(t){return+t.value}));return+n.value===a}));return void 0===n?f[f.length-1].key.includes(t.winState)||f.push({key:t.winState,value:1}):1===n.length&&n[0].key!=f[f.length-1].key&&f.push(n[0]),d.push(f),t}))}return t.map((function(t){if("continuous"===t.attributes[e].type)return t.attributes[e].volatility=r.j(a),t.attributes[e].extent=r.m(l),t.attributes[e].maxDiff=r.m(l)[1]-r.m(l)[0],t;t.attributes[e].characterShifts=d[0].length-1}))}(t,e.field)}))}));return t.map((function(t){return a.map((function(n){return t.map((function(a){var l=t[t.length-1].node;if("continuous"===a.attributes[n].type)return a.attributes[n].species=l,a.attributes[n].color=e.filter((function(t){return t.field===n}))[0].catColor,a.attributes[n].move=a.combineLength,a.attributes[n].combLength=a.combLength,a.attributes[n].node=a.node,a.attributes[n].edgeMove=a.edgeLength,a.attributes[n].edgeLength=a.edgeLength,a.attributes[n].label=n,a.attributes[n].yScale=a.attributes[n].scales.yScale,a.attributes[n].satScale=a.attributes[n].scales.satScale,a.attributes[n].colorScale=a.attributes[n].scales.colorScale,a.attributes[n].normalRange=a.attributes[n].scales.popNormalRange,a.leaf&&(a.attributes[n].leaf=a.leaf),a.attributes[n].leaf=a.leaf,a.attributes[n];if("discrete"===a.attributes[n].type){if(!0===a.leaf){r.k(a.attributes[n].values);a.attributes[n].leaf=a.leaf;var o=a.attributes[n];return o.states={field:n,state:a.attributes[n].values[n]},o.species=l,o.winState=a.attributes[n].values[n]?a.attributes[n].values[n]:r.k(a.attributes[n].values),o.color=a.attributes[n].scales.stateColors.filter((function(t){return t.state.includes(o.winState)}))[0].color,o.move=a.combLength,o.combLength=a.combLength,o.node=a.node,o.edgeMove=a.edgeLength,o.edgeLength=a.edgeLength,o.attrLabel=n,o}return(a.attributes[n].states?a.attributes[n].states:r.k(a.attributes[n].values)).map((function(t,e){return t.state=t.key,t.value=t.value,t.color=a.attributes[n].scales.stateColors.filter((function(e){return e.state===t.key}))[0],t.move=a.combLength,t.combLength=a.combLength,t.node=a.node,t.edgeMove=a.edgeLength,t.edgeLength=a.edgeLength,t.attrLabel=n,t.species=l,t}))}console.error("attribute type not found")}))}))}))}function Me(t,e){return t.length>e?t.slice(0,e)+"...":t}function Le(t,e){return Ee.apply(this,arguments)}function Ee(){return(Ee=we(regeneratorRuntime.mark((function t(e,n){var a,l,o,i,s,c,u,d,p,h,g,v,m,b,x;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=n,t.next=3,f(e,n);case 3:return l=t.sent,0,1,Array.prototype.unique=function(){return this.filter((function(t,e,n){return n.indexOf(t)===e}))},o=[],i=l.links[0],s=l.nodes[0],c=l.nodes[1],u=["_id","label","_key","_rev","key","length"],r.r(c[0]).filter((function(t){return-1===u.indexOf(t)})).forEach((function(t,e){Xe.indexOf(t)>-1?o.push({field:t,type:"discrete"}):o.push({field:t,type:"continuous"})})),d=s.map((function(t,e){var n={};return o.forEach((function(e){if(r.k(t).filter((function(t){return t.key.includes(e.field)})).length>0){n[e.field]={},n[e.field].field=e.field,n[e.field].type=e.type;var a={};r.k(t).filter((function(t){return t.key.includes(e.field)})).map((function(t){if("continuous"===e.type)if(t.key.includes("upperCI"))a.upperCI95=+t.value,a.logUpper=+t.value<0?-1*Math.log(Math.abs(+t.value)):Math.log(+t.value);else if(t.key.includes("lowerCI")){a.lowerCI95=+t.value;var n=+t.value<0?Math.log(Math.abs(+t.value)):Math.log(+t.value);a.logLower=n}else a.realVal=+t.value,a.logVal=+t.value<0?-1*Math.log(Math.abs(+t.value)):Math.log(+t.value);else a[t.key]=t.value})),n[e.field].values=a}})),n.node=t.label,n.key=t.id,n.length=+t.length,n.leaf=!1,n})),p=c.map((function(t,e){var n={};return o.forEach((function(e){n[e.field]={},n[e.field].field=e.field,n[e.field].type=e.type;var a={};r.k(t).filter((function(t){return t.key.includes(e.field)})).map((function(t){"continuous"===e.type?(a.realVal=+t.value,a.logVal=+t.value<0?-1*Math.log(Math.abs(+t.value)):Math.log(+t.value)):a[t.key]=t.value})),n[e.field].values=a})),n.node=t.label,n.label=t.label,n.length=+t.length,n.key=t.id,n.leaf=!0,n})),h=Oe(d,o.map((function(t){return t.field})).filter((function(t){return r.r(d[0]).indexOf(t)>-1})),qe),g=i.map((function(t,e){var n=t.target.includes("internal")?d.filter((function(e){return e.key===t.target}))[0]:p.filter((function(e){return e.key===t.target}))[0],r=t.source.includes("internal")?d.filter((function(e){return e.key===t.source}))[0]:p.filter((function(e){return e.key===t.source}))[0];return n&&Object.keys(n).filter((function(t){return"node"!=t&&"label"!=t&&"length"!=t&&"leaf"!=t&&"key"!=t})).map((function(t,e){var r=h.filter((function(e){return e.field===t}))[0];return n[t].scales=r,t})),{V1:r.node,V2:n.node,node:n.node,leaf:n.leaf,edgeLength:+n.length,attributes:n||null}})),v=y(g,g.filter((function(t){return!0===t.leaf})),"V1","V2").map((function(t,e){var n=t[0],r=d.filter((function(t){return t.node===n.node}))[0];r&&Object.keys(r).filter((function(t){return"node"!=t&&"label"!=t&&"length"!=t&&"leaf"!=t&&"key"!=t})).map((function(t,e){var n=h.filter((function(e){return e.field===t}))[0];return r[t].scales=n,t}));var a={V1:null,V2:r.node,node:r.node,leaf:r.leaf,root:!0,edgeLength:0,attributes:r||null};return t[0]=a,t})),m=je(v),b=se(m,a,h,8),x=ct("All ".concat(a),["Whole Set"],[{label:"All ".concat(a),paths:m,groupBins:b}]),nt.push(x),st("All ".concat(a),m),_e.push(h),Pe.push(m),Be.push(X(m,g)),Fe.push(m.flatMap((function(t){return t.filter((function(t){return!0===t.leaf}))})).map((function(t){return t.node}))),t.abrupt("return",[m,h]);case 28:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function Ie(t,e,n,r,a,l,o){try{var i=t[l](o),s=i.value}catch(t){return void n(t)}i.done?e(s):Promise.resolve(s).then(r,a)}function Re(t){return function(){var e=this,n=arguments;return new Promise((function(r,a){var l=t.apply(e,n);function o(t){Ie(l,r,a,o,i,"next",t)}function i(t){Ie(l,r,a,o,i,"throw",t)}o(void 0)}))}}n.d(e,"dataMaster",(function(){return Pe})),n.d(e,"savedSelected",(function(){return Ne})),n.d(e,"collapsed",(function(){return Te})),n.d(e,"nestedData",(function(){return Be})),n.d(e,"speciesTest",(function(){return Fe})),n.d(e,"calculatedScalesKeeper",(function(){return _e})),n.d(e,"colorKeeper",(function(){return qe})),n.d(e,"attributeList",(function(){return We})),n.d(e,"discreteTraitList",(function(){return Xe})),n.d(e,"workspace",(function(){return Ye})),n.d(e,"loadApp",(function(){return Qe}));var Pe=[],Ne=[],Te=!1,Be=[],Fe=[],_e=[],qe=[["#0dc1d1","#c8f7fd"],["#3AD701","#2a9b01"],["#fec303","#d3a001"],["#fe4ecb","#d30197"],["#f36b2c"],["#1abc9c"],["#493267"],["#a40b0b"],["#0095b6"],["#97A628"],["#9B28A6"],["#3928A6"],["#0dc1d1","#c8f7fd"],["#3AD701","#2a9b01"],["#fec303","#d3a001"],["#fe4ecb","#d30197"],["#f36b2c"],["#1abc9c"],["#493267"],["#a40b0b"],["#0095b6"],["#97A628"],["#9B28A6"],["#3928A6"]],We=[],Xe=["Clade","Group","island/mainland","ecomorph","island"],Ye="evo-bio",He=r.C("#wrapper"),Ke=He.select("#main");He.select("#selected").classed("hidden",!0);He.select("#sidebar");var Ue=He.select("#toolbar").select("#tool-buttons"),Ge=Ue.append("div").classed("toolbar-data-button",!0),$e=Ue.append("div").classed("toolbar-button-wrap",!0);He.select("#filter-tab").classed("hidden",!0);He.append("div").attr("id","tooltip").style("opacity",0);function Je(){return(Je=Re(regeneratorRuntime.mark((function t(){var e,n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,u(Ye);case 2:e=(e=(e=t.sent).results).map((function(t){return{field:t.name,text:"Data: ".concat(t.name)}})),n=e.filter((function(t){return"island-anolis"===t.field}))[0],ht(Ge,e,n),pt(),Qe(Ye,n.field);case 9:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function Qe(t,e){return Ze.apply(this,arguments)}function Ze(){return(Ze=Re(regeneratorRuntime.mark((function t(e,n){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:Le(e,n).then((function(t){yt($e,Ke,t[1]),r.C("#clade-show").selectAll("li").select("input").node().checked=!0,J(null,!0,!1),K(t[0]),Bt(t[1])}));case 1:case"end":return t.stop()}}),t)})))).apply(this,arguments)}!function(){Je.apply(this,arguments)}()},49:function(t,e,n){}});
//# sourceMappingURL=app.fa4e30bc.js.map