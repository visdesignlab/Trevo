!function(t){function e(e){for(var a,i,o=e[0],s=e[1],c=e[2],d=0,f=[];d<o.length;d++)i=o[d],Object.prototype.hasOwnProperty.call(r,i)&&r[i]&&f.push(r[i][0]),r[i]=0;for(a in s)Object.prototype.hasOwnProperty.call(s,a)&&(t[a]=s[a]);for(u&&u(e);f.length;)f.shift()();return l.push.apply(l,c||[]),n()}function n(){for(var t,e=0;e<l.length;e++){for(var n=l[e],a=!0,o=1;o<n.length;o++){var s=n[o];0!==r[s]&&(a=!1)}a&&(l.splice(e--,1),t=i(i.s=n[0]))}return t}var a={},r={0:0},l=[];function i(e){if(a[e])return a[e].exports;var n=a[e]={i:e,l:!1,exports:{}};return t[e].call(n.exports,n,n.exports,i),n.l=!0,n.exports}i.m=t,i.c=a,i.d=function(t,e,n){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)i.d(n,a,function(e){return t[e]}.bind(null,a));return n},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="/Evo-Bio-Design-Study/";var o=window.webpackJsonp=window.webpackJsonp||[],s=o.push.bind(o);o.push=e,o=o.slice();for(var c=0;c<o.length;c++)e(o[c]);var u=s;l.push([172,1]),n()}({172:function(t,e,n){"use strict";n.r(e);n(37),n(18),n(34),n(31),n(65),n(25),n(19),n(20),n(35),n(70),n(21),n(79),n(71),n(36),n(26),n(80),n(48);var a=n(0);function r(t,e,n,a,r,l,i){try{var o=t[l](i),s=o.value}catch(t){return void n(t)}o.done?e(s):Promise.resolve(s).then(a,r)}function l(t,e,n){return i.apply(this,arguments)}function i(){var t;return t=regeneratorRuntime.mark((function t(e,n,a){var r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e(n);case 2:return(r=t.sent).type=String(a),t.abrupt("return",r);case 5:case"end":return t.stop()}}),t)})),(i=function(){var e=this,n=arguments;return new Promise((function(a,l){var i=t.apply(e,n);function o(t){r(i,a,l,o,s,"next",t)}function s(t){r(i,a,l,o,s,"throw",t)}o(void 0)}))}).apply(this,arguments)}n(49),n(50),n(51),n(39),n(52),n(53),n(40);function o(t){return function(t){if(Array.isArray(t)){for(var e=0,n=new Array(t.length);e<t.length;e++)n[e]=t[e];return n}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var s=[];function c(t,e){return t.flatMap((function(e,n){return t.filter((function(t,e){return e!=n})).map((function(t){return{p1:e,p2:t}})).map((function(t){var e,n,r,l,i,c,u,d;return t.distance=(n=(e=t).p2.map((function(t){return t.node})),r=e.p1.filter((function(t){return-1!=n.indexOf(t.node)})),l=r[r.length-1].node,i=e.p1.map((function(t){return t.node})).indexOf(l),c=e.p2.map((function(t){return t.node})).indexOf(l),u=e.p1.filter((function(t,e){return e>=i})),d=e.p2.filter((function(t,e){return e>=c})),e.common=e.p1[i],a.D(u.map((function(t){return t.edgeLength})))+a.D(d.map((function(t){return t.edgeLength})))),t.deltas=function(t,e){var n=t.p2.map((function(t){return t.node})),r=t.p1.filter((function(t){return-1!=n.indexOf(t.node)})),l=r[r.length-1].node,i=t.p1.map((function(t){return t.node})).indexOf(l),c=t.p2.map((function(t){return t.node})).indexOf(l),u=t.p1.filter((function(t,e){return e>=i})),d=t.p2.filter((function(t,e){return e>=c})),f=s[0]-u[0].combLength,p=a.t([u.length,d.length]),h=f/p,g=o(new Array(p-1)).map((function(t,e){return{bottom:u[0].combLength+e*h,top:u[0].combLength+(e+1)*h}}));return g=(g=g.map((function(t,e){var n=u.filter((function(e){return e.combLength<=t.top&&e.combLength>=t.bottom})),a=d.filter((function(e){return e.combLength<=t.top&&e.combLength>=t.bottom}));return t.one=n,t.two=a,t}))).map((function(t,e){return 0===t.one.length&&(t.one=g[e-1].one),0===t.two.length&&(t.two=g[e-1].two),t})),a.k(u[0].attributes).filter((function(t){return"continuous"===t.value.type})).map((function(t){var e=t.key,n=g.map((function(t,n){return Math.abs(t.one[0].attributes[e].values.realVal-t.two[0].attributes[e].values.realVal)}));return t.value=a.t(n),t}))}(t),t.closeness=function(t,e){var n=t.p1.filter((function(t){return!0===t.leaf}))[0].attributes,r=t.p2.filter((function(t){return!0===t.leaf}))[0].attributes;return a.k(n).filter((function(t){return"continuous"===t.value.type})).map((function(t){return t.value=Math.abs(t.value.values.realVal-r[t.key].values.realVal),t}))}(t),t}))}))}function u(t,e,n){return e.map((function(e,r){var l=t.flatMap((function(t){return t[e]})),i=null!=n[r]?n[r][0]:n[0][0];if("continuous"==l[0].type){var o=a.t(l.flatMap((function(t){return t.values.upperCI95}))),s=a.w(l.flatMap((function(t){return t.values.lowerCI95})));a.u(l.flatMap((function(t){return t.values.realVal})));return{field:e,type:"continuous",max:o,min:s,yScale:a.y().range([0,43]).domain([s,o]).clamp(!0),satScale:a.y().range([0,.9]).domain([s,o]),colorScale:a.y().range([i,"#f23929"]).domain([s,o]),catColor:i}}var c=a.r(l[0].values);return{field:e,type:"discrete",stateColors:c.map((function(t,e){return{state:t,color:n[e][0]}})),catColor:i,scales:c.map((function(t){return{field:e,scaleName:t,max:1,min:0,yScale:a.y().range([45,0]).domain([0,1])}}))}}))}function f(t,e,n){var a=e.filter((function(e){return e.node===t[0][0].node}))[0];return Object.keys(a).filter((function(t){return"node"!=t})).map((function(t){a[t].scales=n.filter((function(e){return e.field===t}))[0]})),t.map((function(t,e){return t[0].attributes=a,t[0].root=!0,t}))}function p(t){var e=t.map((function(t){return a.D(t.map((function(t){return t.edgeLength})))}))[0];return s.push(e),t.map((function(t){return t.map((function(t,n,r){return t.maxTime=e,t.combLength=a.D(r.filter((function(t,e){return n>=e})).map((function(t){return t.edgeLength}))),t}))}))}function h(t,e,n){var r=null==n?Object.keys(t[0][0].attributes).filter((function(t){return"node"!=t})):n;return t.map((function(t){return r.map((function(n){return t.map((function(r){var l=t[t.length-1].node;if("continuous"===r.attributes[n].type)return r.attributes[n].species=l,r.attributes[n].color=e.filter((function(t){return t.field===n}))[0].catColor,r.attributes[n].move=r.combineLength,r.attributes[n].combLength=r.combLength,r.attributes[n].node=r.node,r.attributes[n].edgeMove=r.edgeLength,r.attributes[n].edgeLength=r.edgeLength,r.attributes[n].label=n,r.attributes[n].yScale=r.attributes[n].scales.yScale,r.attributes[n].satScale=r.attributes[n].scales.satScale,r.attributes[n].colorScale=r.attributes[n].scales.colorScale,r.leaf&&(r.attributes[n].leaf=r.leaf),r.attributes[n].leaf=r.leaf,r.attributes[n];if("discrete"===r.attributes[n].type){if(r.leaf){a.k(r.attributes[n].values);r.attributes[n].leaf=r.leaf;var i=r.attributes[n];return i.states={field:n,state:r.attributes[n].values[n]},i.species=l,i.winState=r.attributes[n].values[n]?r.attributes[n].values[n]:a.k(r.attributes[n].values),i.color=r.attributes[n].scales.stateColors.filter((function(t){return t.state.includes(i.winState)}))[0].color,i.move=r.combLength,i.combLength=r.combLength,i.node=r.node,i.edgeMove=r.edgeLength,i.edgeLength=r.edgeLength,i.attrLabel=n,i}return(r.attributes[n].states?r.attributes[n].states:a.k(r.attributes[n].values)).map((function(t,e){return t.state=t.key,t.value=t.value,t.color=r.attributes[n].scales.stateColors.filter((function(e){return e.state===t.key}))[0],t.move=r.combLength,t.combLength=r.combLength,t.node=r.node,t.edgeMove=r.edgeLength,t.edgeLength=r.edgeLength,t.attrLabel=n,t.species=l,t}))}console.error("attribute type not found")}))}))}))}n(126),n(127),n(128);function g(t){return function(t){if(Array.isArray(t)){for(var e=0,n=new Array(t.length);e<t.length;e++)n[e]=t[e];return n}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function m(t,e,n,a){return e.map((function(e){return function t(e,n,a,r,l){var i=e.filter((function(t){return t[l]===n[r]}));return i.length>0?(a.push(i[0]),t(e,i[0],a,r,l)):(a.push({root:!0,node:n[r],edgeLength:0}),a.reverse())}(t,e,[e],n,a)}))}function v(t,e,n,a,r){return e.forEach((function(e,l){var i;e.depth=r,e.id=r+"."+l,null!=(i=e.children)&&0!=i.length?(t.push(Object.assign({},e)),v(g(t),g(e.children),n,a,r+1)):(a.push(e.data.node),e.flag=!0,n.push([].concat(g(t),[Object.assign({},e)])))})),n}n(32),n(54),n(129),n(81),n(160),n(161),n(99),n(166);function y(t,e,n,a){var r=t.append("div").classed("dropdown ".concat(a),!0);r.style("display","inline-block");var l=r.append("button").classed("btn dropbtn btn-secondary dropdown-toggle",!0).text(n),i=r.append("div").attr("id",a).classed("dropdown-content",!0);i.append("a").text("text").attr("font-size",11);var o=i.selectAll("a").data(e).join("a").text((function(t){return t.field}));return o.on("click",(function(t,e,n){return i.classed("show",!1)})),l.on("click",(function(t,e,n){i.classed("show")?i.classed("show",!1):i.classed("show",!0)})),o.raise(),o}function b(t,e,n,a,r,l,i){try{var o=t[l](i),s=o.value}catch(t){return void n(t)}o.done?e(s):Promise.resolve(s).then(a,r)}function x(t){return function(){var e=this,n=arguments;return new Promise((function(a,r){var l=t.apply(e,n);function i(t){b(l,a,r,i,o,"next",t)}function o(t){b(l,a,r,i,o,"throw",t)}i(void 0)}))}}var w=[],B=[];function k(t,e,n){return w.push({field:t,names:e,groups:n}),{field:t,names:e,groups:n}}function A(t,e,n){var r=t.filter((function(t){return t.field===n}))[0].scales.map((function(t){return t.scaleName})),l=a.v(e.map((function(t){return t.length})))-a.w(e.map((function(t){return t.length})));return r.map((function(a){var r=e.filter((function(t){return a.includes(t[t.length-1].attributes[n].values[n])})),i=N(r,a,t,l);return{label:a,paths:r,groupBins:i}}))}function C(t){return V.apply(this,arguments)}function V(){return(V=x(regeneratorRuntime.mark((function t(e){var n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:D(e,null,{margin:{top:10,right:90,bottom:50,left:20},width:620,height:700,lengthHeight:800}),n=e.select(".tree-svg").selectAll(".node--leaf"),n.append("text").text((function(t){return t.data.node})).attr("font-size",9).attr("x",4).attr("y",2),e.select(".tree-svg").classed("clade-view",!0).append("g").classed("overlay-brush",!0);case 5:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function S(t,e){var n=[],r=[];a.C(".clade-name").each((function(e,l,i){n.push(i[l].value);var o=a.B(".rect-".concat(l+1)).node().getBoundingClientRect(),s=t.select(".tree-svg.clade-view").selectAll(".node--leaf").filter((function(t,e,n){var a=n[e].getBoundingClientRect();return a.y>=o.y-4&&a.y<=o.y+o.height-4}));s.select("circle").attr("fill","red"),r.push({clade:i[l].value,nodes:s.data().map((function(t){return t.data}))})}));var l,i,o=k(a.B(".group-name").node().value,n,r);l=w,i="change-clade",a.B("#".concat(i)).selectAll("a").data(l).join("a").text((function(t){return t.field}));var s=function(t,e,n){var r=a.v(e.map((function(t){return t.length})))-a.w(e.map((function(t){return t.length})));return n.groups.map((function(n){var a=e.filter((function(t){return n.nodes.indexOf(t[t.length-1])>-1})),l=N(a,n,t,r);return{label:n.clade,paths:a,groupBins:l}}))}(e,yt(),o);a.B(".dropdown.change-clade").select("button").text("Clades Shown: ".concat(o.field)),pt("Summary View",s),Ot(a.B("#sidebar"),null,!0,!1)}function j(t,e){var n=t.append("div").classed("clade-toolbar",!0);n.append("input").classed("group-name",!0).attr("type","text").attr("value","Name Your Group");n.append("button").text("Add Clade Group").on("click",(function(){return S(t,e)}));var r=n.append("div").classed("input-group input-number-group",!0),l=r.append("button").text("-"),i=r.append("input").attr("value",3).attr("min",0).attr("max",10).attr("type","number").classed("input-number",!0),o=r.append("button").text("+"),s=r.append("div").classed("name-input-wrap",!0);function c(t,e){e.selectAll("*").remove(),a.C(".overlay-brush").selectAll("rect").remove();for(var n=function(n){e.append("input").classed("clade-name",!0).attr("value","Group ".concat(n+1)).attr("type","text");var r=a.B(".overlay-brush").append("g").classed("group-".concat(n),!0),l=r.append("rect").classed("rect-".concat(n+1),!0).attr("height",100).attr("width",910).attr("opacity",.3).attr("transform",(function(e,a,r){return"translate(".concat(0,",",800/t*n,")")}));r.append("rect").attr("class","handle-".concat(n)).attr("width",700).attr("height",20).attr("y",l.node().getBoundingClientRect().y+20).attr("opacity",0).call(a.j().on("drag",(function(){var t=a.x(this),e=a.l.y;a.B(this).attr("y",t[1]);var r=+a.B(".rect-".concat(n+1)).attr("height"),l=a.B(".rect-".concat(n+1)).node().getBoundingClientRect().bottom;a.B(".rect-".concat(n+1)).attr("height",r+(e-l)+70)})));l.call(a.j().on("drag",(function(){var t=a.x(this),e=a.l.y;a.B(this).attr("y",t[1]);var r=a.B(".rect-".concat(n+1)).node().getBoundingClientRect().height;a.B(".handle-".concat(n)).attr("y",e+(r-20))})))},r=0;r<t;r+=1)n(r)}l.on("click",(function(){var t=i.attr("value");i.attr("value",+t-1),c(+i.attr("value"),s)})),o.on("click",(function(){var t=i.attr("value");i.attr("value",+t+1),c(+i.attr("value"),s)})),c(+i.attr("value"),s)}function O(){return(O=x(regeneratorRuntime.mark((function t(e,n){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:C(e),j(e,n);case 2:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function D(t,e,n){var r=a.G().size([n.height,n.width]);jt(0,Tt[0]);var l=a.o(Tt[0]);l=r(l);var i=t.select("svg"),o=i.empty()?t.append("svg"):i;o.classed("tree-svg",!0),o.attr("width",n.width+n.margin.left+n.margin.right).attr("height",n.height+n.margin.top+n.margin.bottom);var c=o.select("g.tree-g"),u=c.empty()?o.append("g").classed("tree-g",!0):c;u.attr("transform","translate("+n.margin.left+","+n.margin.top+")"),function t(e,n,r,l,i,o){St(e,0);var c=yt();!function(t,e){(function t(n){null!=n.children?n.children.forEach((function(e){t(e)})):e.push(n)})(t)}(e,[]);var u=a.y().domain([0,s[0]]).range([0,n.width]).clamp(!0);var d=a.y().range([n.height,0]).domain([0,1]);o&&(l.attr("transform","translate(30, 370)"),r.attr("height",1e3),d.range([580,0]).domain([0,c.length-10]),u.range([0,800]));var f=l.selectAll(".link").data(e.descendants().slice(1)).join("path").attr("class","link");f.transition().duration(500).attr("d",(function(t){return"M"+u(t.data.combEdge)+","+d(t.position)+"C"+(u(t.data.combEdge)+u(t.parent.data.combEdge))/2+","+d(t.position)+" "+u(t.parent.data.combEdge)+","+d(t.position)+" "+u(t.parent.data.combEdge)+","+d(t.parent.position)}));var p=l.selectAll(".node").data(e.descendants(),(function(t){return t.data.node})).join("g").attr("class",(function(t){return"node"+(t.children?" node--internal":" node--leaf")}));p.selectAll("circle").data((function(t){return[t]})).join("circle").attr("r",3);p.transition().duration(500).attr("transform",(function(t){return"translate("+u(t.data.combEdge)+","+d(t.position)+")"}));if(null!=i){var h=p.filter((function(t){return!0===t.data.leaf})),g=p.filter((function(t){return 1!=t.data.leaf}));if("discrete"===i.type)i.stateColors.forEach((function(t){h.filter((function(e){return t.state.includes(e.data.attributes[i.field].states.state)})).select("circle").attr("fill",t.color),g.selectAll("circle").attr("fill","gray")}));else{var m=i.yScale;m.range(["#fff","#E74C3C"]),h.select("circle").attr("fill",(function(t,e){return m(t.data.attributes[i.field].values.realVal)}))}}else p.selectAll("circle").attr("fill","gray");p.on("mouseover",(function(t,e,n){var r=a.B("#main-path-view").selectAll(".paths");if(a.B("#main-summary-view").selectAll(".branch-points").filter((function(e){return e.node===t.data.node})).classed("selected",!0),r.filter((function(e){return e.map((function(t){return t.node})).indexOf(t.data.node)>-1})).classed("hover",!0).selectAll("g").filter((function(e){return e.node===t.data.node})).classed("selected",!0),a.B(n[e]).classed("selected-branch",!0),t.data.label){var l=a.B("#tooltip");l.transition().duration(200).style("opacity",.9),l.html("".concat(t.data.label.charAt(0).toUpperCase()+t.data.label.slice(1))).style("left",a.l.pageX-40+"px").style("top",a.l.pageY-28+"px"),l.style("height","auto")}})).on("mouseout",(function(t,e,n){a.C(".paths.hover").classed("hover",!1),a.C("g.selected").classed("selected",!1),a.B(n[e]).classed("selected-branch",!1),a.B("#tooltip").transition().duration(500).style("opacity",0)}));p.filter((function(t){return 0==t.data.children.length}));p.selectAll("text").remove();p.selectAll(".triangle").remove();var v=p.filter((function(t){return!0===t.branchPoint}));v.each((function(t,e,n){if(null===t.children){var r=a.B(n[e]).append("path").classed("triangle",!0).attr("d",a.E().type(a.F).size("400"));r.attr("transform","rotate(-90) translate(0, 65) scale(.9 4)"),r.attr("fill","gray").style("opacity",.3),a.B(n[e]).selectAll("text").data((function(t){return[t]})).join("text").text(t.clade).attr("transform","translate(55, 5)")}}));v.select("circle").attr("fill","red").attr("r",4.5);v.on("click",(function(o,s,c){null==o.children?uncollapseSub(o):collapseSub(o);var u="Hide Lengths"===a.B("button#length").text();t(e,n,r,l,i,u)}));p.raise();p.selectAll("circle").raise();return p}(l,n,o,u,e,!0)}function M(t){return function(t){if(Array.isArray(t)){for(var e=0,n=new Array(t.length);e<t.length;e++)n[e]=t[e];return n}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var L={height:80,observedWidth:200,predictedWidth:900,margin:20,squareDim:15,timeRange:895},I=[["#64B5F6","#F39C12"],["#6A1B9A","#FDD835"]],E=["#546E7A","#5D4037"],z="#baaaaa",T=0,R=[[]];function q(t,e,n,r){console.log(t,e,n,r);var l=n.filter((function(t){return t.field===r}))[0].scales.map((function(t){return t.scaleName})),i=a.v(t.map((function(t){return t.length})))-a.w(t.map((function(t){return t.length})));W(e,l.map((function(e){var a=t.filter((function(t){return e.includes(t[t.length-1].attributes[r].values[r])})),l=N(a,e,n,i);return{label:e,paths:a,groupBins:l}})))}function N(t,e,n,r){var l=gt.filter((function(t){return"hide-attribute"===t.type})).map((function(t){return t.attribute})),i=n.map((function(t){return t.field})).filter((function(t){return-1===l.indexOf(t)})),o=M(t),c=l.length>0?n.filter((function(t){return-1===l.indexOf(t.field)})).map((function(t){return t.field})):null;h(o,n,c);a.t(o.map((function(t){return t.length})));var u=s[0],d=new Array(r).fill().map((function(t,e){var n=u/r;return{base:e*n,top:(e+1)*n,binI:e,step:n}})),f=o.map((function(t){return t.filter((function(t){return 1!=t.leaf&&1!=t.root}))})),p=o.flatMap((function(t){return t.filter((function(t){return!0===t.leaf}))})),g=o.flatMap((function(t){return t.filter((function(t){return!0===t.root}))}));d.map((function(t,e){var n=f.flatMap((function(e){return e.filter((function(e){return e.combLength>t.base&&e.combLength<=t.top}))}));return t.data=n,t}));var m=i.map((function(t){var l=n.filter((function(e){return e.field===t}))[0],i=d.map((function(e){return e.data.length>0?e.fData=e.data.map((function(e){return e.attributes[t]})):e.fData=[],{data:e.fData,range:[e.base,e.top],index:e.binI,key:t}})),o=p.map((function(e){return e.attributes[t]})),c={data:o};if("continuous"===l.type){var u=a.y().domain([l.min,l.max]).range([0,L.height]),f=a.p().value((function(t){return t.values.realVal})).domain(u.domain()).thresholds(u.ticks(20));i.map((function(n,i,o){return n.type=l.type,n.bins=f(n.data),n.domain=[l.max,l.min],n.bins.count=r,n.bins.groupLabel=e,0===a.u(n.bins.map((function(t){return t.length})))&&(0===i?(n.bins=f(g.map((function(e){return e.attributes[t]}))),n.data=g.map((function(e){return e.attributes[t]})),n.bins.count=r):(n.bins=o[i-1].bins,n.data=o[i-1].data)),n}));var h=a.t(o.flatMap((function(t){return+t.values.realVal}))),m=a.w(o.flatMap((function(t){return+t.values.realVal}))),v=a.y().domain([m,h]).range([0,L.height]),y=a.p().value((function(t){return+t.values.realVal})).domain(v.domain()).thresholds(v.ticks(20));return c.bins=y(o),{key:t,branches:M(i),type:l.type,leafData:c,rootData:g.map((function(e){return e.attributes[t]}))[0]}}var b=o[0].scales.scales,x=b[0].state?b.map((function(t){return t.state})):b.map((function(t){return t.scaleName})),w=g[0].attributes[t];w.bins=a.k(g[0].attributes[t].values).map((function(t){return{state:[{state:t.key,value:t.value}],branchCount:r,color:l.stateColors.filter((function(e){return e.state===t.key}))[0],max:80}})),i.bins=null,c.bins=b.map((function(t){return o.filter((function(e){return t.scaleName.includes(e.states.state)}))}));a.y().domain([0,s[0]]).range([0,L.height]);var B=a.y().domain([0,1]).range([0,40]),k=a.p().value((function(t){return t.value})).domain(B.domain()).thresholds(B.ticks(10));return i.map((function(t,e,n){var i=l.stateColors;return t.bins=x.map((function(e){var n=t.data.flatMap((function(t){return Object.entries(t.values).filter((function(t){return t[0]===e}))})).map((function(t){return{state:t[0],value:t[1]}}));return{state:n,branchCount:r,histogram:k(n),color:i.filter((function(t){return t.state===e}))[0],max:80}})),0===t.bins[0].state.length&&(t.bins=0===e?a.k(w.values).map((function(t){var e=k([+t.value]).map((function(e){return t.value<=e.x1&&t.value>=e.x0&&e.push(+t.value),e}));return{state:[{state:t.key,value:t.value}],branchCount:r,histogram:e,color:i.filter((function(e){return e.state===t.key}))[0],max:80}})):n[e-1].bins),t.type=l.type,t})),{key:t,branches:M(i),type:l.type,leafData:c,rootData:g.map((function(e){return e.attributes[t]}))[0],stateKeys:x,maxCount:a.t(i.map((function(t){return t.data.length})))}}));return m.group=e,m.branchCount=r,m.keys=i,m}function F(t,e){var n=e.append("g").classed("branch-bar",!0);n.append("rect").classed("point-dis-rect",!0).attr("height",25).attr("x",-10).attr("y",-10).attr("fill","none");var r=n.append("g").attr("transform","translate(102, -10)");n.append("line").attr("y1",2).attr("y2",2).attr("x1","100").attr("x2",L.predictedWidth).attr("stroke","gray").attr("stroke-width",.25),n.append("text").text("Root").attr("transform","translate(70, 7)"),n.append("g").classed("leaf-label",!0).attr("transform","translate(".concat(L.predictedWidth+200,", 7)")).append("text").text("Leaves");var l=[],i=[];t.paths.map((function(t){t.filter((function(t){return 1!=t.leaf})).map((function(t){-1==i.indexOf(t.node)&&(i.push(t.node),l.push({node:t.node,eMove:t.combLength}))}))}));var o=a.y().domain([0,s[0]]).range([0,L.timeRange]),c=n.selectAll("g.branch-points").data(l).join("g").attr("class",(function(t,e){return t.node})).classed("branch-points",!0);c.attr("transform",(function(t,e){return"translate(".concat(105+o(t.eMove),", 0)")})),c.append("circle").attr("r",5).attr("fill","#fff").attr("opacity",.5);var u=a.y().domain([0,s[0]]).range([0,L.timeRange]),d=r.selectAll("rect.bin").data(t.groupBins[0].branches.map((function(t){return t.range}))).join("rect").classed("bin",!0);d.attr("width",(function(t,e,n){return u(t[1])-u(t[0])})).attr("height",20),d.attr("transform",(function(t,e,n){var a=u(t[1])-u(t[0]);return"translate(".concat(a*e,",0)")})),d.attr("fill","gray").attr("stroke-width",2).attr("stroke","white");var f=a.b(u),p=n.append("g").call(f);return p.attr("transform","translate(103, 10)"),p.select("path").attr("stroke-width",0),n}function W(t,e){var n=a.B("#attribute-show").selectAll("input").filter((function(t,e,n){return!0===n[e].checked})).data();t.append("div").attr("id","summary-view").selectAll(".group-div").data(e).join("div").classed("group-div",!0).each((function(e,r,l){console.log("d",e);var i=e.groupBins.filter((function(t){return n.indexOf(t.key)>-1})),o=a.B(l[r]);o.style("text-align","center"),o.append("text").text(e.label),o.append("text").text(" : ".concat(e.paths.length," Paths"));var c=o.append("svg");c.attr("class","main-summary-view"),c.attr("id","".concat(e.label,"-svg")),c.attr("height",n.length*(L.height+5)+50);var u=F(e,c);u.attr("transform","translate(55, 10)"),o.classed(e.label,!0);var d=a.y().domain([0,e.groupBins.branchCount]).range([0,L.timeRange]),f=u.selectAll("g.branch-points"),p=c.append("g").classed("summary-wrapper",!0);p.attr("transform","translate(70, 50)");var h=p.selectAll(".attr-wrap").data(i).join("g").attr("class",(function(t){return t.key+" attr-wrap"}));h.attr("transform",(function(t,e,n){if(0===e)return"translate(0,0)";var r=a.C(n).filter((function(t,n){return n<e})).data(),l=a.D(r.flatMap((function(t){return"continuous"===t.type?L.height+5:t.stateKeys.length*(L.squareDim+4)})));return t.sum=l,"translate(0, ".concat(l,")")}));var g=h.append("text").text((function(t){return t.key}));g.filter((function(t){return"continuous"===t.type})).attr("y",40).attr("x",80).style("text-anchor","end").style("font-size",11),g.filter((function(t){return"discrete"===t.type})).attr("y",(function(t,e){return 3})).attr("x",(function(t){return-t.stateKeys.length*L.squareDim/2})).style("text-anchor","middle").style("font-size",11).attr("transform","rotate(-90)"),function(t,e,n){var r=a.B("#attribute-show").selectAll("input").filter((function(t,e,n){return!0===n[e].checked})).data(),l=e.append("g").classed("clade-label",!0).attr("transform","translate(10, 0)");return l.append("rect").attr("width",50).attr("height",t.keys.length*(L.height+15)).attr("fill","gray").style("opacity",.2).on("mouseover",(function(t,e){var r=a.B("#sidebar").selectAll(".node"),l=a.B("#sidebar").selectAll(".link");r.filter((function(t){if(t.data.leaf){var e=a.k(t.data.attributes).filter((function(t){return n.includes(t.key)}))[0].value;return n.includes(e.states.state)}var r=a.k(t.data.attributes).filter((function(t){return n.includes(t.key)}))[0],l=a.k(r.value.values).filter((function(t,e,n){var r=a.t(n.map((function(t){return t.value})));return t.value===r}))[0];return n==l.key})).classed("hover clade",!0),l.filter((function(t){if(t.data.leaf){var e=a.k(t.data.attributes).filter((function(t){return n.includes(t.key)}))[0].value;return n.includes(e.states.state)}var r=a.k(t.data.attributes).filter((function(t){return n.includes(t.key)}))[0],l=a.k(r.value.values).filter((function(t,e,n){var r=a.t(n.map((function(t){return t.value})));return t.value===r}))[0];return n==l.key})).classed("hover clade",!0);t.paths.map((function(t){return t[t.length-1].label}))})).on("mouseout",(function(t,e){var n=a.B("#sidebar").selectAll(".node"),r=a.B("#sidebar").selectAll(".link");n.classed("hover clade",!1),r.classed("hover clade",!1)})),l.append("text").text((function(t){return t.label})).style("text-anchor","middle").attr("transform","translate(23, ".concat(r.length*(L.height+15)/2,"), rotate(-90)")),l}(e.groupBins,c,e.label).on("click",(function(e,n,r){a.B(r[n]).select("rect").attr("fill","#F5B041"),R[R.length-1].push(Object.assign({},e)),R[R.length-1].length>1&&(t.selectAll("*").remove(),t.select("#compare-wrap").remove(),function(t,e,n,r){var l=a.B("#attribute-show").selectAll("input").filter((function(t,e,n){return!0===n[e].checked})).data(),i=t.append("div").attr("id","compare-wrap"),o=i.append("div").classed("compare-header",!0).style("margin","auto"),c=o.append("div").attr("height",50).attr("width",200).style("margin-left","460px"),u=o.append("svg"),d=F({paths:e[0].paths.concat(e[1].paths),groupBins:e[0].groupBins},u);d.attr("transform","translate(-30, 10)"),d.selectAll("rect.bin").attr("stroke","#DCD4D4").attr("stroke-width","3px");var f=d.selectAll("g.branch-points");if(o.append("div").style("position","absolute").style("left","5px").style("top","65px").append("i").classed("close fas fa-times",true).style("padding-left","10px").on("click",(function(t,e,n){i.remove(),R.push(new Array),pt("Summary View",B[B.length-1].groups),a.B("#sidebar").selectAll(".node").remove(),a.B("#sidebar").selectAll(".link").remove(),Ot(a.B("#sidebar"),null,!0)})),e.length>1){Ot(a.B("#sidebar"),null,!0),a.B("#toolbar").selectAll(".brush-span").remove();var p=Array.from(new Set(e.flatMap((function(t){return t.paths})).flatMap((function(t){return t.map((function(t){return t.node}))})))),h=a.B("#sidebar").selectAll(".node").filter((function(t){return-1===p.indexOf(t.data.node)})),g=a.B("#sidebar").selectAll(".link").filter((function(t){return-1===p.indexOf(t.data.node)}));h.attr("opacity",.3),g.attr("opacity",.3);var m=Array.from(new Set(e[0].paths.flatMap((function(t){return t.map((function(t){return t.node}))})))),v=Array.from(new Set(e[1].paths.flatMap((function(t){return t.map((function(t){return t.node}))})))),y=a.B("#sidebar").selectAll(".node").filter((function(t){return m.indexOf(t.data.node)>-1})),b=a.B("#sidebar").selectAll(".link").filter((function(t){return m.indexOf(t.data.node)>-1}));y.attr("opacity",.8).selectAll("circle").attr("fill",E[0]),b.attr("opacity",.8).style("stroke",E[0]);var x=a.B("#sidebar").selectAll(".node").filter((function(t){return v.indexOf(t.data.node)>-1})),w=a.B("#sidebar").selectAll(".link").filter((function(t){return v.indexOf(t.data.node)>-1}));x.attr("opacity",.8).selectAll("circle").attr("fill",E[1]),w.attr("opacity",.8).style("stroke",E[1]),c.append("i").classed("fas fa-arrow-left",!0).style("margin-right","10px"),e.forEach((function(t,e){c.append("span").text(t.label).classed("badge badge-secondary",!0).style("padding","5px").style("margin-bottom","7px").style("background",E[e])})),c.append("i").classed("fas fa-arrow-right",!0).style("margin-left","10px")}var k=i.append("svg").attr("class","compare-svg");if(e.length>1){console.log("data",e);var A=e[0].groupBins.filter((function(t){return l.indexOf(t.key)>-1})),C=e[1].groupBins.filter((function(t){return l.indexOf(t.key)>-1})),V=A.map((function(t,n,a){return t.branches=M(t.branches).map((function(t,a){return t.bins=[{key:e[0].label,value:t.bins,index:0},{key:e[1].label,value:C[n].branches[a].bins,index:1}],t.data=[{key:e[0].label,value:t.data.map((function(t){return t.groupKey=e[0].label,t.index=0,t})),index:0},{key:e[1].label,value:C[n].branches[a].data.map((function(t){return t.groupKey=e[1].label,t.index=1,t})),index:1}],t})),"continuous"===t.type?(t.leafData.data=[{key:e[0].label,value:t.leafData.data.map((function(t){return t.groupKey=e[0].label,t.index=0,t})),index:0},{key:e[1].label,value:C[n].leafData.data.map((function(t){return t.groupKey=e[1].label,t.index=1,t})),index:1}],t.leafData.bins=[{key:e[0].label,value:t.leafData.bins,index:0},{key:e[1].label,value:C[n].leafData.bins,index:1}]):(t.leafData.data=[{key:e[0].label,value:t.leafData.data.map((function(t){return t.groupKey=e[0].label,t.index=0,t})),index:0},{key:e[1].label,value:C[n].leafData.data.map((function(t){return t.groupKey=e[1].label,t.index=1,t})),index:1}],t.leafData.bins=[{key:e[0].label,keys:t.stateKeys,value:t.leafData.bins,index:0},{key:e[1].label,keys:t.stateKeys,value:C[n].leafData.bins,index:1}]),t})),S=k.append("g").attr("class","group-wrap").attr("transform","translate(30, 10)").selectAll(".attr-wrap").data(V).join("g").classed("attr-wrap",!0);k.attr("height",V.length*(L.height+5)),S.attr("transform",(function(t,e,n){if(0===e)return"translate(0,0)";var r=a.C(n).filter((function(t,n){return n<e})).data(),l=a.D(r.flatMap((function(t){return"continuous"===t.type?L.height+5:t.stateKeys.length*(L.squareDim+4)})));return t.sum=l,"translate(0, ".concat(l,")")}));var j=S.append("text").text((function(t){return t.key}));j.filter((function(t){return"continuous"===t.type})).attr("y",40).attr("x",80).style("text-anchor","end").style("font-size",11),j.filter((function(t){return"discrete"===t.type})).attr("y",(function(t,e){return 3})).attr("x",(function(t){return-t.stateKeys.length*L.squareDim/2})).style("text-anchor","middle").style("font-size",11).attr("transform","rotate(-90)");var O=S.append("g").classed("predicted",!0);O.attr("transform","translate(25, 0)"),O.filter((function(t){return"discrete"===t.type})).append("g").classed("win-line",!0);var D=O.selectAll("g.root").data((function(t){return[t.rootData]})).join("g").classed("root",!0);D.attr("transform","translate(60,0)");var q=D.filter((function(t){return"continuous"===t.type}));q.append("rect").attr("height",L.height).attr("width",12).attr("fill","#fff").style("stroke-width","0.5px").style("stroke","black");q.append("rect").attr("width",12).attr("height",(function(t){var e=t.scales.yScale;return e.range([L.height-5,0]),e(t.values.lowerCI95)-e(+t.values.upperCI95)})).attr("transform",(function(t,e){var n=t.scales.yScale;return n.range([L.height-5,0]),"translate(0,"+n(+t.values.upperCI95)+")"})).style("opacity",.5).attr("fill",z);q.append("rect").attr("width",12).attr("height",3).attr("transform",(function(t,e){var n=t.scales.yScale;return n.range([L.height,0]),"translate(0,"+n(+t.values.realVal)+")"})).attr("fill","#004573");var N=D.filter((function(t){return"discrete"===t.type})),W=N.selectAll("g.root-state-groups").data((function(t){return t.bins})).join("g").classed("root-state-groups",!0);W.append("text").text((function(t,e){return t.color.state})).attr("y",10).attr("x",-3).style("font-size",10).style("text-anchor","end"),W.attr("transform",(function(t,e){return"translate(0, ".concat(3.5+e*(L.squareDim+2),")")})),W.append("rect").attr("height",L.squareDim).attr("width",L.squareDim).attr("fill","#fff").attr("opacity",1),W.append("rect").classed("color-rect",!0).attr("height",L.squareDim).attr("width",L.squareDim).attr("fill",(function(t,e){return"rgba(89, 91, 101, ".concat(t.state[0].value,")")})).attr("stroke-width",.5).attr("stroke","rgba(200, 203, 219, .9)"),N.selectAll("g.root-state-groups").filter((function(t,e,n){var r=a.t(a.C(n).data().map((function(t){return t.state[0].value})));return t.color.state===a.C(n).data().filter((function(t){return t.state[0].value===r}))[0].color.state})).classed("win",!0).select("rect.color-rect").attr("fill",(function(t,e){return t.color.color})).attr("opacity",(function(t){return a.D(t.state.flatMap((function(t){return t.value})))/t.state.length}));var P=O.selectAll("g.branch-bin").data((function(t){return t.branches})).join("g").classed("branch-bin",!0);P.attr("transform",(function(t,e,r){var l=r.length<11?(t.range[1]-t.range[0])/5:0,i=a.y().domain([0,s[0]]).range([0,L.timeRange]);return"translate("+(100+n(e)+i(l))+", 0)"}));var _=P.filter((function(t){return"discrete"===t.type})).append("g");_.attr("transform","translate(5, 0)");var G=_.selectAll("g.middle-group").data((function(t){return t.bins.map((function(e){return e.key=t.key,e}))})).join("g").classed("middle-group",!0).attr("transform",(function(t,e){var n=0===t.index?-L.squareDim/2:0;return"translate(".concat(n,", 0)")})),U=G.selectAll("rect.state-rect").data((function(t){return t.value.map((function(e){return e.key=t.key,e}))})).join("rect").classed("state-rect",!0).attr("height",L.squareDim).attr("width",L.squareDim/2);U.attr("fill",(function(t,e,n){var r=a.D(t.state.map((function(t){return t.value})))/t.state.length,l=a.y().domain([0,1]).range([0,1]);return"rgba(89, 91, 101, ".concat(l(r),")")})).attr("stroke-width",.5).attr("stroke","rgba(200, 203, 219, .9)"),U.attr("transform",(function(t,e){return"translate(0, ".concat(3.5+e*(L.squareDim+2),")")}));var J=_.selectAll("g.group").data((function(t){return t.bins})).join("g").classed("group",!0).attr("transform",(function(t,e){var n=0===t.index?-40-L.squareDim/2:L.squareDim/2;return"translate(".concat(n,", 0)")})).selectAll("g.histo-bars").data((function(t){return t.value.map((function(e){return e.index=t.index,e}))})).join("g").classed("histo-bars",!0);J.attr("transform",(function(t,e){a.i(t.state.map((function(t){return t.value})));var n=a.u(t.state.map((function(t){return t.value}))),r=a.y().domain([0,1]).range([0,40]).clamp(!0),l=0===t.index?40-r(n):0;return"translate(".concat(l,", ").concat(3.5+e*(L.squareDim+2),")")}));J.append("rect").attr("height",L.squareDim).attr("width",(function(t,e,n){a.i(t.state.map((function(t){return t.value})));var r=a.u(t.state.map((function(t){return t.value})));return a.y().domain([0,1]).range([0,40]).clamp(!0)(r)})).attr("fill",(function(t){return t.color.color})).attr("opacity",.3);U.on("mouseover",(function(t,e,n){var r=a.D(t.state.map((function(t){return t.value})))/t.state.length,l=a.B("#tooltip");l.transition().duration(200).style("opacity",.9);var i=a.n(".3f");l.html("".concat(t.key," </br> ").concat(t.state[0].state," : ").concat(i(r))).style("left",a.l.pageX-40+"px").style("top",a.l.pageY-28+"px"),l.style("height","auto")})).on("mouseout",(function(){a.B("#tooltip").transition().duration(500).style("opacity",0)})),G.each((function(t,e,n){var r=0,l=null;t.value.map((function(t){a.D(t.state.flatMap((function(t){return t.value})))>r&&(r=a.D(t.state.flatMap((function(t){return t.value}))),l=t.color.state)}));a.B(n[e]).selectAll("rect.state-rect").filter((function(t,e,n){return t.color.state===l})).classed("win",!0).attr("fill",(function(t){return t.color.color})).attr("opacity",(function(t){return a.D(t.state.flatMap((function(t){return t.value})))/t.state.length}))}));var Q=P.filter((function(t){return"continuous"===t.type}));Q.on("mouseover",(function(t,e,n){var r=t.data,l=r[0].value.concat(r[1].value).map((function(t){return t.node})),i=(f.filter((function(t){return l.indexOf(t.node)>-1})).classed("selected",!0),a.B("#sidebar").selectAll(".node").filter((function(t){return l.indexOf(t.data.node)>-1})).classed("selected-branch",!0),a.y().domain(t.domain).range([0,L.height]));a.B(n[e]).append("g").classed("y-axis",!0).call(a.c(i).ticks(5))})).on("mouseout",(function(t,e,n){a.C(".branch-points.selected").classed("selected",!1),a.C(".selected-branch").classed("selected-branch",!1),a.B(n[e]).select(".y-axis").remove()}));var Z=Q.selectAll("g.group").data((function(t){return t.bins})).join("g").attr("class",(function(t){return"g-".concat(t.index," group")}));Z.each((function(t,e,n){t.maxCount=a.D(t.value.map((function(t){return t.length}))),t.value.maxCount=a.D(t.value.map((function(t){return t.length})));var r=a.B(n[e]).selectAll("g").data([t.value.map((function(e){return e.maxCount=a.D(t.value.map((function(t){return t.length}))),e.index=t.index,e}))]).join("g").classed("distribution",!0);r.attr("transform",(function(t,e,n){return 0===t[0].index?"translate(0, 0) rotate(90)":"translate(11, "+L.height+") rotate(-90)"})),r.append("path").attr("d",0===t.index?Y:X).attr("fill",(function(t,e,n){return z})).attr("opacity",.4).style("stroke",E[t.index])}));Z.append("rect").attr("height",L.height).attr("width",10).style("fill","#fff").style("stroke","gray"),Q.selectAll("g.range-wrap").data((function(t){return t.data})).join("g").classed("range-wrap",!0).selectAll("rect.range").data((function(t,e){return t.value.map((function(n){return n.range=t.range,n.gindex=e,n}))})).join("rect").classed("range",!0);Q.selectAll("rect.av-rect").data((function(t){return t.data})).join("rect").classed("av-rect",!0).attr("width",10).attr("height",(function(t,e){return null!=t.value?3:0})).attr("transform",(function(t,e){if(null!=t.value){var n=t.value[0].scales.yScale;return n.range([L.height,0]),"translate(0,"+n(a.u(t.value.map((function(t){return+t.values.realVal}))))+")"}return"translate(0,0)"})).attr("fill",(function(t){return E[t.index]}));var $=a.e().extent([[0,0],[20,L.height]]);$.on("end",(function(){var t=this,e=a.B(this.parentNode).data()[0],n=e.bins.map((function(t){return t.maxCount})),r=a.l.selection,l=a.n(".3n"),i=a.B("#toolbar").selectAll(".brush-span").size(),o=0===i?"one":"two";if(null!=r){a.B("#sidebar").selectAll(".node").filter((function(t){return!0===t.data.leaf}));var s=a.y().domain([e.domain[0],e.domain[1]]).range([0,L.height]),c=(e.key,[s.invert(r[1]),s.invert(r[0])]),u=a.B("#sidebar").selectAll(".node"),d=e.data.map((function(t){return t.value.filter((function(t){return t.values.realVal>=c[0]&&t.values.realVal<=c[1]}))})),f=Q.filter((function(t){return t.index===e.index&&t.key!=e.key})),p=Q.filter((function(t){return t.index>e.index&&t.key===e.key}));d.forEach((function(e,r){if(e.length>0){var l=a.B(t.parentNode).select(".g-".concat(r)).append("g").classed("distribution-too",!0),i=H(e);i.maxCount=n[r];var o=e.map((function(t){return t.node}));l.data([i]),l.append("path").attr("d",0===r?Y:X).style("stroke",E[r]).style("fill",E[r]).style("fill-opacity",.8),l.attr("transform",0===r?"translate(0, 0) rotate(90)":"translate(11, ".concat(L.height,") rotate(-90)"));f.select(".g-".concat(r)).each((function(t,e,n){var l=H(t.data.filter((function(t){return t.index===r}))[0].value.filter((function(t){return o.indexOf(t.node)>-1})));l.maxCount=t.bins[r].maxCount;var i=a.B(n[e]).append("g").classed("distribution-too",!0);i.data([l]).append("path").attr("d",0===r?Y:X).style("stroke",E[r]).style("fill",E[r]).style("fill-opacity",.8),i.attr("transform",0===r?"translate(0, 0) rotate(90)":"translate(11, ".concat(L.height,") rotate(-90)"))})),p.select(".g-".concat(r)).each((function(t,e,n){var l=H(t.data.filter((function(t){return t.index===r}))[0].value.filter((function(t){return t.values.realVal>c[0]&&t.values.realVal<c[1]})));l.maxCount=t.bins[r].maxCount;var i=a.B(n[e]).append("g").classed("distribution-too",!0);i.data([l]).append("path").attr("d",0===r?Y:X).style("stroke",E[r]).style("fill",E[r]).style("fill-opacity",.8),i.attr("transform",0===r?"translate(0, 0) rotate(90)":"translate(11, ".concat(L.height,") rotate(-90)"))}))}}));var h=K(e.data.flatMap((function(t){return t.value.filter((function(t){return t.values.realVal>=c[0]&&t.values.realVal<=c[1]}))})),e.data.flatMap((function(t){return t.value.filter((function(t){return t.values.realVal<c[0]||t.values.realVal>c[1]}))})),e,c,o),g=h[0],m=h[1];h[2],h[3];if(i<2){var v=a.B("#toolbar").selectAll(".brush-span").filter((function(t,n,r){return a.B(r[n]).attr("value")=="".concat(e.bins.groupLabel,"-").concat(e.key)}));if(0===v.size()){a.B(this).select(".selection").style("fill","".concat(I[i][0])).attr("stroke","".concat(I[i][0])).attr("stroke-width",2),a.B(this).select(".overlay").attr("stroke",I[i][1]).attr("stroke-width",2),a.B("#toolbar").append("span").attr("class",o).attr("id",o).classed("brush-span",!0).classed("".concat(e.bins.groupLabel),!0).classed("badge badge-secondary",!0).style("background",I[i][0]).attr("value","".concat(e.bins.groupLabel,"-").concat(e.key)).datum({brush:this,nodes:d}).text("".concat(e.bins.groupLabel,", ").concat(e.key,": ").concat(l(c[0])," - ").concat(l(c[1]))).append("i").classed("close fas fa-times",!0).style("padding-left","10px").on("click",(function(t,e,n){var r=0===i?"one":"two";a.B(t.brush).call($.move,null),a.B(n[e].parentNode).remove(),a.B(t.brush).select(".overlay").attr("stroke-width",0),p.selectAll(".distribution-too").remove(),f.selectAll(".distribution-too").remove(),a.B(t.brush.parentNode).selectAll(".distribution-too").remove(),a.B("#sidebar").selectAll(".".concat(r)).classed("anti-brushed-second",!1),a.B("#sidebar").selectAll(".".concat(r)).classed("anti-brushed",!1)}))}else{v.text("".concat(e.bins.groupLabel,", ").concat(e.key,": ").concat(l(c[0])," - ").concat(l(c[1]))),v.append("i").classed("close fas fa-times",!0).style("padding-left","10px").on("click",(function(t,e,n){a.B(t).call($.move,null),a.B(t).select(".overlay").attr("stroke-width",0),a.B(n[e].parentNode).remove()})),a.B(v.datum()).call($.move,null),a.B(v.datum()).select(".overlay").attr("stroke-width",0),u.selectAll(".".concat(e.key)).selectAll("".concat(e.bins.groupLabel)).selectAll(".second-branch").classed("second-branch",!1).classed("one",!1).classed("two",!1).classed("".concat(e.key),!1),u.selectAll(".".concat(e.key)).selectAll(".selected-branch").classed("selected-branch",!1).classed("one",!1).classed("two",!1).classed("".concat(e.key),!1),u.selectAll(".".concat(e.key)).selectAll(".anti-brushed-second").classed("anti-brushed-second",!1).classed("one",!1).classed("two",!1).classed("".concat(e.key),!1),u.selectAll(".".concat(e.key)).selectAll(".anti-brushed-branch").classed("anti-brushed-branch",!1).classed("one",!1).classed("two",!1).classed("".concat(e.key),!1);var y=v.attr("id");i="one"===y?0:1,a.B(this).select(".selection").style("fill","".concat(I[i][0])).attr("stroke","".concat(I[i][0])).attr("stroke-width",2),a.B(this).select(".overlay").attr("stroke",I[i][1]).attr("stroke-width",2);var b=e.data.flatMap((function(t){return t.value.filter((function(t){return t.values.realVal>=c[0]&&t.values.realVal<=c[1]}))})),x=e.data.flatMap((function(t){return t.value.filter((function(t){return t.values.realVal<c[0]||t.values.realVal>c[1]}))}));v.datum({brush:this,nodes:b}),K(b,x,e,c,y)}}else{a.B("#toolbar").selectAll(".brush-span").filter((function(t,e){return 0===e})).remove();var w=0===T?"one":"two";a.B("#toolbar").append("span").attr("class").classed("brush-span",!0).classed("badge badge-secondary",!0).style("background",I[T][0]).attr("value","".concat(e.bins.groupLabel,"-").concat(e.key)).text("".concat(e.bins.groupLabel,", ").concat(e.key,": ").concat(l(c[0])," - ").concat(l(c[1]))),T=0===T?1:0,m.classed(w,!0),g.classed(w,!0)}}else a.C(".".concat(e.key,".brushed-branch")).classed("brushed-branch",!1),a.C(".".concat(e.key,".brushed-second")).classed("brushed-second",!1)})),Q.append("g").classed("continuous-branch-brush",!0).attr("class","brush").call($);var tt=S.append("g").classed("observed",!0);tt.attr("transform",(function(t,e,n){return"translate("+(L.predictedWidth+150)+", 0)"}));var et=tt.filter((function(t){return"continuous"===t.type}));et.attr("transform","translate(".concat(L.predictedWidth+160,", -15)"));var nt=et.selectAll("g.cont-groups").data((function(t){return t.leafData.bins})).join("g").classed("cont-groups",!0).selectAll("g.ob-bars").data((function(t){return t.value.map((function(e){return e.index=t.index,e}))})).join("g").classed("ob-bars",!0);nt.append("rect").attr("width",(function(t,e,n){return L.observedWidth/n.length})).attr("height",(function(t,e){return a.y().domain([0,Object.keys(t).length]).range([L.height-L.margin,0])(Object.keys(t).length-2)})).attr("fill",(function(t){return E[t.index]})).attr("fill-opacity",.4);nt.attr("transform",(function(t,e,n){var r=L.observedWidth/n.length,l=a.y().domain([0,Object.keys(t).length]).range([L.height-L.margin,0]);return"translate("+r*e+", "+(L.height-l(Object.keys(t).length-2))+")"})),et.each((function(t,e,n){var r=t.leafData.data[0].value.map((function(t){return+t.values.realVal})),l=a.y().domain([a.w(r),a.t(r)]).range([0,L.observedWidth]),i=a.y().domain([0,a.t(t.leafData.bins[0].value.map((function(t){return Object.keys(t).length})))-2]).range([L.height-L.margin,0]);a.B(n[e]).append("g").classed("x-axis",!0).call(a.b(l)).attr("transform","translate(0, "+L.height+")"),a.B(n[e]).append("g").classed("y-axis",!0).call(a.c(i).ticks(4)).attr("transform","translate(0, "+L.margin+")"),a.B(n[e]).select(".x-axis").selectAll("text").style("font-size","8px"),a.B(n[e]).select(".y-axis").selectAll("text").style("font-size","8px"),a.B(n[e]).append("g").classed("x-axis-label",!0).append("text").text("Frequency").attr("transform","translate(-20, ".concat(L.height-10,") rotate(-90)")).style("font-size","10px")}));var at=tt.filter((function(t){return"discrete"===t.type}));at.attr("transform","translate(".concat(L.predictedWidth+160,", 5)"));var rt=at.selectAll("g.dis-groups").data((function(t){return t.leafData.bins})).join("g").classed("dis-groups",!0).selectAll("g.ob-bars").data((function(t){return t.keys.map((function(e,n){return{state:e,data:t.value[n],max:a.D(t.value[n].map((function(t){return t.length}))),index:t.index}}))})).join("g").classed("ob-bars",!0),lt=rt.append("rect").attr("width",(function(t,e,n){return L.observedWidth/n.length/2})).attr("height",(function(t,e,n){var r=t.data[0]?t.data[0].scales.stateColors.length*L.squareDim-10:0;return a.y().domain([0,t.max]).range([0,r])(t.data.length)})).attr("fill",(function(t,e){return null!=t.data[0]?t.data[0].color:"#fff"})).attr("opacity",.3);rt.attr("transform",(function(t,e,n){var r=L.observedWidth/n.length,l=r/2,i=t.data[0]?t.data[0].scales.stateColors.length*L.squareDim-10:0,o=i-2-a.y().domain([0,t.max]).range([0,i-5])(t.data.length);return 0===t.index?"translate("+r*e+", "+o+")":"translate("+(l+r*e)+", "+o+")"})),lt.on("mouseover",(function(t,e,n){var r=a.B("g."+t[0].label).selectAll("g.state");r.filter((function(e){return e[0].state===t[0].winState})).attr("opacity",.8),r.filter((function(e){return e[0].state!=t[0].winState})).attr("opacity",.1),a.B(n[e]).attr("opacity",.9)})).on("mouseout",(function(t,e,n){a.B(n[e]).attr("opacity",.3);a.B("g."+t[0].label).selectAll("g.state").attr("opacity",.6)})),at.each((function(t,e,n){var r=a.A().domain(t.stateKeys).range([0,L.observedWidth]).padding(.6),l=t.stateKeys?t.stateKeys.length*L.squareDim-10:0,i=a.y().domain([0,t.leafData.data.length]).range([l,0]);a.B(n[e]).append("g").classed("y-axis",!0).call(a.c(i).ticks(4)),a.B(n[e]).append("g").classed("x-axis",!0).call(a.b(r)).attr("transform","translate(0, "+l+")"),a.B(n[e]).select(".x-axis").selectAll("text").style("font-size","8px"),a.B(n[e]).select(".y-axis").selectAll("text").style("font-size","8px")}))}}(t,R[R.length-1],d))})),P(h,d,f)}))}function P(t,e,n){var r=t.append("g").classed("predicted",!0);r.attr("transform","translate(25, 0)"),r.filter((function(t){return"discrete"===t.type})).append("g").classed("win-line",!0);var l=r.selectAll("g.root").data((function(t){return[t.rootData]})).join("g").classed("root",!0);l.attr("transform","translate(60,0)");var i=l.filter((function(t){return"continuous"===t.type}));i.append("rect").attr("height",L.height).attr("width",12).attr("fill","#fff").style("stroke-width","0.5px").style("stroke","black");i.append("rect").attr("width",12).attr("height",(function(t){var e=t.scales.yScale;return e.range([L.height-5,0]),e(t.values.lowerCI95)-e(+t.values.upperCI95)})).attr("transform",(function(t,e){var n=t.scales.yScale;return n.range([L.height-5,0]),"translate(0,"+n(+t.values.upperCI95)+")"})).style("opacity",.5).attr("fill",z);i.append("rect").attr("width",12).attr("height",3).attr("transform",(function(t,e){var n=t.scales.yScale;return n.range([L.height,0]),"translate(0,"+n(+t.values.realVal)+")"})).attr("fill","#004573");var o=l.filter((function(t){return"discrete"===t.type})),c=o.selectAll("g.root-state-groups").data((function(t){return t.bins})).join("g").classed("root-state-groups",!0);c.append("text").text((function(t,e){return t.color.state})).attr("y",10).attr("x",-3).style("font-size",10).style("text-anchor","end"),c.attr("transform",(function(t,e){return"translate(0, ".concat(3.5+e*(L.squareDim+2),")")})),c.append("rect").attr("height",L.squareDim).attr("width",L.squareDim).attr("fill","#fff").attr("opacity",1),c.append("rect").classed("color-rect",!0).attr("height",L.squareDim).attr("width",L.squareDim).attr("fill",(function(t,e){return"rgba(89, 91, 101, ".concat(t.state[0].value,")")})).attr("stroke-width",.5).attr("stroke","rgba(200, 203, 219, .9)"),o.selectAll("g.root-state-groups").filter((function(t,e,n){var r=a.t(a.C(n).data().map((function(t){return t.state[0].value})));return t.color.state===a.C(n).data().filter((function(t){return t.state[0].value===r}))[0].color.state})).classed("win",!0).select("rect.color-rect").attr("fill",(function(t,e){return t.color.color})).attr("opacity",(function(t){return a.D(t.state.flatMap((function(t){return t.value})))/t.state.length}));var u=r.selectAll("g.branch-bin").data((function(t){return t.branches})).join("g").classed("branch-bin",!0);u.attr("transform",(function(t,n,r){var l=r.length<11?(t.range[1]-t.range[0])/5:0,i=a.y().domain([0,s[0]]).range([0,L.timeRange]);return"translate("+(100+e(n)+i(l))+", 0)"}));var d=u.filter((function(t){return"discrete"===t.type})),f=d.selectAll("g.histo-bars").data((function(t){return t.bins.map((function(e){return e.index=t.index,e}))})).join("g").classed("histo-bars",!0);f.attr("transform",(function(t,e,n){return"translate(".concat(L.squareDim,", ").concat(3.5+e*(L.squareDim+2),")")}));f.append("rect").attr("height",L.squareDim).attr("width",(function(t,e,n){a.i(t.state.map((function(t){return t.value})));var r=a.u(t.state.map((function(t){return t.value})));return a.y().domain([0,1]).range([0,40])(r)})).attr("fill",(function(t){return t.color.color})).attr("opacity",.3);var p=d.selectAll("g.state-bins").data((function(t){return t.bins})).join("g").classed("state-bins",!0);p.attr("transform",(function(t,e){return"translate(0, ".concat(3.5+e*(L.squareDim+2),")")})),p.append("rect").attr("height",L.squareDim).attr("width",L.squareDim).attr("fill","#fff").attr("opacity",1);var h=p.append("rect").classed("state-rect",!0).attr("height",L.squareDim).attr("width",L.squareDim);h.attr("fill",(function(t,e,n){var r=a.D(t.state.map((function(t){return t.value})))/t.state.length,l=a.y().domain([0,1]).range([0,1]);return"rgba(89, 91, 101, ".concat(l(r),")")})).attr("stroke-width",.5).attr("stroke","rgba(200, 203, 219, .9)"),h.on("mouseover",(function(t,e,n){var r=a.D(t.state.map((function(t){return t.value})))/t.state.length,l=a.B("#tooltip");l.transition().duration(200).style("opacity",.9);var i=a.n(".3f");l.html("".concat(t.state[0].state," : ").concat(i(r))).style("left",a.l.pageX-40+"px").style("top",a.l.pageY-28+"px"),l.style("height","auto")})).on("mouseout",(function(){a.B("#tooltip").transition().duration(500).style("opacity",0)})),d.each((function(t,e,n){var r=0,l=null;t.bins.map((function(t){a.D(t.state.flatMap((function(t){return t.value})))>r&&(r=a.D(t.state.flatMap((function(t){return t.value}))),l=t.color.state)})),a.B(n[e]).selectAll("g.state-bins").filter((function(t,e,n){return t.color.state===l})).classed("win",!0).select("rect.state-rect").attr("fill",(function(t){return t.color.color})).attr("opacity",(function(t){return a.D(t.state.flatMap((function(t){return t.value})))/t.state.length}))}));var g=r.filter((function(t){return"discrete"===t.type})),m=[];g.each((function(t,e,n){var r=[];a.B(n[e]).selectAll(".win").each((function(t,e,n){r.push([n[e].getBoundingClientRect().x,n[e].getBoundingClientRect().y+10]),r.push([n[e].getBoundingClientRect().x+15,n[e].getBoundingClientRect().y+10])})),m.push([].concat(r));a.s();r[r.length-1][1]=r[r.length-1][1]+2,r[r.length-2][1]=r[r.length-2][1]+2,t.win=r})),g.each((function(t,e,n){var r=a.s();a.B(n[e]).select(".win-line").append("path").attr("d",(function(t){return r(t.win)})).attr("transform","translate(-75, -"+n[e].getBoundingClientRect().y+")").attr("fill","none").attr("stroke","rgba(200, 203, 219, .9)").attr("stoke-width",1)}));var v=u.filter((function(t){return"continuous"===t.type}));v.on("mouseover",(function(t,e,r){var l=t.data.map((function(t){return t.node})),i=(n.filter((function(t){return l.indexOf(t.node)>-1})).classed("selected",!0),a.B("#sidebar").selectAll(".node").filter((function(t){return l.indexOf(t.data.node)>-1})).classed("selected-branch",!0),a.y().domain(t.domain).range([0,L.height]));a.B(r[e]).append("g").classed("y-axis",!0).call(a.c(i).ticks(5))})).on("mouseout",(function(t,e,n){a.C(".branch-points.selected").classed("selected",!1),a.C(".selected-branch").classed("selected-branch",!1),a.B(n[e]).select(".y-axis").remove()})),v.each((function(t,e,n){var r=a.B(n[e]).selectAll("g").data([t.bins]).join("g").classed("distribution",!0);r.attr("transform","translate(11, "+L.height+") rotate(-90)"),r.append("path").attr("d",X).attr("fill",z).attr("fill-opacity",.4).style("stroke",z)}));v.append("rect").attr("height",L.height).attr("width",10).style("fill","none").style("stroke","gray");var y=v.selectAll("rect.range").data((function(t){return t.data.map((function(e){return e.range=t.range,e}))})).join("rect").classed("range",!0);y.attr("width",10),y.attr("height",(function(t,e){if(null!=t.scales.yScale){var n=t.scales.yScale;return n.range([80,0]),n(t.values.lowerCI95)-n(t.values.upperCI95)}return 0})).attr("transform",(function(t,e){var n=t.scales.yScale;return n.range([80,0]),"translate(0,"+n(t.values.upperCI95)+")"})),y.attr("fill",z).attr("opacity",.5),v.append("rect").attr("width",10).attr("height",(function(t,e){return null!=t.data[0]?3:0})).attr("transform",(function(t,e){if(null!=t.data[0]){var n=t.data[0].scales.yScale;return n.range([L.height,0]),"translate(0,"+n(a.u(t.data.map((function(t){return+t.values.realVal}))))+")"}return"translate(0,0)"})).attr("fill","#004573");var b=a.e().extent([[0,0],[20,L.height]]);b.on("end",(function(){var t=a.B(this.parentNode).data()[0],e=a.l.selection,n=a.n(".3n"),r=a.B("#toolbar").selectAll(".brush-span").size(),l=0===r?"one":"two";if(null!=e){a.B("#sidebar").selectAll(".node").filter((function(t){return!0===t.data.leaf})).empty()&&Ot(a.B("#sidebar"),null,!0);var i=a.y().domain([t.domain[0],t.domain[1]]).range([0,L.height]),o=(t.key,[i.invert(e[1]),i.invert(e[0])]),s=a.B("#sidebar").selectAll(".node"),c=t.data.filter((function(t){return t.values.realVal>o[0]&&t.values.realVal<o[1]})),u=H(c);u.maxCount=a.D(t.bins.map((function(t){return t.length})));var d=a.B(this.parentNode).selectAll("g.distribution-too").data([u]).join("g").classed("distribution-too",!0);d.attr("transform","translate(0, 0) rotate(90)"),d.append("path").attr("d",Y).attr("fill",I[r][0]).attr("fill-opacity",.5).style("stroke",I[r][0]);var f=c.map((function(t){return t.node})),p=v.filter((function(e){return e.index===t.index&&e.key!=t.key}));p.each((function(t,e,n){var l=H(t.data.filter((function(t){return f.indexOf(t.node)>-1})));l.maxCount=a.D(t.bins.map((function(t){return t.length})));var i=a.B(n[e]).selectAll("g.distribution-too").data([l]).join("g").classed("distribution-too",!0);i.attr("transform","translate(0, 0) rotate(90)"),i.append("path").attr("d",Y).attr("fill",I[r][0]).attr("fill-opacity",.5).style("stroke",I[r][0])}));var h=v.filter((function(e){return e.index>t.index&&e.key===t.key}));h.each((function(t,e,n){var l=H(t.data.filter((function(t){return t.values.realVal>o[0]&&t.values.realVal<o[1]})));l.maxCount=a.D(t.bins.map((function(t){return t.length})));var i=a.B(n[e]).selectAll("g.distribution-too").data([l]).join("g").classed("distribution-too",!0);i.attr("transform","translate(0, 0) rotate(90)"),i.append("path").attr("d",Y).attr("fill",I[r][0]).attr("fill-opacity",.5).style("stroke",I[r][0])}));var g=t.data.filter((function(t){return t.values.realVal<o[0]||t.values.realVal>o[1]})),m=K(c,g,t,o,l),y=m[0],x=m[1];m[2],m[3];if(r<2){var w=a.B("#toolbar").selectAll(".brush-span").filter((function(e,n,r){return a.B(r[n]).attr("value")=="".concat(t.bins.groupLabel,"-").concat(t.key)}));if(0===w.size()){a.B(this).select(".selection").style("fill","".concat(I[r][0])).attr("stroke","".concat(I[r][0])).attr("stroke-width",2),a.B(this).select(".overlay").attr("stroke",I[r][1]).attr("stroke-width",2),a.B("#toolbar").append("span").attr("class",l).attr("id",l).classed("brush-span",!0).classed("".concat(t.bins.groupLabel),!0).classed("badge badge-secondary",!0).style("background",I[r][0]).attr("value","".concat(t.bins.groupLabel,"-").concat(t.key)).datum({brush:this,nodes:c}).text("".concat(t.bins.groupLabel,", ").concat(t.key,": ").concat(n(o[0])," - ").concat(n(o[1]))).append("i").classed("close fas fa-times",!0).style("padding-left","10px").on("click",(function(t,e,n){var l=0===r?"one":"two";a.B(t.brush).call(b.move,null),a.B(n[e].parentNode).remove(),a.B(t.brush).select(".overlay").attr("stroke-width",0),h.selectAll(".distribution-too").remove(),p.selectAll(".distribution-too").remove(),a.B(t.brush.parentNode).select(".distribution-too").remove(),a.B("#sidebar").selectAll(".".concat(l)).classed("anti-brushed-second",!1),a.B("#sidebar").selectAll(".".concat(l)).classed("anti-brushed",!1)}))}else{w.text("".concat(t.bins.groupLabel,", ").concat(t.key,": ").concat(n(o[0])," - ").concat(n(o[1]))),w.append("i").classed("close fas fa-times",!0).style("padding-left","10px").on("click",(function(t,e,n){a.B(t).call(b.move,null),a.B(t).select(".overlay").attr("stroke-width",0),a.B(n[e].parentNode).remove()})),a.B(w.datum().brush).call(b.move,null),a.B(w.datum().brush).select(".overlay").attr("stroke-width",0),s.selectAll(".".concat(t.key)).selectAll("".concat(t.bins.groupLabel)).selectAll(".second-branch").classed("second-branch",!1).classed("one",!1).classed("two",!1).classed("".concat(t.key),!1),s.selectAll(".".concat(t.key)).selectAll(".selected-branch").classed("selected-branch",!1).classed("one",!1).classed("two",!1).classed("".concat(t.key),!1),s.selectAll(".".concat(t.key)).selectAll(".anti-brushed-second").classed("anti-brushed-second",!1).classed("one",!1).classed("two",!1).classed("".concat(t.key),!1),s.selectAll(".".concat(t.key)).selectAll(".anti-brushed-branch").classed("anti-brushed-branch",!1).classed("one",!1).classed("two",!1).classed("".concat(t.key),!1);var B=w.attr("id");r="one"===B?0:1,a.B(this).select(".selection").style("fill","".concat(I[r][0])).attr("stroke","".concat(I[r][0])).attr("stroke-width",2),a.B(this).select(".overlay").attr("stroke",I[r][1]).attr("stroke-width",2);var k=t.data.filter((function(t){return t.values.realVal>=o[0]&&t.values.realVal<=o[1]})),A=t.data.filter((function(t){return t.values.realVal<o[0]||t.values.realVal>o[1]}));w.datum({brush:this,nodes:k}),K(k,A,t,o,B)}}else{a.B("#toolbar").selectAll(".brush-span").filter((function(t,e){return 0===e})).remove();var C=0===T?"one":"two";a.B("#toolbar").append("span").attr("class").classed("brush-span",!0).classed("badge badge-secondary",!0).style("background",I[T][0]).attr("value","".concat(t.bins.groupLabel,"-").concat(t.key)).text("".concat(t.bins.groupLabel,", ").concat(t.key,": ").concat(n(o[0])," - ").concat(n(o[1]))),T=0===T?1:0,x.classed(C,!0),y.classed(C,!0)}}else a.C(".".concat(t.key,".brushed-branch")).classed("brushed-branch",!1),a.C(".".concat(t.key,".brushed-second")).classed("brushed-second",!1)})),v.append("g").classed("continuous-branch-brush",!0).attr("class","brush").call(b);var x=t.append("g").classed("observed",!0);x.attr("transform",(function(t,e,n){return"translate("+(L.predictedWidth+150)+", 0)"}));var w=x.filter((function(t){return"continuous"===t.type}));w.attr("transform","translate(".concat(L.predictedWidth+160,", -15)"));var B=w.selectAll("g.ob-bars").data((function(t){return t.leafData.bins})).join("g").classed("ob-bars",!0);B.append("rect").attr("width",(function(t,e,n){return L.observedWidth/n.length})).attr("height",(function(t,e){return a.y().domain([0,Object.keys(t).length]).range([L.height-L.margin,0])(Object.keys(t).length-2)})).attr("fill",z).attr("fill-opacity",.5);B.attr("transform",(function(t,e,n){var r=L.observedWidth/n.length,l=a.y().domain([0,Object.keys(t).length]).range([L.height-L.margin,0]);return"translate("+r*e+", "+(L.height-l(Object.keys(t).length-2))+")"})),w.each((function(t,e,n){var r=t.leafData.data.map((function(t){return+t.values.realVal})),l=a.y().domain([a.w(r),a.t(r)]).range([0,L.observedWidth]),i=a.y().domain([0,a.t(t.leafData.bins.map((function(t){return Object.keys(t).length})))-2]).range([L.height-L.margin,0]);a.B(n[e]).append("g").classed("x-axis",!0).call(a.b(l)).attr("transform","translate(0, "+L.height+")"),a.B(n[e]).append("g").classed("y-axis",!0).call(a.c(i).ticks(4)).attr("transform","translate(0, "+L.margin+")"),a.B(n[e]).select(".x-axis").selectAll("text").style("font-size","8px"),a.B(n[e]).select(".y-axis").selectAll("text").style("font-size","8px"),a.B(n[e]).append("g").classed("x-axis-label",!0).append("text").text("Frequency").attr("transform","translate(-20, ".concat(L.height-10,") rotate(-90)")).style("font-size","10px")}));var k=x.filter((function(t){return"discrete"===t.type}));k.attr("transform","translate(".concat(L.predictedWidth+160,", 5)"));var A=k.selectAll("g.ob-bars").data((function(t){return t.stateKeys.map((function(e,n){return{state:e,data:t.leafData.bins[n],max:a.D(t.leafData.bins.map((function(t){return t.length})))}}))})).join("g").classed("ob-bars",!0),C=A.append("rect").attr("width",(function(t,e,n){return L.observedWidth/n.length})).attr("height",(function(t,e,n){var r=t.data[0]?t.data[0].scales.stateColors.length*L.squareDim-10:0;return a.y().domain([0,t.max]).range([0,r])(t.data.length)})).attr("fill",(function(t,e){return null!=t.data[0]?t.data[0].color:"#fff"})).attr("opacity",.3);A.attr("transform",(function(t,e,n){var r=L.observedWidth/n.length,l=t.data[0]?t.data[0].scales.stateColors.length*L.squareDim-10:0;return"translate("+r*e+", "+(l-5-a.y().domain([0,t.max]).range([0,l-5])(t.data.length))+")"})),C.on("mouseover",(function(t,e,n){var r=a.B("g."+t[0].label).selectAll("g.state");r.filter((function(e){return e[0].state===t[0].winState})).attr("opacity",.8),r.filter((function(e){return e[0].state!=t[0].winState})).attr("opacity",.1),a.B(n[e]).attr("opacity",.9)})).on("mouseout",(function(t,e,n){a.B(n[e]).attr("opacity",.3);a.B("g."+t[0].label).selectAll("g.state").attr("opacity",.6)})),k.each((function(t,e,n){var r=a.A().domain(t.stateKeys).range([0,L.observedWidth]).padding(.6),l=t.stateKeys?t.stateKeys.length*L.squareDim-10:0,i=a.y().domain([0,t.leafData.data.length]).range([l,0]);a.B(n[e]).append("g").classed("y-axis",!0).call(a.c(i).ticks(4)),a.B(n[e]).append("g").classed("x-axis",!0).call(a.b(r)).attr("transform","translate(0, "+l+")"),a.B(n[e]).select(".x-axis").selectAll("text").style("font-size","8px"),a.B(n[e]).select(".y-axis").selectAll("text").style("font-size","8px")}))}function K(t,e,n,r,l){var i=t.map((function(t){return t.node})),o=e.map((function(t){return t.node})),s=(a.m(t.map((function(t){return t.combLength}))),a.B("#sidebar").selectAll(".node")),c=s.filter((function(t){return i.indexOf(t.data.node)>-1})).classed("brushed-branch",!0),u=s.filter((function(t){return o.indexOf(t.data.node)>-1})).classed("anti-brushed",!0),d=v([],c.data(),[],[],0),f=v([],u.data(),[],[],0),p=d.flatMap((function(t){return t})).filter((function(t){return t.data.attributes[n.key].values.realVal>=r[0]&&t.data.attributes[n.key].values.realVal<=r[1]})).map((function(t){return t.data.node})),h=f.flatMap((function(t){return t})).filter((function(t){return t.data.attributes[n.key].values.realVal<r[0]||t.data.attributes[n.key].values.realVal>r[1]})).map((function(t){return t.data.node})),g=s.filter((function(t){return-1===i.indexOf(t.data.node)&&p.indexOf(t.data.node)>-1})).classed("brushed-second",!0).classed("".concat(n.key),!0).classed(l,!0);a.B("#sidebar").selectAll(".link").filter((function(t){return-1===i.indexOf(t.data.node)&&p.indexOf(t.data.node)>-1})).classed("brushed-second",!0).classed("".concat(n.key),!0).classed(l,!0);c.classed("".concat(n.key),!0).classed(l,!0).classed("brushed-branch",!0);var m=s.filter((function(t){return-1===o.indexOf(t.data.node)&&h.indexOf(t.data.node)>-1})).classed("anti-brushed-second",!0).classed("".concat(n.key),!0).classed(l,!0);return a.B("#sidebar").selectAll(".link").filter((function(t,e){return-1===o.indexOf(t.data.node)&&h.indexOf(t.data.node)>-1})).classed("anti-brushed-second",!0).classed("".concat(n.key),!0).classed(l,!0),u.classed("anti-brushed",!0).classed(l,!0).classed(l,!0),[c,g,u,m]}function H(t){var e=t[0].yScale;return a.p().value((function(t){return t.values.realVal})).domain(e.domain()).thresholds(e.ticks(20))(t)}var Y=a.a().curve(a.g).x((function(t,e,n){return a.y().domain([n.length-1,0]).range([0,L.height]).clamp(!0)(e)})).y0((function(t){return 0})).y1((function(t,e,n){var r=n.maxCount?n.maxCount:t.maxCount,l=t.length,i=n.count?n.count:8;return a.y().domain([0,r]).range([0,L.predictedWidth/i*.5]).clamp(!0)(l)})),X=a.a().curve(a.g).x((function(t,e,n){return a.y().domain([0,n.length-1]).range([0,L.height]).clamp(!0)(e)})).y0((function(t){return 0})).y1((function(t,e,n){var r=t.maxCount?t.maxCount:a.D(n.map((function(t){return t.length}))),l=t.length,i=n.count?n.count:8;return a.y().domain([0,r]).range([0,L.predictedWidth/i*.5]).clamp(!0)(l)})),_=(n(132),n(133),n(174));n(168);function G(t){return function(t){if(Array.isArray(t)){for(var e=0,n=new Array(t.length);e<t.length;e++)n[e]=t[e];return n}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var U=[],J=[];function Q(t,e,n){var r=a.B("div#selected"),l=a.B("div#main");if(null===t){U=[],a.B("div#selected").selectAll("*").remove(),r.style("height",0),a.B("div#main").style("padding-top","0px");var i=a.B("div#main");nt(G(e),i,n)}else{var o=function(t,e,n,r){var l=t.flatMap((function(t){return t.filter((function(t){return!0===t.leaf})).map((function(t){return t.node}))})),i=a.B("#sidebar").select("svg").selectAll(".node");i.filter((function(t){return l.indexOf(t.data.node)>-1})).classed("selected",!0);var o=gt.filter((function(t){return"hide-attribute"===t.type})).length>0?gt.filter((function(t){return"hide-attribute"===t.type})).map((function(t){return t.attribute})):[],s=o.length>0?r.filter((function(t){return-1===o.indexOf(t.field)})).map((function(t){return t.field})):null,c=n.select(".selected-toolbar"),u=c.empty()?n.append("div").classed("selected-toolbar",!0):c;u.selectAll("*").remove();var d=u.append("div").style("display","inline-block");d.append("text").text("Topology: ");var f=d.append("button").classed("btn btn-secondary btn-sm",!0);f.text("Sort Most to Least"),f.on("click",(function(){var t;"Sort Most to Least"===(t=f).text()?t.text("Sort Least to Most"):t.text("Sort Most to Least")}));var p=r.map((function(t){return t.field})),g=u.append("div").style("display","inline-block");g.append("h6").text("Sort by: ").style("display","inline");var m=g.selectAll("div.attr-radio").data(p).join("div").classed("attr-radio form-check form-check-inline",!0),v=m.append("input").attr("type","radio").property("name","attribute-radio-sort").property("value",(function(t){return t})).attr("id",(function(t,e){return"radio-"+e})).classed("form-check-input",!0);m.append("label").text((function(t){return t})).property("for",(function(t,e){return"radio-"+e})).classed("form-check-label",!0);var y=n.select("svg.select-svg"),b=y.empty()?n.append("svg").classed("select-svg",!0):y;b.selectAll("*").remove();var x=t.flatMap((function(t){return t.flatMap((function(t){return t.node}))})).reduce((function(t,e){return void 0===t[e]?t[e]=1:t[e]+=1,t}),{});if(1===t.length){var w=b.append("g").classed("select-wrap",!0);w.attr("transform",(function(t,e){return"translate(0,20)"}));var B=a.z().range([6,14]).domain([1,a.t(Object.values(x))]),k=w.selectAll(".paths").data(t).join("g").classed("paths",!0);k.append("rect").classed("path-rect",!0).attr("y",-8),Z(k,r),k.on("mouseover",(function(t,e){var n=a.B("#sidebar").selectAll(".node"),r=a.B("#sidebar").selectAll(".link");return n.filter((function(e){return t.map((function(t){return t.node})).indexOf(e.data.node)>-1})).classed("hover",!0),r.filter((function(e){return t.map((function(t){return t.node})).indexOf(e.data.node)>-1})).classed("hover",!0),a.B(this).classed("hover",!0)})).on("mouseout",(function(t,e){a.B("#sidebar").selectAll(".node").classed("hover",!1),a.B("#sidebar").selectAll(".link").classed("hover",!1);return a.B(this).classed("hover",!1)})),k.append("text").text((function(t){var e=t.filter((function(t){return!0===t.leaf}))[0].label;return e.charAt(0).toUpperCase()+e.slice(1)})).attr("x",25).attr("y",15);var A=k.append("g").classed("time-line",!0);A.attr("transform",(function(t,e){return"translate(150, 0)"}));A.append("line").attr("x1",0).attr("x2",1e3).attr("y1",15).attr("y2",15);var C=A.selectAll(".node").data((function(t){return t})).join("g").classed("node",!0);C.attr("transform",(function(t){return"translate("+a.y().domain([0,1]).range([0,1e3])(t.edgeMove)+", 10)"})),C.append("circle").attr("cx",0).attr("cy",0).attr("r",(function(t){return B(x[t.node])})).attr("class",(function(t,e){return"node-"+t.node})).on("mouseover",(function(t,e){var n=C.filter((function(e){return e.node===t.node}));a.B("#sidebar").selectAll(".node").filter((function(e){return e.data.node===t.node})).classed("selected-branch",!0);return n.classed("hover-branch",!0)})).on("mouseout",(function(t,e){var n=C.filter((function(e){return e.node===t.node}));return a.C(".selected-branch").classed("selected-branch",!1),n.classed("hover-branch",!1)}));C.filter((function(t){return null!=t.label})).append("text").text((function(t){return t.label.charAt(0).toUpperCase()+t.label.slice(1)})).attr("x",10).attr("y",5);k.attr("transform",(function(t,e){return"translate(0,"+60*e+")"})),k.select(".time-line").selectAll(".node").on("mouseover",(function(t,n){var a=e.filter((function(e){return e.flatMap((function(t){return t.node})).indexOf(t.node)>-1}));a[0],a[1]}));var V=k.append("g").classed("attribute-wrapper",!0),S=h(t,r,s),j=at(V,S,r,null);return k.attr("transform",(function(t,e){return"translate(10,"+e*(55*(Object.keys(t[1].attributes).length+1))+")"})),lt(j),st(j,r,!1),b.style("height",50*(t.length+j.data().map((function(t){return t[0]})).length)+50+"px"),n.style("height",50*(t.length+j.data().map((function(t){return t[0]})).length)+50+"px"),V.attr("transform",(function(t){return"translate(140, 25)"})),a.C(".selected-path").classed("selected-path",!1),v.on("click",(function(n,l){var o=t.map((function(t){return t.filter((function(t){return!0===t.leaf}))[0]}))[0],s=G(e).sort((function(t,e){return t.filter((function(t){return!0===t.leaf}))[0].attributes[n].realVal-e.filter((function(t){return!0===t.leaf}))[0].attributes[n].realVal})),c=a.B("div#main");nt(s.reverse(),c,r),c.style("padding-top","250px");var u=c.select("svg#main-path-view").selectAll(".paths"),d=u.filter((function(t){return t.filter((function(t){return!0===t.leaf}))[0].attributes[n].realVal>o.attributes[n].realVal}));d.classed("high",!0);var f=d.data().map((function(t){return t.filter((function(t){return!0===t.leaf}))[0].node}));i.filter((function(t){return f.indexOf(t.data.node)>-1})).classed("high",!0);var p=u.filter((function(t){return t.filter((function(t){return!0===t.leaf}))[0].attributes[n].realVal<o.attributes[n].realVal}));p.classed("low",!0);var h=p.data().map((function(t){return t.filter((function(t){return!0===t.leaf}))[0].node}));i.filter((function(t){return h.indexOf(t.data.node)>-1})).classed("low",!0),u.filter((function(t){return t.filter((function(t){return!0===t.leaf}))[0].attributes[n].realVal===o.attributes[n].realVal})).classed("same",!0)})),t}if(t.length>1&&t.length<5){var O=function(t){var e=a.t(t.map((function(t){return t.length}))),n=t.filter((function(t){return t.length===e}))[0].filter((function(t){return 1!=t.leaf}));t.map((function(t){n=G(t).filter((function(t){return n.map((function(t){return t.node})).indexOf(t.node)>-1&1!=t.leaf}))}));var r=t.map((function(t){var e=(t=!0===t[0].leaf?t.reverse():t).map((function(t){return t.node})).indexOf(n[n.length-1].node);return t.filter((function(t,n){return n>e}))}));return n[n.length-1].children=r.map((function(t,e){var r=a.t(t.map((function(t){return t.edgeMove})))-n[n.length-1].edgeMove;return t.map((function(t,l,i){t.parentBase=n[n.length-1].edgeMove,t.move=t.edgeMove-n[n.length-1].edgeMove,t.base=0===l?0:i[l-1].edgeMove-n[n.length-1].edgeMove;var o=a.y().domain([0,1]).range([0,1e3])(n[n.length-1].edgeMove);return t.xScale=a.y().domain([0,r]).range([0,1e3-o]),t.level=e,t}))})),n}(t);!function(t,e,n,r){var l=e.append("g").classed("select-wrap",!0);l.attr("transform","translate(0, 20)");var i=a.z().range([6,14]).domain([1,a.t(Object.values(r))]),o=l.selectAll(".paths").data([t]).join("g").classed("paths",!0),s=o.append("rect").classed("path-rect",!0);s.attr("y",-8),s.attr("height",35+25*t[t.length-1].children.length),Z(o,n);var c=o.append("g").classed("time-line",!0);c.attr("transform",(function(t,e){return"translate(145, 0)"}));c.append("line").attr("x1",0).attr("x2",(function(t,e){return a.y().domain([0,1]).range([0,1e3])(t[t.length-1].edgeMove)})).attr("y1",15).attr("y2",15);var u=c.selectAll(".node").data((function(t){return t})).join("g").classed("node",!0);u.attr("transform",(function(t){return"translate("+a.y().domain([0,1]).range([0,1e3])(t.edgeMove)+", 10)"})),u.classed("common-node",!0);var d=u.filter((function(t){return null!=t.children})).selectAll("g.child").data((function(t){return t.children})).join("g").classed("child",!0),f=d.selectAll("g.node").data((function(t){return t})).join("g").classed("node",!0);f.attr("transform",(function(t,e,n){return"translate("+t.xScale(t.move)+", "+20*t.level+")"})),d.append("path").attr("d",(function(t,e,n){var r=[{x:0,y:0},{x:0,y:e}];return t.map((function(t){r.push({x:t.xScale(t.move),y:t.level})})),a.s().curve(a.h).x((function(t){return t.x})).y((function(t){return 20*t.y}))(r)})).attr("stoke-width","2px").attr("fill","none").attr("stroke","gray"),d.on("mouseover",(function(e,n){e.map((function(t){return t.species}));var r=u.filter((function(t){return t.node===e.node})),l=G(t).map((function(t){return t.node})).concat(e.map((function(t){return t.node}))),i=a.B("#sidebar").selectAll(".node"),o=a.B("#sidebar").selectAll(".link");return i.filter((function(t){return l.indexOf(t.data.node)>-1})).classed("hover",!0),o.filter((function(t){return l.indexOf(t.data.node)>-1})).classed("hover",!0),r.classed("hover-branch",!0)})).on("mouseout",(function(t,e){a.C(".hover").classed("hover",!1)}));u.append("circle").attr("cx",0).attr("cy",0).attr("r",(function(t){return i(r[t.node])})).attr("class",(function(t,e){return"node-"+t.node}));f.append("circle").attr("r",7).attr("fill","red").attr("y",5).on("mouseover",(function(t,e){var n=u.filter((function(e){return e.node===t.node}));a.B("#sidebar").selectAll(".node").filter((function(e){return e.data.node===t.node})).classed("selected-branch",!0);return n.classed("hover-branch",!0)})).on("mouseout",(function(t,e){var n=u.filter((function(e){return e.node===t.node}));return a.C(".selected-branch").classed("selected-branch",!1),n.classed("hover-branch",!1)})),f.filter((function(t){return!0===t.leaf})).append("text").text((function(t){return t.label})).attr("x",9).attr("y",4)}(O,b,r,x);var D=b.append("g").classed("attribute-wrapper",!0),M=(O[O.length-1].children.map((function(t){return G(O).concat(t)})),h(t,r,s)),L=M[0].map((function(e,n){var a=t[0].filter((function(t){return!0===t.leaf}))[0].label;e[e.length-1].offset=0;for(var r={label:e[e.length-1].label,type:e[e.length-1].type,data:[{species:a,paths:e}]},l=1;l<M.length;l++){var i=t[l].filter((function(t){return!0===t.leaf}))[0].label,o=M[l][n].length-1;M[l][n][o].offset=8*l,r.data.push({species:i,paths:M[l][n]})}return r})).map((function(t){return t.data=t.data.map((function(e,n){return e.paths=e.paths.map((function(e){if("discrete"===t.type){var r=5*n;return e.states?{realVal:1,state:e.winState,color:e.color,edgeMove:e.edgeMove,offset:e.offset,leaf:!0}:function(t,e){var n=a.t(t.map((function(t){return t.realVal}))),r=t.filter((function(t){return t.realVal!=n})),l=t[t.map((function(t){return t.realVal})).indexOf(n)];return l.other=r,l.offset=e,l}(e,r)}return e})),e})),t})),I=D.selectAll("g").data(L).join("g").classed("attr",!0);I.attr("transform",(function(t,e){return"translate(145,"+60*e+")"})),I.append("text").text((function(t){return t.label})).style("text-anchor","end").style("font-size",11).attr("transform","translate(0,25)");var E=I.append("rect").attr("width",1010);E.attr("height",50),E.style("fill","#fff"),E.style("stroke","gray"),E.style("opacity",.5),I.append("line").classed("half",!0).attr("x1",0).attr("y1",22).attr("x2",1010).attr("y2",22);var z=I.selectAll("g").data((function(t){return t.data=t.data.map((function(e){return e.type=t.type,e})),t.data})).join("g").classed("species",!0),T=a.s().x((function(t){return a.y().domain([0,1]).range([0,1e3])(t.edgeMove)})).y((function(t){return a.y().domain([0,1]).range([48,1])(t.realVal)+t.offset})),R=a.s().x((function(t){return a.y().domain([0,1]).range([0,1e3])(t.edgeMove)})).y((function(t){var e=t.yScale;return e.range([48,1]),e(t.realVal)+2}));z.append("path").attr("d",(function(t){return"discrete"===t.type?T(t.paths):R(t.paths)})).attr("class",(function(t,e){return t.species+" inner-line"})).style("stroke-width",.7).style("fill","none").style("stroke","gray").on("mouseover",(function(t,e,n){a.B(n[e]).classed("selected",!0)})).on("mouseout",(function(t,e,n){a.B(n[e]).classed("selected",!1)}));var q=z.filter((function(t){return"discrete"===t.type})).selectAll(".branch").data((function(t){return t.paths})).join("g").classed("branch",!0);q.attr("transform",(function(t){return"translate("+a.y().domain([0,1]).range([0,1e3])(t.edgeMove)+", 0)"}));var N=q.append("circle").attr("r",5).attr("cy",(function(t,e){return a.y().domain([0,1]).range([45,2])(t.realVal)+t.offset})).attr("cx",5);N.attr("fill",(function(t,e){return t.color}));var F=q.filter((function(t){return 1!=t.leaf})).selectAll(".other").data((function(t){return t.other})).join("circle").classed("other",!0);F.attr("r",4).attr("cx",5).attr("cy",(function(t,e){var n=a.y().domain([1,0]);return n.range([0,45]),n(t.realVal)})).attr("fill",(function(t){return t.color})).style("opacity",.1),F.on("mouseover",(function(t){var e=a.B("#tooltip");e.transition().duration(200).style("opacity",.9);var n=a.n(".3f");e.html(t.state+": "+n(t.realVal)).style("left",a.l.pageX+10+"px").style("top",a.l.pageY-28+"px")})).on("mouseout",(function(t){a.B("#tooltip").transition().duration(500).style("opacity",0)})),N.on("mouseover",(function(t){var e=a.B("#tooltip");e.transition().duration(200).style("opacity",.9);var n=a.n(".3f");e.html(t.state+": "+n(t.realVal)).style("left",a.l.pageX+10+"px").style("top",a.l.pageY-28+"px")})).on("mouseout",(function(t){a.B("#tooltip").transition().duration(500).style("opacity",0)})),q.on("mouseover",(function(t,e,n){var r=a.y().domain([1,0]);r.range([0,45]),b.selectAll("path.inner-line."+t.species).attr("stroke","red"),b.selectAll("path.inner-line."+t.species).classed("selected",!0),a.B(n[e]).append("g").classed("y-axis",!0).call(a.c(r).ticks(3)),a.B(n[e]).selectAll(".other").style("opacity",.7)})).on("mouseout",(function(t,e,n){a.B(n[e]).select("g.y-axis"),a.B(n[e]).select("g.y-axis").remove(),a.C("path.inner-line."+t.species).attr("stroke","gray"),a.C("path.inner-line."+t.species).classed("selected",!1),a.C(".other").style("opacity",.1)}));var W=z.filter((function(t){return"continuous"===t.type})).selectAll(".branch").data((function(t){return t.paths})).join("g").classed("branch",!0);W.attr("transform",(function(t){return"translate("+a.y().domain([0,1]).range([0,1e3])(t.edgeMove)+", 0)"})),W.on("mouseover",(function(t,e,n){var r=t.yScale;r.range([0,45]),b.selectAll("path.inner-line."+t.species).attr("stroke","red"),b.selectAll("path.inner-line."+t.species).classed("selected",!0),a.B(n[e]).append("g").classed("y-axis",!0).call(a.c(r).ticks(3)),a.B(n[e]).selectAll(".other").style("opacity",.7)})).on("mouseout",(function(t,e,n){a.B(n[e]).select("g.y-axis"),a.B(n[e]).select("g.y-axis").remove(),a.C("path.inner-line."+t.species).attr("stroke","gray"),a.C("path.inner-line."+t.species).classed("selected",!1),a.C(".other").style("opacity",.1)}));var K=W.append("rect");K.attr("width",10).attr("height",3),K.attr("y",(function(t,e){var n=r.filter((function(e){return e.field===t.label}))[0];return a.y().domain([n.min,n.max]).range([50,0])(t.realVal)}));var H=W.filter((function(t){return 1!=t.leaf})).append("rect");return H.attr("width",10).attr("height",(function(t,e){var n=r.filter((function(e){return e.field===t.label}))[0],l=a.y().domain([n.min,n.max]).range([50,0]);return l(t.lowerCI95)-l(t.upperCI95)})),H.attr("y",(function(t,e){var n=r.filter((function(e){return e.field===t.label}))[0];return a.y().domain([n.min,n.max]).range([50,0])(t.upperCI95)})),H.style("opacity",.1),b.style("height",50*(t.length+I.data().map((function(t){return t[0]})).length)+50+"px"),n.style("height",50*(t.length+I.data().map((function(t){return t[0]})).length)+50+"px"),D.attr("transform",(function(t){return"translate(0, 60)"})),a.C(".selected-path").classed("selected-path",!1),O}var Y=a.t(t.map((function(t){return t.length}))),X=t.filter((function(t){return t.length===Y}))[0].filter((function(t){return 1!=t.leaf}));t.map((function(t){X=G(t).filter((function(t){return X.map((function(t){return t.node})).indexOf(t.node)>-1&1!=t.leaf}))})),b.remove();var _=u.append("g").classed("x-icon",!0);return _.attr("transform","translate(15, 10)"),_.append("circle").attr("r",7).attr("fill","#fff"),_.append("text").text("x").attr("transform","translate(-5, 5)"),_.style("cursor","pointer"),_.on("click",(function(t,e,n){a.C(".high").classed("high",!1),a.C(".low").classed("low",!1),i.select(".selected").classed("selected",!1),Q(null,It[0],r)})),P(t,n,r),n.style("height","550px"),a.C(".selected-path").classed("selected-path",!1),v.on("click",(function(n,l){var o=t.map((function(t){return t.filter((function(t){return!0===t.leaf}))[0]}))[0],s=G(e).sort((function(t,e){return t.filter((function(t){return!0===t.leaf}))[0].attributes[n].realVal-e.filter((function(t){return!0===t.leaf}))[0].attributes[n].realVal})),c=a.B("div#main");nt(s.reverse(),c,r),c.style("padding-top","250px");var u=c.select("svg#main-path-view").selectAll(".paths"),d=u.filter((function(t){return t.filter((function(t){return!0===t.leaf}))[0].attributes[n].realVal>o.attributes[n].realVal}));d.classed("high",!0);var f=d.data().map((function(t){return t.filter((function(t){return!0===t.leaf}))[0].node}));i.filter((function(t){return f.indexOf(t.data.node)>-1})).classed("high",!0);var p=u.filter((function(t){return t.filter((function(t){return!0===t.leaf}))[0].attributes[n].realVal<o.attributes[n].realVal}));p.classed("low",!0);var h=p.data().map((function(t){return t.filter((function(t){return!0===t.leaf}))[0].node}));i.filter((function(t){return h.indexOf(t.data.node)>-1})).classed("low",!0),u.filter((function(t){return t.filter((function(t){return!0===t.leaf}))[0].attributes[n].realVal===o.attributes[n].realVal})).classed("same",!0)})),b.style("height",50*(t.length+attributeGroups.data().map((function(t){return t[0]})).length)+50+"px"),n.style("height",50*(t.length+attGroups.data().map((function(t){return t[0]})).length)+50+"px"),attWrap.attr("transform",(function(t){return"translate(140, 25)"})),a.C(".selected-path").classed("selected-path",!1),X}(G(U=U.concat(t)),G(e),r,n);nt(function(t,e,n){if(!(t.length>1)){var a=t[0].reverse().map((function(t){return t.node}));return e.map((function(t){var e=t.reverse().map((function(t,e){return a.indexOf(t.node),{indexOf:a.indexOf(t.node),pathIndex:e,node:t,chosen:a[a.indexOf(t.node)]}})).filter((function(t){return t.indexOf>-1})),n=e[0].indexOf+e[0].pathIndex;return{data:t.reverse(),distance:n}})).sort((function(t,e){return t.distance-e.distance}))}if(null!=n){var r=n.reverse().map((function(t){return t.node}));return e.map((function(t){var e=t.reverse().map((function(t,e){return r.indexOf(t.node),{indexOf:r.indexOf(t.node),pathIndex:e,node:t,chosen:r[r.indexOf(t.node)]}})).filter((function(t){return t.indexOf>-1})),n=e[0].indexOf+e[0].pathIndex;return{data:t.reverse(),distance:n}})).sort((function(t,e){return t.distance-e.distance}))}console.error("multiple paths without common node")}(G(U),G(e),G(o)).map((function(t){return t.data})),l,n);l.style("padding-top","250px")}}function Z(t,e){var n=t.append("g").classed("x-icon",!0);n.attr("transform","translate(15, 10)"),n.append("circle").attr("r",7).attr("fill","#fff"),n.append("text").text("x").attr("transform","translate(-5, 5)"),n.style("cursor","pointer"),n.on("click",(function(t,n,r){a.C(".high").classed("high",!1),a.C(".low").classed("low",!1),treeNodes.select(".selected").classed("selected",!1),Q(null,It[0],e)}))}function $(t,e,n,r){var l=n.select(".button-wrap"),i=l.empty()?n.append("div").classed("button-wrap",!0):l;i.style("display","inline-block").style("width","900px").style("height","50px");var o=a.B("div#main");if(o.style("padding-top","300px"),null!=t){var s=J.map((function(t){return t.groupColor})),c=Nt.find((function(t){return-1===s.indexOf(t[0])}));t.groupColor=c[0],J.push(t)}if(J.length>1){var u=a.B("#toolbar").select("#compare-button"),d=u.empty()?a.B("#toolbar").append("button").text("Normal Mode").attr("id","compare-button").classed("btn btn-info",!0):u;d.on("click",(function(){"Normal Mode"===d.text()?d.text("Compare Mode"):d.text("Normal Mode"),$(null,e,n,r)}))}var f=r.map((function(t,e){var n={field:t.field,type:t.type,data:[]};return J.map((function(e,a){var l=h(e.data,r,[t.field]),i=l.flatMap((function(t){return t.map((function(t){return t.map((function(t){var e=!0===t.leaf?0:(t.upperCI95-t.realVal)/2;return t.variance=e*e,t}))}))}));n.data.push({group:{first:e.first,second:e.second,color:e.groupColor},data:"continuous"===t.type?i:l.flatMap((function(t){return t}))})})),n})),p=i.selectAll("button").data(J).join("button").classed("btn btn-info",!0).style("background",(function(t){return t.groupColor}));p.selectAll("span").data((function(t){return[t]})).join("span").text((function(t){return t.first?"".concat(t.first[1]," / ").concat(t.second[1]):t.state})).append("span").text((function(t){return t.data.length})).classed("badge badge-light",!0),p.selectAll("i").data((function(t){return[t]})).join("i").classed("close fas fa-times",!0).style("padding-left","10px").on("click",(function(t,a){var l=J.filter((function(e){return e.groupColor!=t.groupColor}));(J=l).length>0?$(null,e,n,r):(n.selectAll("*").remove(),n.style("height","0px"),o.style("padding-top","0px"))}));var g=n.select(".comparison-svg"),m=g.empty()?n.append("svg").classed("comparison-svg",!0):g;n.style("height","300px").style("width","100%"),m.style("height","300px");var v=m.selectAll(".att-wrapper").data(f.filter((function(t){return"continuous"===t.type})).map((function(t){var e=a.t(t.data.flatMap((function(t){return t.data.flatMap((function(t){return t.map((function(t){return t.upperCI95}))}))})))+.2,n=a.w(t.data.flatMap((function(t){return t.data.flatMap((function(t){return t.map((function(t){return t.lowerCI95}))}))})))-.2;return t.data.map((function(t){var r=new Array(6).fill().map((function(t,a){return{base:a*(1/6),top:(a+1)*(1/6),binI:a,max:e,min:n}})),l=t.data.map((function(t){return t.filter((function(t){return 1!=t.leaf}))})),i=t.data.flatMap((function(t){return t.filter((function(t){return!0===t.leaf}))}));return t.bins=r.map((function(t,e,n){var i=l.flatMap((function(e){return e.filter((function(e){return e.edgeMove>=t.base&&e.edgeMove<=t.top}))}));t.data=i;var o=a.u(i.map((function(t){return t.realVal})));t.mean=void 0===o?r[e-1].mean:o;var s=Math.sqrt(a.u(i.map((function(t){return t.variance}))));t.meanStandard=0===i.length?0:s;var c=2*s;return t.upCon95=void 0===o?r[e-1].upCon95:o+c,t.lowCon95=void 0===o?r[e-1].lowCon95:o-c,t})),t.leaves=i,t})),t})));v.exit().remove();var y=v.enter().append("g").classed("att-wrapper",!0);y.append("text").text((function(t){return t.field})).style("text-anchor","end").style("font-size","11px").attr("transform","translate(120, 35)");(v=y.merge(v)).attr("transform",(function(t,e){return"translate(0,"+(10+70*e)+")"}));var b=v.selectAll("g.inner-group").data((function(t){return[t]})).join("g").classed("inner-group",!0);b.attr("transform","translate(150, 0)");b.selectAll("rect.outline-rect").data((function(t){return[t]})).join("rect").classed("outline-rect",!0).attr("width",800).attr("height",60).attr("fill","#fff").attr("stroke","gray");if(a.B("#compare-button").empty()||"Normal Mode"===a.B("#compare-button").text()){var x=a.s().x((function(t,e){return a.y().domain([0,5]).range([0,800])(e)})).y((function(t){var e=a.y().domain([t.min,t.max]);return e.range([60,1]),e(t.mean)})),w=b.selectAll("g.path-groups").data((function(t){return t.data})).join("g").classed("path-groups",!0);w.selectAll("*").remove();var B=w.append("path").attr("d",(function(t){t.bins[0].data[0].yScale;return t.bins=t.bins.map((function(e,n,r){return void 0===e.mean&&(e.mean=t.bins[n-1].mean,t.missing=!0),e.yScale=a.y().domain([e.min,e.max]).range([60,1]),e})),x(t.bins)})).classed("path",!0),k=a.a().curve(a.g).x((function(t,e){return a.y().domain([0,5]).range([0,800])(e)})).y0((function(t){var e=t.yScale;return e.range([60,1]),e(t.lowCon95)})).y1((function(t){var e=t.yScale;return e.range([60,1]),e(t.upCon95)})),A=b.selectAll("g.conf-groups").data((function(t){return t.data})).join("g").classed("conf-groups",!0);A.selectAll("*").remove();var C=A.append("path").attr("d",(function(t){return t.bins=t.bins.map((function(e,n,a){return NaN===e.upCon95&&(e.upCon95=t.bins[n-1].upCon95,t.missing=!0),NaN===e.lowCon95&&(e.lowCon95=t.bins[n-1].lowCon95,t.missing=!0),e})),k(t.bins)})).classed("path",!0);B.style("fill","none"),B.style("stroke",(function(t){return t.group.color})),B.style("stroke-width","2px"),C.style("fill",(function(t){return t.group.color})),C.style("opacity",.15);b.append("g").classed("y-axis",!0);b.on("mousemove",(function(t,e){var n=this,r=a.y().domain([t.data[0].bins[0].min,t.data[0].bins[0].max]).range([1,60]),l=a.B(this).select(".y-axis"),i=l.empty()?a.B(this).append("g").classed("y-axis",!0):l;if(a.B("#compare-button").empty()||"Normal Mode"===a.B("#compare-button").text())i.attr("transform",(function(t,e){return"translate("+(a.x(n)[0]-10)+",0)"})),i.call(a.c(r).ticks(5));else{var o=a.B(this).select(".path-groups").selectAll("path").data().map((function(t){return t[0].maxDiff}))[0];i.attr("transform",(function(t,e){return"translate("+(a.x(n)[0]-10)+",0)"}));var s=a.y().domain([o,0]).range([0,60]);i.call(a.c(s).ticks(5))}})).on("mouseleave",(function(){a.B(this).select(".y-axis").remove()}))}else{b.selectAll(".path-groups").remove(),b.selectAll("g.conf-groups").remove();var V=b.selectAll("g.path-groups").data((function(t){for(var e=t.data[0].bins,n=[],a=function(a){var r=[];t.data[a].bins.map((function(n,l){void 0===n.mean&&(n.mean=t.data[a].bins[l-1].mean),void 0===e[l].mean&&(e[l].mean=e[l-1].mean);var i=t.data[0].bins[0].max-t.data[0].bins[0].min;r.push({diff:Math.abs(e[l].mean-n.mean),maxDiff:i})})),n.push(r)},r=1;r<t.data.length;r++)a(r);return n})).join("g").classed("path-groups",!0),S=a.s().x((function(t,e){return a.y().domain([0,5]).range([0,800])(e)})).y((function(t){var e=a.y().domain([0,t.maxDiff]).clamp(!0);return e.range([60,0]),e(t.diff)})),j=V.append("path").attr("d",(function(t){return S(t)}));j.style("fill","none"),j.style("stroke","black"),j.style("stroke-width","2px")}var O=v.selectAll(".observed-dist-wrap").data((function(t){var e=a.t(t.data.flatMap((function(t){return t.leaves.map((function(t){return t.realVal}))}))),n=a.w(t.data.flatMap((function(t){return t.leaves.map((function(t){return t.realVal}))}))),r=a.y().domain([n,e]).range([0,200]),l=a.p().value((function(t){return t.realVal})).domain(r.domain()).thresholds(r.ticks(10));return[{data:t.data.map((function(t){var e=G(t.leaves).map((function(e){return e.x=r,e.group=t.group,e}));return{binData:l(t.leaves),data:e,group:t.group,xScale:r}})),xScale:r}]})).join("g").classed("observed-dist-wrap",!0);O.attr("transform","translate(970, 0)");var D=O.selectAll("g.axis-x").data((function(t){return[t]})).join("g").classed("axis-x",!0);D.attr("transform","translate(0, 50)"),D.each((function(t,e,n){a.B(n[e]).call(a.b(t.xScale).ticks(5))}));var M=O.selectAll(".observed-group").data((function(t){return t.data.map((function(t,e,n){return t.index=e,t.groupLength=n.length,t}))})).join("g").classed("observed-group",!0);M.selectAll(".line").data((function(t){return[{mean:a.u(t.data.map((function(t){return t.realVal}))),group:t.group,x:t.xScale}]})).join("rect").classed("line",!0).attr("transform",(function(t,e){return"translate("+(t.x(t.mean)-1.5)+",0)"})).attr("height",50).attr("width",3).attr("fill",(function(t){return t.group.color})).style("opacity","0.4"),M.selectAll(".circ-wrap").data((function(t,e){return[t]})).join("g").classed("circ-wrap",!0).attr("transform",(function(t,e,n){return"translate(0,"+a.y().domain([0,t.groupLength]).range([0,60])(t.index+.5)+")"})).selectAll("circle.disDots").data((function(t){return t.data})).join("circle").attr("r",3).attr("cx",(function(t,e){return t.x(t.realVal)})).attr("cy",(function(t,e,n){return 0})).attr("fill",(function(t){return t.group.color}))}function tt(t,e,n,a,r,l,i){try{var o=t[l](i),s=o.value}catch(t){return void n(t)}o.done?e(s):Promise.resolve(s).then(a,r)}var et={rectWidth:15,rectHeight:40,collapsedHeight:20};function nt(t,e,n){var r=!0,l=a.B("#scrunch").attr("value");e.select("#main-path-view").selectAll("*").remove();var i=function(t,e,n){var r=e.select("#main-path-view"),l=r.empty()?e.append("svg").attr("id","main-path-view"):r,i=!1,o=l.select(".path-wrapper"),c=o.empty()?l.append("g").classed("path-wrapper",!0):o;c.attr("transform",(function(t,e){return"translate(0,20)"}));var u=t.flatMap((function(t){return t.flatMap((function(t){return t.node}))})).reduce((function(t,e){return void 0===t[e]?t[e]=1:t[e]+=1,t}),{}),d=a.z().range([6,12]).domain([1,a.t(Object.values(u))]),f=c.selectAll(".paths").data(t).join("g").classed("paths",!0);f.append("rect").classed("path-rect",!0).attr("y",-8);var p=f.append("g").classed("fas fa-search-plus",!0);p.attr("transform","translate(15, 10)"),p.append("circle").attr("r",7).attr("fill","#fff"),p.append("text").text("+").attr("transform","translate(-5, 5)"),p.style("cursor","pointer"),p.on("click",(function(t,e,r){var l=a.C(r).filter((function(t,n){return n!=e})).classed("selected-path",!1);a.B(r[e]).classed("selected-path")?(a.B(r[e]).classed("selected-path",!1),Q(null,l.data(),n)):(a.B(r[e]).classed("selected-path",!0),Q([t],l.data(),n))})),f.on("mouseover",(function(t,e){var n=a.B("#sidebar").selectAll(".node"),r=a.B("#sidebar").selectAll(".link");return n.filter((function(e){return t.map((function(t){return t.node})).indexOf(e.data.node)>-1})).classed("hover",!0),r.filter((function(e){return t.map((function(t){return t.node})).indexOf(e.data.node)>-1})).classed("hover",!0),a.B(this).classed("hover",!0)})).on("mouseout",(function(t,e){a.B("#sidebar").selectAll(".node").classed("hover",!1),a.B("#sidebar").selectAll(".link").classed("hover",!1);return a.B(this).classed("hover",!1)})),f.append("text").text((function(t){var e=t.filter((function(t){return!0===t.leaf}))[0].node;return e.charAt(0).toUpperCase()+e.slice(1)})).attr("x",25).attr("y",15);var h=f.append("g").classed("time-line",!0);h.attr("transform",(function(t,e){return"translate(150, 0)"}));h.append("line").attr("x1",0).attr("x2",1e3).attr("y1",15).attr("y2",15);var g=h.selectAll(".node").data((function(t){return t})).join("g").attr("class",(function(t,e,n){return a.B(n[n.length-1]).data()[0].node+" node"}));g.attr("transform",(function(t){return"translate("+a.y().domain([0,s[0]]).range([0,1e3])(t.combLength)+", 10)"})),g.on("click",(function(t,e,r){i?(i=!1,a.B("#branch-tooltip").classed("hidden",!0)):(i=!0,a.B("#branch-tooltip").style("left",a.l.pageX+"px").style("top",a.l.pageY-28+"px").select("#value").text(t.node),a.B("#branch-tooltip").classed("hidden",!1),a.B("#filter-by-node").on("click",(function(){xt(t.node,n),i=!1,a.B("#branch-tooltip").classed("hidden",!0)})),a.B("#select-by-node").on("click",(function(){yt();var e=f.filter((function(e){return e.map((function(t){return t.node})).indexOf(t.node)>-1})),r=f.filter((function(e){return-1===e.map((function(t){return t.node})).indexOf(t.node)}));i=!1,a.B("#branch-tooltip").classed("hidden",!0),Q(e.data(),r.data(),n)})))})),g.append("circle").attr("cx",0).attr("cy",0).attr("r",(function(t){return d(u[t.node])})).attr("class",(function(t,e){return"node-"+t.node})).on("mouseover",(function(t,e){var n=g.filter((function(e){return e.node===t.node}));a.B("#sidebar").selectAll(".node").filter((function(e){return e.data.node===t.node})).classed("selected-branch",!0);return n.classed("hover-branch",!0)})).on("mouseout",(function(t,e){var n=g.filter((function(e){return e.node===t.node}));return a.C(".selected-branch").classed("selected-branch",!1),n.classed("hover-branch",!1)}));g.filter((function(t){return null!=t.label})).append("text").text((function(t){return t.label.charAt(0).toUpperCase()+t.label.slice(1)})).attr("x",10).attr("y",5);return f}(t,e,n),o=i.append("g").classed("attribute-wrapper",!0),c=gt.filter((function(t){return"hide-attribute"===t.type})).map((function(t){return t.attribute})),u=c.length>0?n.filter((function(t){return-1===c.indexOf(t.field)})).map((function(t){return t.field})):null,d=h(t,n,u),f=null===u?n.length:u.length,p=at(o,d,n,null,l),g="true"===l?22:45;i.attr("transform",(function(t,e){return"translate(10,"+e*((g+5)*(f+1))+")"}));lt(p,l),st(p,l,!1);return function(t,e,n,a){t.style("height",n.length*(a+52)+"px"),e.attr("transform",(function(t){return"translate(140, 25)"}))}(e.select("#main-path-view"),o,t,f*g),a.C(".discrete-leaf").on("click",(function(t,e){r?(r=!1,a.B("#state-tooltip").classed("hidden",!0)):(r=!0,a.B("#state-tooltip").style("left",a.l.pageX+"px").style("top",a.l.pageY-28+"px").select("#value").text(t.winState),a.B("#state-tooltip").classed("hidden",!1),a.B("#filter-by-state").on("click",(function(){!function(t,e){var n=yt(),r=(gt.filter((function(t){return"data-filter"===t.filterType})),n.filter((function(e){return e[e.length-1].attributes[t.label].winState===t.winState})));bt(vt("data-filter","leaf","l-"+gt.filter((function(t){return"leaf"===t.attributeType})).length,xt,ht(n),ht(r),[["leafState",[t.label,t.winState]]]),e),pt("Summary View");var l=a.B("#sidebar").selectAll(".link"),i=a.B("#sidebar").selectAll(".node"),o=r.flatMap((function(t){return t.map((function(t){return t.node}))}));a.C(".link-not-there").classed("link-not-there",!1),a.C(".node-not-there").classed("node-not-there",!1),l.filter((function(t){return-1===o.indexOf(t.data.node)})).classed("link-not-there",!0),i.filter((function(t){return-1===o.indexOf(t.data.node)})).classed("node-not-there",!0)}(t,n),r=!1,a.B("#state-tooltip").classed("hidden",!0)})),a.B("#select-by-state").on("click",(function(){var e=yt(),l=e.filter((function(e){return e[e.length-1].attributes[t.label].winState===t.winState})),i=e.filter((function(e){return e[e.length-1].attributes[t.label].winState!=t.winState}));r=!1,a.B("#state-tooltip").classed("hidden",!0),Q(l,i,n)})))})),i}function at(t,e,n,a,r){var l="true"===r?20:45,i=t.selectAll("g").data((function(t,n){return e[n]})).join("g");i.classed("predicated-attr-groups",!0),i.attr("transform",(function(t,e){return"translate(0, "+e*(l+5)+")"}));var o=i.append("text").text((function(t){return t[t.length-1].label?t[t.length-1].label:t[t.length-1].attrLabel}));return o.classed("attribute-label",!0),o.attr("transform","translate(-15, 20)"),i}function rt(){var t;return t=regeneratorRuntime.mark((function t(e,n){var r,l,i;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.data().forEach((function(t){var e;(e=t).map((function(t,n){var a=0===n?0:1,r=t.realVal>e[n-a].realVal?1:18;t.change=r}))})),r="true"===n?et.collapsedHeight:et.rectHeight,l=a.s().x((function(t){return a.y().domain([0,s[0]]).range([0,1e3])(t.combLength)})).y((function(t){var e=t.scales.yScale;return e.range([r,0]),"true"===n?t.change:e(t.values.realVal)})),i=e.append("path").attr("d",l).attr("class","inner-line").style("stroke",(function(t){return t[0].color})),t.abrupt("return",i);case 5:case"end":return t.stop()}}),t)})),(rt=function(){var e=this,n=arguments;return new Promise((function(a,r){var l=t.apply(e,n);function i(t){tt(l,a,r,i,o,"next",t)}function o(t){tt(l,a,r,i,o,"throw",t)}i(void 0)}))}).apply(this,arguments)}function lt(t,e){var n=t.filter((function(t){return null!=t[t.length-1]?"continuous"===t[t.length-1].type:"continuous"===t.type})),r="true"===e?et.collapsedHeight:et.rectHeight,l=n.append("g").classed("attribute-time-line",!0);!function(t,e){rt.apply(this,arguments)}(l,e);l.append("rect").classed("attribute-rect",!0).attr("height",r);var i=l.selectAll("g").data((function(t){return t})).join("g").classed("attribute-node",!0),o=i.append("g").classed("inner-bars",!0);o.attr("transform",(function(t){return"translate("+a.y().domain([0,s[0]]).range([0,1e3])(t.combLength)+", 0)"}));var c=o.append("rect").classed("range-rect",!0);return c.attr("width",et.rectWidth).attr("height",(function(t,n){var a=t.scales.yScale;a.range([r,0]);var l=t.leaf?0:a(t.values.lowerCI95)-a(t.values.upperCI95);return"true"===e?et.collapsedHeight:l})),c.attr("transform",(function(t,n){var a=t.scales.yScale;return a.range([r,0]),"translate(0, "+(t.leaf||"true"===e?0:a(t.values.upperCI95))+")"})),c.style("fill",(function(t){return t.colorScale(t.values.realVal)})),c.attr("opacity",(function(t){return t.satScale(t.values.realVal)})),"true"!=e&&o.append("rect").attr("width",et.rectWidth).attr("height",4).attr("transform",(function(t,e){var n=t.scales.yScale;return n.range([r,0]),"translate(0, "+n(t.values.realVal)+")"})).attr("fill",(function(t){return t.color})).classed("val-bar",!0),o.on("mouseover",(function(t,e,n){var l=t.scales.yScale;l.range([0,r]),a.B(n[e]).append("g").classed("y-axis",!0).call(a.c(l).ticks(5));var i=a.B("#tooltip");i.transition().duration(200).style("opacity",.9);var o=a.n(".3f");i.html("mean: "+o(t.values.realVal)+"</br></br>upperCI: "+o(t.values.upperCI95)+"</br></br>lowerCI: "+o(t.values.lowerCI95)).style("left",a.l.pageX+"px").style("top",a.l.pageY-28+"px"),i.style("height","auto")})).on("mouseout",(function(t,e,n){a.B(n[e]).select("g.y-axis"),a.B(n[e]).select("g.y-axis").remove(),a.B("#tooltip").transition().duration(500).style("opacity",0)})),i}function it(t,e){var n=a.t(t.map((function(t){return t.values.realVal}))),r=t.filter((function(t){return t.values.realVal!=n})),l=t[t.map((function(t){return t.values.realVal})).indexOf(n)];return l.other=r,l.offset=e,l}function ot(t,e){a.B("#show-drop-div-group").attr("value","grouped");var n=a.B("#selected");n.selectAll("*").remove();var r=a.B("#main");r.style("padding-top",0),a.B("#toolbar").append("text").text(t[0].field);var l=[{field:"None"}].concat(e.filter((function(e){return e.field!=t[0].field&&"discrete"===e.type})));y(a.B("#toolbar"),l,"Split On","show-drop-div-group").on("click",(function(r,l,i){if(a.B("#toolbar").append("text").text(r.field),"discrete"===r.type){var u=t.map((function(t){var e=r.scales.map((function(e){var n=e.field,a=e.scaleName,r=t.data.filter((function(t){return t.filter((function(t){return!0===t.leaf}))[0].attributes[n].winState===a}));return{field:n,state:a,data:r}}));return t.data=e,t})),d=a.B("#main");d.selectAll("*").remove(),d.style("padding-top","40px");var f=d.selectAll("div.first-group").data(u).join("div").classed("first-group",!0).append("svg");f.attr("height",(function(t){return 270*t.data.length}));var p=f.append("g"),g=(p.append("text").text((function(t){return t.state})).attr("transform","translate(10, 10)"),p.selectAll("g.second-group").data((function(t){return t.data.map((function(e){var n={};return n.first=[t.field,t.state],n.second=[e.field,e.state],n.data=e.data,n.leaves=e.data.flatMap((function(t){return t.filter((function(t){return!0===t.leaf}))})),n}))})).join("g").classed("second-group",!0));(g=g.filter((function(t){return t.data.length>0}))).attr("transform",(function(t,e){return"translate(30,"+(20+270*e)+")"})),g.each((function(t,n,r){var l=F(t.data,a.B(r[n]));l.select("rect").attr("x",-80).attr("fill","gray"),l.selectAll(".branch-points").selectAll("circle").attr("fill","rgba(255, 255, 255, 0.3)"),l.select(".leaf-label").append("text").text((function(t,e){return": "+t.data.length})).attr("transform","translate(45, 0)"),l.selectAll("text").style("font-size","11.5px").style("fill","#fff"),l.select("line").attr("stroke","#fff");var i=a.B(r[n]).append("g"),o=i.append("g").classed("fas fa-search-plus",!0);o.attr("transform","translate(-10, 15)"),o.append("circle").attr("r",7).attr("fill","#fff"),o.append("text").text("+").attr("transform","translate(-5, 3)").attr("fill","gray"),o.style("cursor","pointer"),o.on("click",(function(){var l=a.C(r).filter((function(t,e){return e!=n}));$(t,l.data(),a.B("#selected"),e)}));var s=i.append("text").text((function(t,e){return t.second[1]}));s.attr("transform",(function(t,e){return"translate(3, 20)"})),s.attr("fill","#fff")}));var m=g.filter((function(t){return t.data.length>0})).append("g").classed("inner-wrap",!0);m.attr("transform",(function(t,e){return"translate(110, 0)"}));var v=m.selectAll(".att-wrapper").data((function(t){var n=h(t.data,e,null);return n[0].map((function(e,a){var r=t.data[0].filter((function(t){return!0===t.leaf}))[0].label;e[e.length-1].offset=0;for(var l={label:e[e.length-1].label,type:e[e.length-1].type,data:[{species:r,paths:e}]},i=1;i<n.length;i++){var o=t.data[i].filter((function(t){return!0===t.leaf}))[0].label,s=n[i][a].length-1;n[i][a][s].offset=8*i,l.data.push({species:o,paths:n[i][a]})}return l})).map((function(t){return t.data=t.data.map((function(e,n){return e.paths=e.paths.map((function(e){if("discrete"===t.type){var a=5*n;return e.states?{realVal:1,state:e.winState,color:e.color,combLength:e.combLength,offset:e.offset,leaf:!0}:it(e,a)}return e})),e})),t.leaves=t.data.flatMap((function(t){return t.paths.filter((function(t){return!0===t.leaf}))})),t}))})).join("g").classed("att-wrapper",!0),y=v.append("rect").attr("width",800);y.attr("height",40),y.style("fill","#fff"),y.style("stroke","gray"),v.attr("transform",(function(t,e){return"translate(0,"+(45*e+30)+")"})),c.attr("transform",(function(t,e){return"translate(60,"+(275*e+50)+")"})),o.attr("height",275*c.data().length+50),v.append("text").text((function(t){return t.label})).style("text-anchor","end").style("font-size",11).attr("transform","translate(-5,25)");var b=v.filter((function(t){return"discrete"===t.type})).selectAll("g.shift-wrap").data((function(t){return[t.data.flatMap((function(t){return t.paths.filter((function(e,n){return 0===n?0===n:n>0?t.paths[n-1].state!=e.state:n<t.paths.length-1?t.paths[n+1].state!=e.state:void 0}))}))]})).join("g").classed("shift-wrap",!0);b.attr("transform","translate(850, 0)");var x=b.append("g").classed("axis-x",!0);x.attr("transform","translate(0, 25)"),x.each((function(t,e,n){var r=a.y().domain([0,s[0]]).range([0,200]);a.B(n[e]).call(a.b(r).ticks(5))}));var w=b.append("g").attr("transform","translate(0, 20)").selectAll("circle.shift").data((function(t){return t})).join("circle").classed("shift",!0);w.attr("r",4).attr("cx",(function(t,e){return a.y().domain([0,s[0]]).range([0,200])(t.combLength)})),w.attr("fill",(function(t){return t.color})).style("opacity",.4);var B=v.filter((function(t){return"continuous"===t.type})).selectAll("g.observe-wrap").data((function(t){var e=v.data().filter((function(e){return e.label===t.label})).flatMap((function(t){return t.leaves.map((function(t){return t.realVal}))})),n=a.t(e),r=a.w(e),l=a.u(e),i=a.y().domain([r,n]).range([0,200]),o=t.leaves.map((function(t,e){return t.index=e,{value:t.realVal,x:i,min:r,max:n,species:t.species}})),s=a.u(o.map((function(t){return t.value})));return[{dotVals:o,x:i,totalMean:l,groupMean:s}]})).join("g").classed("observe-wrap",!0);B.attr("transform","translate(850, 0)");var k=B.append("g").classed("axis-x",!0);k.attr("transform","translate(0, 25)"),k.each((function(t,e,n){a.B(n[e]).call(a.b(t.x).ticks(5))}));B.append("rect").classed("line",!0).attr("transform",(function(t,e){return"translate("+(t.x(t.totalMean)-1.5)+",0)"})).attr("height",25).attr("width",3).attr("fill","red").style("opacity","0.4"),B.append("rect").classed("line",!0).attr("transform",(function(t,e){return"translate("+(t.x(t.groupMean)-1.5)+",0)"})).attr("height",25).attr("width",3).attr("fill","gray").style("opacity","0.4");var A=B.append("g").attr("transform","translate(0, 20)").selectAll("circle").data((function(t){return t.dotVals})).join("circle");A.attr("r",4).attr("cx",(function(t,e){return t.x(t.value)})).style("opacity","0.3"),A.on("mouseover",(function(t,e,n){var r=a.B("#tooltip");r.transition().duration(200).style("opacity",.9);a.n(".3f");r.html(t.species).style("left",a.l.pageX+10+"px").style("top",a.l.pageY-28+"px"),a.B("#sidebar").selectAll(".node--leaf").filter((function(e){return e.data.label===t.species})).classed("selected",!0)})).on("mouseout",(function(t,e,n){a.B(n[e]).classed("selected",!1),A.classed("selected",!1).style("opacity",.3),a.B("#tooltip").transition().duration(500).style("opacity",0),a.B("#sidebar").selectAll(".node--leaf").filter((function(e){return e.data.label===t.species})).classed("selected",!1)}));var C=v.selectAll("g.species").data((function(t){return t.data=t.data.map((function(e){return e.type=t.type,e})),t.data})).join("g").classed("species",!0),V=a.s().x((function(t){return a.y().domain([0,s[0]]).range([0,800])(t.combLength)})).y((function(t){return a.y().domain([0,1]).range([38,1])(t.realVal)})),S=a.s().x((function(t){return a.y().domain([0,s[0]]).range([0,800])(t.combLength)})).y((function(t){var e=t.scales.yScale;return e.range([38,1]),e(t.values.realVal)+2}));C.append("path").attr("d",(function(t){return"discrete"===t.type?V(t.paths):S(t.paths)})).attr("class",(function(t,e){return t.species+" inner-line"})).style("stroke-width",.7).style("fill","none").style("stroke","gray").on("mouseover",(function(t,e,n){a.B(n[e]).classed("selected",!0),A.filter((function(e){return e.species===t.species})).classed("selected",!0).style("opacity",1);var r=a.B("#tooltip");r.transition().duration(200).style("opacity",.9);a.n(".3f");r.html(t.species).style("left",a.l.pageX+10+"px").style("top",a.l.pageY-28+"px"),a.B("#sidebar").selectAll(".node--leaf").filter((function(e){return e.data.label===t.species})).classed("selected",!0)})).on("mouseout",(function(t,e,n){a.B(n[e]).classed("selected",!1),A.classed("selected",!1).style("opacity",.3),a.B("#tooltip").transition().duration(500).style("opacity",0),a.B("#sidebar").selectAll(".node--leaf").filter((function(e){return e.data.label===t.species})).classed("selected",!1)}));var j=C.filter((function(t){return"discrete"===t.type})).selectAll(".branch").data((function(t){return t.paths})).join("g").classed("branch",!0);j.attr("transform",(function(t){return"translate("+a.y().domain([0,1]).range([0,800])(t.combLength)+", 0)"}));var O=j.append("circle").attr("r",5).attr("cy",(function(t,e){return a.y().domain([0,1]).range([35,2])(t.realVal)})).attr("cx",5);O.classed("win-state",!0),O.attr("fill",(function(t,e,n){return 0===e?t.color:e===n.length-1?t.state===a.B(n[e-1]).data()[0].state?"rgba(189, 195, 199, 0.3)":(t.shift=!0,t.color):t.state===a.B(n[e+1]).data()[0].state||t.state===a.B(n[e-1]).data()[0].state?"rgba(189, 195, 199, 0.3)":(t.shift=!0,t.color)}));var D=j.filter((function(t){return 1!=t.leaf})).selectAll(".other").data((function(t){return t.other})).join("circle").classed("other",!0);D.attr("r",4).attr("cx",5).attr("cy",(function(t,e){var n=a.y().domain([1,0]);return n.range([0,35]),n(t.realVal)})).attr("fill","rgba(189, 195, 199, 0.1)"),D.on("mouseover",(function(t){var e=a.B("#tooltip");e.transition().duration(200).style("opacity",.9);var n=a.n(".3f");e.html(t.state+": "+n(t.realVal)).style("left",a.l.pageX+10+"px").style("top",a.l.pageY-28+"px")})).on("mouseout",(function(t){a.B("#tooltip").transition().duration(500).style("opacity",0)})),O.on("mouseover",(function(t){var e=a.B("#tooltip");e.transition().duration(200).style("opacity",.9);var n=a.n(".3f");e.html(t.state+": "+n(t.realVal)).style("left",a.l.pageX+10+"px").style("top",a.l.pageY-28+"px")})).on("mouseout",(function(t){a.B("#tooltip").transition().duration(500).style("opacity",0)})),j.on("mouseover",(function(t,e,n){var r=a.y().domain([1,0]);r.range([0,35]),o.selectAll("path.inner-line."+t.species).attr("stroke","red"),o.selectAll("path.inner-line."+t.species).classed("selected",!0),a.B(n[e]).append("g").classed("y-axis",!0).call(a.c(r).ticks(3)),a.B(n[e]).selectAll(".other").style("opacity",.7).attr("fill",(function(t){return t.color})),a.B(n[e]).selectAll(".win-state").style("opacity",.7).attr("fill",(function(t){return t.color}))})).on("mouseout",(function(t,e,n){a.B(n[e]).select("g.y-axis"),a.B(n[e]).select("g.y-axis").remove(),a.C("path.inner-line."+t.species).attr("stroke","gray"),a.C("path.inner-line."+t.species).classed("selected",!1),a.C(".other").attr("fill","rgba(189, 195, 199, 0.1)"),a.B(n[e]).selectAll(".win-state").filter((function(t){return 1!=t.shift})).attr("fill","rgba(189, 195, 199, 0.3)")}));var M=C.filter((function(t){return"continuous"===t.type})).selectAll(".branch").data((function(t){return t.paths})).join("g").classed("branch",!0);M.attr("transform",(function(t){return"translate("+a.y().domain([0,1]).range([0,800])(t.combLength)+", 0)"})),M.on("mouseover",(function(t,e,n){var r=t.yScale;r.range([0,35]),o.selectAll("path.inner-line."+t.species).attr("stroke","red"),o.selectAll("path.inner-line."+t.species).classed("selected",!0),a.B(n[e]).append("g").classed("y-axis",!0).call(a.c(r).ticks(3)),a.B(n[e]).selectAll(".other").style("opacity",.7)})).on("mouseout",(function(t,e,n){a.B(n[e]).select("g.y-axis"),a.B(n[e]).select("g.y-axis").remove(),a.C("path.inner-line."+t.species).attr("stroke","gray"),a.C("path.inner-line."+t.species).classed("selected",!1),a.C(".other").style("opacity",.1)}));var L=M.append("rect");L.attr("width",et.rectWidth).attr("height",3),L.attr("y",(function(t,n){var r=e.filter((function(e){return e.field===t.label}))[0];return a.y().domain([r.min,r.max]).range([40,0])(t.realVal)}));var I=M.filter((function(t){return 1!=t.leaf})).append("rect");I.attr("width",et.rectWidth).attr("height",(function(t,n){var r=e.filter((function(e){return e.field===t.label}))[0],l=a.y().domain([r.min,r.max]).range([40,0]);return l(t.lowerCI95)-l(t.upperCI95)})),I.attr("y",(function(t,n){var r=e.filter((function(e){return e.field===t.label}))[0];return a.y().domain([r.min,r.max]).range([40,0])(t.upperCI95)})),I.style("opacity",.1)}else console.error("THIS HAS TO BE DISCRETE");n.select("#show-drop-div-group").classed("show",!1)}));var i=r.select("#main-path-view"),o=i.empty()?r.append("svg").attr("id","main-path-view"):i;o.selectAll("*").remove(),o.attr("height",60*t.length),o.append("g").attr("transform","translate(500, 40)").append("text").text(t[0].field);var c=o.selectAll(".grouped").data(t).join("g").classed("grouped",!0);c.each((function(t,e,n){var r=F(t.data,a.B(n[e]));r.select("rect").attr("x",-80).attr("fill","gray"),r.selectAll(".branch-points").selectAll("circle").attr("fill","rgba(255, 255, 255, 0.3)"),r.select(".leaf-label").append("text").text((function(t,e){return": "+t.data.length})).attr("transform","translate(45, 0)"),r.selectAll("text").style("font-size","11.5px").style("fill","#fff"),r.select("line").attr("stroke","#fff")}));var u=c.append("g"),d=u.append("g").classed("fas fa-search-plus",!0);d.attr("transform","translate(20, -5)"),d.append("circle").attr("r",7).attr("fill","#fff"),d.append("text").text("+").attr("transform","translate(5, 3)").attr("fill","gray"),d.style("cursor","pointer"),d.on("click",(function(t,n,r){$(t,a.C(r).filter((function(t,e){return e!=n})).data(),a.B("#selected"),e)})),u.append("text").text((function(t,e){return t.state})),u.attr("transform",(function(t,e){return"translate(40, 16)"})),u.style("text-anchor","end"),u.attr("fill","#fff");var f=c.append("g").classed("inner-wrap",!0);f.attr("transform",(function(t,e){return"translate(110, 0)"}));var p=f.selectAll(".att-wrapper").data((function(t,n){var a=h(t.data,e,null);return a[0].map((function(e,n){var r=t.data[0].filter((function(t){return!0===t.leaf}))[0].label;e[e.length-1].offset=0;for(var l={label:e[e.length-1].label,type:e[e.length-1].type,data:[{species:r,paths:e}]},i=1;i<a.length;i++){var o=t.data[i].filter((function(t){return!0===t.leaf}))[0].label,s=a[i][n].length-1;a[i][n][s].offset=8*i,l.data.push({species:o,paths:a[i][n]})}return l})).map((function(t){return t.data=t.data.map((function(e,n){return e.paths=e.paths.map((function(e){if("discrete"===t.type){var a=5*n;return e.states?{realVal:1,state:e.winState,color:e.color,combLength:e.combLength,offset:e.offset,leaf:!0}:it(e,a)}return e})),e})),t}))})).join("g").classed("att-wrapper",!0),g=p.append("rect").attr("width",800);g.attr("height",40),g.style("fill","#fff"),g.style("stroke","gray"),p.attr("transform",(function(t,e){return"translate(0,"+(45*e+30)+")"})),c.attr("transform",(function(t,e){return"translate(60,"+(275*e+50)+")"})),o.attr("height",275*c.data().length+50),function(t,e){var n=t.filter((function(t){return"continuous"===t.type})).selectAll("g.observe-wrap-first.continuous").data((function(e){var n=t.data().filter((function(t){return t.label===e.label})).map((function(t){return t.data})).flatMap((function(t){return t.flatMap((function(t){return t.paths[t.paths.length-1].realVal}))})),r=a.t(n),l=a.w(n),i=a.u(n),o=a.y().domain([l,r]).range([0,200]),s=e.data.map((function(t,e){return t.index=e,{value:t.paths[t.paths.length-1].values.realVal,x:o,min:l,max:r,species:t.species}})),c=a.u(s.map((function(t){return t.value})));return[{dotVals:s,x:o,totalMean:i,groupMean:c}]})).join("g").classed("observe-wrap-first continuous",!0);n.attr("transform","translate(850, 0)");var r=n.append("g").classed("axis-x",!0);r.attr("transform","translate(0, 25)"),r.each((function(t,e,n){a.B(n[e]).call(a.b(t.x).ticks(5))})),n.append("rect").classed("line",!0).attr("transform",(function(t,e){return"translate("+(t.x(t.totalMean)-1.5)+",0)"})).attr("height",25).attr("width",3).attr("fill","red").style("opacity","0.4"),n.append("rect").classed("line",!0).attr("transform",(function(t,e){return"translate("+(t.x(t.groupMean)-1.5)+",0)"})).attr("height",25).attr("width",3).attr("fill","gray").style("opacity","0.4"),n.append("g").attr("transform","translate(0, 20)").selectAll("circle").data((function(t){return t.dotVals})).join("circle").attr("r",4).attr("cx",(function(t,e){return t.x(t.value)})).style("opacity","0.3");var l=t.filter((function(t){return"discrete"===t.type})).selectAll("g.observe-wrap-first.discrete").data((function(t){return[t]})).join("g").classed("observe-wrap-first discrete",!0),i=l.filter((function(t){return t.label!=e})).selectAll("rect").data((function(t){var e=_.a(t.data.map((function(t){return t.paths[t.paths.length-1]})),(function(t){return t.state}));return e.sort((function(t,e){return e[1].length-t[1].length})),e})).join("rect").attr("height",15).attr("width",(function(t,e,n){var r=a.y().domain([0,a.D(a.C(n).data().map((function(t){return t[1].length})))]).range([5,170]);return t.width=r(t[1].length),r(t[1].length)}));i.attr("x",(function(t,e,n){return 0===e?0:(a.C(n).filter((function(t,n){return n<e})),a.D(a.C(n).filter((function(t,n){return n<e})).data().map((function(t){return t.width}))))})).attr("y",12),i.attr("fill",(function(t){return t[1][0].color})),i.on("mouseover",(function(t,e,n){var r=a.B("#tooltip");r.transition().duration(200).style("opacity",.9),r.html(t[0]+"</br>"+t[1].length).style("left",a.l.pageX+10+"px").style("top",a.l.pageY+20+"px"),a.C(n).filter((function(t,n){return n!=e})).attr("opacity",.3)})).on("mouseout",(function(t,e,n){a.B("#tooltip").transition().duration(500).style("opacity",0),a.C(n).filter((function(t,n){return n!=e})).attr("opacity",1)})),l.attr("transform","translate(850, 0)");var o=l.filter((function(t){return t.label===e})).selectAll("text").data((function(t){return[t]})).join("text").text((function(t){var e=t.data[t.data.length-1].paths;return"".concat(e[e.length-1].state,": ").concat(t.data.length," / ").concat(100)}));o.style("text-anchor","middle"),o.style("font-size","12px"),o.attr("x",90).attr("y",25)}(p,t[0].field),p.append("text").text((function(t){return t.label})).style("text-anchor","end").style("font-size",11).attr("transform","translate(-5,25)");var m=p.selectAll("g.species").data((function(t){return t.data=t.data.map((function(e){return e.type=t.type,e})),t.data})).join("g").classed("species",!0),v=a.s().x((function(t){return a.y().domain([0,s[0]]).range([0,800])(t.combLength)})).y((function(t){return a.y().domain([0,1]).range([38,1])(t.values.realVal)})),b=a.s().x((function(t){return a.y().domain([0,1]).range([0,800])(t.combLength)})).y((function(t){var e=t.yScale;return e.range([38,1]),e(t.values.realVal)+2}));m.append("path").attr("d",(function(t){return"discrete"===t.type?v(t.paths):b(t.paths)})).attr("class",(function(t,e){return t.species+" inner-line"})).style("stroke-width",.7).style("fill","none").style("stroke","gray").on("mouseover",(function(t,e,n){a.B(n[e]).classed("selected",!0)})).on("mouseout",(function(t,e,n){a.B(n[e]).classed("selected",!1)}));var x=m.filter((function(t){return"discrete"===t.type})).selectAll(".branch").data((function(t){return t.paths})).join("g").classed("branch",!0);x.attr("transform",(function(t){return"translate("+a.y().domain([0,s[0]]).range([0,800])(t.combLength)+", 0)"}));var w=x.append("circle").attr("r",5).attr("cy",(function(t,e){return a.y().domain([0,1]).range([35,2])(t.values.realVal)})).attr("cx",5);w.classed("win-state",!0),w.attr("fill",(function(t,e,n){return 0===e||e===n.length-1?t.color:t.state===a.B(n[e+1]).data()[0].state||t.state===a.B(n[e-1]).data()[0].state?"rgba(189, 195, 199, 0.3)":(t.shift=!0,t.color)}));var B=x.filter((function(t){return 1!=t.leaf})).selectAll(".other").data((function(t){return t.other})).join("circle").classed("other",!0);B.attr("r",4).attr("cx",5).attr("cy",(function(t,e){var n=a.y().domain([1,0]);return n.range([0,35]),n(t.realVal)})).attr("fill","rgba(189, 195, 199, 0.1)"),B.on("mouseover",(function(t){var e=a.B("#tooltip");e.transition().duration(200).style("opacity",.9);var n=a.n(".3f");e.html(t.state+": "+n(t.realVal)).style("left",a.l.pageX+10+"px").style("top",a.l.pageY-28+"px")})).on("mouseout",(function(t){a.B("#tooltip").transition().duration(500).style("opacity",0)})),w.on("mouseover",(function(t){var e=a.B("#tooltip");e.transition().duration(200).style("opacity",.9);var n=a.n(".3f");e.html(t.state+": "+n(t.realVal)).style("left",a.l.pageX+10+"px").style("top",a.l.pageY-28+"px")})).on("mouseout",(function(t){a.B("#tooltip").transition().duration(500).style("opacity",0)})),x.on("mouseover",(function(t,e,n){var r=a.y().domain([1,0]);r.range([0,35]),o.selectAll("path.inner-line."+t.species).attr("stroke","red"),o.selectAll("path.inner-line."+t.species).classed("selected",!0),a.B(n[e]).append("g").classed("y-axis",!0).call(a.c(r).ticks(3)),a.B(n[e]).selectAll(".other").style("opacity",.7).attr("fill",(function(t){return t.color})),a.B(n[e]).selectAll(".win-state").style("opacity",.7).attr("fill",(function(t){return t.color}))})).on("mouseout",(function(t,e,n){a.B(n[e]).select("g.y-axis"),a.B(n[e]).select("g.y-axis").remove(),a.C("path.inner-line."+t.species).attr("stroke","gray"),a.C("path.inner-line."+t.species).classed("selected",!1),a.C(".other").attr("fill","rgba(189, 195, 199, 0.1)"),a.B(n[e]).selectAll(".win-state").filter((function(t){return 1!=t.shift})).attr("fill","rgba(189, 195, 199, 0.3)")}));var k=m.filter((function(t){return"continuous"===t.type})).selectAll(".branch").data((function(t){return t.paths})).join("g").classed("branch",!0);k.attr("transform",(function(t){return"translate("+a.y().domain([0,s[0]]).range([0,800])(t.combLength)+", 0)"})),k.on("mouseover",(function(t,e,n){var r=t.yScale;r.range([0,35]),o.selectAll("path.inner-line."+t.species).attr("stroke","red"),o.selectAll("path.inner-line."+t.species).classed("selected",!0),a.B(n[e]).append("g").classed("y-axis",!0).call(a.c(r).ticks(3)),a.B(n[e]).selectAll(".other").style("opacity",.7)})).on("mouseout",(function(t,e,n){a.B(n[e]).select("g.y-axis"),a.B(n[e]).select("g.y-axis").remove(),a.C("path.inner-line."+t.species).attr("stroke","gray"),a.C("path.inner-line."+t.species).classed("selected",!1),a.C(".other").style("opacity",.1)}));var A=k.append("rect");A.attr("width",et.rectWidth).attr("height",3),A.attr("y",(function(t,n){var r=e.filter((function(e){return e.field===t.label}))[0];return a.y().domain([r.min,r.max]).range([40,0])(t.realVal)}));var C=k.filter((function(t){return 1!=t.leaf})).append("rect");C.attr("width",et.rectWidth).attr("height",(function(t,n){var r=e.filter((function(e){return e.field===t.label}))[0],l=a.y().domain([r.min,r.max]).range([40,0]);return l(t.lowerCI95)-l(t.upperCI95)})),C.attr("y",(function(t,n){var r=e.filter((function(e){return e.field===t.label}))[0];return a.y().domain([r.min,r.max]).range([40,0])(t.upperCI95)})),C.style("opacity",.1),a.C(".att-wrapper").selectAll(".branch").on("mouseover",(function(t,e,n){a.B("#sidebar").selectAll(".node").filter((function(e){return t.node===e.data.node})).classed("selected",!0)})).on("mouseout",(function(t,e,n){a.B("#sidebar").selectAll(".node").filter((function(e){return t.node===e.data.node})).classed("selected",!1)}))}function st(t,e,n){var r=t.filter((function(t){return"discrete"===t[t.length-1].type})),l="true"===e?20:45,i=r.append("g").classed("attribute-time-line",!0);i.append("line").classed("half",!0).attr("x1",0).attr("y1",22).attr("x2",1010).attr("y2",22);var o=i.selectAll("g").data((function(t){var e=t;return e[0].map((function(t){return t.state})).map((function(t){return e.map((function(e){return e.leaf?e:e.filter((function(e){return e.state==t}))[0]}))}))})).join("g").classed("state-path",!0),c=a.s().x((function(t){return a.y().domain([0,s[0]]).range([0,1e3])(t.combLength)+7})).y((function(t){var e=a.y().domain([0,1]).range([l-2,1]);return t.value?e(t.value):e(1)}));o.append("path").attr("d",c).attr("class",(function(t,e){return t[0].species+" inner-line"})).style("stroke-width",.7).style("stroke",(function(t){return t[0].color}));i.append("rect").classed("attribute-rect",!0).attr("height",l);var u=i.selectAll(".attribute-node-discrete").data((function(t){return t})).join("g");if(u.attr("transform",(function(t){var e=a.y().domain([0,s[0]]).range([0,1e3]);return t[0]?"translate("+e(t[0].combLength)+", 0)":"translate("+e(t.combLength)+", 0)"})),u.append("rect").attr("width",et.rectWidth).attr("height",l).attr("opacity",0),u.append("line").attr("x1",10).attr("x2",10).attr("y1",0).attr("y2",l),u.on("mouseover",(function(t,e,n){var r=a.y().domain([1,0]);r.range([0,l]),a.B(n[e]).append("g").classed("y-axis",!0).call(a.c(r).ticks(3))})).on("mouseout",(function(t,e,n){a.B(n[e]).select("g.y-axis"),a.B(n[e]).select("g.y-axis").remove()})),u.attr("class",(function(t,e,n){var r=a.C(n).data();return r[r.length-1].species})).classed("attribute-node-discrete",!0),!1===n){var d=u.filter((function(t,e){return null!=t[0]})).selectAll(".dots").data((function(t){return t})).join("circle").classed("dots",!0);d.attr("cx",10).attr("cy",(function(t){var e=a.y().domain([0,1]).range([l-2,2]);return t.realVal?e(t.realVal):e(t.value)})).attr("r",2),d.style("fill",(function(t,e,n){return"gray"})),d.filter((function(t){return t.realVal>.5})).attr("r",4),d.on("mouseover",(function(t){var e=a.B("#tooltip");e.transition().duration(200).style("opacity",.9);var n=a.n(".3f");e.html(t.state+": "+n(t.realVal)).style("left",a.l.pageX+"px").style("top",a.l.pageY-28+"px")})).on("mouseout",(function(t){a.B("#tooltip").transition().duration(500).style("opacity",0)}));var f=u.filter((function(t,e){return void 0===t[0]})).classed("discrete-leaf",!0);f.append("circle").attr("cx",10).attr("cy",2).attr("r",7).style("fill",(function(t){return t.color})),f.append("text").text((function(t){return t.winState})).attr("transform","translate(20, 5)").style("font-size",10)}else{u.filter((function(t,e){return null!=t[0]})).append("rect").attr("height",l).attr("width",et.rectWidth).attr("fill","#fff");var p=u.filter((function(t,e){return null!=t[0]})).selectAll(".dis-rect").data((function(t){return t})).join("rect").classed("dis-rect",!0);p.attr("width",et.rectWidth).attr("height",(function(t,e){return a.y().domain([0,1]).range([0,l])(t.realVal)})),p.attr("fill",(function(t,e){return t.color})),p.attr("opacity","0.7"),p.attr("stroke","#fff"),p.attr("transform",(function(t,e,n){var r=a.y().domain([0,1]).range([0,l]),i=a.C(n).data().sort((function(t,e){return e.realVal-t.realVal})),o=i.map((function(t){return t.state})).indexOf(t.state);if(0===o)return"translate(0,0)";for(var s=0,c=0;c<o;c++)s+=i[c].realVal;return"translate(0,"+r(s)+")"})),p.on("mouseover",(function(t){var e=a.B("#tooltip");e.transition().duration(200).style("opacity",.9);var n=a.n(".3f");e.html(t.state+": "+n(t.realVal)).style("left",a.l.pageX+"px").style("top",a.l.pageY-28+"px")})).on("mouseout",(function(t){a.B("#tooltip").transition().duration(500).style("opacity",0)}));var h=u.filter((function(t,e){return void 0===t[0]})).classed("discrete-leaf",!0);h.append("circle").attr("cx",10).attr("cy",2).attr("r",7).style("fill",(function(t){return t.color})),h.append("text").text((function(t){return t.winState})).attr("transform","translate(20, 5)").style("font-size",10)}return u}n(169);var ct=n(134);function ut(t,e,n){var r=[{field:"Summary View"},{field:"Path View"},{field:"Pair View"},{field:"Clade View"}];y(t,r,r[0].field,"change-view").on("click",(function(t,e,n){var r=B[B.length-1];pt(t.field,r.groups),a.B(".dropdown.change-view").select("button").node().value=t.field,a.B(".dropdown.change-view").select("button").text(t.field),a.B("#change-view").classed("show",!1)}));var l=t.append("button").attr("id","view-filter");l.attr("class","btn btn-outline-secondary").text("Show Filters"),l.on("click",(function(){return function(t,e,n){console.log(t,e,n);var r=a.B("#filter-tab"),l=yt();r.classed("hidden")?(t.text("Hide Filters"),r.classed("hidden",!1),e.style("padding-top","200px"),function(t,e,n,r,l,i){var o=["Select a Trait"].concat(Object.keys(n[0][0].attributes)),s=t.append("div").classed("filter-wrap",!0);s.style("width","200px"),s.append("h6").text("State Transition:");var c=kt(s,o,"attr-select",""),u=s.append("div").classed("attribute-properties",!0);c.on("change",(function(n){var l=a.B(this).property("value"),o=i.filter((function(t){return t.field===l}))[0];if(u.selectAll("*").remove(),"discrete"===o.type){var s=["Any"],c=o.scales.map((function(t){return t.scaleName}));s=s.concat(c);var d=kt(u,s,"predicted-state","From"),f=kt(u,s,"observed-state","To"),p=u.append("button").classed("btn btn-outline-success",!0);p.text("Filter"),p.on("click",(function(){var n=d.node().classList[0],o=f.node().classList[0],s=(gt.filter((function(t){return"data-filter"===t.filterType})),yt()),c=Bt(s,l,n,o),u=vt("data-filter","discrete","d-"+gt.filter((function(t){return"discrete"===t.attributeType})).length,Bt,ht(s),ht(c),[["state",[n,o]],["selectedOption",l]]);pt("Summary View");var p=a.B("#sidebar").selectAll(".link"),h=a.B("#sidebar").selectAll(".node"),g=c.flatMap((function(t){return t.map((function(t){return t.node}))}));a.C(".link-not-there").classed("link-not-there",!1),a.C(".node-not-there").classed("node-not-there",!1),p.filter((function(t){return-1===g.indexOf(t.data.node)})).classed("link-not-there",!0),h.filter((function(t){return-1===g.indexOf(t.data.node)})).classed("node-not-there",!0),bt(u,i),e.text("Show Filters"),t.selectAll("*").remove(),t.classed("hidden",!0),r.style("padding-top","0px")}))}else{var h=a.y().domain([o.min,o.max]).range([60,0]),g=u.append("svg");g.attr("width",200).attr("height",100);var m=g.selectAll(".range").data([{label:"Ancestors",type:"predicted"},{label:"Leaves",type:"observed"}]).join("g").classed("range",!0);m.attr("transform",(function(t,e){return"translate("+125*e+",20)"}));var v=m.append("g");v.attr("transform","translate(10, 10)"),m.append("text").text((function(t){return t.label+": "})).attr("x",0).attr("y",0),v.append("rect").attr("width",20).attr("height",50).attr("x",10),v.append("g").attr("class","axis axis--y").attr("transform","translate(10,0)").call(a.c(h).ticks(3));var y=a.e().extent([[10,0],[30,60]]).on("end",(function(){var t=a.l.selection;if(null==t)handle.attr("display","none");else t.map(h.invert)})),b=v.append("g").call(y);b.call(y.move,[0,60]);var x=u.append("button").classed("btn btn-outline-success",!0);x.text("Filter"),x.on("click",(function(){var n=b._groups[0].map((function(t){return t.__brush.selection.map((function(t){return t[1]}))})),o=n[0].map(h.invert).sort(),s=n[1].map(h.invert).sort(),c=gt.filter((function(t){return"data-filter"===t.filterType})),u=c.length>0?c[c.length-1].data:It[0],d=wt(u,l,o,s),f=vt("data-filter","continuous","c-"+gt.filter((function(t){return"continuous"===t.attributeType})).length,wt,ht(u),ht(d),[["selectedOption",l],["predictedFilter",o],["observedFilter",s]]);pt("Summary View"),bt(f,i);var p=a.B("#sidebar").selectAll(".link"),g=a.B("#sidebar").selectAll(".node"),m=d.flatMap((function(t){return t.map((function(t){return t.node}))}));a.C(".link-not-there").classed("link-not-there",!1),a.C(".node-not-there").classed("node-not-there",!1),p.filter((function(t){return-1===m.indexOf(t.data.node)})).classed("link-not-there",!0),g.filter((function(t){return-1===m.indexOf(t.data.node)})).classed("node-not-there",!0),e.text("Show Filters"),t.selectAll("*").remove(),t.classed("hidden",!0),r.style("padding-top","0px")}))}}))}(r,t,l,e),function(t,e,n,r,l){var i=t.append("div").classed("search-bar-div",!0);i.append("h6").text("Query Filter:");var o=i.append("form").classed("form-inline",!0),s=o.append("input").classed("form-control mr-sm-2",!0);s.attr("type","search").attr("placeholder","Search by Species").attr("aria-label","Search"),o.append("button").classed("btn btn-outline-success my-2 my-sm-0",!0).attr("type","button").append("i").classed("fas fa-search",!0).on("click",(function(){var l=s.node().value.split(" ").map((function(t){return t.toLowerCase()})),i=n.filter((function(t){var e=t.filter((function(t){return!0===t.leaf}))[0].label;return l.indexOf(e)>-1}));pt("Summary View");var o=a.B("#toolbar").append("button").classed("btn btn-info",!0);o.append("span").classed("badge badge-light",!0).text(i.length),o.append("h6").text("Query Filter"),o.append("i").classed("close fas fa-times",!0).on("click",(function(){pt("Summary View"),o.remove()})),a.B("#main-path-view").style("height",(function(){return 60*i.length+100*Object.keys(i[0][0].attributes).length+"px"})),e.text("Show Filters"),t.selectAll("*").remove(),t.classed("hidden",!0),r.style("padding-top","0px")}))}(r,t,l,e)):(t.text("Show Filters"),r.selectAll("*").remove(),r.classed("hidden",!0),e.style("padding-top","0px"))}(l,e,n)}));var i=t.append("button").attr("id","scrunch");i.attr("class","btn btn-outline-secondary").text("Collapse Attributes"),i.attr("value",!1),i.on("click",(function(){return function(t,e,n){var a=yt();"Collapse Attributes"===t.text()?(t.text("Expand Attributes"),e.selectAll("*").remove(),t.attr("value",!0),nt(a,e,n)):(t.text("Collapse Attributes"),e.selectAll("*").remove(),t.attr("value",!1),nt(a,e,n))}(i,e,n)}));var o=t.append("button").attr("id","discrete-view");o.attr("class","btn btn-outline-secondary").text("Switch to Discrete Bars"),o.attr("value",!1),o.on("click",(function(){var t=a.C(".predicated-attr-groups");"Switch to Discrete Bars"===o.text()?(o.text("Switch to Discrete Dots"),st(t,zt,!0)):(o.text("Switch to Discrete Bars"),st(t,zt,!1))}));var s=[{field:"None"}];n.map((function(t){"discrete"===t.type&&s.push(t)}));var c=y(t,s,"Group By","show-drop-div-group");t.select("#show-drop-div-group").attr("value","ungrouped"),a.B(".dropdown.show-drop-div-group").select("button").style("display","none"),c.on("click",(function(e,r,l){if("discrete"===e.type){var i=yt(),o=e.scales.map((function(t){return{field:t.field,state:t.scaleName,data:[]}}));o.map((function(t){t.data=i.filter((function(e){return e.filter((function(t){return!0===t.leaf}))[0].attributes[t.field].winState===t.state}))})),a.B("#main").selectAll("*").remove(),ot(o,n)}else console.error("THIS HAS TO BE DISCRETE");t.select("#show-drop-div-group").classed("show",!1)}));var u=n.map((function(t){return t.field})),f=u.length>11?u.slice(0,8):u,p=t.append("div").classed("dropdown attribute-show",!0);p.style("display","inline-block");var h=p.append("button").classed("btn dropbtn btn-secondary dropdown-toggle",!0).text("Shown Attributes"),g=p.append("div").attr("id","attribute-show").classed("dropdown-content",!0),m=g.append("ul").selectAll("li").data(u).join("li");m.append("input").attr("type","checkbox");m.append("text").text((function(t){return" ".concat(t)})),m.filter((function(t){return f.indexOf(t)>-1})).select("input").each((function(t,e,n){return n[e].checked=!0})),h.on("click",(function(t,e,n){g.classed("show")?(g.classed("show",!1),pt("Summary View",B[B.length-1].groups)):g.classed("show",!0)}));y(t,w,"Clades Shown: ".concat(w[0].field),"change-clade");a.B("#change-clade").selectAll("a").on("click",(function(t,e,n){a.B(".dropdown.change-clade").select("button").text("Clades Shown: ".concat(t.field)),B.push(t),pt("Summary View",t.groups)})),0===w.length&&a.B(".dropdown.change-clade").select("button").text(d.field)}function dt(t){return function(t){if(Array.isArray(t)){for(var e=0,n=new Array(t.length);e<t.length;e++)n[e]=t[e];return n}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function ft(t,e,n){console.log("pairs",t,e);var r=a.t(dt(t).map((function(t){return t.deltas.filter((function(t){return t.key===e}))[0]})).map((function(t){return t.value}))),l=a.t(dt(t).map((function(t){return t.closeness.filter((function(t){return t.key===e}))[0]})).map((function(t){return t.value}))),i=a.t(dt(t).map((function(t){return t.distance}))),o=a.y().domain([0,r]).range([0,1]),c=a.y().domain([l,0]).range([0,1]),u=a.y().domain([0,i]).range([0,1]),d=dt(t).map((function(t){return t.delta=t.deltas.filter((function(t){return t.key===e}))[0],t.closeness=t.closeness.filter((function(t){return t.key===e}))[0],t.deltaRank=o(t.delta.value),t.closenessRank=c(t.closeness.value),t.distanceRank=u(t.distance),t.totalRank=n[0]*t.distanceRank+n[1]*t.deltaRank+n[2]*t.closenessRank,t})).sort((function(t,e){return e.totalRank-t.totalRank})).slice(0,40);!function(t,e){var n=this,r=["#FF5733","#129BF5"],l=(o=a.B("#toolbar").selectAll(".brush-span"),c=[],o.each((function(t){return c.push(t)})),c.flatMap((function(t){return t.nodes}))),i=a.y().domain([0,s[0]]).range([0,600]);var o,c;a.B("#main").selectAll("*").remove();var u=a.B("#main").append("svg");u.attr("height",150*t.length);var d=u.append("g");d.attr("transform","translate(20, 100)");var f=d.selectAll("g.pair-wrap").data(t).join("g").classed("pair-wrap",!0);f.attr("transform",(function(t,e){return"translate(50,".concat(150*e,")")})),f.append("rect").attr("width",(function(t,e){return 600-i(t.common.combLength)})).attr("height",100).attr("x",(function(t){return i(t.common.combLength)})).attr("stroke-width",1).attr("stroke","black").attr("fill","#fff"),f.append("text").text((function(t,e){return"".concat(t.p1[t.p1.length-1].node," + ").concat(t.p2[t.p2.length-1].node)})).attr("y",-10);var p=f.append("g").classed("score-wrap",!0),h=p.selectAll("g.score").data((function(t,e){return[{label:"Distance",value:t.distance,score:t.distanceRank},{label:"Delta",value:t.delta.value,score:t.deltaRank},{label:"Closeness",value:t.closeness.value,score:t.closenessRank}]})).join("g").classed("score",!0),g=p.append("g").attr("transform","translate(650, 10)");g.append("rect").attr("width",200).attr("height",40).attr("fill","gray").attr("y",45).attr("opacity",.1),g.append("text").text("Score").attr("y",20).style("text-anchor","end").style("font-size",11),g.append("text").text("Value").attr("y",40).style("text-anchor","end").style("font-size",11),g.append("text").text("Total Score").attr("y",60).attr("x",95).style("text-anchor","end").style("font-size",11),g.append("text").text("Rank").attr("y",80).attr("x",95).style("text-anchor","end").style("font-size",11),h.attr("transform",(function(t,e,n){return"translate(".concat(0===e?670:660+a.D(a.C(n).filter((function(t,n){return e>n})).data().map((function(t){return 6*t.label.length})))+30*e,",0)")}));var m=a.n(".3n");h.append("text").text((function(t,e){return t.label})).style("font-size",10).attr("y",10),h.append("text").text((function(t,e){return m(t.score)})).style("font-size",10).attr("y",30),h.append("text").text((function(t,e){return m(t.value)})).style("font-size",10).attr("y",50),g.append("text").text((function(t,e,n){return m(t.closenessRank+t.distanceRank+t.deltaRank)})).style("font-size",10).attr("y",60).attr("x",115),g.append("text").text((function(t,e){return e+1})).style("font-size",10).attr("y",80).attr("x",115);var v=a.s().x((function(t){return a.y().domain([0,s[0]]).range([0,600])(t.combLength)})).y((function(t){var n=t.attributes[e].scales.yScale;return n.range([100,0]),n(t.attributes[e].values.realVal)})),y=f.selectAll("g.pair-neighbor").data((function(t,e,n){var r=t.p1.map((function(t){return t.node})),l=t.p2.map((function(t){return t.node})),i=dt(t.p1.filter((function(t){return!0===t.leaf})).map((function(t){return t.node}))).concat(t.p2.filter((function(t){return!0===t.leaf})).map((function(t){return t.node}))).flatMap((function(t){var e=Rt[0].indexOf(t);return Rt[0].filter((function(t,n){return n<+e+2&&n>+e-2}))})),o=[r[r.length-1],l[l.length-1]],s=dt(It[0].filter((function(t){return i.indexOf(t[t.length-1].node)>-1&&-1===o.indexOf(t[t.length-1].node)}))).map((function(t){var e=t[t.length-1].node;return t.map((function(t){return t.name=e,t}))})),c=s.map((function(t){return t.filter((function(t){return r.indexOf(t.node)>-1}))})),u=s.map((function(t){return t.filter((function(t){return l.indexOf(t.node)>-1}))})),d=c.filter((function(t,e,n){var r=a.t(n.map((function(t){return t.length})));return t.length===r}))[0],f=u.filter((function(t,e,n){var r=a.t(n.map((function(t){return t.length})));return t.length===r}))[0];return[s.filter((function(t){return t[t.length-1].node===d[d.length-1].name}))[0],s.filter((function(t){return t[t.length-1].node===f[f.length-1].name}))[0]]})).join("g").classed("pair-neighbor",!0).attr("opacity",0),b=(y.append("path").attr("d",v).attr("class","inner-line-n").attr("fill","none").attr("stroke-width",1).style("stroke","rgba(160, 141, 184, .9)"),y.selectAll("g.branch-n").data((function(t){return t})).join("g").classed("branch-n",!0));b.attr("transform",(function(t,e){return"translate(".concat(i(t.combLength),", 0)")})),b.filter((function(t){return 1!=t.leaf})).append("rect").attr("width",10).attr("height",(function(t){var n=t.attributes[e].scales.yScale;return n(t.attributes[e].values.lowerCI95)-n(t.attributes[e].values.upperCI95)})).attr("fill","rgba(160, 141, 184, .2)").attr("y",(function(t,n){return(0,t.attributes[e].scales.yScale)(t.attributes[e].values.upperCI95)})),b.append("rect").attr("width",10).attr("height",4).attr("y",(function(t,n){return t.attributes[e].scales.yScale(t.attributes[e].values.realVal)-2})).attr("opacity",.5),b.filter((function(t,e,n){return e===n.length-1})).append("text").text((function(t){return t.node})).attr("fill","rgba(160, 141, 184, 1)").attr("y",(function(t,n){return(0,t.attributes[e].scales.yScale)(t.attributes[e].values.realVal)-4})).attr("x",3).style("font-size",10);var x=f.selectAll("g.pair").data((function(t){return[t.p1,t.p2]})).join("g").classed("pair",!0),w=(x.append("path").attr("d",v).attr("class","inner-line").style("stroke",(function(t,e){return r[e]})).filter((function(t){return t.filter((function(t){return l.map((function(t){return t.node})).indexOf(t.node)>-1})).length>0})).style("stroke","#64B5F6").style("stroke-width","5px"),x.selectAll("g.branch").data((function(t){return t})).join("g").classed("branch",!0));w.attr("transform",(function(t,e){return"translate(".concat(i(t.combLength),", 0)")})),w.filter((function(t){return 1!=t.leaf})).append("rect").classed("range",!0).attr("width",10).attr("height",(function(t){var n=t.attributes[e].scales.yScale;return n(t.attributes[e].values.lowerCI95)-n(t.attributes[e].values.upperCI95)})).attr("fill","rgba(165, 185, 198, .5)").attr("y",(function(t,n){return(0,t.attributes[e].scales.yScale)(t.attributes[e].values.upperCI95)}));w.filter((function(t){return l.map((function(t){return t.node})).indexOf(t.node)>-1})).selectAll("rect.range").attr("fill","#64B5F6");w.append("rect").attr("width",10).attr("height",4).attr("y",(function(t,n){return t.attributes[e].scales.yScale(t.attributes[e].values.realVal)-2})),f.append("rect").attr("width",(function(t,e){return i(t.common.combLength)})).attr("height",100).attr("fill","#fff").style("opacity",.7);f.append("g").classed("y-axis",!0);var B=f.append("g").classed("x-axis",!0);B.call(a.b(i).ticks(10)),B.attr("transform","translate(0, ".concat(100,")")),f.on("mouseover",(function(t,e,r){var l=t.p1.map((function(t){return t.node})),i=t.p2.map((function(t){return t.node})),o=dt(t.p1.filter((function(t){return!0===t.leaf})).map((function(t){return t.node}))).concat(t.p2.filter((function(t){return!0===t.leaf})).map((function(t){return t.node}))).flatMap((function(t){var e=Rt[0].indexOf(t);return Rt[0].filter((function(t,n){return n<+e+2&&n>+e-2}))})),s=It[0].filter((function(t){return o.indexOf(t[t.length-1].node)>-1})).flatMap((function(t){return t.map((function(t){return t.node}))})),c=a.B("#sidebar").selectAll(".node"),u=a.B("#sidebar").selectAll(".link");c.filter((function(t){return l.indexOf(t.data.node)>-1})).classed("hover one",!0),c.filter((function(t){return i.indexOf(t.data.node)>-1})).classed("hover two",!0);u.filter((function(t){return l.indexOf(t.data.node)>-1})).classed("hover one",!0),u.filter((function(t){return i.indexOf(t.data.node)>-1})).classed("hover two",!0),c.filter((function(t){return s.indexOf(t.data.node)>-1})).classed("hover-neighbor",!0),c.filter((function(t){return-1===s.indexOf(t.data.node)&&-1===l.concat(i).indexOf(t.data.node)})).classed("hover-not",!0),u.filter((function(t){return s.indexOf(t.data.node)>-1})).classed("hover-neighbor",!0),u.filter((function(t){return-1===s.indexOf(t.data.node)&&-1===l.concat(i).indexOf(t.data.node)})).classed("hover-not",!0);l[l.length-1],i[i.length-1];return a.B(r[e]).selectAll(".pair-neighbor").attr("opacity",1),a.B(n).classed("hover",!0)})).on("mouseleave",(function(t,e,n){a.B(n[e]).selectAll(".pair-neighbor").attr("opacity",0);a.B("#sidebar").selectAll(".node").classed("hover",!1).classed("hover-neighbor",!1).classed("hover-not",!1).classed("two",!1).classed("one",!1),a.B("#sidebar").selectAll(".link").classed("hover",!1).classed("hover-neighbor",!1).classed("hover-not",!1).classed("two",!1).classed("one",!1);return a.B(n[e]).classed("hover",!1)})),f.append("g").classed("y-axis",!0).each((function(t,n,r){var l=t.p1[0].attributes[e].scales.yScale;a.B(r[n]).call(a.c(l).ticks(5))}));var k=f.append("g").attr("class","mouse-over-effects");k.append("path").attr("class","mouse-line").style("stroke","black").style("stroke-width","1px").style("opacity","0");var A=k.selectAll(".mouse-per-line").data((function(t,e){return[t.p1,t.p2]})).join("g").attr("class","mouse-per-line");A.append("circle").attr("r",7).style("stroke",(function(t){return"red"})).style("fill","none").style("stroke-width","1px").style("opacity","0"),A.append("text").attr("class","value").attr("transform","translate(10,3)"),A.append("text").attr("class","species").attr("transform","translate(10,3)"),k.append("svg:rect").attr("width",600).attr("height",100).attr("fill","none").attr("pointer-events","all").on("mouseout",(function(){a.C(".mouse-line").style("opacity","0"),a.C(".mouse-per-line circle").style("opacity","0"),a.C(".mouse-per-line text").style("opacity","0")})).on("mouseover",(function(t,e,n){a.B(n[e].parentNode).selectAll(".mouse-line").style("opacity","1"),a.B(n[e].parentNode).selectAll(".mouse-per-line circle").style("opacity","1"),a.B(n[e].parentNode).selectAll(".mouse-per-line text").style("opacity","1")})).on("mousemove",(function(t,n,r){var l=a.x(r[n]);a.B(r[n].parentNode).select(".mouse-line").attr("d",(function(){var t="M"+l[0]+",100";return t+=" "+l[0]+",0"})),a.B(r[n].parentNode).selectAll(".mouse-per-line").attr("transform",(function(o,s,c){for(var u=i.invert(l[0]),d=((0,a.d((function(t){return t.edgeLength})).right)(o.values,u),r[n].parentNode.parentNode.getElementsByClassName("inner-line")),f=0,p=d[s].getTotalLength(),h=null;;){h=Math.floor((f+p)/2);var g=d[s].getPointAtLength(h);if((h===p||h===f)&&g.x!==l[0])break;if(g.x>l[0])p=h;else{if(!(g.x<l[0]))break;f=h}}var m=t.p1[0].attributes[e].scales.yScale;return a.B(c[s]).select("text.value").text(m.invert(g.y).toFixed(2)).style("font-size",11).attr("y",(function(){return 0===s?10:-10})),a.B(c[s]).select("text.species").text(o[o.length-1].node).style("font-size",11).attr("y",(function(){return 0===s?19:-19})),"translate("+l[0]+","+g.y+")"}))}))}(d=d.filter((function(t,e){return e%2==0})),e)}function pt(t,e){var n=a.B("#main"),r=yt(),l=qt[0];n.selectAll("*").remove(),"Path View"===t||null===t?(a.B("#pair-rank").classed("hidden",!0),nt(r,n,l),document.getElementById("scrunch").disabled=!1):"Summary View"===t?(a.B("#pair-rank").classed("hidden",!0),document.getElementById("scrunch").disabled=!0,e?W(n,e):q(r,n,l,null)):"Pair View"===t?(function(t){var e=a.B("#pair-rank").classed("hidden",!1);e.selectAll("*").remove();var n=[1,1,1],r=e.append("svg").attr("width",800).attr("height",100).append("g").attr("transform","translate(10,10)");r.append("svg:image").attr("width",200).attr("height",140).attr("y",-50).attr("xlink:href","./public/mini-diagram.gif"),r.append("text").text("Distance").attr("font-size",10).attr("x",85).attr("y",60),r.append("text").text("Delta").attr("font-size",10).attr("x",66).attr("y",20),r.append("text").text("Closeness").attr("font-size",10).attr("x",195).attr("y",22),r.selectAll("text.labels").data(["Distance","Delta","Closeness"]).join("text").classed("labels",!0).text((function(t){return t})).attr("y",10).attr("x",(function(t,e){return 300+200*e})),n.forEach((function(e,l){var i=ct.a().min(0).max(1).step(.1).width(150).default(n[l]).displayValue(!1).fill("#7FB3D5").on("end",(function(e){n[l]=e,ft(c(t),a.B(".attr-drop.dropdown").select("button").attr("value"),n)}));r.append("g").attr("transform","translate(".concat(300+200*l,", 20)")).call(i)}))}(r),function(t){var e=c(t),n=[1,1,1],r=a.k(e[0].p1[0].attributes).filter((function(t){return"continuous"===t.value.type})).map((function(t){return{field:t.key,value:t.key}})),l=a.B(".attr-drop.dropdown").selectAll("a").empty()?y(a.B("#toolbar"),r,"Trait: ".concat(r[0].field),"attr-drop"):a.B(".attr-drop.dropdown").selectAll("a");a.B(".attr-drop.dropdown").select("button").attr("value",r[0].field),l.on("click",(function(e,r,l){ft(c(t),e.field,n),Ot(a.B("#sidebar"),null,!0,e.field),a.B(".attr-drop.dropdown").select("button").attr("value",e.field),a.B(".attr-drop.dropdown").select("button").text("Trait: ".concat(e.field)),a.B("#attr-drop").classed("show",!1)})),ft(dt(e),r[0].field,n)}(r)):"Clade View"===t?(a.B("#pair-rank").classed("hidden",!0),function(t,e){O.apply(this,arguments)}(n,l)):console.error("field not found")}function ht(t){return function(t){if(Array.isArray(t)){for(var e=0,n=new Array(t.length);e<t.length;e++)n[e]=t[e];return n}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var gt=[];function mt(t,e){var n=gt.filter((function(t){return"data-filter"===t.filterType})),r=n.map((function(t){return t.filterId})).indexOf(t);if(r!=n.length-1)for(var l=ht(0===r?It[0]:n[r-1].data),i=(a.B("#toolbar").selectAll(".filter-tag").remove(),r+1);i<n.length;i++){var o=n[i].filterFunction;if("continuous"===n[i].attributeType){var s=o(l,n[i].selectedOption,n[i].predictedFilter,n[i].observedFilter);n[i].data=ht(s),n[i].filterId="c-"+i,bt(n[i],e),l=s}else{var c=o(l,n[i].selectedOption,n[i].fromState,n[i].toState);n[i].data=ht(c),n[i].filterId="d-"+i,bt(n[i],e),l=c}}var u=gt.filter((function(e){return e.filterId!=t}));gt=u}function vt(t,e,n,a,r,l,i){var o={filterType:t,attributeType:e,filterId:n,filterFunction:a,"before-data":r,data:l};return null!=i&&i.forEach((function(t){o[t[0]]=t[1]})),gt.push(o),o}function yt(){return gt.length>0?gt[gt.length-1].data:It[0]}function bt(t,e){var n=a.B("#toolbar");if("continuous"===t.attributeType){var r=a.n(".2s"),l=n.append("button").classed("btn btn-info filter-tag",!0);a.B(l).datum(t),l.append("span").classed("badge badge-light",!0).text(t.data.length),l.append("h6").text(t.selectedOption+"  Predicted: "+r(t.predictedFilter[0])+"-"+r(t.predictedFilter[1])+" Observed: "+r(t.observedFilter[0])+"-"+r(t.observedFilter[1])).append("i").classed("close fas fa-times",!0).on("click",(function(){gt.filter((function(t){return"data-filter"===t.filterType})).filter((function(e){return t.attribute!=e.attribute}));mt(t.filterId,e),pt("Summary View"),a.C(".link-not-there").classed("link-not-there",!1),a.C(".node-not-there").classed("node-not-there",!1),l.remove()}))}else if("discrete"===t.attributeType){var i=n.append("button").classed("btn btn-info filter-tag",!0);i.append("span").classed("badge badge-light",!0).text(t.data.length),i.append("h6").text(t.state[0]),i.append("i").classed("fas fa-arrow-right",!0),i.append("h6").text(t.state[1]+"  "),i.append("i").classed("close fas fa-times",!0).on("click",(function(){mt(t.filterId,e),pt("Summary View"),a.C(".link-not-there").classed("link-not-there",!1),a.C(".node-not-there").classed("node-not-there",!1),i.remove()}))}else if("branch"===t.attributeType){var o=n.append("button").classed("btn btn-info filter-tag",!0);o.append("span").classed("badge badge-light",!0).text(t.data.length),o.append("h6").text(" At Branch: "+t.nodeId),o.append("i").classed("close fas fa-times",!0).on("click",(function(){mt(t.filterId,e),pt("Summary View"),a.C(".link-not-there").classed("link-not-there",!1),a.C(".node-not-there").classed("node-not-there",!1),o.remove()}))}}function xt(t,e){var n=yt(),r=(gt.filter((function(t){return"data-filter"===t.filterType})),n.filter((function(e){return e.map((function(t){return t.node})).indexOf(t)>-1})));bt(vt("data-filter","branch","b-"+gt.filter((function(t){return"branch"===t.attributeType})).length,xt,ht(n),ht(r),[["nodeId",t]]),e),pt("Summary View");var l=a.B("#sidebar").selectAll(".link"),i=a.B("#sidebar").selectAll(".node"),o=r.flatMap((function(t){return t.map((function(t){return t.node}))}));a.C(".link-not-there").classed("link-not-there",!1),a.C(".node-not-there").classed("node-not-there",!1),l.filter((function(t){return-1===o.indexOf(t.data.node)})).classed("link-not-there",!0),i.filter((function(t){return-1===o.indexOf(t.data.node)})).classed("node-not-there",!0)}function wt(t,e,n,a){return t.filter((function(t){return-1===t.map((function(t){var r=t.attributes[e].realVal;return 1==t.leaf?r>a[0]&&r<a[1]:r>n[0]&&r<n[1]})).indexOf(!1)}))}function Bt(t,e,n,a){if(null!=e)return t.filter((function(t){var r=t.filter((function(t){return 1!=t.leaf})).map((function(t){var a=t.attributes[e].states;return"Any"===n||a.filter((function(t){return t.state===n})).length>0&&a.filter((function(t){return t.state===n}))[0].realVal>.75})),l=t.filter((function(t){return!0===t.leaf})).map((function(t){var n=t.attributes[e].winState;return"Any"===a||n===a}));return r.indexOf(!0)>-1&&l.indexOf(!0)>-1}))}function kt(t,e,n,r){var l=t.append("div").classed("selector",!0);l.append("h6").text(r);return l.append("select").attr("id",n).attr("class","Any").selectAll("option").data(e).join("option").text((function(t){return t})).attr("value",(function(t){return t})),a.B("#"+n).on("change",(function(t){var e=a.B(this).property("value");a.B(this).attr("class",e)})),a.B("#"+n)}function At(t,e){return function t(e,n){return e.children=n.filter((function(t){return String(t.V1)===String(e.node)})),e.name=String(e.node),e.children.length>0?(e.children.forEach((function(e){return t(e,n)})),e):e}(t[0][0],e)}function Ct(t,e,n){var r=(n=n.append("div").classed("button-wrap",!0)).append("button").text("Hide Lengths").attr("id","length").classed("btn btn-outline-secondary",!0);r.on("click",(function(){n.select("svg").remove(),"Show Lengths"===r.text()?(Ot(n,null,!0,!1),r.text("Hide Lengths")):(Ot(n,null,!1,!1),r.text("Show Lengths"))})),r.style("opacity",0).style("width",0).style("padding",0).style("margin",0);var l=[{field:"None"}];e.map((function(t){return l.push(t)})),y(n,l,"Color By Value","show-drop-div-sidebar").on("click",(function(t,e,r){"discrete"===t.type?(Ot(n,t,!0,!1),a.B(".dropdown.show-drop-div-sidebar").select("button").text("Colored by ".concat(t.field))):"continuous"===t.type?(Ot(n,t,!0,!1),a.B(".dropdown.show-drop-div-sidebar").select("button").text("Colored by ".concat(t.field))):(Ot(n,null,!1,!1),a.B(".dropdown.show-drop-div-sidebar").select("button").text("Color By Value")),n.select("#show-drop-div-sidebar").classed("show",!1)}));var i=[{field:"None"}];e.filter((function(t){return"discrete"!=t.type})).map((function(t){return i.push(t)}));var o=a.B("#sidebar").select(".button-wrap").append("button").text("View Phenogram");o.classed("btn btn-outline-secondary",!0),o.on("click",(function(){if("View Phenogram"===o.text()){if(a.B(".attr-drop.dropdown").select("button").empty()){var e=y(a.B("#toolbar"),i,"Trait: ".concat(i[1].field),"attr-drop");a.B(".attr-drop.dropdown").select("button").attr("value",i[1].field),a.B(".dropdown.show-drop-div-sidebar").select("button").text("Color By Value"),e.on("click",(function(e,n,r){"View Pairs"===a.B(".dropdown.change-view").select("button").node().value&&ft(c(t),e.field),Ot(a.B("#sidebar"),null,!0,e.field),a.B(".attr-drop.dropdown").select("button").text("Trait: ".concat(e.field)),a.B(".attr-drop.dropdown").select("button").attr("value"),a.B(".attr-drop.dropdown").select("button").attr("value",e.field),a.B("#attr-drop").classed("show",!1)})),Ot(a.B("#sidebar"),null,!0,a.B(".attr-drop.dropdown").select("button").attr("value"))}else Ot(a.B("#sidebar"),null,!0,a.B(".attr-drop.dropdown").select("button").attr("value"));o.text("View Phylogeny")}else Ot(a.B("#sidebar"),null,!1,!1),o.text("View Phenogram")}))}function Vt(t){t.children&&(t._children=t.children,t._children.forEach(Vt),t.children=null)}function St(t,e){if(void 0===t.children||null===t.children)return e+=1.5,t.position=e,e;var n=[];return t.children.forEach((function(t){e=St(t,e),n.push(e)})),t.options=n,t.position=a.t(n),e}function jt(t,e){e.combEdge=e.edgeLength+t,e.children&&e.children.forEach((function(t){jt(e.combEdge,t)}))}function Ot(t,e,n,r){var l={margin:{top:10,right:90,bottom:50,left:20},width:260,height:520,lengthHeight:800},i=a.G().size([l.height,l.width]);jt(0,Tt[0]);var o=a.o(Tt[0]);o=i(o);var s=a.B("#show-drop-div-group").attr("value"),c="Hide Lengths"===a.B("button#length").text(),u=t.select("svg"),d=u.empty()?t.append("svg"):u;d.classed("tree-svg",!0),d.attr("width",l.width+l.margin.left+l.margin.right).attr("height",l.height+l.margin.top+l.margin.bottom);var f=d.select("g.tree-g"),p=f.empty()?d.append("g").classed("tree-g",!0):f;(p.attr("transform","translate("+l.margin.left+","+l.margin.top+")"),"ungrouped"===s&&!1===n)?w.length>0&&"Clade Attribute)"!=B[B.length-1].field?Dt(function(t){return e(t,[]),function t(n){var a=e(n,[]);var r=new Set(a.map((function(t){return t.data.attributes.Clade.values.Clade})));if(!(r.size>1))return n.branchPoint=!0,n.clade=Array.from(r)[0],Vt(n),n;n.children.map((function(e){return t(e)}));return n}(t);function e(t,n){return null!=t.children?t.children.map((function(t){return e(t,n)})):n.push(t),n}}(o),l,d,p,e,c,n):Dt(o,l,d,p,e,c,r,n):Dt(o,l,d,p,e,c,r,n)}function Dt(t,e,n,r,l,i,o,c){a.B(".pheno-y-axis").remove(),a.B(".pheno-x-axis").remove(),St(t,0);var u=function(t,e){return function t(n){null!=n.children?n.children.forEach((function(e){t(e)})):e.push(n)}(t),e}(t,[]),d=a.y().domain([0,s[0]]).range([0,e.width]).clamp(!0),f=a.y().range([e.height,0]).domain([0,1]);i&&(r.attr("transform","translate(20, 265)"),n.attr("height",800),f.range([500,0]).domain([0,u.length]),d.range([0,e.width+10])),o&&(n.attr("height",800),d.domain(t.data.attributes[o].scales.yScale.domain()),f.domain([0,s[0]]).range([0,500]));var p=r.selectAll(".link").data(t.descendants().slice(1)).join("path").attr("class","link");if(p.transition().duration(500).attr("d",(function(t){return i&&void 0===o||i&&!1===o?"M"+d(t.data.combEdge)+","+f(t.position)+"C"+(d(t.data.combEdge)+d(t.parent.data.combEdge))/2+","+f(t.position)+" "+d(t.parent.data.combEdge)+","+f(t.position)+" "+d(t.parent.data.combEdge)+","+f(t.parent.position):"M"+d(t.data.attributes[o].values.realVal)+","+f(t.data.combEdge)+" "+d(t.parent.data.attributes[o].values.realVal)+","+f(t.parent.data.combEdge)})),o){p.style("opacity",.3),r.attr("transform","translate(30, 50)");var h=d.domain(t.data.attributes[o].scales.yScale.domain()).range([0,e.width+20]),g=a.b(h);r.append("g").classed("pheno-x-axis",!0).call(g).attr("transform","translate(0, 510)").select("path").attr("stroke-width",0);var m=a.y().domain([0,s[0]]).range([0,e.height-20]),v=a.c(m);r.append("g").classed("pheno-y-axis",!0).call(v).attr("transform","translate(0, 2)").select("path").attr("stroke-width",0)}var y=r.selectAll(".node").data(t.descendants(),(function(t){return t.data.node})).join("g").attr("class",(function(t){return"node"+(t.children?" node--internal":" node--leaf")}));if(y.selectAll("circle").data((function(t){return[t]})).join("circle").attr("r",3),y.transition().duration(500).attr("transform",(function(t){return i&&void 0===o||!1===o?"translate("+d(t.data.combEdge)+","+f(t.position)+")":"translate("+(d(t.data.attributes[o].values.realVal)-5)+","+f(t.data.combEdge)+")"})),null!=l){var b=y.filter((function(t){return!0===t.data.leaf})),x=y.filter((function(t){return 1!=t.data.leaf}));if("discrete"===l.type)l.stateColors.forEach((function(t){b.filter((function(e){return t.state.includes(e.data.attributes[l.field].states.state)})).select("circle").attr("fill",t.color),x.selectAll("circle").attr("fill","gray")}));else{var w=l.yScale;w.range(["#fff","#E74C3C"]),b.select("circle").attr("fill",(function(t,e){return w(t.data.attributes[l.field].values.realVal)}))}}else y.selectAll("circle").attr("fill","gray");y.on("mouseover",(function(t,e,n){var r=a.B("#main-path-view").selectAll(".paths");if(a.B("#main-summary-view").selectAll(".branch-points").filter((function(e){return e.node===t.data.node})).classed("selected",!0),r.filter((function(e){return e.map((function(t){return t.node})).indexOf(t.data.node)>-1})).classed("hover",!0).selectAll("g").filter((function(e){return e.node===t.data.node})).classed("selected",!0),a.B(n[e]).classed("selected-branch",!0),t.data.label){var l=a.B("#tooltip");l.transition().duration(200).style("opacity",.9),l.html("".concat(t.data.label.charAt(0).toUpperCase()+t.data.label.slice(1))).style("left",a.l.pageX-40+"px").style("top",a.l.pageY-28+"px"),l.style("height","auto")}})).on("mouseout",(function(t,e,n){a.C(".paths.hover").classed("hover",!1),a.C("g.selected").classed("selected",!1),a.B(n[e]).classed("selected-branch",!1),a.B("#tooltip").transition().duration(500).style("opacity",0)}));y.filter((function(t){return 0==t.data.children.length}));y.selectAll("text").remove(),y.selectAll(".triangle").remove();var B=y.filter((function(t){return!0===t.branchPoint}));return B.each((function(t,e,n){if(null===t.children){var r=a.B(n[e]).append("path").classed("triangle",!0).attr("d",a.E().type(a.F).size("400"));r.attr("transform","rotate(-90) translate(0, 65) scale(.9 4)"),r.attr("fill","gray").style("opacity",.3),a.B(n[e]).selectAll("text").data((function(t){return[t]})).join("text").text(t.clade).attr("transform","translate(55, 5)")}})),B.select("circle").attr("fill","red").attr("r",4.5),B.on("click",(function(i,o,s){null==i.children?function t(e){e.children=e._children,e._children=null,e.children&&e.children.map((function(e){return t(e)}))}(i):Vt(i);var u="Hide Lengths"===a.B("button#length").text();Dt(t,e,n,r,l,u,c)})),y.raise(),y.selectAll("circle").raise(),y}function Mt(t,e,n,a,r,l,i){try{var o=t[l](i),s=o.value}catch(t){return void n(t)}o.done?e(s):Promise.resolve(s).then(a,r)}function Lt(t){return function(){var e=this,n=arguments;return new Promise((function(a,r){var l=t.apply(e,n);function i(t){Mt(l,a,r,i,o,"next",t)}function o(t){Mt(l,a,r,i,o,"throw",t)}i(void 0)}))}}n.d(e,"dataMaster",(function(){return It})),n.d(e,"savedSelected",(function(){return Et})),n.d(e,"collapsed",(function(){return zt})),n.d(e,"nestedData",(function(){return Tt})),n.d(e,"speciesTest",(function(){return Rt})),n.d(e,"calculatedScalesKeeper",(function(){return qt})),n.d(e,"colorKeeper",(function(){return Nt})),n.d(e,"attributeList",(function(){return Ft}));var It=[],Et=[],zt=!1,Tt=[],Rt=[],qt=[],Nt=[["#0dc1d1","#c8f7fd"],["#3AD701","#2a9b01"],["#fec303","#d3a001"],["#fe4ecb","#d30197"],["#f36b2c"],["#1abc9c"],["#493267"],["#a40b0b"],["#0095b6"],["#97A628"],["#9B28A6"],["#3928A6"],["#0dc1d1","#c8f7fd"],["#3AD701","#2a9b01"],["#fec303","#d3a001"],["#fe4ecb","#d30197"],["#f36b2c"],["#1abc9c"],["#493267"],["#a40b0b"],["#0095b6"],["#97A628"],["#9B28A6"],["#3928A6"]],Ft=[],Wt=["Clade","Group","island/mainland"],Pt=a.B("#wrapper"),Kt=Pt.select("#main");Pt.select("#selected").classed("hidden",!0);var Ht=Pt.select("#sidebar"),Yt=Pt.select("#toolbar");Pt.select("#filter-tab").classed("hidden",!0);Pt.append("div").attr("id","tooltip").style("opacity",0);function Xt(){return(Xt=Lt(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:_t("anolis-edges.json","anolis-edge-lengths.json","anolis-leaf-data.csv","anolis-res.json").then((function(t){var e,n,r;ut(Yt,Kt,t[1]),Ct(t[0],t[1],Ht),Ot(Ht,null,!0,!1),e=t[1],n=a.B("#main"),r=yt(),console.log("data",r),n.selectAll("*").remove(),r.length>50?(q(r,n,e,"Clade"),a.B("#view-toggle").text("View Paths"),document.getElementById("scrunch").disabled=!0):(nt(r,n,e),a.B("#view-toggle").text("View Summary"),document.getElementById("scrunch").disabled=!1)}));case 1:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function _t(t,e,n,a){return Gt.apply(this,arguments)}function Gt(){return(Gt=Lt(regeneratorRuntime.mark((function t(e,n,r,i){var o,s,c,d,h,g,v,y,b,x,C,V,S,j,O,D,M,L,I;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Array.prototype.unique=function(){return this.filter((function(t,e,n){return n.indexOf(t)===e}))},t.next=3,l(a.q,"./public/data/".concat(e),"edge");case 3:return o=t.sent,t.next=6,l(a.f,"./public/data/".concat(r),"");case 6:return s=t.sent,t.next=9,l(a.q,"./public/data/".concat(n),"edge");case 9:return c=t.sent,t.next=12,l(a.q,"./public/data/".concat(i),"");case 12:return d=t.sent,s.columns.filter((function(t){return"species"!=t})).forEach((function(t,e){Wt.indexOf(t)>-1?Ft.push({field:t,type:"discrete"}):Ft.push({field:t,type:"continuous"})})),o.rows=o.rows.filter((function(t){return""!=t.From})).map((function(t,e){return t.edgeLength=c.rows[e].x,t})),h=o.rows.map((function(t){return t.From})),g=o.rows.filter((function(t){return-1==h.indexOf(t.To)})),v=d.rows.map((function(t,e){var n={};return Ft.forEach((function(e){n[e.field]={},n[e.field].field=e.field,n[e.field].type=e.type;var r={};a.k(t).filter((function(t){return t.key.includes(e.field)})).map((function(t){"continuous"===e.type?t.key.includes("upperCI")?r.upperCI95=t.value:t.key.includes("lowerCI")?r.lowerCI95=t.value:r.realVal=t.value:r[t.key]=t.value})),n[e.field].values=r})),n.node=t.nodeLabels,n})),y=u(v,Ft.map((function(t){return t.field})),Nt),b=o.rows.map((function(t,e){var n=v.filter((function(e){return e.node===t.To}))[0];return n&&Object.keys(n).filter((function(t){return"node"!=t})).map((function(t,e){var a=y.filter((function(e){return e.field===t}))[0];return n[t].scales=a,t})),{V1:t.From,V2:t.To,node:t.To,edgeLength:t.edgeLength,attributes:n||null}})),x=s.map((function(t,e){var n={};return Ft.forEach((function(e){n[e.field]={},n[e.field].field=e.field,n[e.field].type=e.type;var r={};a.k(t).filter((function(t){return t.key.includes(e.field)})).map((function(t){"continuous"===e.type?r.realVal=t.value:r[t.key]=t.value})),n[e.field].values=r})),n.node=t.species,n.label=t.species,n})),C=g.map((function(t,e){var n=x.filter((function(e){return e.node===t.To}))[0];return n&&Object.keys(n).map((function(t,e){if("node"!=t&&"label"!=t){var a=y.filter((function(e){return e.field===t}))[0];return n[t].scales=a,t}})),{V1:t.From,V2:t.To,node:t.To,edgeLength:t.edgeLength,attributes:n||null,group:null,leaf:!0}})),V=b.filter((function(t){return null!=t.attributes})),S=m(V,C,"V1","V2"),j=f(S,v,y),O=p(j),0===w.length&&(y.map((function(t){return t.field})).indexOf("Clade")>-1?(D=A(y,O,"Clade"),M=k("Clade Attribute",D.map((function(t){return t.label})),D),B.push(M)):(L=N(O,"ungrouped",y,8),I=k("Ungrouped",["Whole Set"],[{label:"Ungrouped",paths:O,groupBins:L}]),B.push(I))),qt.push(y),It.push(O),Tt.push(At(O,V.concat(C))),Rt.push(O.flatMap((function(t){return t.filter((function(t){return!0===t.leaf}))})).map((function(t){return t.node}))),t.abrupt("return",[O,y]);case 32:case"end":return t.stop()}}),t)})))).apply(this,arguments)}!function(){Xt.apply(this,arguments)}()},48:function(t,e,n){}});
//# sourceMappingURL=app.9dad3106.js.map